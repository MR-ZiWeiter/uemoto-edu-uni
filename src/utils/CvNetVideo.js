(function(e){if(typeof exports==="object"&&typeof module!=="undefined"){module.exports=e()}else if(typeof define==="function"&&define.amd){define([],e)}else{var t;if(typeof window!=="undefined"){t=window}else if(typeof global!=="undefined"){t=global}else if(typeof self!=="undefined"){t=self}else{t=this}t.CvNetVideo=e()}})(function(){var n,e,t;return function(){function l(s,a,o){function c(i,e){if(!a[i]){if(!s[i]){var t="function"==typeof require&&require;if(!e&&t)return t(i,!0);if(d)return d(i,!0);var r=new Error("Cannot find module '"+i+"'");throw r.code="MODULE_NOT_FOUND",r}var n=a[i]={exports:{}};s[i][0].call(n.exports,function(e){var t=s[i][1][e];return c(t||e)},n,n.exports,l,s,a,o)}return a[i].exports}for(var d="function"==typeof require&&require,e=0;e<o.length;e++)c(o[e]);return c}return l}()({1:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:true});var r=function(){function r(e,t){for(var i=0;i<t.length;i++){var r=t[i];r.enumerable=r.enumerable||false;r.configurable=true;if("value"in r)r.writable=true;Object.defineProperty(e,r.key,r)}}return function(e,t,i){if(t)r(e.prototype,t);if(i)r(e,i);return e}}();function n(e,t){if(!(e instanceof t)){throw new TypeError("Cannot call a class as a function")}}var s=function(){function i(e,t){n(this,i)}r(i,[{key:"StartRealTimeVideo",value:function e(t,i){var r=arguments.length>2&&arguments[2]!==undefined?arguments[2]:1;return-1}},{key:"StartBackTimeVideo",value:function e(t,i,r,n){var s=arguments.length>4&&arguments[4]!==undefined?arguments[4]:1;return-1}},{key:"StopVideo",value:function e(){}},{key:"onMediaWaiting",value:function e(){}},{key:"SetRtvsAddr",value:function e(t){}},{key:"onHlsInfo",value:function e(t){}},{key:"onMediaError",value:function e(){}},{key:"onWebrtcSFUInfo",value:function e(t){}},{key:"onBufferAppending",value:function e(t){}},{key:"onBufferReset",value:function e(t){}}]);return i}();i.default=s},{}],2:[function(e,t,i){"use strict";var s=this&&this.__awaiter||function(e,a,i,o){function c(t){return t instanceof i?t:new i(function(e){e(t)})}return new(i||(i=Promise))(function(t,i){function r(e){try{s(o.next(e))}catch(e){i(e)}}function n(e){try{s(o["throw"](e))}catch(e){i(e)}}function s(e){e.done?t(e.value):c(e.value).then(r,n)}s((o=o.apply(e,a||[])).next())})};Object.defineProperty(i,"__esModule",{value:true});class r{constructor({ClosedErrorClass:e=Error,StoppedErrorClass:t=Error}={ClosedErrorClass:Error,StoppedErrorClass:Error}){this.closed=false;this.pendingTasks=[];this.ClosedErrorClass=Error;this.StoppedErrorClass=Error;this.ClosedErrorClass=e;this.StoppedErrorClass=t}get size(){return this.pendingTasks.length}close(){if(this.closed)return;this.closed=true;for(const e of this.pendingTasks){e.stopped=true;e.reject(new this.ClosedErrorClass("AwaitQueue closed"))}this.pendingTasks.length=0}push(r,n){return s(this,void 0,void 0,function*(){if(this.closed)throw new this.ClosedErrorClass("AwaitQueue closed");if(typeof r!=="function")throw new TypeError("given task is not a function");if(!r.name&&n){try{Object.defineProperty(r,"name",{value:n})}catch(e){}}return new Promise((e,t)=>{const i={task:r,name:n,resolve:e,reject:t,stopped:false,enqueuedAt:new Date,executedAt:undefined};this.pendingTasks.push(i);if(this.pendingTasks.length===1)this.next()})})}stop(){if(this.closed)return;for(const e of this.pendingTasks){e.stopped=true;e.reject(new this.StoppedErrorClass("AwaitQueue stopped"))}this.pendingTasks.length=0}dump(){const t=new Date;return this.pendingTasks.map(e=>{return{task:e.task,name:e.name,enqueuedTime:e.executedAt?e.executedAt.getTime()-e.enqueuedAt.getTime():t.getTime()-e.enqueuedAt.getTime(),executingTime:e.executedAt?t.getTime()-e.executedAt.getTime():0}})}next(){return s(this,void 0,void 0,function*(){const e=this.pendingTasks[0];if(!e)return;yield this.executeTask(e);this.pendingTasks.shift();this.next()})}executeTask(t){return s(this,void 0,void 0,function*(){if(t.stopped)return;t.executedAt=new Date;try{const e=yield t.task();if(t.stopped)return;t.resolve(e)}catch(e){if(t.stopped)return;t.reject(e)}})}}i.AwaitQueue=r},{}],3:[function(e,i,r){!function(e,t){"object"==typeof r&&"object"==typeof i?i.exports=t():"function"==typeof n&&n.amd?n([],t):"object"==typeof r?r.bowser=t():e.bowser=t()}(this,function(){return function(i){var r={};function n(e){if(r[e])return r[e].exports;var t=r[e]={i:e,l:!1,exports:{}};return i[e].call(t.exports,t,t.exports,n),t.l=!0,t.exports}return n.m=i,n.c=r,n.d=function(e,t,i){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:i})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(t,e){if(1&e&&(t=n(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var i=Object.create(null);if(n.r(i),Object.defineProperty(i,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var r in t)n.d(i,r,function(e){return t[e]}.bind(null,r));return i},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=90)}({17:function(e,t,i){"use strict";t.__esModule=!0,t.default=void 0;var r=i(18),n=function(){function c(){}return c.getFirstMatch=function(e,t){var i=t.match(e);return i&&i.length>0&&i[1]||""},c.getSecondMatch=function(e,t){var i=t.match(e);return i&&i.length>1&&i[2]||""},c.matchAndReturnConst=function(e,t,i){if(e.test(t))return i},c.getWindowsVersionName=function(e){switch(e){case"NT":return"NT";case"XP":return"XP";case"NT 5.0":return"2000";case"NT 5.1":return"XP";case"NT 5.2":return"2003";case"NT 6.0":return"Vista";case"NT 6.1":return"7";case"NT 6.2":return"8";case"NT 6.3":return"8.1";case"NT 10.0":return"10";default:return}},c.getMacOSVersionName=function(e){var t=e.split(".").splice(0,2).map(function(e){return parseInt(e,10)||0});if(t.push(0),10===t[0])switch(t[1]){case 5:return"Leopard";case 6:return"Snow Leopard";case 7:return"Lion";case 8:return"Mountain Lion";case 9:return"Mavericks";case 10:return"Yosemite";case 11:return"El Capitan";case 12:return"Sierra";case 13:return"High Sierra";case 14:return"Mojave";case 15:return"Catalina";default:return}},c.getAndroidVersionName=function(e){var t=e.split(".").splice(0,2).map(function(e){return parseInt(e,10)||0});if(t.push(0),!(1===t[0]&&t[1]<5))return 1===t[0]&&t[1]<6?"Cupcake":1===t[0]&&t[1]>=6?"Donut":2===t[0]&&t[1]<2?"Eclair":2===t[0]&&2===t[1]?"Froyo":2===t[0]&&t[1]>2?"Gingerbread":3===t[0]?"Honeycomb":4===t[0]&&t[1]<1?"Ice Cream Sandwich":4===t[0]&&t[1]<4?"Jelly Bean":4===t[0]&&t[1]>=4?"KitKat":5===t[0]?"Lollipop":6===t[0]?"Marshmallow":7===t[0]?"Nougat":8===t[0]?"Oreo":9===t[0]?"Pie":void 0},c.getVersionPrecision=function(e){return e.split(".").length},c.compareVersions=function(e,t,i){void 0===i&&(i=!1);var r=c.getVersionPrecision(e),n=c.getVersionPrecision(t),s=Math.max(r,n),a=0,o=c.map([e,t],function(e){var t=s-c.getVersionPrecision(e),i=e+new Array(t+1).join(".0");return c.map(i.split("."),function(e){return new Array(20-e.length).join("0")+e}).reverse()});for(i&&(a=s-Math.min(r,n)),s-=1;s>=a;){if(o[0][s]>o[1][s])return 1;if(o[0][s]===o[1][s]){if(s===a)return 0;s-=1}else if(o[0][s]<o[1][s])return-1}},c.map=function(e,t){var i,r=[];if(Array.prototype.map)return Array.prototype.map.call(e,t);for(i=0;i<e.length;i+=1)r.push(t(e[i]));return r},c.find=function(e,t){var i,r;if(Array.prototype.find)return Array.prototype.find.call(e,t);for(i=0,r=e.length;i<r;i+=1){var n=e[i];if(t(n,i))return n}},c.assign=function(e){for(var i,t,r=e,n=arguments.length,s=new Array(n>1?n-1:0),a=1;a<n;a++)s[a-1]=arguments[a];if(Object.assign)return Object.assign.apply(Object,[e].concat(s));var o=function(){var t=s[i];"object"==typeof t&&null!==t&&Object.keys(t).forEach(function(e){r[e]=t[e]})};for(i=0,t=s.length;i<t;i+=1)o();return e},c.getBrowserAlias=function(e){return r.BROWSER_ALIASES_MAP[e]},c.getBrowserTypeByAlias=function(e){return r.BROWSER_MAP[e]||""},c}();t.default=n,e.exports=t.default},18:function(e,t,i){"use strict";t.__esModule=!0,t.ENGINE_MAP=t.OS_MAP=t.PLATFORMS_MAP=t.BROWSER_MAP=t.BROWSER_ALIASES_MAP=void 0;t.BROWSER_ALIASES_MAP={"Amazon Silk":"amazon_silk","Android Browser":"android",Bada:"bada",BlackBerry:"blackberry",Chrome:"chrome",Chromium:"chromium",Electron:"electron",Epiphany:"epiphany",Firefox:"firefox",Focus:"focus",Generic:"generic","Google Search":"google_search",Googlebot:"googlebot","Internet Explorer":"ie","K-Meleon":"k_meleon",Maxthon:"maxthon","Microsoft Edge":"edge","MZ Browser":"mz","NAVER Whale Browser":"naver",Opera:"opera","Opera Coast":"opera_coast",PhantomJS:"phantomjs",Puffin:"puffin",QupZilla:"qupzilla",QQ:"qq",QQLite:"qqlite",Safari:"safari",Sailfish:"sailfish","Samsung Internet for Android":"samsung_internet",SeaMonkey:"seamonkey",Sleipnir:"sleipnir",Swing:"swing",Tizen:"tizen","UC Browser":"uc",Vivaldi:"vivaldi","WebOS Browser":"webos",WeChat:"wechat","Yandex Browser":"yandex",Roku:"roku"};t.BROWSER_MAP={amazon_silk:"Amazon Silk",android:"Android Browser",bada:"Bada",blackberry:"BlackBerry",chrome:"Chrome",chromium:"Chromium",electron:"Electron",epiphany:"Epiphany",firefox:"Firefox",focus:"Focus",generic:"Generic",googlebot:"Googlebot",google_search:"Google Search",ie:"Internet Explorer",k_meleon:"K-Meleon",maxthon:"Maxthon",edge:"Microsoft Edge",mz:"MZ Browser",naver:"NAVER Whale Browser",opera:"Opera",opera_coast:"Opera Coast",phantomjs:"PhantomJS",puffin:"Puffin",qupzilla:"QupZilla",qq:"QQ Browser",qqlite:"QQ Browser Lite",safari:"Safari",sailfish:"Sailfish",samsung_internet:"Samsung Internet for Android",seamonkey:"SeaMonkey",sleipnir:"Sleipnir",swing:"Swing",tizen:"Tizen",uc:"UC Browser",vivaldi:"Vivaldi",webos:"WebOS Browser",wechat:"WeChat",yandex:"Yandex Browser"};t.PLATFORMS_MAP={tablet:"tablet",mobile:"mobile",desktop:"desktop",tv:"tv"};t.OS_MAP={WindowsPhone:"Windows Phone",Windows:"Windows",MacOS:"macOS",iOS:"iOS",Android:"Android",WebOS:"WebOS",BlackBerry:"BlackBerry",Bada:"Bada",Tizen:"Tizen",Linux:"Linux",ChromeOS:"Chrome OS",PlayStation4:"PlayStation 4",Roku:"Roku"};t.ENGINE_MAP={EdgeHTML:"EdgeHTML",Blink:"Blink",Trident:"Trident",Presto:"Presto",Gecko:"Gecko",WebKit:"WebKit"}},90:function(e,t,i){"use strict";t.__esModule=!0,t.default=void 0;var r,n=(r=i(91))&&r.__esModule?r:{default:r},s=i(18);function a(e,t){for(var i=0;i<t.length;i++){var r=t[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var o=function(){function e(){}var t,i,r;return e.getParser=function(e,t){if(void 0===t&&(t=!1),"string"!=typeof e)throw new Error("UserAgent should be a string");return new n.default(e,t)},e.parse=function(e){return new n.default(e).getResult()},t=e,r=[{key:"BROWSER_MAP",get:function(){return s.BROWSER_MAP}},{key:"ENGINE_MAP",get:function(){return s.ENGINE_MAP}},{key:"OS_MAP",get:function(){return s.OS_MAP}},{key:"PLATFORMS_MAP",get:function(){return s.PLATFORMS_MAP}}],(i=null)&&a(t.prototype,i),r&&a(t,r),e}();t.default=o,e.exports=t.default},91:function(e,t,i){"use strict";t.__esModule=!0,t.default=void 0;var r=o(i(92)),n=o(i(93)),s=o(i(94)),a=o(i(95)),f=o(i(17));function o(e){return e&&e.__esModule?e:{default:e}}var c=function(){function e(e,t){if(void 0===t&&(t=!1),null==e||""===e)throw new Error("UserAgent parameter can't be empty");this._ua=e,this.parsedResult={},!0!==t&&this.parse()}var t=e.prototype;return t.getUA=function(){return this._ua},t.test=function(e){return e.test(this._ua)},t.parseBrowser=function(){var t=this;this.parsedResult.browser={};var e=f.default.find(r.default,function(e){if("function"==typeof e.test)return e.test(t);if(e.test instanceof Array)return e.test.some(function(e){return t.test(e)});throw new Error("Browser's test function is not valid")});return e&&(this.parsedResult.browser=e.describe(this.getUA())),this.parsedResult.browser},t.getBrowser=function(){return this.parsedResult.browser?this.parsedResult.browser:this.parseBrowser()},t.getBrowserName=function(e){return e?String(this.getBrowser().name).toLowerCase()||"":this.getBrowser().name||""},t.getBrowserVersion=function(){return this.getBrowser().version},t.getOS=function(){return this.parsedResult.os?this.parsedResult.os:this.parseOS()},t.parseOS=function(){var t=this;this.parsedResult.os={};var e=f.default.find(n.default,function(e){if("function"==typeof e.test)return e.test(t);if(e.test instanceof Array)return e.test.some(function(e){return t.test(e)});throw new Error("Browser's test function is not valid")});return e&&(this.parsedResult.os=e.describe(this.getUA())),this.parsedResult.os},t.getOSName=function(e){var t=this.getOS().name;return e?String(t).toLowerCase()||"":t||""},t.getOSVersion=function(){return this.getOS().version},t.getPlatform=function(){return this.parsedResult.platform?this.parsedResult.platform:this.parsePlatform()},t.getPlatformType=function(e){void 0===e&&(e=!1);var t=this.getPlatform().type;return e?String(t).toLowerCase()||"":t||""},t.parsePlatform=function(){var t=this;this.parsedResult.platform={};var e=f.default.find(s.default,function(e){if("function"==typeof e.test)return e.test(t);if(e.test instanceof Array)return e.test.some(function(e){return t.test(e)});throw new Error("Browser's test function is not valid")});return e&&(this.parsedResult.platform=e.describe(this.getUA())),this.parsedResult.platform},t.getEngine=function(){return this.parsedResult.engine?this.parsedResult.engine:this.parseEngine()},t.getEngineName=function(e){return e?String(this.getEngine().name).toLowerCase()||"":this.getEngine().name||""},t.parseEngine=function(){var t=this;this.parsedResult.engine={};var e=f.default.find(a.default,function(e){if("function"==typeof e.test)return e.test(t);if(e.test instanceof Array)return e.test.some(function(e){return t.test(e)});throw new Error("Browser's test function is not valid")});return e&&(this.parsedResult.engine=e.describe(this.getUA())),this.parsedResult.engine},t.parse=function(){return this.parseBrowser(),this.parseOS(),this.parsePlatform(),this.parseEngine(),this},t.getResult=function(){return f.default.assign({},this.parsedResult)},t.satisfies=function(i){var t=this,r={},n=0,s={},a=0;if(Object.keys(i).forEach(function(e){var t=i[e];"string"==typeof t?(s[e]=t,a+=1):"object"==typeof t&&(r[e]=t,n+=1)}),n>0){var e=Object.keys(r),o=f.default.find(e,function(e){return t.isOS(e)});if(o){var c=this.satisfies(r[o]);if(void 0!==c)return c}var d=f.default.find(e,function(e){return t.isPlatform(e)});if(d){var l=this.satisfies(r[d]);if(void 0!==l)return l}}if(a>0){var u=Object.keys(s),h=f.default.find(u,function(e){return t.isBrowser(e,!0)});if(void 0!==h)return this.compareVersion(s[h])}},t.isBrowser=function(e,t){void 0===t&&(t=!1);var i=this.getBrowserName().toLowerCase(),r=e.toLowerCase(),n=f.default.getBrowserTypeByAlias(r);return t&&n&&(r=n.toLowerCase()),r===i},t.compareVersion=function(e){var t=[0],i=e,r=!1,n=this.getBrowserVersion();if("string"==typeof n)return">"===e[0]||"<"===e[0]?(i=e.substr(1),"="===e[1]?(r=!0,i=e.substr(2)):t=[],">"===e[0]?t.push(1):t.push(-1)):"="===e[0]?i=e.substr(1):"~"===e[0]&&(r=!0,i=e.substr(1)),t.indexOf(f.default.compareVersions(n,i,r))>-1},t.isOS=function(e){return this.getOSName(!0)===String(e).toLowerCase()},t.isPlatform=function(e){return this.getPlatformType(!0)===String(e).toLowerCase()},t.isEngine=function(e){return this.getEngineName(!0)===String(e).toLowerCase()},t.is=function(e,t){return void 0===t&&(t=!1),this.isBrowser(e,t)||this.isOS(e)||this.isPlatform(e)},t.some=function(e){var t=this;return void 0===e&&(e=[]),e.some(function(e){return t.is(e)})},e}();t.default=c,e.exports=t.default},92:function(e,t,i){"use strict";t.__esModule=!0,t.default=void 0;var r,n=(r=i(17))&&r.__esModule?r:{default:r};var s=/version\/(\d+(\.?_?\d+)+)/i,a=[{test:[/googlebot/i],describe:function(e){var t={name:"Googlebot"},i=n.default.getFirstMatch(/googlebot\/(\d+(\.\d+))/i,e)||n.default.getFirstMatch(s,e);return i&&(t.version=i),t}},{test:[/opera/i],describe:function(e){var t={name:"Opera"},i=n.default.getFirstMatch(s,e)||n.default.getFirstMatch(/(?:opera)[\s/](\d+(\.?_?\d+)+)/i,e);return i&&(t.version=i),t}},{test:[/opr\/|opios/i],describe:function(e){var t={name:"Opera"},i=n.default.getFirstMatch(/(?:opr|opios)[\s/](\S+)/i,e)||n.default.getFirstMatch(s,e);return i&&(t.version=i),t}},{test:[/SamsungBrowser/i],describe:function(e){var t={name:"Samsung Internet for Android"},i=n.default.getFirstMatch(s,e)||n.default.getFirstMatch(/(?:SamsungBrowser)[\s/](\d+(\.?_?\d+)+)/i,e);return i&&(t.version=i),t}},{test:[/Whale/i],describe:function(e){var t={name:"NAVER Whale Browser"},i=n.default.getFirstMatch(s,e)||n.default.getFirstMatch(/(?:whale)[\s/](\d+(?:\.\d+)+)/i,e);return i&&(t.version=i),t}},{test:[/MZBrowser/i],describe:function(e){var t={name:"MZ Browser"},i=n.default.getFirstMatch(/(?:MZBrowser)[\s/](\d+(?:\.\d+)+)/i,e)||n.default.getFirstMatch(s,e);return i&&(t.version=i),t}},{test:[/focus/i],describe:function(e){var t={name:"Focus"},i=n.default.getFirstMatch(/(?:focus)[\s/](\d+(?:\.\d+)+)/i,e)||n.default.getFirstMatch(s,e);return i&&(t.version=i),t}},{test:[/swing/i],describe:function(e){var t={name:"Swing"},i=n.default.getFirstMatch(/(?:swing)[\s/](\d+(?:\.\d+)+)/i,e)||n.default.getFirstMatch(s,e);return i&&(t.version=i),t}},{test:[/coast/i],describe:function(e){var t={name:"Opera Coast"},i=n.default.getFirstMatch(s,e)||n.default.getFirstMatch(/(?:coast)[\s/](\d+(\.?_?\d+)+)/i,e);return i&&(t.version=i),t}},{test:[/opt\/\d+(?:.?_?\d+)+/i],describe:function(e){var t={name:"Opera Touch"},i=n.default.getFirstMatch(/(?:opt)[\s/](\d+(\.?_?\d+)+)/i,e)||n.default.getFirstMatch(s,e);return i&&(t.version=i),t}},{test:[/yabrowser/i],describe:function(e){var t={name:"Yandex Browser"},i=n.default.getFirstMatch(/(?:yabrowser)[\s/](\d+(\.?_?\d+)+)/i,e)||n.default.getFirstMatch(s,e);return i&&(t.version=i),t}},{test:[/ucbrowser/i],describe:function(e){var t={name:"UC Browser"},i=n.default.getFirstMatch(s,e)||n.default.getFirstMatch(/(?:ucbrowser)[\s/](\d+(\.?_?\d+)+)/i,e);return i&&(t.version=i),t}},{test:[/Maxthon|mxios/i],describe:function(e){var t={name:"Maxthon"},i=n.default.getFirstMatch(s,e)||n.default.getFirstMatch(/(?:Maxthon|mxios)[\s/](\d+(\.?_?\d+)+)/i,e);return i&&(t.version=i),t}},{test:[/epiphany/i],describe:function(e){var t={name:"Epiphany"},i=n.default.getFirstMatch(s,e)||n.default.getFirstMatch(/(?:epiphany)[\s/](\d+(\.?_?\d+)+)/i,e);return i&&(t.version=i),t}},{test:[/puffin/i],describe:function(e){var t={name:"Puffin"},i=n.default.getFirstMatch(s,e)||n.default.getFirstMatch(/(?:puffin)[\s/](\d+(\.?_?\d+)+)/i,e);return i&&(t.version=i),t}},{test:[/sleipnir/i],describe:function(e){var t={name:"Sleipnir"},i=n.default.getFirstMatch(s,e)||n.default.getFirstMatch(/(?:sleipnir)[\s/](\d+(\.?_?\d+)+)/i,e);return i&&(t.version=i),t}},{test:[/k-meleon/i],describe:function(e){var t={name:"K-Meleon"},i=n.default.getFirstMatch(s,e)||n.default.getFirstMatch(/(?:k-meleon)[\s/](\d+(\.?_?\d+)+)/i,e);return i&&(t.version=i),t}},{test:[/micromessenger/i],describe:function(e){var t={name:"WeChat"},i=n.default.getFirstMatch(/(?:micromessenger)[\s/](\d+(\.?_?\d+)+)/i,e)||n.default.getFirstMatch(s,e);return i&&(t.version=i),t}},{test:[/qqbrowser/i],describe:function(e){var t={name:/qqbrowserlite/i.test(e)?"QQ Browser Lite":"QQ Browser"},i=n.default.getFirstMatch(/(?:qqbrowserlite|qqbrowser)[/](\d+(\.?_?\d+)+)/i,e)||n.default.getFirstMatch(s,e);return i&&(t.version=i),t}},{test:[/msie|trident/i],describe:function(e){var t={name:"Internet Explorer"},i=n.default.getFirstMatch(/(?:msie |rv:)(\d+(\.?_?\d+)+)/i,e);return i&&(t.version=i),t}},{test:[/\sedg\//i],describe:function(e){var t={name:"Microsoft Edge"},i=n.default.getFirstMatch(/\sedg\/(\d+(\.?_?\d+)+)/i,e);return i&&(t.version=i),t}},{test:[/edg([ea]|ios)/i],describe:function(e){var t={name:"Microsoft Edge"},i=n.default.getSecondMatch(/edg([ea]|ios)\/(\d+(\.?_?\d+)+)/i,e);return i&&(t.version=i),t}},{test:[/vivaldi/i],describe:function(e){var t={name:"Vivaldi"},i=n.default.getFirstMatch(/vivaldi\/(\d+(\.?_?\d+)+)/i,e);return i&&(t.version=i),t}},{test:[/seamonkey/i],describe:function(e){var t={name:"SeaMonkey"},i=n.default.getFirstMatch(/seamonkey\/(\d+(\.?_?\d+)+)/i,e);return i&&(t.version=i),t}},{test:[/sailfish/i],describe:function(e){var t={name:"Sailfish"},i=n.default.getFirstMatch(/sailfish\s?browser\/(\d+(\.\d+)?)/i,e);return i&&(t.version=i),t}},{test:[/silk/i],describe:function(e){var t={name:"Amazon Silk"},i=n.default.getFirstMatch(/silk\/(\d+(\.?_?\d+)+)/i,e);return i&&(t.version=i),t}},{test:[/phantom/i],describe:function(e){var t={name:"PhantomJS"},i=n.default.getFirstMatch(/phantomjs\/(\d+(\.?_?\d+)+)/i,e);return i&&(t.version=i),t}},{test:[/slimerjs/i],describe:function(e){var t={name:"SlimerJS"},i=n.default.getFirstMatch(/slimerjs\/(\d+(\.?_?\d+)+)/i,e);return i&&(t.version=i),t}},{test:[/blackberry|\bbb\d+/i,/rim\stablet/i],describe:function(e){var t={name:"BlackBerry"},i=n.default.getFirstMatch(s,e)||n.default.getFirstMatch(/blackberry[\d]+\/(\d+(\.?_?\d+)+)/i,e);return i&&(t.version=i),t}},{test:[/(web|hpw)[o0]s/i],describe:function(e){var t={name:"WebOS Browser"},i=n.default.getFirstMatch(s,e)||n.default.getFirstMatch(/w(?:eb)?[o0]sbrowser\/(\d+(\.?_?\d+)+)/i,e);return i&&(t.version=i),t}},{test:[/bada/i],describe:function(e){var t={name:"Bada"},i=n.default.getFirstMatch(/dolfin\/(\d+(\.?_?\d+)+)/i,e);return i&&(t.version=i),t}},{test:[/tizen/i],describe:function(e){var t={name:"Tizen"},i=n.default.getFirstMatch(/(?:tizen\s?)?browser\/(\d+(\.?_?\d+)+)/i,e)||n.default.getFirstMatch(s,e);return i&&(t.version=i),t}},{test:[/qupzilla/i],describe:function(e){var t={name:"QupZilla"},i=n.default.getFirstMatch(/(?:qupzilla)[\s/](\d+(\.?_?\d+)+)/i,e)||n.default.getFirstMatch(s,e);return i&&(t.version=i),t}},{test:[/firefox|iceweasel|fxios/i],describe:function(e){var t={name:"Firefox"},i=n.default.getFirstMatch(/(?:firefox|iceweasel|fxios)[\s/](\d+(\.?_?\d+)+)/i,e);return i&&(t.version=i),t}},{test:[/electron/i],describe:function(e){var t={name:"Electron"},i=n.default.getFirstMatch(/(?:electron)\/(\d+(\.?_?\d+)+)/i,e);return i&&(t.version=i),t}},{test:[/MiuiBrowser/i],describe:function(e){var t={name:"Miui"},i=n.default.getFirstMatch(/(?:MiuiBrowser)[\s/](\d+(\.?_?\d+)+)/i,e);return i&&(t.version=i),t}},{test:[/chromium/i],describe:function(e){var t={name:"Chromium"},i=n.default.getFirstMatch(/(?:chromium)[\s/](\d+(\.?_?\d+)+)/i,e)||n.default.getFirstMatch(s,e);return i&&(t.version=i),t}},{test:[/chrome|crios|crmo/i],describe:function(e){var t={name:"Chrome"},i=n.default.getFirstMatch(/(?:chrome|crios|crmo)\/(\d+(\.?_?\d+)+)/i,e);return i&&(t.version=i),t}},{test:[/GSA/i],describe:function(e){var t={name:"Google Search"},i=n.default.getFirstMatch(/(?:GSA)\/(\d+(\.?_?\d+)+)/i,e);return i&&(t.version=i),t}},{test:function(e){var t=!e.test(/like android/i),i=e.test(/android/i);return t&&i},describe:function(e){var t={name:"Android Browser"},i=n.default.getFirstMatch(s,e);return i&&(t.version=i),t}},{test:[/playstation 4/i],describe:function(e){var t={name:"PlayStation 4"},i=n.default.getFirstMatch(s,e);return i&&(t.version=i),t}},{test:[/safari|applewebkit/i],describe:function(e){var t={name:"Safari"},i=n.default.getFirstMatch(s,e);return i&&(t.version=i),t}},{test:[/.*/i],describe:function(e){var t=-1!==e.search("\\(")?/^(.*)\/(.*)[ \t]\((.*)/:/^(.*)\/(.*) /;return{name:n.default.getFirstMatch(t,e),version:n.default.getSecondMatch(t,e)}}}];t.default=a,e.exports=t.default},93:function(e,t,i){"use strict";t.__esModule=!0,t.default=void 0;var r,n=(r=i(17))&&r.__esModule?r:{default:r},s=i(18);var a=[{test:[/Roku\/DVP/],describe:function(e){var t=n.default.getFirstMatch(/Roku\/DVP-(\d+\.\d+)/i,e);return{name:s.OS_MAP.Roku,version:t}}},{test:[/windows phone/i],describe:function(e){var t=n.default.getFirstMatch(/windows phone (?:os)?\s?(\d+(\.\d+)*)/i,e);return{name:s.OS_MAP.WindowsPhone,version:t}}},{test:[/windows /i],describe:function(e){var t=n.default.getFirstMatch(/Windows ((NT|XP)( \d\d?.\d)?)/i,e),i=n.default.getWindowsVersionName(t);return{name:s.OS_MAP.Windows,version:t,versionName:i}}},{test:[/Macintosh(.*?) FxiOS(.*?)\//],describe:function(e){var t={name:s.OS_MAP.iOS},i=n.default.getSecondMatch(/(Version\/)(\d[\d.]+)/,e);return i&&(t.version=i),t}},{test:[/macintosh/i],describe:function(e){var t=n.default.getFirstMatch(/mac os x (\d+(\.?_?\d+)+)/i,e).replace(/[_\s]/g,"."),i=n.default.getMacOSVersionName(t),r={name:s.OS_MAP.MacOS,version:t};return i&&(r.versionName=i),r}},{test:[/(ipod|iphone|ipad)/i],describe:function(e){var t=n.default.getFirstMatch(/os (\d+([_\s]\d+)*) like mac os x/i,e).replace(/[_\s]/g,".");return{name:s.OS_MAP.iOS,version:t}}},{test:function(e){var t=!e.test(/like android/i),i=e.test(/android/i);return t&&i},describe:function(e){var t=n.default.getFirstMatch(/android[\s/-](\d+(\.\d+)*)/i,e),i=n.default.getAndroidVersionName(t),r={name:s.OS_MAP.Android,version:t};return i&&(r.versionName=i),r}},{test:[/(web|hpw)[o0]s/i],describe:function(e){var t=n.default.getFirstMatch(/(?:web|hpw)[o0]s\/(\d+(\.\d+)*)/i,e),i={name:s.OS_MAP.WebOS};return t&&t.length&&(i.version=t),i}},{test:[/blackberry|\bbb\d+/i,/rim\stablet/i],describe:function(e){var t=n.default.getFirstMatch(/rim\stablet\sos\s(\d+(\.\d+)*)/i,e)||n.default.getFirstMatch(/blackberry\d+\/(\d+([_\s]\d+)*)/i,e)||n.default.getFirstMatch(/\bbb(\d+)/i,e);return{name:s.OS_MAP.BlackBerry,version:t}}},{test:[/bada/i],describe:function(e){var t=n.default.getFirstMatch(/bada\/(\d+(\.\d+)*)/i,e);return{name:s.OS_MAP.Bada,version:t}}},{test:[/tizen/i],describe:function(e){var t=n.default.getFirstMatch(/tizen[/\s](\d+(\.\d+)*)/i,e);return{name:s.OS_MAP.Tizen,version:t}}},{test:[/linux/i],describe:function(){return{name:s.OS_MAP.Linux}}},{test:[/CrOS/],describe:function(){return{name:s.OS_MAP.ChromeOS}}},{test:[/PlayStation 4/],describe:function(e){var t=n.default.getFirstMatch(/PlayStation 4[/\s](\d+(\.\d+)*)/i,e);return{name:s.OS_MAP.PlayStation4,version:t}}}];t.default=a,e.exports=t.default},94:function(e,t,i){"use strict";t.__esModule=!0,t.default=void 0;var r,n=(r=i(17))&&r.__esModule?r:{default:r},s=i(18);var a=[{test:[/googlebot/i],describe:function(){return{type:"bot",vendor:"Google"}}},{test:[/huawei/i],describe:function(e){var t=n.default.getFirstMatch(/(can-l01)/i,e)&&"Nova",i={type:s.PLATFORMS_MAP.mobile,vendor:"Huawei"};return t&&(i.model=t),i}},{test:[/nexus\s*(?:7|8|9|10).*/i],describe:function(){return{type:s.PLATFORMS_MAP.tablet,vendor:"Nexus"}}},{test:[/ipad/i],describe:function(){return{type:s.PLATFORMS_MAP.tablet,vendor:"Apple",model:"iPad"}}},{test:[/Macintosh(.*?) FxiOS(.*?)\//],describe:function(){return{type:s.PLATFORMS_MAP.tablet,vendor:"Apple",model:"iPad"}}},{test:[/kftt build/i],describe:function(){return{type:s.PLATFORMS_MAP.tablet,vendor:"Amazon",model:"Kindle Fire HD 7"}}},{test:[/silk/i],describe:function(){return{type:s.PLATFORMS_MAP.tablet,vendor:"Amazon"}}},{test:[/tablet(?! pc)/i],describe:function(){return{type:s.PLATFORMS_MAP.tablet}}},{test:function(e){var t=e.test(/ipod|iphone/i),i=e.test(/like (ipod|iphone)/i);return t&&!i},describe:function(e){var t=n.default.getFirstMatch(/(ipod|iphone)/i,e);return{type:s.PLATFORMS_MAP.mobile,vendor:"Apple",model:t}}},{test:[/nexus\s*[0-6].*/i,/galaxy nexus/i],describe:function(){return{type:s.PLATFORMS_MAP.mobile,vendor:"Nexus"}}},{test:[/[^-]mobi/i],describe:function(){return{type:s.PLATFORMS_MAP.mobile}}},{test:function(e){return"blackberry"===e.getBrowserName(!0)},describe:function(){return{type:s.PLATFORMS_MAP.mobile,vendor:"BlackBerry"}}},{test:function(e){return"bada"===e.getBrowserName(!0)},describe:function(){return{type:s.PLATFORMS_MAP.mobile}}},{test:function(e){return"windows phone"===e.getBrowserName()},describe:function(){return{type:s.PLATFORMS_MAP.mobile,vendor:"Microsoft"}}},{test:function(e){var t=Number(String(e.getOSVersion()).split(".")[0]);return"android"===e.getOSName(!0)&&t>=3},describe:function(){return{type:s.PLATFORMS_MAP.tablet}}},{test:function(e){return"android"===e.getOSName(!0)},describe:function(){return{type:s.PLATFORMS_MAP.mobile}}},{test:function(e){return"macos"===e.getOSName(!0)},describe:function(){return{type:s.PLATFORMS_MAP.desktop,vendor:"Apple"}}},{test:function(e){return"windows"===e.getOSName(!0)},describe:function(){return{type:s.PLATFORMS_MAP.desktop}}},{test:function(e){return"linux"===e.getOSName(!0)},describe:function(){return{type:s.PLATFORMS_MAP.desktop}}},{test:function(e){return"playstation 4"===e.getOSName(!0)},describe:function(){return{type:s.PLATFORMS_MAP.tv}}},{test:function(e){return"roku"===e.getOSName(!0)},describe:function(){return{type:s.PLATFORMS_MAP.tv}}}];t.default=a,e.exports=t.default},95:function(e,t,i){"use strict";t.__esModule=!0,t.default=void 0;var r,n=(r=i(17))&&r.__esModule?r:{default:r},s=i(18);var a=[{test:function(e){return"microsoft edge"===e.getBrowserName(!0)},describe:function(e){if(/\sedg\//i.test(e))return{name:s.ENGINE_MAP.Blink};var t=n.default.getFirstMatch(/edge\/(\d+(\.?_?\d+)+)/i,e);return{name:s.ENGINE_MAP.EdgeHTML,version:t}}},{test:[/trident/i],describe:function(e){var t={name:s.ENGINE_MAP.Trident},i=n.default.getFirstMatch(/trident\/(\d+(\.?_?\d+)+)/i,e);return i&&(t.version=i),t}},{test:function(e){return e.test(/presto/i)},describe:function(e){var t={name:s.ENGINE_MAP.Presto},i=n.default.getFirstMatch(/presto\/(\d+(\.?_?\d+)+)/i,e);return i&&(t.version=i),t}},{test:function(e){var t=e.test(/gecko/i),i=e.test(/like gecko/i);return t&&!i},describe:function(e){var t={name:s.ENGINE_MAP.Gecko},i=n.default.getFirstMatch(/gecko\/(\d+(\.?_?\d+)+)/i,e);return i&&(t.version=i),t}},{test:[/(apple)?webkit\/537\.36/i],describe:function(){return{name:s.ENGINE_MAP.Blink}}},{test:[/(apple)?webkit/i],describe:function(e){var t={name:s.ENGINE_MAP.WebKit},i=n.default.getFirstMatch(/webkit\/(\d+(\.?_?\d+)+)/i,e);return i&&(t.version=i),t}}];t.default=a,e.exports=t.default}})})},{}],4:[function(e,t,i){var r=function(){if(typeof self==="object"&&self)return self;if(typeof window==="object"&&window)return window;throw new Error("Unable to resolve global `this`")};t.exports=function(){if(this)return this;if(typeof globalThis==="object"&&globalThis)return globalThis;try{Object.defineProperty(Object.prototype,"__global__",{get:function(){return this},configurable:true})}catch(e){return r()}try{if(!__global__)return r();return __global__}finally{delete Object.prototype.__global__}}()},{}],5:[function(e,t,i){function r(){this._events=this._events||{};this._maxListeners=this._maxListeners||undefined}t.exports=r;r.EventEmitter=r;r.prototype._events=undefined;r.prototype._maxListeners=undefined;r.defaultMaxListeners=10;r.prototype.setMaxListeners=function(e){if(!n(e)||e<0||isNaN(e))throw TypeError("n must be a positive number");this._maxListeners=e;return this};r.prototype.emit=function(e){var t,i,r,n,s,a;if(!this._events)this._events={};if(e==="error"){if(!this._events.error||d(this._events.error)&&!this._events.error.length){t=arguments[1];if(t instanceof Error){throw t}else{var o=new Error('Uncaught, unspecified "error" event. ('+t+")");o.context=t;throw o}}}i=this._events[e];if(l(i))return false;if(c(i)){switch(arguments.length){case 1:i.call(this);break;case 2:i.call(this,arguments[1]);break;case 3:i.call(this,arguments[1],arguments[2]);break;default:n=Array.prototype.slice.call(arguments,1);i.apply(this,n)}}else if(d(i)){n=Array.prototype.slice.call(arguments,1);a=i.slice();r=a.length;for(s=0;s<r;s++)a[s].apply(this,n)}return true};r.prototype.addListener=function(e,t){var i;if(!c(t))throw TypeError("listener must be a function");if(!this._events)this._events={};if(this._events.newListener)this.emit("newListener",e,c(t.listener)?t.listener:t);if(!this._events[e])this._events[e]=t;else if(d(this._events[e]))this._events[e].push(t);else this._events[e]=[this._events[e],t];if(d(this._events[e])&&!this._events[e].warned){if(!l(this._maxListeners)){i=this._maxListeners}else{i=r.defaultMaxListeners}if(i&&i>0&&this._events[e].length>i){this._events[e].warned=true;console.error("(node) warning: possible EventEmitter memory "+"leak detected. %d listeners added. "+"Use emitter.setMaxListeners() to increase limit.",this._events[e].length);if(typeof console.trace==="function"){console.trace()}}}return this};r.prototype.on=r.prototype.addListener;r.prototype.once=function(e,t){if(!c(t))throw TypeError("listener must be a function");var i=false;function r(){this.removeListener(e,r);if(!i){i=true;t.apply(this,arguments)}}r.listener=t;this.on(e,r);return this};r.prototype.removeListener=function(e,t){var i,r,n,s;if(!c(t))throw TypeError("listener must be a function");if(!this._events||!this._events[e])return this;i=this._events[e];n=i.length;r=-1;if(i===t||c(i.listener)&&i.listener===t){delete this._events[e];if(this._events.removeListener)this.emit("removeListener",e,t)}else if(d(i)){for(s=n;s-- >0;){if(i[s]===t||i[s].listener&&i[s].listener===t){r=s;break}}if(r<0)return this;if(i.length===1){i.length=0;delete this._events[e]}else{i.splice(r,1)}if(this._events.removeListener)this.emit("removeListener",e,t)}return this};r.prototype.removeAllListeners=function(e){var t,i;if(!this._events)return this;if(!this._events.removeListener){if(arguments.length===0)this._events={};else if(this._events[e])delete this._events[e];return this}if(arguments.length===0){for(t in this._events){if(t==="removeListener")continue;this.removeAllListeners(t)}this.removeAllListeners("removeListener");this._events={};return this}i=this._events[e];if(c(i)){this.removeListener(e,i)}else if(i){while(i.length)this.removeListener(e,i[i.length-1])}delete this._events[e];return this};r.prototype.listeners=function(e){var t;if(!this._events||!this._events[e])t=[];else if(c(this._events[e]))t=[this._events[e]];else t=this._events[e].slice();return t};r.prototype.listenerCount=function(e){if(this._events){var t=this._events[e];if(c(t))return 1;else if(t)return t.length}return 0};r.listenerCount=function(e,t){return e.listenerCount(t)};function c(e){return typeof e==="function"}function n(e){return typeof e==="number"}function d(e){return typeof e==="object"&&e!==null}function l(e){return e===void 0}},{}],6:[function(e,t,d){const l=e("debug")("h264-profile-level-id");l.log=console.info.bind(console);const r=1;const n=2;const s=3;const a=4;const o=5;d.ProfileConstrainedBaseline=r;d.ProfileBaseline=n;d.ProfileMain=s;d.ProfileConstrainedHigh=a;d.ProfileHigh=o;const c=0;const u=10;const h=11;const f=12;const p=13;const m=20;const v=21;const g=22;const y=30;const _=31;const b=32;const S=40;const w=41;const k=42;const C=50;const T=51;const P=52;d.Level1_b=c;d.Level1=u;d.Level1_1=h;d.Level1_2=f;d.Level1_3=p;d.Level2=m;d.Level2_1=v;d.Level2_2=g;d.Level3=y;d.Level3_1=_;d.Level3_2=b;d.Level4=S;d.Level4_1=w;d.Level4_2=k;d.Level5=C;d.Level5_1=T;d.Level5_2=P;class R{constructor(e,t){this.profile=e;this.level=t}}d.ProfileLevelId=R;const i=new R(r,_);const x=16;class M{constructor(e){this._mask=~L("x",e);this._maskedValue=L("1",e)}isMatch(e){return this._maskedValue===(e&this._mask)}}class E{constructor(e,t,i){this.profile_idc=e;this.profile_iop=t;this.profile=i}}const D=[new E(66,new M("x1xx0000"),r),new E(77,new M("1xxx0000"),r),new E(88,new M("11xx0000"),r),new E(66,new M("x0xx0000"),n),new E(88,new M("10xx0000"),n),new E(77,new M("0x0x0000"),s),new E(100,new M("00000000"),o),new E(100,new M("00001100"),a)];d.parseProfileLevelId=function(e){if(typeof e!=="string"||e.length!==6)return null;const t=parseInt(e,16);if(t===0)return null;const i=t&255;const r=t>>8&255;const n=t>>16&255;let s;switch(i){case h:{s=(r&x)!==0?c:h;break}case u:case f:case p:case m:case v:case g:case y:case _:case b:case S:case w:case k:case C:case T:case P:{s=i;break}default:{l("parseProfileLevelId() | unrecognized level_idc:%s",i);return null}}for(const a of D){if(n===a.profile_idc&&a.profile_iop.isMatch(r)){return new R(a.profile,s)}}l("parseProfileLevelId() | unrecognized profile_idc/profile_iop combination");return null};d.profileLevelIdToString=function(e){if(e.level==c){switch(e.profile){case r:{return"42f00b"}case n:{return"42100b"}case s:{return"4d100b"}default:{l("profileLevelIdToString() | Level 1_b not is allowed for profile:%s",e.profile);return null}}}let t;switch(e.profile){case r:{t="42e0";break}case n:{t="4200";break}case s:{t="4d00";break}case a:{t="640c";break}case o:{t="6400";break}default:{l("profileLevelIdToString() | unrecognized profile:%s",e.profile);return null}}let i=e.level.toString(16);if(i.length===1)i=`0${i}`;return`${t}${i}`};d.parseSdpProfileLevelId=function(e={}){const t=e["profile-level-id"];return!t?i:d.parseProfileLevelId(t)};d.isSameProfile=function(e={},t={}){const i=d.parseSdpProfileLevelId(e);const r=d.parseSdpProfileLevelId(t);return Boolean(i&&r&&i.profile===r.profile)};d.generateProfileLevelIdForAnswer=function(e={},t={}){if(!e["profile-level-id"]&&!t["profile-level-id"]){l("generateProfileLevelIdForAnswer() | no profile-level-id in local and remote params");return null}const i=d.parseSdpProfileLevelId(e);const r=d.parseSdpProfileLevelId(t);if(!i)throw new TypeError("invalid local_profile_level_id");if(!r)throw new TypeError("invalid remote_profile_level_id");if(i.profile!==r.profile)throw new TypeError("H264 Profile mismatch");const n=j(e)&&j(t);const s=i.level;const a=r.level;const o=O(s,a);const c=n?s:o;l("generateProfileLevelIdForAnswer() | result: [profile:%s, level:%s]",i.profile,c);return d.profileLevelIdToString(new R(i.profile,c))};function L(e,t){return(t[0]===e)<<7|(t[1]===e)<<6|(t[2]===e)<<5|(t[3]===e)<<4|(t[4]===e)<<3|(t[5]===e)<<2|(t[6]===e)<<1|(t[7]===e)<<0}function I(e,t){if(e===c)return t!==u&&t!==c;if(t===c)return e!==u;return e<t}function O(e,t){return I(e,t)?e:t}function j(e={}){const t=e["level-asymmetry-allowed"];return t===1||t==="1"}},{debug:7}],7:[function(o,c,d){(function(t){d.formatArgs=i;d.save=r;d.load=n;d.useColors=e;d.storage=s();d.destroy=(()=>{let e=false;return()=>{if(!e){e=true;console.warn("Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`.")}}})();d.colors=["#0000CC","#0000FF","#0033CC","#0033FF","#0066CC","#0066FF","#0099CC","#0099FF","#00CC00","#00CC33","#00CC66","#00CC99","#00CCCC","#00CCFF","#3300CC","#3300FF","#3333CC","#3333FF","#3366CC","#3366FF","#3399CC","#3399FF","#33CC00","#33CC33","#33CC66","#33CC99","#33CCCC","#33CCFF","#6600CC","#6600FF","#6633CC","#6633FF","#66CC00","#66CC33","#9900CC","#9900FF","#9933CC","#9933FF","#99CC00","#99CC33","#CC0000","#CC0033","#CC0066","#CC0099","#CC00CC","#CC00FF","#CC3300","#CC3333","#CC3366","#CC3399","#CC33CC","#CC33FF","#CC6600","#CC6633","#CC9900","#CC9933","#CCCC00","#CCCC33","#FF0000","#FF0033","#FF0066","#FF0099","#FF00CC","#FF00FF","#FF3300","#FF3333","#FF3366","#FF3399","#FF33CC","#FF33FF","#FF6600","#FF6633","#FF9900","#FF9933","#FFCC00","#FFCC33"];function e(){if(typeof window!=="undefined"&&window.process&&(window.process.type==="renderer"||window.process.__nwjs)){return true}if(typeof navigator!=="undefined"&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/(edge|trident)\/(\d+)/)){return false}return typeof document!=="undefined"&&document.documentElement&&document.documentElement.style&&document.documentElement.style.WebkitAppearance||typeof window!=="undefined"&&window.console&&(window.console.firebug||window.console.exception&&window.console.table)||typeof navigator!=="undefined"&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/firefox\/(\d+)/)&&parseInt(RegExp.$1,10)>=31||typeof navigator!=="undefined"&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/applewebkit\/(\d+)/)}function i(e){e[0]=(this.useColors?"%c":"")+this.namespace+(this.useColors?" %c":" ")+e[0]+(this.useColors?"%c ":" ")+"+"+c.exports.humanize(this.diff);if(!this.useColors){return}const t="color: "+this.color;e.splice(1,0,t,"color: inherit");let i=0;let r=0;e[0].replace(/%[a-zA-Z%]/g,e=>{if(e==="%%"){return}i++;if(e==="%c"){r=i}});e.splice(r,0,t)}d.log=console.debug||console.log||(()=>{});function r(e){try{if(e){d.storage.setItem("debug",e)}else{d.storage.removeItem("debug")}}catch(e){}}function n(){let e;try{e=d.storage.getItem("debug")}catch(e){}if(!e&&typeof t!=="undefined"&&"env"in t){e=t.env.DEBUG}return e}function s(){try{return localStorage}catch(e){}}c.exports=o("./common")(d);const{formatters:a}=c.exports;a.j=function(e){try{return JSON.stringify(e)}catch(e){return"[UnexpectedJSONParseError]: "+e.message}}}).call(this,o("_process"))},{"./common":8,_process:45}],8:[function(l,e,t){function i(t){c.debug=c;c.default=c;c.coerce=o;c.disable=n;c.enable=r;c.enabled=s;c.humanize=l("ms");c.destroy=d;Object.keys(t).forEach(e=>{c[e]=t[e]});c.names=[];c.skips=[];c.formatters={};function e(t){let i=0;for(let e=0;e<t.length;e++){i=(i<<5)-i+t.charCodeAt(e);i|=0}return c.colors[Math.abs(i)%c.colors.length]}c.selectColor=e;function c(e){let r;let t=null;function o(...n){if(!o.enabled){return}const s=o;const e=Number(new Date);const t=e-(r||e);s.diff=t;s.prev=r;s.curr=e;r=e;n[0]=c.coerce(n[0]);if(typeof n[0]!=="string"){n.unshift("%O")}let a=0;n[0]=n[0].replace(/%([a-zA-Z%])/g,(e,t)=>{if(e==="%%"){return"%"}a++;const i=c.formatters[t];if(typeof i==="function"){const r=n[a];e=i.call(s,r);n.splice(a,1);a--}return e});c.formatArgs.call(s,n);const i=s.log||c.log;i.apply(s,n)}o.namespace=e;o.useColors=c.useColors();o.color=c.selectColor(e);o.extend=i;o.destroy=c.destroy;Object.defineProperty(o,"enabled",{enumerable:true,configurable:false,get:()=>t===null?c.enabled(e):t,set:e=>{t=e}});if(typeof c.init==="function"){c.init(o)}return o}function i(e,t){const i=c(this.namespace+(typeof t==="undefined"?":":t)+e);i.log=this.log;return i}function r(e){c.save(e);c.names=[];c.skips=[];let t;const i=(typeof e==="string"?e:"").split(/[\s,]+/);const r=i.length;for(t=0;t<r;t++){if(!i[t]){continue}e=i[t].replace(/\*/g,".*?");if(e[0]==="-"){c.skips.push(new RegExp("^"+e.substr(1)+"$"))}else{c.names.push(new RegExp("^"+e+"$"))}}}function n(){const e=[...c.names.map(a),...c.skips.map(a).map(e=>"-"+e)].join(",");c.enable("");return e}function s(e){if(e[e.length-1]==="*"){return true}let t;let i;for(t=0,i=c.skips.length;t<i;t++){if(c.skips[t].test(e)){return false}}for(t=0,i=c.names.length;t<i;t++){if(c.names[t].test(e)){return true}}return false}function a(e){return e.toString().substring(2,e.toString().length-2).replace(/\.\*\?$/,"*")}function o(e){if(e instanceof Error){return e.stack||e.message}return e}function d(){console.warn("Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`.")}c.enable(c.load());return c}e.exports=i},{ms:9}],9:[function(e,t,i){var n=1e3;var s=n*60;var a=s*60;var o=a*24;var c=o*7;var d=o*365.25;t.exports=function(e,t){t=t||{};var i=typeof e;if(i==="string"&&e.length>0){return r(e)}else if(i==="number"&&isFinite(e)){return t.long?u(e):l(e)}throw new Error("val is not a non-empty string or a valid number. val="+JSON.stringify(e))};function r(e){e=String(e);if(e.length>100){return}var t=/^(-?(?:\d+)?\.?\d+) *(milliseconds?|msecs?|ms|seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|weeks?|w|years?|yrs?|y)?$/i.exec(e);if(!t){return}var i=parseFloat(t[1]);var r=(t[2]||"ms").toLowerCase();switch(r){case"years":case"year":case"yrs":case"yr":case"y":return i*d;case"weeks":case"week":case"w":return i*c;case"days":case"day":case"d":return i*o;case"hours":case"hour":case"hrs":case"hr":case"h":return i*a;case"minutes":case"minute":case"mins":case"min":case"m":return i*s;case"seconds":case"second":case"secs":case"sec":case"s":return i*n;case"milliseconds":case"millisecond":case"msecs":case"msec":case"ms":return i;default:return undefined}}function l(e){var t=Math.abs(e);if(t>=o){return Math.round(e/o)+"d"}if(t>=a){return Math.round(e/a)+"h"}if(t>=s){return Math.round(e/s)+"m"}if(t>=n){return Math.round(e/n)+"s"}return e+"ms"}function u(e){var t=Math.abs(e);if(t>=o){return h(e,t,o,"day")}if(t>=a){return h(e,t,a,"hour")}if(t>=s){return h(e,t,s,"minute")}if(t>=n){return h(e,t,n,"second")}return e+" ms"}function h(e,t,i,r){var n=t>=i*1.5;return Math.round(e/i)+" "+r+(n?"s":"")}},{}],10:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:true});i.Consumer=void 0;const r=e("./Logger");const o=e("./EnhancedEventEmitter");const n=e("./errors");const c=new r.Logger("Consumer");class s extends o.EnhancedEventEmitter{constructor({id:e,localId:t,producerId:i,rtpReceiver:r,track:n,rtpParameters:s,appData:a}){super();this._closed=false;this._observer=new o.EnhancedEventEmitter;c.debug("constructor()");this._id=e;this._localId=t;this._producerId=i;this._rtpReceiver=r;this._track=n;this._rtpParameters=s;this._paused=!n.enabled;this._appData=a;this._onTrackEnded=this._onTrackEnded.bind(this);this._handleTrack()}get id(){return this._id}get localId(){return this._localId}get producerId(){return this._producerId}get closed(){return this._closed}get kind(){return this._track.kind}get rtpReceiver(){return this._rtpReceiver}get track(){return this._track}get rtpParameters(){return this._rtpParameters}get paused(){return this._paused}get appData(){return this._appData}set appData(e){throw new Error("cannot override appData object")}get observer(){return this._observer}close(){if(this._closed)return;c.debug("close()");this._closed=true;this._destroyTrack();this.emit("@close");this._observer.safeEmit("close")}transportClosed(){if(this._closed)return;c.debug("transportClosed()");this._closed=true;this._destroyTrack();this.safeEmit("transportclose");this._observer.safeEmit("close")}async getStats(){if(this._closed)throw new n.InvalidStateError("closed");return this.safeEmitAsPromise("@getstats")}pause(){c.debug("pause()");if(this._closed){c.error("pause() | Consumer closed");return}this._paused=true;this._track.enabled=false;this._observer.safeEmit("pause")}resume(){c.debug("resume()");if(this._closed){c.error("resume() | Consumer closed");return}this._paused=false;this._track.enabled=true;this._observer.safeEmit("resume")}_onTrackEnded(){c.debug('track "ended" event');this.safeEmit("trackended");this._observer.safeEmit("trackended")}_handleTrack(){this._track.addEventListener("ended",this._onTrackEnded)}_destroyTrack(){try{this._track.removeEventListener("ended",this._onTrackEnded);this._track.stop()}catch(e){}}}i.Consumer=s},{"./EnhancedEventEmitter":14,"./Logger":15,"./errors":20}],11:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:true});i.DataConsumer=void 0;const r=e("./Logger");const s=e("./EnhancedEventEmitter");const a=new r.Logger("DataConsumer");class n extends s.EnhancedEventEmitter{constructor({id:e,dataProducerId:t,dataChannel:i,sctpStreamParameters:r,appData:n}){super();this._closed=false;this._observer=new s.EnhancedEventEmitter;a.debug("constructor()");this._id=e;this._dataProducerId=t;this._dataChannel=i;this._sctpStreamParameters=r;this._appData=n;this._handleDataChannel()}get id(){return this._id}get dataProducerId(){return this._dataProducerId}get closed(){return this._closed}get sctpStreamParameters(){return this._sctpStreamParameters}get readyState(){return this._dataChannel.readyState}get label(){return this._dataChannel.label}get protocol(){return this._dataChannel.protocol}get binaryType(){return this._dataChannel.binaryType}set binaryType(e){this._dataChannel.binaryType=e}get appData(){return this._appData}set appData(e){throw new Error("cannot override appData object")}get observer(){return this._observer}close(){if(this._closed)return;a.debug("close()");this._closed=true;this._dataChannel.close();this.emit("@close");this._observer.safeEmit("close")}transportClosed(){if(this._closed)return;a.debug("transportClosed()");this._closed=true;this._dataChannel.close();this.safeEmit("transportclose");this._observer.safeEmit("close")}_handleDataChannel(){this._dataChannel.addEventListener("open",()=>{if(this._closed)return;a.debug('DataChannel "open" event');this.safeEmit("open")});this._dataChannel.addEventListener("error",e=>{if(this._closed)return;let{error:t}=e;if(!t)t=new Error("unknown DataChannel error");if(t.errorDetail==="sctp-failure"){a.error("DataChannel SCTP error [sctpCauseCode:%s]: %s",t.sctpCauseCode,t.message)}else{a.error('DataChannel "error" event: %o',t)}this.safeEmit("error",t)});this._dataChannel.addEventListener("close",()=>{if(this._closed)return;a.warn('DataChannel "close" event');this._closed=true;this.emit("@close");this.safeEmit("close")});this._dataChannel.addEventListener("message",e=>{if(this._closed)return;this.safeEmit("message",e.data)})}}i.DataConsumer=n},{"./EnhancedEventEmitter":14,"./Logger":15}],12:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:true});i.DataProducer=void 0;const r=e("./Logger");const n=e("./EnhancedEventEmitter");const s=e("./errors");const a=new r.Logger("DataProducer");class o extends n.EnhancedEventEmitter{constructor({id:e,dataChannel:t,sctpStreamParameters:i,appData:r}){super();this._closed=false;this._observer=new n.EnhancedEventEmitter;a.debug("constructor()");this._id=e;this._dataChannel=t;this._sctpStreamParameters=i;this._appData=r;this._handleDataChannel()}get id(){return this._id}get closed(){return this._closed}get sctpStreamParameters(){return this._sctpStreamParameters}get readyState(){return this._dataChannel.readyState}get label(){return this._dataChannel.label}get protocol(){return this._dataChannel.protocol}get bufferedAmount(){return this._dataChannel.bufferedAmount}get bufferedAmountLowThreshold(){return this._dataChannel.bufferedAmountLowThreshold}set bufferedAmountLowThreshold(e){this._dataChannel.bufferedAmountLowThreshold=e}get appData(){return this._appData}set appData(e){throw new Error("cannot override appData object")}get observer(){return this._observer}close(){if(this._closed)return;a.debug("close()");this._closed=true;this._dataChannel.close();this.emit("@close");this._observer.safeEmit("close")}transportClosed(){if(this._closed)return;a.debug("transportClosed()");this._closed=true;this._dataChannel.close();this.safeEmit("transportclose");this._observer.safeEmit("close")}send(e){a.debug("send()");if(this._closed)throw new s.InvalidStateError("closed");this._dataChannel.send(e)}_handleDataChannel(){this._dataChannel.addEventListener("open",()=>{if(this._closed)return;a.debug('DataChannel "open" event');this.safeEmit("open")});this._dataChannel.addEventListener("error",e=>{if(this._closed)return;let{error:t}=e;if(!t)t=new Error("unknown DataChannel error");if(t.errorDetail==="sctp-failure"){a.error("DataChannel SCTP error [sctpCauseCode:%s]: %s",t.sctpCauseCode,t.message)}else{a.error('DataChannel "error" event: %o',t)}this.safeEmit("error",t)});this._dataChannel.addEventListener("close",()=>{if(this._closed)return;a.warn('DataChannel "close" event');this._closed=true;this.emit("@close");this.safeEmit("close")});this._dataChannel.addEventListener("message",()=>{if(this._closed)return;a.warn('DataChannel "message" event in a DataProducer, message discarded')});this._dataChannel.addEventListener("bufferedamountlow",()=>{if(this._closed)return;this.safeEmit("bufferedamountlow")})}}i.DataProducer=o},{"./EnhancedEventEmitter":14,"./Logger":15,"./errors":20}],13:[function(e,t,i){"use strict";var r=this&&this.__createBinding||(Object.create?function(e,t,i,r){if(r===undefined)r=i;Object.defineProperty(e,r,{enumerable:true,get:function(){return t[i]}})}:function(e,t,i,r){if(r===undefined)r=i;e[r]=t[i]});var n=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:true,value:t})}:function(e,t){e["default"]=t});var s=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(e!=null)for(var i in e)if(i!=="default"&&Object.hasOwnProperty.call(e,i))r(t,e,i);n(t,e);return t};var a=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(i,"__esModule",{value:true});i.Device=i.detectDevice=void 0;const o=a(e("bowser"));const c=e("./Logger");const d=e("./EnhancedEventEmitter");const h=e("./errors");const l=s(e("./utils"));const u=s(e("./ortc"));const f=e("./Transport");const p=e("./handlers/Chrome74");const m=e("./handlers/Chrome70");const v=e("./handlers/Chrome67");const g=e("./handlers/Chrome55");const y=e("./handlers/Firefox60");const _=e("./handlers/Safari12");const b=e("./handlers/Safari11");const S=e("./handlers/Edge11");const w=e("./handlers/ReactNative");const k=new c.Logger("Device");function C(){if(typeof navigator==="object"&&navigator.product==="ReactNative"){if(typeof RTCPeerConnection==="undefined"){k.warn("this._detectDevice() | unsupported ReactNative without RTCPeerConnection");return undefined}k.debug("this._detectDevice() | ReactNative handler chosen");return"ReactNative"}else if(typeof navigator==="object"&&typeof navigator.userAgent==="string"){const e=navigator.userAgent;const t=o.default.getParser(e);const i=t.getEngine();if(t.satisfies({chrome:">=74",chromium:">=74"})){return"Chrome74"}else if(t.satisfies({chrome:">=70",chromium:">=70"})){return"Chrome70"}else if(t.satisfies({chrome:">=67",chromium:">=67"})){return"Chrome67"}else if(t.satisfies({chrome:">=55",chromium:">=55"})){return"Chrome55"}else if(t.satisfies({firefox:">=60"})){return"Firefox60"}else if(t.satisfies({safari:">=12.0"})&&typeof RTCRtpTransceiver!=="undefined"&&RTCRtpTransceiver.prototype.hasOwnProperty("currentDirection")){return"Safari12"}else if(t.satisfies({safari:">=11"})){return"Safari11"}else if(t.satisfies({"microsoft edge":">=11"})&&t.satisfies({"microsoft edge":"<=18"})){return"Edge11"}else if(i.name&&i.name.toLowerCase()==="blink"){const r=e.match(/(?:(?:Chrome|Chromium))[ /](\w+)/i);if(r){const n=Number(r[1]);if(n>=74){return"Chrome74"}else if(n>=70){return"Chrome70"}else if(n>=67){return"Chrome67"}else{return"Chrome55"}}else{return"Chrome74"}}else{k.warn("this._detectDevice() | browser not supported [name:%s, version:%s]",t.getBrowserName(),t.getBrowserVersion());return undefined}}else{k.warn("this._detectDevice() | unknown device");return undefined}}i.detectDevice=C;class T{constructor({handlerName:e,handlerFactory:t,Handler:i}={}){this._loaded=false;this._observer=new d.EnhancedEventEmitter;k.debug("constructor()");if(i){k.warn("constructor() | Handler option is DEPRECATED, use handlerName or handlerFactory instead");if(typeof i==="string")e=i;else throw new TypeError("non string Handler option no longer supported, use handlerFactory instead")}if(e&&t){throw new TypeError("just one of handlerName or handlerInterface can be given")}if(t){this._handlerFactory=t}else{if(e){k.debug("constructor() | handler given: %s",e)}else{e=C();if(e)k.debug("constructor() | detected handler: %s",e);else throw new h.UnsupportedError("device not supported")}switch(e){case"Chrome74":this._handlerFactory=p.Chrome74.createFactory();break;case"Chrome70":this._handlerFactory=m.Chrome70.createFactory();break;case"Chrome67":this._handlerFactory=v.Chrome67.createFactory();break;case"Chrome55":this._handlerFactory=g.Chrome55.createFactory();break;case"Firefox60":this._handlerFactory=y.Firefox60.createFactory();break;case"Safari12":this._handlerFactory=_.Safari12.createFactory();break;case"Safari11":this._handlerFactory=b.Safari11.createFactory();break;case"Edge11":this._handlerFactory=S.Edge11.createFactory();break;case"ReactNative":this._handlerFactory=w.ReactNative.createFactory();break;default:throw new TypeError(`unknown handlerName "${e}"`)}}const r=this._handlerFactory();this._handlerName=r.name;r.close();this._extendedRtpCapabilities=undefined;this._recvRtpCapabilities=undefined;this._canProduceByKind={audio:false,video:false};this._sctpCapabilities=undefined}get handlerName(){return this._handlerName}get loaded(){return this._loaded}get rtpCapabilities(){if(!this._loaded)throw new h.InvalidStateError("not loaded");return this._recvRtpCapabilities}get sctpCapabilities(){if(!this._loaded)throw new h.InvalidStateError("not loaded");return this._sctpCapabilities}get observer(){return this._observer}async load({routerRtpCapabilities:e}){k.debug("load() [routerRtpCapabilities:%o]",e);e=l.clone(e,undefined);let t;try{if(this._loaded)throw new h.InvalidStateError("already loaded");u.validateRtpCapabilities(e);t=this._handlerFactory();const i=await t.getNativeRtpCapabilities();k.debug("load() | got native RTP capabilities:%o",i);u.validateRtpCapabilities(i);this._extendedRtpCapabilities=u.getExtendedRtpCapabilities(i,e);k.debug("load() | got extended RTP capabilities:%o",this._extendedRtpCapabilities);this._canProduceByKind.audio=u.canSend("audio",this._extendedRtpCapabilities);this._canProduceByKind.video=u.canSend("video",this._extendedRtpCapabilities);this._recvRtpCapabilities=u.getRecvRtpCapabilities(this._extendedRtpCapabilities);u.validateRtpCapabilities(this._recvRtpCapabilities);k.debug("load() | got receiving RTP capabilities:%o",this._recvRtpCapabilities);this._sctpCapabilities=await t.getNativeSctpCapabilities();k.debug("load() | got native SCTP capabilities:%o",this._sctpCapabilities);u.validateSctpCapabilities(this._sctpCapabilities);k.debug("load() succeeded");this._loaded=true;t.close()}catch(e){if(t)t.close();throw e}}canProduce(e){if(!this._loaded)throw new h.InvalidStateError("not loaded");else if(e!=="audio"&&e!=="video")throw new TypeError(`invalid kind "${e}"`);return this._canProduceByKind[e]}createSendTransport({id:e,iceParameters:t,iceCandidates:i,dtlsParameters:r,sctpParameters:n,iceServers:s,iceTransportPolicy:a,additionalSettings:o,proprietaryConstraints:c,appData:d={}}){k.debug("createSendTransport()");return this._createTransport({direction:"send",id:e,iceParameters:t,iceCandidates:i,dtlsParameters:r,sctpParameters:n,iceServers:s,iceTransportPolicy:a,additionalSettings:o,proprietaryConstraints:c,appData:d})}createRecvTransport({id:e,iceParameters:t,iceCandidates:i,dtlsParameters:r,sctpParameters:n,iceServers:s,iceTransportPolicy:a,additionalSettings:o,proprietaryConstraints:c,appData:d={}}){k.debug("createRecvTransport()");return this._createTransport({direction:"recv",id:e,iceParameters:t,iceCandidates:i,dtlsParameters:r,sctpParameters:n,iceServers:s,iceTransportPolicy:a,additionalSettings:o,proprietaryConstraints:c,appData:d})}_createTransport({direction:e,id:t,iceParameters:i,iceCandidates:r,dtlsParameters:n,sctpParameters:s,iceServers:a,iceTransportPolicy:o,additionalSettings:c,proprietaryConstraints:d,appData:l={}}){if(!this._loaded)throw new h.InvalidStateError("not loaded");else if(typeof t!=="string")throw new TypeError("missing id");else if(typeof i!=="object")throw new TypeError("missing iceParameters");else if(!Array.isArray(r))throw new TypeError("missing iceCandidates");else if(typeof n!=="object")throw new TypeError("missing dtlsParameters");else if(s&&typeof s!=="object")throw new TypeError("wrong sctpParameters");else if(l&&typeof l!=="object")throw new TypeError("if given, appData must be an object");const u=new f.Transport({direction:e,id:t,iceParameters:i,iceCandidates:r,dtlsParameters:n,sctpParameters:s,iceServers:a,iceTransportPolicy:o,additionalSettings:c,proprietaryConstraints:d,appData:l,handlerFactory:this._handlerFactory,extendedRtpCapabilities:this._extendedRtpCapabilities,canProduceByKind:this._canProduceByKind});this._observer.safeEmit("newtransport",u);return u}}i.Device=T},{"./EnhancedEventEmitter":14,"./Logger":15,"./Transport":19,"./errors":20,"./handlers/Chrome55":21,"./handlers/Chrome67":22,"./handlers/Chrome70":23,"./handlers/Chrome74":24,"./handlers/Edge11":25,"./handlers/Firefox60":26,"./handlers/ReactNative":28,"./handlers/Safari11":29,"./handlers/Safari12":30,"./ortc":38,"./utils":41,bowser:3}],14:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:true});i.EnhancedEventEmitter=void 0;const r=e("events");const n=e("./Logger");const s=new n.Logger("EnhancedEventEmitter");class a extends r.EventEmitter{constructor(){super();this.setMaxListeners(Infinity)}safeEmit(t,...e){const i=this.listenerCount(t);try{return this.emit(t,...e)}catch(e){s.error("safeEmit() | event listener threw an error [event:%s]:%o",t,e);return Boolean(i)}}async safeEmitAsPromise(i,...r){return new Promise((e,t)=>{try{this.emit(i,...r,e,t)}catch(e){s.error("safeEmitAsPromise() | event listener threw an error [event:%s]:%o",i,e);t(e)}})}}i.EnhancedEventEmitter=a},{"./Logger":15,events:5}],15:[function(e,t,i){"use strict";var r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(i,"__esModule",{value:true});i.Logger=void 0;const n=r(e("debug"));const s="mediasoup-client";class a{constructor(e){if(e){this._debug=n.default(`${s}:${e}`);this._warn=n.default(`${s}:WARN:${e}`);this._error=n.default(`${s}:ERROR:${e}`)}else{this._debug=n.default(s);this._warn=n.default(`${s}:WARN`);this._error=n.default(`${s}:ERROR`)}this._debug.log=console.info.bind(console);this._warn.log=console.warn.bind(console);this._error.log=console.error.bind(console)}get debug(){return this._debug}get warn(){return this._warn}get error(){return this._error}}i.Logger=a},{debug:42}],16:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:true});i.Producer=void 0;const r=e("./Logger");const d=e("./EnhancedEventEmitter");const n=e("./errors");const l=new r.Logger("Producer");class s extends d.EnhancedEventEmitter{constructor({id:e,localId:t,rtpSender:i,track:r,rtpParameters:n,stopTracks:s,disableTrackOnPause:a,zeroRtpOnPause:o,appData:c}){super();this._closed=false;this._observer=new d.EnhancedEventEmitter;l.debug("constructor()");this._id=e;this._localId=t;this._rtpSender=i;this._track=r;this._kind=r.kind;this._rtpParameters=n;this._paused=a?!r.enabled:false;this._maxSpatialLayer=undefined;this._stopTracks=s;this._disableTrackOnPause=a;this._zeroRtpOnPause=o;this._appData=c;this._onTrackEnded=this._onTrackEnded.bind(this);this._handleTrack()}get id(){return this._id}get localId(){return this._localId}get closed(){return this._closed}get kind(){return this._kind}get rtpSender(){return this._rtpSender}get track(){return this._track}get rtpParameters(){return this._rtpParameters}get paused(){return this._paused}get maxSpatialLayer(){return this._maxSpatialLayer}get appData(){return this._appData}set appData(e){throw new Error("cannot override appData object")}get observer(){return this._observer}close(){if(this._closed)return;l.debug("close()");this._closed=true;this._destroyTrack();this.emit("@close");this._observer.safeEmit("close")}transportClosed(){if(this._closed)return;l.debug("transportClosed()");this._closed=true;this._destroyTrack();this.safeEmit("transportclose");this._observer.safeEmit("close")}async getStats(){if(this._closed)throw new n.InvalidStateError("closed");return this.safeEmitAsPromise("@getstats")}pause(){l.debug("pause()");if(this._closed){l.error("pause() | Producer closed");return}this._paused=true;if(this._track&&this._disableTrackOnPause){this._track.enabled=false}if(this._zeroRtpOnPause){this.safeEmitAsPromise("@replacetrack",null).catch(()=>{})}this._observer.safeEmit("pause")}resume(){l.debug("resume()");if(this._closed){l.error("resume() | Producer closed");return}this._paused=false;if(this._track&&this._disableTrackOnPause){this._track.enabled=true}if(this._zeroRtpOnPause){this.safeEmitAsPromise("@replacetrack",this._track).catch(()=>{})}this._observer.safeEmit("resume")}async replaceTrack({track:e}){l.debug("replaceTrack() [track:%o]",e);if(this._closed){if(e&&this._stopTracks){try{e.stop()}catch(e){}}throw new n.InvalidStateError("closed")}else if(e&&e.readyState==="ended"){throw new n.InvalidStateError("track ended")}if(e===this._track){l.debug("replaceTrack() | same track, ignored");return}if(!this._zeroRtpOnPause||!this._paused){await this.safeEmitAsPromise("@replacetrack",e)}this._destroyTrack();this._track=e;if(this._track&&this._disableTrackOnPause){if(!this._paused)this._track.enabled=true;else if(this._paused)this._track.enabled=false}this._handleTrack()}async setMaxSpatialLayer(e){if(this._closed)throw new n.InvalidStateError("closed");else if(this._kind!=="video")throw new n.UnsupportedError("not a video Producer");else if(typeof e!=="number")throw new TypeError("invalid spatialLayer");if(e===this._maxSpatialLayer)return;await this.safeEmitAsPromise("@setmaxspatiallayer",e);this._maxSpatialLayer=e}async setRtpEncodingParameters(e){if(this._closed)throw new n.InvalidStateError("closed");else if(typeof e!=="object")throw new TypeError("invalid params");await this.safeEmitAsPromise("@setrtpencodingparameters",e)}_onTrackEnded(){l.debug('track "ended" event');this.safeEmit("trackended");this._observer.safeEmit("trackended")}_handleTrack(){if(!this._track)return;this._track.addEventListener("ended",this._onTrackEnded)}_destroyTrack(){if(!this._track)return;try{this._track.removeEventListener("ended",this._onTrackEnded);if(this._stopTracks)this._track.stop()}catch(e){}}}i.Producer=s},{"./EnhancedEventEmitter":14,"./Logger":15,"./errors":20}],17:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:true})},{}],18:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:true})},{}],19:[function(e,t,i){"use strict";var r=this&&this.__createBinding||(Object.create?function(e,t,i,r){if(r===undefined)r=i;Object.defineProperty(e,r,{enumerable:true,get:function(){return t[i]}})}:function(e,t,i,r){if(r===undefined)r=i;e[r]=t[i]});var n=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:true,value:t})}:function(e,t){e["default"]=t});var s=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(e!=null)for(var i in e)if(i!=="default"&&Object.hasOwnProperty.call(e,i))r(t,e,i);n(t,e);return t};Object.defineProperty(i,"__esModule",{value:true});i.Transport=void 0;const p=e("awaitqueue");const a=e("./Logger");const m=e("./EnhancedEventEmitter");const v=e("./errors");const g=s(e("./utils"));const y=s(e("./ortc"));const _=e("./Producer");const u=e("./Consumer");const h=e("./DataProducer");const c=e("./DataConsumer");const b=new a.Logger("Transport");class o extends m.EnhancedEventEmitter{constructor({direction:e,id:t,iceParameters:i,iceCandidates:r,dtlsParameters:n,sctpParameters:s,iceServers:a,iceTransportPolicy:o,additionalSettings:c,proprietaryConstraints:d,appData:l,handlerFactory:u,extendedRtpCapabilities:h,canProduceByKind:f}){super();this._closed=false;this._connectionState="new";this._producers=new Map;this._consumers=new Map;this._dataProducers=new Map;this._dataConsumers=new Map;this._probatorConsumerCreated=false;this._awaitQueue=new p.AwaitQueue({ClosedErrorClass:v.InvalidStateError});this._observer=new m.EnhancedEventEmitter;b.debug("constructor() [id:%s, direction:%s]",t,e);this._id=t;this._direction=e;this._extendedRtpCapabilities=h;this._canProduceByKind=f;this._maxSctpMessageSize=s?s.maxMessageSize:null;c=g.clone(c,{});delete c.iceServers;delete c.iceTransportPolicy;delete c.bundlePolicy;delete c.rtcpMuxPolicy;delete c.sdpSemantics;this._handler=u();this._handler.run({direction:e,iceParameters:i,iceCandidates:r,dtlsParameters:n,sctpParameters:s,iceServers:a,iceTransportPolicy:o,additionalSettings:c,proprietaryConstraints:d,extendedRtpCapabilities:h});this._appData=l;this._handleHandler()}get id(){return this._id}get closed(){return this._closed}get direction(){return this._direction}get handler(){return this._handler}get connectionState(){return this._connectionState}get appData(){return this._appData}set appData(e){throw new Error("cannot override appData object")}get observer(){return this._observer}close(){if(this._closed)return;b.debug("close()");this._closed=true;this._awaitQueue.close();this._handler.close();for(const e of this._producers.values()){e.transportClosed()}this._producers.clear();for(const t of this._consumers.values()){t.transportClosed()}this._consumers.clear();for(const i of this._dataProducers.values()){i.transportClosed()}this._dataProducers.clear();for(const r of this._dataConsumers.values()){r.transportClosed()}this._dataConsumers.clear();this._observer.safeEmit("close")}async getStats(){if(this._closed)throw new v.InvalidStateError("closed");return this._handler.getTransportStats()}async restartIce({iceParameters:e}){b.debug("restartIce()");if(this._closed)throw new v.InvalidStateError("closed");else if(!e)throw new TypeError("missing iceParameters");return this._awaitQueue.push(async()=>this._handler.restartIce(e),"transport.restartIce()")}async updateIceServers({iceServers:e}={}){b.debug("updateIceServers()");if(this._closed)throw new v.InvalidStateError("closed");else if(!Array.isArray(e))throw new TypeError("missing iceServers");return this._awaitQueue.push(async()=>this._handler.updateIceServers(e),"transport.updateIceServers()")}async produce({track:a,encodings:o,codecOptions:c,codec:d,stopTracks:l=true,disableTrackOnPause:u=true,zeroRtpOnPause:h=false,appData:f={}}={}){b.debug("produce() [track:%o]",a);if(!a)throw new TypeError("missing track");else if(this._direction!=="send")throw new v.UnsupportedError("not a sending Transport");else if(!this._canProduceByKind[a.kind])throw new v.UnsupportedError(`cannot produce ${a.kind}`);else if(a.readyState==="ended")throw new v.InvalidStateError("track ended");else if(this.listenerCount("connect")===0&&this._connectionState==="new")throw new TypeError('no "connect" listener set into this transport');else if(this.listenerCount("produce")===0)throw new TypeError('no "produce" listener set into this transport');else if(f&&typeof f!=="object")throw new TypeError("if given, appData must be an object");return this._awaitQueue.push(async()=>{let e;if(o&&!Array.isArray(o)){throw TypeError("encodings must be an array")}else if(o&&o.length===0){e=undefined}else if(o){e=o.map(e=>{const t={active:true};if(e.active===false)t.active=false;if(typeof e.dtx==="boolean")t.dtx=e.dtx;if(typeof e.scalabilityMode==="string")t.scalabilityMode=e.scalabilityMode;if(typeof e.scaleResolutionDownBy==="number")t.scaleResolutionDownBy=e.scaleResolutionDownBy;if(typeof e.maxBitrate==="number")t.maxBitrate=e.maxBitrate;if(typeof e.maxFramerate==="number")t.maxFramerate=e.maxFramerate;if(typeof e.adaptivePtime==="boolean")t.adaptivePtime=e.adaptivePtime;if(typeof e.priority==="string")t.priority=e.priority;if(typeof e.networkPriority==="string")t.networkPriority=e.networkPriority;return t})}const{localId:t,rtpParameters:i,rtpSender:r}=await this._handler.send({track:a,encodings:e,codecOptions:c,codec:d});try{y.validateRtpParameters(i);const{id:n}=await this.safeEmitAsPromise("produce",{kind:a.kind,rtpParameters:i,appData:f});const s=new _.Producer({id:n,localId:t,rtpSender:r,track:a,rtpParameters:i,stopTracks:l,disableTrackOnPause:u,zeroRtpOnPause:h,appData:f});this._producers.set(s.id,s);this._handleProducer(s);this._observer.safeEmit("newproducer",s);return s}catch(e){this._handler.stopSending(t).catch(()=>{});throw e}},"transport.produce()").catch(e=>{if(l){try{a.stop()}catch(e){}}throw e})}async consume({id:a,producerId:o,kind:c,rtpParameters:d,appData:l={}}){b.debug("consume()");d=g.clone(d,undefined);if(this._closed)throw new v.InvalidStateError("closed");else if(this._direction!=="recv")throw new v.UnsupportedError("not a receiving Transport");else if(typeof a!=="string")throw new TypeError("missing id");else if(typeof o!=="string")throw new TypeError("missing producerId");else if(c!=="audio"&&c!=="video")throw new TypeError(`invalid kind '${c}'`);else if(this.listenerCount("connect")===0&&this._connectionState==="new")throw new TypeError('no "connect" listener set into this transport');else if(l&&typeof l!=="object")throw new TypeError("if given, appData must be an object");return this._awaitQueue.push(async()=>{const e=y.canReceive(d,this._extendedRtpCapabilities);if(!e)throw new v.UnsupportedError("cannot consume this Producer");const{localId:t,rtpReceiver:i,track:r}=await this._handler.receive({trackId:a,kind:c,rtpParameters:d});const n=new u.Consumer({id:a,localId:t,producerId:o,rtpReceiver:i,track:r,rtpParameters:d,appData:l});this._consumers.set(n.id,n);this._handleConsumer(n);if(!this._probatorConsumerCreated&&c==="video"){try{const s=y.generateProbatorRtpParameters(n.rtpParameters);await this._handler.receive({trackId:"probator",kind:"video",rtpParameters:s});b.debug("consume() | Consumer for RTP probation created");this._probatorConsumerCreated=true}catch(e){b.error("consume() | failed to create Consumer for RTP probation:%o",e)}}this._observer.safeEmit("newconsumer",n);return n},"transport.consume()")}async produceData({ordered:n=true,maxPacketLifeTime:s,maxRetransmits:a,priority:o="low",label:c="",protocol:d="",appData:l={}}={}){b.debug("produceData()");if(this._direction!=="send")throw new v.UnsupportedError("not a sending Transport");else if(!this._maxSctpMessageSize)throw new v.UnsupportedError("SCTP not enabled by remote Transport");else if(!["very-low","low","medium","high"].includes(o))throw new TypeError("wrong priority");else if(this.listenerCount("connect")===0&&this._connectionState==="new")throw new TypeError('no "connect" listener set into this transport');else if(this.listenerCount("producedata")===0)throw new TypeError('no "producedata" listener set into this transport');else if(l&&typeof l!=="object")throw new TypeError("if given, appData must be an object");if(s||a)n=false;return this._awaitQueue.push(async()=>{const{dataChannel:e,sctpStreamParameters:t}=await this._handler.sendDataChannel({ordered:n,maxPacketLifeTime:s,maxRetransmits:a,priority:o,label:c,protocol:d});y.validateSctpStreamParameters(t);const{id:i}=await this.safeEmitAsPromise("producedata",{sctpStreamParameters:t,label:c,protocol:d,appData:l});const r=new h.DataProducer({id:i,dataChannel:e,sctpStreamParameters:t,appData:l});this._dataProducers.set(r.id,r);this._handleDataProducer(r);this._observer.safeEmit("newdataproducer",r);return r},"transport.produceData()")}async consumeData({id:i,dataProducerId:r,sctpStreamParameters:n,label:s="",protocol:a="",appData:o={}}){b.debug("consumeData()");n=g.clone(n,undefined);if(this._closed)throw new v.InvalidStateError("closed");else if(this._direction!=="recv")throw new v.UnsupportedError("not a receiving Transport");else if(!this._maxSctpMessageSize)throw new v.UnsupportedError("SCTP not enabled by remote Transport");else if(typeof i!=="string")throw new TypeError("missing id");else if(typeof r!=="string")throw new TypeError("missing dataProducerId");else if(this.listenerCount("connect")===0&&this._connectionState==="new")throw new TypeError('no "connect" listener set into this transport');else if(o&&typeof o!=="object")throw new TypeError("if given, appData must be an object");y.validateSctpStreamParameters(n);return this._awaitQueue.push(async()=>{const{dataChannel:e}=await this._handler.receiveDataChannel({sctpStreamParameters:n,label:s,protocol:a});const t=new c.DataConsumer({id:i,dataProducerId:r,dataChannel:e,sctpStreamParameters:n,appData:o});this._dataConsumers.set(t.id,t);this._handleDataConsumer(t);this._observer.safeEmit("newdataconsumer",t);return t},"transport.consumeData()")}_handleHandler(){const e=this._handler;e.on("@connect",({dtlsParameters:e},t,i)=>{if(this._closed){i(new v.InvalidStateError("closed"));return}this.safeEmit("connect",{dtlsParameters:e},t,i)});e.on("@connectionstatechange",e=>{if(e===this._connectionState)return;b.debug("connection state changed to %s",e);this._connectionState=e;if(!this._closed)this.safeEmit("connectionstatechange",e)})}_handleProducer(r){r.on("@close",()=>{this._producers.delete(r.id);if(this._closed)return;this._awaitQueue.push(async()=>this._handler.stopSending(r.localId),"producer @close event").catch(e=>b.warn("producer.close() failed:%o",e))});r.on("@replacetrack",(e,t,i)=>{this._awaitQueue.push(async()=>this._handler.replaceTrack(r.localId,e),"producer @replacetrack event").then(t).catch(i)});r.on("@setmaxspatiallayer",(e,t,i)=>{this._awaitQueue.push(async()=>this._handler.setMaxSpatialLayer(r.localId,e),"producer @setmaxspatiallayer event").then(t).catch(i)});r.on("@setrtpencodingparameters",(e,t,i)=>{this._awaitQueue.push(async()=>this._handler.setRtpEncodingParameters(r.localId,e),"producer @setrtpencodingparameters event").then(t).catch(i)});r.on("@getstats",(e,t)=>{if(this._closed)return t(new v.InvalidStateError("closed"));this._handler.getSenderStats(r.localId).then(e).catch(t)})}_handleConsumer(i){i.on("@close",()=>{this._consumers.delete(i.id);if(this._closed)return;this._awaitQueue.push(async()=>this._handler.stopReceiving(i.localId),"consumer @close event").catch(()=>{})});i.on("@getstats",(e,t)=>{if(this._closed)return t(new v.InvalidStateError("closed"));this._handler.getReceiverStats(i.localId).then(e).catch(t)})}_handleDataProducer(e){e.on("@close",()=>{this._dataProducers.delete(e.id)})}_handleDataConsumer(e){e.on("@close",()=>{this._dataConsumers.delete(e.id)})}}i.Transport=o},{"./Consumer":10,"./DataConsumer":11,"./DataProducer":12,"./EnhancedEventEmitter":14,"./Logger":15,"./Producer":16,"./errors":20,"./ortc":38,"./utils":41,awaitqueue:2}],20:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:true});i.InvalidStateError=i.UnsupportedError=void 0;class r extends Error{constructor(e){super(e);this.name="UnsupportedError";if(Error.hasOwnProperty("captureStackTrace")){Error.captureStackTrace(this,r)}else{this.stack=new Error(e).stack}}}i.UnsupportedError=r;class n extends Error{constructor(e){super(e);this.name="InvalidStateError";if(Error.hasOwnProperty("captureStackTrace")){Error.captureStackTrace(this,n)}else{this.stack=new Error(e).stack}}}i.InvalidStateError=n},{}],21:[function(e,t,i){"use strict";var r=this&&this.__createBinding||(Object.create?function(e,t,i,r){if(r===undefined)r=i;Object.defineProperty(e,r,{enumerable:true,get:function(){return t[i]}})}:function(e,t,i,r){if(r===undefined)r=i;e[r]=t[i]});var n=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:true,value:t})}:function(e,t){e["default"]=t});var s=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(e!=null)for(var i in e)if(i!=="default"&&Object.hasOwnProperty.call(e,i))r(t,e,i);n(t,e);return t};Object.defineProperty(i,"__esModule",{value:true});i.Chrome55=void 0;const f=s(e("sdp-transform"));const a=e("../Logger");const o=e("../errors");const h=s(e("../utils"));const p=s(e("../ortc"));const m=s(e("./sdp/commonUtils"));const v=s(e("./sdp/planBUtils"));const c=e("./HandlerInterface");const l=e("./sdp/RemoteSdp");const g=new a.Logger("Chrome55");const y={OS:1024,MIS:1024};class d extends c.HandlerInterface{constructor(){super();this._sendStream=new MediaStream;this._mapSendLocalIdTrack=new Map;this._nextSendLocalId=0;this._mapRecvLocalIdInfo=new Map;this._hasDataChannelMediaSection=false;this._nextSendSctpStreamId=0;this._transportReady=false}static createFactory(){return()=>new d}get name(){return"Chrome55"}close(){g.debug("close()");if(this._pc){try{this._pc.close()}catch(e){}}}async getNativeRtpCapabilities(){g.debug("getNativeRtpCapabilities()");const t=new RTCPeerConnection({iceServers:[],iceTransportPolicy:"all",bundlePolicy:"max-bundle",rtcpMuxPolicy:"require",sdpSemantics:"plan-b"});try{const e=await t.createOffer({offerToReceiveAudio:true,offerToReceiveVideo:true});try{t.close()}catch(e){}const i=f.parse(e.sdp);const r=m.extractRtpCapabilities({sdpObject:i});return r}catch(e){try{t.close()}catch(e){}throw e}}async getNativeSctpCapabilities(){g.debug("getNativeSctpCapabilities()");return{numStreams:y}}run({direction:e,iceParameters:t,iceCandidates:i,dtlsParameters:r,sctpParameters:n,iceServers:s,iceTransportPolicy:a,additionalSettings:o,proprietaryConstraints:c,extendedRtpCapabilities:d}){g.debug("run()");this._direction=e;this._remoteSdp=new l.RemoteSdp({iceParameters:t,iceCandidates:i,dtlsParameters:r,sctpParameters:n,planB:true});this._sendingRtpParametersByKind={audio:p.getSendingRtpParameters("audio",d),video:p.getSendingRtpParameters("video",d)};this._sendingRemoteRtpParametersByKind={audio:p.getSendingRemoteRtpParameters("audio",d),video:p.getSendingRemoteRtpParameters("video",d)};this._pc=new RTCPeerConnection(Object.assign({iceServers:s||[],iceTransportPolicy:a||"all",bundlePolicy:"max-bundle",rtcpMuxPolicy:"require",sdpSemantics:"plan-b"},o),c);this._pc.addEventListener("iceconnectionstatechange",()=>{switch(this._pc.iceConnectionState){case"checking":this.emit("@connectionstatechange","connecting");break;case"connected":case"completed":this.emit("@connectionstatechange","connected");break;case"failed":this.emit("@connectionstatechange","failed");break;case"disconnected":this.emit("@connectionstatechange","disconnected");break;case"closed":this.emit("@connectionstatechange","closed");break}})}async updateIceServers(e){g.debug("updateIceServers()");const t=this._pc.getConfiguration();t.iceServers=e;this._pc.setConfiguration(t)}async restartIce(e){g.debug("restartIce()");this._remoteSdp.updateIceParameters(e);if(!this._transportReady)return;if(this._direction==="send"){const t=await this._pc.createOffer({iceRestart:true});g.debug("restartIce() | calling pc.setLocalDescription() [offer:%o]",t);await this._pc.setLocalDescription(t);const i={type:"answer",sdp:this._remoteSdp.getSdp()};g.debug("restartIce() | calling pc.setRemoteDescription() [answer:%o]",i);await this._pc.setRemoteDescription(i)}else{const t={type:"offer",sdp:this._remoteSdp.getSdp()};g.debug("restartIce() | calling pc.setRemoteDescription() [offer:%o]",t);await this._pc.setRemoteDescription(t);const i=await this._pc.createAnswer();g.debug("restartIce() | calling pc.setLocalDescription() [answer:%o]",i);await this._pc.setLocalDescription(i)}}async getTransportStats(){return this._pc.getStats()}async send({track:t,encodings:i,codecOptions:e,codec:r}){this._assertSendDirection();g.debug("send() [kind:%s, track.id:%s]",t.kind,t.id);if(r){g.warn("send() | codec selection is not available in %s handler",this.name)}this._sendStream.addTrack(t);this._pc.addStream(this._sendStream);let n=await this._pc.createOffer();let s=f.parse(n.sdp);let a;const o=h.clone(this._sendingRtpParametersByKind[t.kind],{});o.codecs=p.reduceCodecs(o.codecs);const c=h.clone(this._sendingRemoteRtpParametersByKind[t.kind],{});c.codecs=p.reduceCodecs(c.codecs);if(!this._transportReady)await this._setupTransport({localDtlsRole:"server",localSdpObject:s});if(t.kind==="video"&&i&&i.length>1){g.debug("send() | enabling simulcast");s=f.parse(n.sdp);a=s.media.find(e=>e.type==="video");v.addLegacySimulcast({offerMediaObject:a,track:t,numStreams:i.length});n={type:"offer",sdp:f.write(s)}}g.debug("send() | calling pc.setLocalDescription() [offer:%o]",n);await this._pc.setLocalDescription(n);s=f.parse(this._pc.localDescription.sdp);a=s.media.find(e=>e.type===t.kind);o.rtcp.cname=m.getCname({offerMediaObject:a});o.encodings=v.getRtpEncodings({offerMediaObject:a,track:t});if(i){for(let e=0;e<o.encodings.length;++e){if(i[e])Object.assign(o.encodings[e],i[e])}}if(o.encodings.length>1&&o.codecs[0].mimeType.toLowerCase()==="video/vp8"){for(const u of o.encodings){u.scalabilityMode="S1T3"}}this._remoteSdp.send({offerMediaObject:a,offerRtpParameters:o,answerRtpParameters:c,codecOptions:e});const d={type:"answer",sdp:this._remoteSdp.getSdp()};g.debug("send() | calling pc.setRemoteDescription() [answer:%o]",d);await this._pc.setRemoteDescription(d);const l=String(this._nextSendLocalId);this._nextSendLocalId++;this._mapSendLocalIdTrack.set(l,t);return{localId:l,rtpParameters:o}}async stopSending(e){this._assertSendDirection();g.debug("stopSending() [localId:%s]",e);const t=this._mapSendLocalIdTrack.get(e);if(!t)throw new Error("track not found");this._mapSendLocalIdTrack.delete(e);this._sendStream.removeTrack(t);this._pc.addStream(this._sendStream);const i=await this._pc.createOffer();g.debug("stopSending() | calling pc.setLocalDescription() [offer:%o]",i);try{await this._pc.setLocalDescription(i)}catch(e){if(this._sendStream.getTracks().length===0){g.warn("stopSending() | ignoring expected error due no sending tracks: %s",e.toString());return}throw e}if(this._pc.signalingState==="stable")return;const r={type:"answer",sdp:this._remoteSdp.getSdp()};g.debug("stopSending() | calling pc.setRemoteDescription() [answer:%o]",r);await this._pc.setRemoteDescription(r)}async replaceTrack(e,t){throw new o.UnsupportedError("not implemented")}async setMaxSpatialLayer(e,t){throw new o.UnsupportedError(" not implemented")}async setRtpEncodingParameters(e,t){throw new o.UnsupportedError("not supported")}async getSenderStats(e){throw new o.UnsupportedError("not implemented")}async sendDataChannel({ordered:e,maxPacketLifeTime:t,maxRetransmits:i,label:r,protocol:n,priority:s}){this._assertSendDirection();const a={negotiated:true,id:this._nextSendSctpStreamId,ordered:e,maxPacketLifeTime:t,maxRetransmitTime:t,maxRetransmits:i,protocol:n,priority:s};g.debug("sendDataChannel() [options:%o]",a);const o=this._pc.createDataChannel(r,a);this._nextSendSctpStreamId=++this._nextSendSctpStreamId%y.MIS;if(!this._hasDataChannelMediaSection){const d=await this._pc.createOffer();const l=f.parse(d.sdp);const u=l.media.find(e=>e.type==="application");if(!this._transportReady)await this._setupTransport({localDtlsRole:"server",localSdpObject:l});g.debug("sendDataChannel() | calling pc.setLocalDescription() [offer:%o]",d);await this._pc.setLocalDescription(d);this._remoteSdp.sendSctpAssociation({offerMediaObject:u});const h={type:"answer",sdp:this._remoteSdp.getSdp()};g.debug("sendDataChannel() | calling pc.setRemoteDescription() [answer:%o]",h);await this._pc.setRemoteDescription(h);this._hasDataChannelMediaSection=true}const c={streamId:a.id,ordered:a.ordered,maxPacketLifeTime:a.maxPacketLifeTime,maxRetransmits:a.maxRetransmits};return{dataChannel:o,sctpStreamParameters:c}}async receive({trackId:e,kind:t,rtpParameters:i}){this._assertRecvDirection();g.debug("receive() [trackId:%s, kind:%s]",e,t);const r=e;const n=t;const s=i.rtcp.cname;this._remoteSdp.receive({mid:n,kind:t,offerRtpParameters:i,streamId:s,trackId:e});const a={type:"offer",sdp:this._remoteSdp.getSdp()};g.debug("receive() | calling pc.setRemoteDescription() [offer:%o]",a);await this._pc.setRemoteDescription(a);let o=await this._pc.createAnswer();const c=f.parse(o.sdp);const d=c.media.find(e=>String(e.mid)===n);m.applyCodecParameters({offerRtpParameters:i,answerMediaObject:d});o={type:"answer",sdp:f.write(c)};if(!this._transportReady)await this._setupTransport({localDtlsRole:"client",localSdpObject:c});g.debug("receive() | calling pc.setLocalDescription() [answer:%o]",o);await this._pc.setLocalDescription(o);const l=this._pc.getRemoteStreams().find(e=>e.id===s);const u=l.getTrackById(r);if(!u)throw new Error("remote track not found");this._mapRecvLocalIdInfo.set(r,{mid:n,rtpParameters:i});return{localId:r,track:u}}async stopReceiving(e){this._assertRecvDirection();g.debug("stopReceiving() [localId:%s]",e);const{mid:t,rtpParameters:i}=this._mapRecvLocalIdInfo.get(e)||{};this._mapRecvLocalIdInfo.delete(e);this._remoteSdp.planBStopReceiving({mid:t,offerRtpParameters:i});const r={type:"offer",sdp:this._remoteSdp.getSdp()};g.debug("stopReceiving() | calling pc.setRemoteDescription() [offer:%o]",r);await this._pc.setRemoteDescription(r);const n=await this._pc.createAnswer();g.debug("stopReceiving() | calling pc.setLocalDescription() [answer:%o]",n);await this._pc.setLocalDescription(n)}async getReceiverStats(e){throw new o.UnsupportedError("not implemented")}async receiveDataChannel({sctpStreamParameters:e,label:t,protocol:i}){this._assertRecvDirection();const{streamId:r,ordered:n,maxPacketLifeTime:s,maxRetransmits:a}=e;const o={negotiated:true,id:r,ordered:n,maxPacketLifeTime:s,maxRetransmitTime:s,maxRetransmits:a,protocol:i};g.debug("receiveDataChannel() [options:%o]",o);const c=this._pc.createDataChannel(t,o);if(!this._hasDataChannelMediaSection){this._remoteSdp.receiveSctpAssociation({oldDataChannelSpec:true});const d={type:"offer",sdp:this._remoteSdp.getSdp()};g.debug("receiveDataChannel() | calling pc.setRemoteDescription() [offer:%o]",d);await this._pc.setRemoteDescription(d);const l=await this._pc.createAnswer();if(!this._transportReady){const u=f.parse(l.sdp);await this._setupTransport({localDtlsRole:"client",localSdpObject:u})}g.debug("receiveDataChannel() | calling pc.setRemoteDescription() [answer:%o]",l);await this._pc.setLocalDescription(l);this._hasDataChannelMediaSection=true}return{dataChannel:c}}async _setupTransport({localDtlsRole:e,localSdpObject:t}){if(!t)t=f.parse(this._pc.localDescription.sdp);const i=m.extractDtlsParameters({sdpObject:t});i.role=e;this._remoteSdp.updateDtlsRole(e==="client"?"server":"client");await this.safeEmitAsPromise("@connect",{dtlsParameters:i});this._transportReady=true}_assertSendDirection(){if(this._direction!=="send"){throw new Error('method can just be called for handlers with "send" direction')}}_assertRecvDirection(){if(this._direction!=="recv"){throw new Error('method can just be called for handlers with "recv" direction')}}}i.Chrome55=d},{"../Logger":15,"../errors":20,"../ortc":38,"../utils":41,"./HandlerInterface":27,"./sdp/RemoteSdp":33,"./sdp/commonUtils":34,"./sdp/planBUtils":35,"sdp-transform":64}],22:[function(e,t,i){"use strict";var r=this&&this.__createBinding||(Object.create?function(e,t,i,r){if(r===undefined)r=i;Object.defineProperty(e,r,{enumerable:true,get:function(){return t[i]}})}:function(e,t,i,r){if(r===undefined)r=i;e[r]=t[i]});var n=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:true,value:t})}:function(e,t){e["default"]=t});var s=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(e!=null)for(var i in e)if(i!=="default"&&Object.hasOwnProperty.call(e,i))r(t,e,i);n(t,e);return t};Object.defineProperty(i,"__esModule",{value:true});i.Chrome67=void 0;const f=s(e("sdp-transform"));const a=e("../Logger");const p=s(e("../utils"));const m=s(e("../ortc"));const v=s(e("./sdp/commonUtils"));const g=s(e("./sdp/planBUtils"));const o=e("./HandlerInterface");const l=e("./sdp/RemoteSdp");const y=new a.Logger("Chrome67");const _={OS:1024,MIS:1024};class c extends o.HandlerInterface{constructor(){super();this._sendStream=new MediaStream;this._mapSendLocalIdRtpSender=new Map;this._nextSendLocalId=0;this._mapRecvLocalIdInfo=new Map;this._hasDataChannelMediaSection=false;this._nextSendSctpStreamId=0;this._transportReady=false}static createFactory(){return()=>new c}get name(){return"Chrome67"}close(){y.debug("close()");if(this._pc){try{this._pc.close()}catch(e){}}}async getNativeRtpCapabilities(){y.debug("getNativeRtpCapabilities()");const t=new RTCPeerConnection({iceServers:[],iceTransportPolicy:"all",bundlePolicy:"max-bundle",rtcpMuxPolicy:"require",sdpSemantics:"plan-b"});try{const e=await t.createOffer({offerToReceiveAudio:true,offerToReceiveVideo:true});try{t.close()}catch(e){}const i=f.parse(e.sdp);const r=v.extractRtpCapabilities({sdpObject:i});return r}catch(e){try{t.close()}catch(e){}throw e}}async getNativeSctpCapabilities(){y.debug("getNativeSctpCapabilities()");return{numStreams:_}}run({direction:e,iceParameters:t,iceCandidates:i,dtlsParameters:r,sctpParameters:n,iceServers:s,iceTransportPolicy:a,additionalSettings:o,proprietaryConstraints:c,extendedRtpCapabilities:d}){y.debug("run()");this._direction=e;this._remoteSdp=new l.RemoteSdp({iceParameters:t,iceCandidates:i,dtlsParameters:r,sctpParameters:n,planB:true});this._sendingRtpParametersByKind={audio:m.getSendingRtpParameters("audio",d),video:m.getSendingRtpParameters("video",d)};this._sendingRemoteRtpParametersByKind={audio:m.getSendingRemoteRtpParameters("audio",d),video:m.getSendingRemoteRtpParameters("video",d)};this._pc=new RTCPeerConnection(Object.assign({iceServers:s||[],iceTransportPolicy:a||"all",bundlePolicy:"max-bundle",rtcpMuxPolicy:"require",sdpSemantics:"plan-b"},o),c);this._pc.addEventListener("iceconnectionstatechange",()=>{switch(this._pc.iceConnectionState){case"checking":this.emit("@connectionstatechange","connecting");break;case"connected":case"completed":this.emit("@connectionstatechange","connected");break;case"failed":this.emit("@connectionstatechange","failed");break;case"disconnected":this.emit("@connectionstatechange","disconnected");break;case"closed":this.emit("@connectionstatechange","closed");break}})}async updateIceServers(e){y.debug("updateIceServers()");const t=this._pc.getConfiguration();t.iceServers=e;this._pc.setConfiguration(t)}async restartIce(e){y.debug("restartIce()");this._remoteSdp.updateIceParameters(e);if(!this._transportReady)return;if(this._direction==="send"){const t=await this._pc.createOffer({iceRestart:true});y.debug("restartIce() | calling pc.setLocalDescription() [offer:%o]",t);await this._pc.setLocalDescription(t);const i={type:"answer",sdp:this._remoteSdp.getSdp()};y.debug("restartIce() | calling pc.setRemoteDescription() [answer:%o]",i);await this._pc.setRemoteDescription(i)}else{const t={type:"offer",sdp:this._remoteSdp.getSdp()};y.debug("restartIce() | calling pc.setRemoteDescription() [offer:%o]",t);await this._pc.setRemoteDescription(t);const i=await this._pc.createAnswer();y.debug("restartIce() | calling pc.setLocalDescription() [answer:%o]",i);await this._pc.setLocalDescription(i)}}async getTransportStats(){return this._pc.getStats()}async send({track:t,encodings:i,codecOptions:e,codec:r}){this._assertSendDirection();y.debug("send() [kind:%s, track.id:%s]",t.kind,t.id);if(r){y.warn("send() | codec selection is not available in %s handler",this.name)}this._sendStream.addTrack(t);this._pc.addTrack(t,this._sendStream);let n=await this._pc.createOffer();let s=f.parse(n.sdp);let a;const o=p.clone(this._sendingRtpParametersByKind[t.kind],{});o.codecs=m.reduceCodecs(o.codecs);const c=p.clone(this._sendingRemoteRtpParametersByKind[t.kind],{});c.codecs=m.reduceCodecs(c.codecs);if(!this._transportReady)await this._setupTransport({localDtlsRole:"server",localSdpObject:s});if(t.kind==="video"&&i&&i.length>1){y.debug("send() | enabling simulcast");s=f.parse(n.sdp);a=s.media.find(e=>e.type==="video");g.addLegacySimulcast({offerMediaObject:a,track:t,numStreams:i.length});n={type:"offer",sdp:f.write(s)}}y.debug("send() | calling pc.setLocalDescription() [offer:%o]",n);await this._pc.setLocalDescription(n);s=f.parse(this._pc.localDescription.sdp);a=s.media.find(e=>e.type===t.kind);o.rtcp.cname=v.getCname({offerMediaObject:a});o.encodings=g.getRtpEncodings({offerMediaObject:a,track:t});if(i){for(let e=0;e<o.encodings.length;++e){if(i[e])Object.assign(o.encodings[e],i[e])}}if(o.encodings.length>1&&o.codecs[0].mimeType.toLowerCase()==="video/vp8"){for(const h of o.encodings){h.scalabilityMode="S1T3"}}this._remoteSdp.send({offerMediaObject:a,offerRtpParameters:o,answerRtpParameters:c,codecOptions:e});const d={type:"answer",sdp:this._remoteSdp.getSdp()};y.debug("send() | calling pc.setRemoteDescription() [answer:%o]",d);await this._pc.setRemoteDescription(d);const l=String(this._nextSendLocalId);this._nextSendLocalId++;const u=this._pc.getSenders().find(e=>e.track===t);this._mapSendLocalIdRtpSender.set(l,u);return{localId:l,rtpParameters:o,rtpSender:u}}async stopSending(e){this._assertSendDirection();y.debug("stopSending() [localId:%s]",e);const t=this._mapSendLocalIdRtpSender.get(e);if(!t)throw new Error("associated RTCRtpSender not found");this._pc.removeTrack(t);if(t.track)this._sendStream.removeTrack(t.track);this._mapSendLocalIdRtpSender.delete(e);const i=await this._pc.createOffer();y.debug("stopSending() | calling pc.setLocalDescription() [offer:%o]",i);try{await this._pc.setLocalDescription(i)}catch(e){if(this._sendStream.getTracks().length===0){y.warn("stopSending() | ignoring expected error due no sending tracks: %s",e.toString());return}throw e}if(this._pc.signalingState==="stable")return;const r={type:"answer",sdp:this._remoteSdp.getSdp()};y.debug("stopSending() | calling pc.setRemoteDescription() [answer:%o]",r);await this._pc.setRemoteDescription(r)}async replaceTrack(e,t){this._assertSendDirection();if(t){y.debug("replaceTrack() [localId:%s, track.id:%s]",e,t.id)}else{y.debug("replaceTrack() [localId:%s, no track]",e)}const i=this._mapSendLocalIdRtpSender.get(e);if(!i)throw new Error("associated RTCRtpSender not found");const r=i.track;await i.replaceTrack(t);if(r)this._sendStream.removeTrack(r);if(t)this._sendStream.addTrack(t)}async setMaxSpatialLayer(e,i){this._assertSendDirection();y.debug("setMaxSpatialLayer() [localId:%s, spatialLayer:%s]",e,i);const t=this._mapSendLocalIdRtpSender.get(e);if(!t)throw new Error("associated RTCRtpSender not found");const r=t.getParameters();r.encodings.forEach((e,t)=>{if(t<=i)e.active=true;else e.active=false});await t.setParameters(r)}async setRtpEncodingParameters(e,i){this._assertSendDirection();y.debug("setRtpEncodingParameters() [localId:%s, params:%o]",e,i);const t=this._mapSendLocalIdRtpSender.get(e);if(!t)throw new Error("associated RTCRtpSender not found");const r=t.getParameters();r.encodings.forEach((e,t)=>{r.encodings[t]=Object.assign(Object.assign({},e),i)});await t.setParameters(r)}async getSenderStats(e){this._assertSendDirection();const t=this._mapSendLocalIdRtpSender.get(e);if(!t)throw new Error("associated RTCRtpSender not found");return t.getStats()}async sendDataChannel({ordered:e,maxPacketLifeTime:t,maxRetransmits:i,label:r,protocol:n,priority:s}){this._assertSendDirection();const a={negotiated:true,id:this._nextSendSctpStreamId,ordered:e,maxPacketLifeTime:t,maxRetransmitTime:t,maxRetransmits:i,protocol:n,priority:s};y.debug("sendDataChannel() [options:%o]",a);const o=this._pc.createDataChannel(r,a);this._nextSendSctpStreamId=++this._nextSendSctpStreamId%_.MIS;if(!this._hasDataChannelMediaSection){const d=await this._pc.createOffer();const l=f.parse(d.sdp);const u=l.media.find(e=>e.type==="application");if(!this._transportReady)await this._setupTransport({localDtlsRole:"server",localSdpObject:l});y.debug("sendDataChannel() | calling pc.setLocalDescription() [offer:%o]",d);await this._pc.setLocalDescription(d);this._remoteSdp.sendSctpAssociation({offerMediaObject:u});const h={type:"answer",sdp:this._remoteSdp.getSdp()};y.debug("sendDataChannel() | calling pc.setRemoteDescription() [answer:%o]",h);await this._pc.setRemoteDescription(h);this._hasDataChannelMediaSection=true}const c={streamId:a.id,ordered:a.ordered,maxPacketLifeTime:a.maxPacketLifeTime,maxRetransmits:a.maxRetransmits};return{dataChannel:o,sctpStreamParameters:c}}async receive({trackId:e,kind:t,rtpParameters:i}){this._assertRecvDirection();y.debug("receive() [trackId:%s, kind:%s]",e,t);const r=e;const n=t;this._remoteSdp.receive({mid:n,kind:t,offerRtpParameters:i,streamId:i.rtcp.cname,trackId:e});const s={type:"offer",sdp:this._remoteSdp.getSdp()};y.debug("receive() | calling pc.setRemoteDescription() [offer:%o]",s);await this._pc.setRemoteDescription(s);let a=await this._pc.createAnswer();const o=f.parse(a.sdp);const c=o.media.find(e=>String(e.mid)===n);v.applyCodecParameters({offerRtpParameters:i,answerMediaObject:c});a={type:"answer",sdp:f.write(o)};if(!this._transportReady)await this._setupTransport({localDtlsRole:"client",localSdpObject:o});y.debug("receive() | calling pc.setLocalDescription() [answer:%o]",a);await this._pc.setLocalDescription(a);const d=this._pc.getReceivers().find(e=>e.track&&e.track.id===r);if(!d)throw new Error("new RTCRtpReceiver not");this._mapRecvLocalIdInfo.set(r,{mid:n,rtpParameters:i,rtpReceiver:d});return{localId:r,track:d.track,rtpReceiver:d}}async stopReceiving(e){this._assertRecvDirection();y.debug("stopReceiving() [localId:%s]",e);const{mid:t,rtpParameters:i}=this._mapRecvLocalIdInfo.get(e)||{};this._mapRecvLocalIdInfo.delete(e);this._remoteSdp.planBStopReceiving({mid:t,offerRtpParameters:i});const r={type:"offer",sdp:this._remoteSdp.getSdp()};y.debug("stopReceiving() | calling pc.setRemoteDescription() [offer:%o]",r);await this._pc.setRemoteDescription(r);const n=await this._pc.createAnswer();y.debug("stopReceiving() | calling pc.setLocalDescription() [answer:%o]",n);await this._pc.setLocalDescription(n)}async getReceiverStats(e){this._assertRecvDirection();const{rtpReceiver:t}=this._mapRecvLocalIdInfo.get(e)||{};if(!t)throw new Error("associated RTCRtpReceiver not found");return t.getStats()}async receiveDataChannel({sctpStreamParameters:e,label:t,protocol:i}){this._assertRecvDirection();const{streamId:r,ordered:n,maxPacketLifeTime:s,maxRetransmits:a}=e;const o={negotiated:true,id:r,ordered:n,maxPacketLifeTime:s,maxRetransmitTime:s,maxRetransmits:a,protocol:i};y.debug("receiveDataChannel() [options:%o]",o);const c=this._pc.createDataChannel(t,o);if(!this._hasDataChannelMediaSection){this._remoteSdp.receiveSctpAssociation({oldDataChannelSpec:true});const d={type:"offer",sdp:this._remoteSdp.getSdp()};y.debug("receiveDataChannel() | calling pc.setRemoteDescription() [offer:%o]",d);await this._pc.setRemoteDescription(d);const l=await this._pc.createAnswer();if(!this._transportReady){const u=f.parse(l.sdp);await this._setupTransport({localDtlsRole:"client",localSdpObject:u})}y.debug("receiveDataChannel() | calling pc.setRemoteDescription() [answer:%o]",l);await this._pc.setLocalDescription(l);this._hasDataChannelMediaSection=true}return{dataChannel:c}}async _setupTransport({localDtlsRole:e,localSdpObject:t}){if(!t)t=f.parse(this._pc.localDescription.sdp);const i=v.extractDtlsParameters({sdpObject:t});i.role=e;this._remoteSdp.updateDtlsRole(e==="client"?"server":"client");await this.safeEmitAsPromise("@connect",{dtlsParameters:i});this._transportReady=true}_assertSendDirection(){if(this._direction!=="send"){throw new Error('method can just be called for handlers with "send" direction')}}_assertRecvDirection(){if(this._direction!=="recv"){throw new Error('method can just be called for handlers with "recv" direction')}}}i.Chrome67=c},{"../Logger":15,"../ortc":38,"../utils":41,"./HandlerInterface":27,"./sdp/RemoteSdp":33,"./sdp/commonUtils":34,"./sdp/planBUtils":35,"sdp-transform":64}],23:[function(e,t,i){"use strict";var r=this&&this.__createBinding||(Object.create?function(e,t,i,r){if(r===undefined)r=i;Object.defineProperty(e,r,{enumerable:true,get:function(){return t[i]}})}:function(e,t,i,r){if(r===undefined)r=i;e[r]=t[i]});var n=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:true,value:t})}:function(e,t){e["default"]=t});var s=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(e!=null)for(var i in e)if(i!=="default"&&Object.hasOwnProperty.call(e,i))r(t,e,i);n(t,e);return t};Object.defineProperty(i,"__esModule",{value:true});i.Chrome70=void 0;const y=s(e("sdp-transform"));const a=e("../Logger");const _=s(e("../utils"));const b=s(e("../ortc"));const S=s(e("./sdp/commonUtils"));const w=s(e("./sdp/unifiedPlanUtils"));const o=e("./HandlerInterface");const l=e("./sdp/RemoteSdp");const k=e("../scalabilityModes");const C=new a.Logger("Chrome70");const f={OS:1024,MIS:1024};class c extends o.HandlerInterface{constructor(){super();this._mapMidTransceiver=new Map;this._sendStream=new MediaStream;this._hasDataChannelMediaSection=false;this._nextSendSctpStreamId=0;this._transportReady=false}static createFactory(){return()=>new c}get name(){return"Chrome70"}close(){C.debug("close()");if(this._pc){try{this._pc.close()}catch(e){}}}async getNativeRtpCapabilities(){C.debug("getNativeRtpCapabilities()");const t=new RTCPeerConnection({iceServers:[],iceTransportPolicy:"all",bundlePolicy:"max-bundle",rtcpMuxPolicy:"require",sdpSemantics:"unified-plan"});try{t.addTransceiver("audio");t.addTransceiver("video");const e=await t.createOffer();try{t.close()}catch(e){}const i=y.parse(e.sdp);const r=S.extractRtpCapabilities({sdpObject:i});return r}catch(e){try{t.close()}catch(e){}throw e}}async getNativeSctpCapabilities(){C.debug("getNativeSctpCapabilities()");return{numStreams:f}}run({direction:e,iceParameters:t,iceCandidates:i,dtlsParameters:r,sctpParameters:n,iceServers:s,iceTransportPolicy:a,additionalSettings:o,proprietaryConstraints:c,extendedRtpCapabilities:d}){C.debug("run()");this._direction=e;this._remoteSdp=new l.RemoteSdp({iceParameters:t,iceCandidates:i,dtlsParameters:r,sctpParameters:n});this._sendingRtpParametersByKind={audio:b.getSendingRtpParameters("audio",d),video:b.getSendingRtpParameters("video",d)};this._sendingRemoteRtpParametersByKind={audio:b.getSendingRemoteRtpParameters("audio",d),video:b.getSendingRemoteRtpParameters("video",d)};this._pc=new RTCPeerConnection(Object.assign({iceServers:s||[],iceTransportPolicy:a||"all",bundlePolicy:"max-bundle",rtcpMuxPolicy:"require",sdpSemantics:"unified-plan"},o),c);this._pc.addEventListener("iceconnectionstatechange",()=>{switch(this._pc.iceConnectionState){case"checking":this.emit("@connectionstatechange","connecting");break;case"connected":case"completed":this.emit("@connectionstatechange","connected");break;case"failed":this.emit("@connectionstatechange","failed");break;case"disconnected":this.emit("@connectionstatechange","disconnected");break;case"closed":this.emit("@connectionstatechange","closed");break}})}async updateIceServers(e){C.debug("updateIceServers()");const t=this._pc.getConfiguration();t.iceServers=e;this._pc.setConfiguration(t)}async restartIce(e){C.debug("restartIce()");this._remoteSdp.updateIceParameters(e);if(!this._transportReady)return;if(this._direction==="send"){const t=await this._pc.createOffer({iceRestart:true});C.debug("restartIce() | calling pc.setLocalDescription() [offer:%o]",t);await this._pc.setLocalDescription(t);const i={type:"answer",sdp:this._remoteSdp.getSdp()};C.debug("restartIce() | calling pc.setRemoteDescription() [answer:%o]",i);await this._pc.setRemoteDescription(i)}else{const t={type:"offer",sdp:this._remoteSdp.getSdp()};C.debug("restartIce() | calling pc.setRemoteDescription() [offer:%o]",t);await this._pc.setRemoteDescription(t);const i=await this._pc.createAnswer();C.debug("restartIce() | calling pc.setLocalDescription() [answer:%o]",i);await this._pc.setLocalDescription(i)}}async getTransportStats(){return this._pc.getStats()}async send({track:e,encodings:t,codecOptions:i,codec:r}){this._assertSendDirection();C.debug("send() [kind:%s, track.id:%s]",e.kind,e.id);const n=_.clone(this._sendingRtpParametersByKind[e.kind],{});n.codecs=b.reduceCodecs(n.codecs,r);const s=_.clone(this._sendingRemoteRtpParametersByKind[e.kind],{});s.codecs=b.reduceCodecs(s.codecs,r);const a=this._remoteSdp.getNextMediaSectionIdx();const o=this._pc.addTransceiver(e,{direction:"sendonly",streams:[this._sendStream]});let c=await this._pc.createOffer();let d=y.parse(c.sdp);let l;if(!this._transportReady)await this._setupTransport({localDtlsRole:"server",localSdpObject:d});if(t&&t.length>1){C.debug("send() | enabling legacy simulcast");d=y.parse(c.sdp);l=d.media[a.idx];w.addLegacySimulcast({offerMediaObject:l,numStreams:t.length});c={type:"offer",sdp:y.write(d)}}let u=false;const h=k.parse((t||[{}])[0].scalabilityMode);if(t&&t.length===1&&h.spatialLayers>1&&n.codecs[0].mimeType.toLowerCase()==="video/vp9"){C.debug("send() | enabling legacy simulcast for VP9 SVC");u=true;d=y.parse(c.sdp);l=d.media[a.idx];w.addLegacySimulcast({offerMediaObject:l,numStreams:h.spatialLayers});c={type:"offer",sdp:y.write(d)}}C.debug("send() | calling pc.setLocalDescription() [offer:%o]",c);await this._pc.setLocalDescription(c);if(t){C.debug("send() | applying given encodings");const m=o.sender.getParameters();for(let e=0;e<(m.encodings||[]).length;++e){const v=m.encodings[e];const g=t[e];if(!g)break;m.encodings[e]=Object.assign(v,g)}await o.sender.setParameters(m)}const f=o.mid;n.mid=f;d=y.parse(this._pc.localDescription.sdp);l=d.media[a.idx];n.rtcp.cname=S.getCname({offerMediaObject:l});n.encodings=w.getRtpEncodings({offerMediaObject:l});if(t){for(let e=0;e<n.encodings.length;++e){if(t[e])Object.assign(n.encodings[e],t[e])}}if(u){n.encodings=[n.encodings[0]]}if(n.encodings.length>1&&(n.codecs[0].mimeType.toLowerCase()==="video/vp8"||n.codecs[0].mimeType.toLowerCase()==="video/h264")){for(const v of n.encodings){v.scalabilityMode="S1T3"}}this._remoteSdp.send({offerMediaObject:l,reuseMid:a.reuseMid,offerRtpParameters:n,answerRtpParameters:s,codecOptions:i});const p={type:"answer",sdp:this._remoteSdp.getSdp()};C.debug("send() | calling pc.setRemoteDescription() [answer:%o]",p);await this._pc.setRemoteDescription(p);this._mapMidTransceiver.set(f,o);return{localId:f,rtpParameters:n,rtpSender:o.sender}}async stopSending(e){this._assertSendDirection();C.debug("stopSending() [localId:%s]",e);const t=this._mapMidTransceiver.get(e);if(!t)throw new Error("associated RTCRtpTransceiver not found");t.sender.replaceTrack(null);this._pc.removeTrack(t.sender);this._remoteSdp.closeMediaSection(t.mid);const i=await this._pc.createOffer();C.debug("stopSending() | calling pc.setLocalDescription() [offer:%o]",i);await this._pc.setLocalDescription(i);const r={type:"answer",sdp:this._remoteSdp.getSdp()};C.debug("stopSending() | calling pc.setRemoteDescription() [answer:%o]",r);await this._pc.setRemoteDescription(r)}async replaceTrack(e,t){this._assertSendDirection();if(t){C.debug("replaceTrack() [localId:%s, track.id:%s]",e,t.id)}else{C.debug("replaceTrack() [localId:%s, no track]",e)}const i=this._mapMidTransceiver.get(e);if(!i)throw new Error("associated RTCRtpTransceiver not found");await i.sender.replaceTrack(t)}async setMaxSpatialLayer(e,i){this._assertSendDirection();C.debug("setMaxSpatialLayer() [localId:%s, spatialLayer:%s]",e,i);const t=this._mapMidTransceiver.get(e);if(!t)throw new Error("associated RTCRtpTransceiver not found");const r=t.sender.getParameters();r.encodings.forEach((e,t)=>{if(t<=i)e.active=true;else e.active=false});await t.sender.setParameters(r)}async setRtpEncodingParameters(e,i){this._assertSendDirection();C.debug("setRtpEncodingParameters() [localId:%s, params:%o]",e,i);const t=this._mapMidTransceiver.get(e);if(!t)throw new Error("associated RTCRtpTransceiver not found");const r=t.sender.getParameters();r.encodings.forEach((e,t)=>{r.encodings[t]=Object.assign(Object.assign({},e),i)});await t.sender.setParameters(r)}async getSenderStats(e){this._assertSendDirection();const t=this._mapMidTransceiver.get(e);if(!t)throw new Error("associated RTCRtpTransceiver not found");return t.sender.getStats()}async sendDataChannel({ordered:e,maxPacketLifeTime:t,maxRetransmits:i,label:r,protocol:n,priority:s}){this._assertSendDirection();const a={negotiated:true,id:this._nextSendSctpStreamId,ordered:e,maxPacketLifeTime:t,maxRetransmitTime:t,maxRetransmits:i,protocol:n,priority:s};C.debug("sendDataChannel() [options:%o]",a);const o=this._pc.createDataChannel(r,a);this._nextSendSctpStreamId=++this._nextSendSctpStreamId%f.MIS;if(!this._hasDataChannelMediaSection){const d=await this._pc.createOffer();const l=y.parse(d.sdp);const u=l.media.find(e=>e.type==="application");if(!this._transportReady)await this._setupTransport({localDtlsRole:"server",localSdpObject:l});C.debug("sendDataChannel() | calling pc.setLocalDescription() [offer:%o]",d);await this._pc.setLocalDescription(d);this._remoteSdp.sendSctpAssociation({offerMediaObject:u});const h={type:"answer",sdp:this._remoteSdp.getSdp()};C.debug("sendDataChannel() | calling pc.setRemoteDescription() [answer:%o]",h);await this._pc.setRemoteDescription(h);this._hasDataChannelMediaSection=true}const c={streamId:a.id,ordered:a.ordered,maxPacketLifeTime:a.maxPacketLifeTime,maxRetransmits:a.maxRetransmits};return{dataChannel:o,sctpStreamParameters:c}}async receive({trackId:e,kind:t,rtpParameters:i}){this._assertRecvDirection();C.debug("receive() [trackId:%s, kind:%s]",e,t);const r=i.mid||String(this._mapMidTransceiver.size);this._remoteSdp.receive({mid:r,kind:t,offerRtpParameters:i,streamId:i.rtcp.cname,trackId:e});const n={type:"offer",sdp:this._remoteSdp.getSdp()};C.debug("receive() | calling pc.setRemoteDescription() [offer:%o]",n);await this._pc.setRemoteDescription(n);let s=await this._pc.createAnswer();const a=y.parse(s.sdp);const o=a.media.find(e=>String(e.mid)===r);S.applyCodecParameters({offerRtpParameters:i,answerMediaObject:o});s={type:"answer",sdp:y.write(a)};if(!this._transportReady)await this._setupTransport({localDtlsRole:"client",localSdpObject:a});C.debug("receive() | calling pc.setLocalDescription() [answer:%o]",s);await this._pc.setLocalDescription(s);const c=this._pc.getTransceivers().find(e=>e.mid===r);if(!c)throw new Error("new RTCRtpTransceiver not found");this._mapMidTransceiver.set(r,c);return{localId:r,track:c.receiver.track,rtpReceiver:c.receiver}}async stopReceiving(e){this._assertRecvDirection();C.debug("stopReceiving() [localId:%s]",e);const t=this._mapMidTransceiver.get(e);if(!t)throw new Error("associated RTCRtpTransceiver not found");this._remoteSdp.closeMediaSection(t.mid);const i={type:"offer",sdp:this._remoteSdp.getSdp()};C.debug("stopReceiving() | calling pc.setRemoteDescription() [offer:%o]",i);await this._pc.setRemoteDescription(i);const r=await this._pc.createAnswer();C.debug("stopReceiving() | calling pc.setLocalDescription() [answer:%o]",r);await this._pc.setLocalDescription(r)}async getReceiverStats(e){this._assertRecvDirection();const t=this._mapMidTransceiver.get(e);if(!t)throw new Error("associated RTCRtpTransceiver not found");return t.receiver.getStats()}async receiveDataChannel({sctpStreamParameters:e,label:t,protocol:i}){this._assertRecvDirection();const{streamId:r,ordered:n,maxPacketLifeTime:s,maxRetransmits:a}=e;const o={negotiated:true,id:r,ordered:n,maxPacketLifeTime:s,maxRetransmitTime:s,maxRetransmits:a,protocol:i};C.debug("receiveDataChannel() [options:%o]",o);const c=this._pc.createDataChannel(t,o);if(!this._hasDataChannelMediaSection){this._remoteSdp.receiveSctpAssociation();const d={type:"offer",sdp:this._remoteSdp.getSdp()};C.debug("receiveDataChannel() | calling pc.setRemoteDescription() [offer:%o]",d);await this._pc.setRemoteDescription(d);const l=await this._pc.createAnswer();if(!this._transportReady){const u=y.parse(l.sdp);await this._setupTransport({localDtlsRole:"client",localSdpObject:u})}C.debug("receiveDataChannel() | calling pc.setRemoteDescription() [answer:%o]",l);await this._pc.setLocalDescription(l);this._hasDataChannelMediaSection=true}return{dataChannel:c}}async _setupTransport({localDtlsRole:e,localSdpObject:t}){if(!t)t=y.parse(this._pc.localDescription.sdp);const i=S.extractDtlsParameters({sdpObject:t});i.role=e;this._remoteSdp.updateDtlsRole(e==="client"?"server":"client");await this.safeEmitAsPromise("@connect",{dtlsParameters:i});this._transportReady=true}_assertSendDirection(){if(this._direction!=="send"){throw new Error('method can just be called for handlers with "send" direction')}}_assertRecvDirection(){if(this._direction!=="recv"){throw new Error('method can just be called for handlers with "recv" direction')}}}i.Chrome70=c},{"../Logger":15,"../ortc":38,"../scalabilityModes":39,"../utils":41,"./HandlerInterface":27,"./sdp/RemoteSdp":33,"./sdp/commonUtils":34,"./sdp/unifiedPlanUtils":36,"sdp-transform":64}],24:[function(e,t,i){"use strict";var r=this&&this.__createBinding||(Object.create?function(e,t,i,r){if(r===undefined)r=i;Object.defineProperty(e,r,{enumerable:true,get:function(){return t[i]}})}:function(e,t,i,r){if(r===undefined)r=i;e[r]=t[i]});var n=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:true,value:t})}:function(e,t){e["default"]=t});var s=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(e!=null)for(var i in e)if(i!=="default"&&Object.hasOwnProperty.call(e,i))r(t,e,i);n(t,e);return t};Object.defineProperty(i,"__esModule",{value:true});i.Chrome74=void 0;const v=s(e("sdp-transform"));const a=e("../Logger");const g=s(e("../utils"));const y=s(e("../ortc"));const _=s(e("./sdp/commonUtils"));const b=s(e("./sdp/unifiedPlanUtils"));const o=e("./HandlerInterface");const l=e("./sdp/RemoteSdp");const S=e("../scalabilityModes");const w=new a.Logger("Chrome74");const f={OS:1024,MIS:1024};class c extends o.HandlerInterface{constructor(){super();this._mapMidTransceiver=new Map;this._sendStream=new MediaStream;this._hasDataChannelMediaSection=false;this._nextSendSctpStreamId=0;this._transportReady=false}static createFactory(){return()=>new c}get name(){return"Chrome74"}close(){w.debug("close()");if(this._pc){try{this._pc.close()}catch(e){}}}async getNativeRtpCapabilities(){w.debug("getNativeRtpCapabilities()");const t=new RTCPeerConnection({iceServers:[],iceTransportPolicy:"all",bundlePolicy:"max-bundle",rtcpMuxPolicy:"require",sdpSemantics:"unified-plan"});try{t.addTransceiver("audio");t.addTransceiver("video");const e=await t.createOffer();try{t.close()}catch(e){}const i=v.parse(e.sdp);const r=_.extractRtpCapabilities({sdpObject:i});return r}catch(e){try{t.close()}catch(e){}throw e}}async getNativeSctpCapabilities(){w.debug("getNativeSctpCapabilities()");return{numStreams:f}}run({direction:e,iceParameters:t,iceCandidates:i,dtlsParameters:r,sctpParameters:n,iceServers:s,iceTransportPolicy:a,additionalSettings:o,proprietaryConstraints:c,extendedRtpCapabilities:d}){w.debug("run()");this._direction=e;this._remoteSdp=new l.RemoteSdp({iceParameters:t,iceCandidates:i,dtlsParameters:r,sctpParameters:n});this._sendingRtpParametersByKind={audio:y.getSendingRtpParameters("audio",d),video:y.getSendingRtpParameters("video",d)};this._sendingRemoteRtpParametersByKind={audio:y.getSendingRemoteRtpParameters("audio",d),video:y.getSendingRemoteRtpParameters("video",d)};this._pc=new RTCPeerConnection(Object.assign({iceServers:s||[],iceTransportPolicy:a||"all",bundlePolicy:"max-bundle",rtcpMuxPolicy:"require",sdpSemantics:"unified-plan"},o),c);this._pc.addEventListener("iceconnectionstatechange",()=>{switch(this._pc.iceConnectionState){case"checking":this.emit("@connectionstatechange","connecting");break;case"connected":case"completed":this.emit("@connectionstatechange","connected");break;case"failed":this.emit("@connectionstatechange","failed");break;case"disconnected":this.emit("@connectionstatechange","disconnected");break;case"closed":this.emit("@connectionstatechange","closed");break}})}async updateIceServers(e){w.debug("updateIceServers()");const t=this._pc.getConfiguration();t.iceServers=e;this._pc.setConfiguration(t)}async restartIce(e){w.debug("restartIce()");this._remoteSdp.updateIceParameters(e);if(!this._transportReady)return;if(this._direction==="send"){const t=await this._pc.createOffer({iceRestart:true});w.debug("restartIce() | calling pc.setLocalDescription() [offer:%o]",t);await this._pc.setLocalDescription(t);const i={type:"answer",sdp:this._remoteSdp.getSdp()};w.debug("restartIce() | calling pc.setRemoteDescription() [answer:%o]",i);await this._pc.setRemoteDescription(i)}else{const t={type:"offer",sdp:this._remoteSdp.getSdp()};w.debug("restartIce() | calling pc.setRemoteDescription() [offer:%o]",t);await this._pc.setRemoteDescription(t);const i=await this._pc.createAnswer();w.debug("restartIce() | calling pc.setLocalDescription() [answer:%o]",i);await this._pc.setLocalDescription(i)}}async getTransportStats(){return this._pc.getStats()}async send({track:e,encodings:t,codecOptions:i,codec:r}){this._assertSendDirection();w.debug("send() [kind:%s, track.id:%s]",e.kind,e.id);if(t&&t.length>1){t.forEach((e,t)=>{e.rid=`r${t}`})}const n=g.clone(this._sendingRtpParametersByKind[e.kind],{});n.codecs=y.reduceCodecs(n.codecs,r);const s=g.clone(this._sendingRemoteRtpParametersByKind[e.kind],{});s.codecs=y.reduceCodecs(s.codecs,r);const a=this._remoteSdp.getNextMediaSectionIdx();const o=this._pc.addTransceiver(e,{direction:"sendonly",streams:[this._sendStream],sendEncodings:t});let c=await this._pc.createOffer();let d=v.parse(c.sdp);let l;if(!this._transportReady)await this._setupTransport({localDtlsRole:"server",localSdpObject:d});let u=false;const h=S.parse((t||[{}])[0].scalabilityMode);if(t&&t.length===1&&h.spatialLayers>1&&n.codecs[0].mimeType.toLowerCase()==="video/vp9"){w.debug("send() | enabling legacy simulcast for VP9 SVC");u=true;d=v.parse(c.sdp);l=d.media[a.idx];b.addLegacySimulcast({offerMediaObject:l,numStreams:h.spatialLayers});c={type:"offer",sdp:v.write(d)}}w.debug("send() | calling pc.setLocalDescription() [offer:%o]",c);await this._pc.setLocalDescription(c);const f=o.mid;n.mid=f;d=v.parse(this._pc.localDescription.sdp);l=d.media[a.idx];n.rtcp.cname=_.getCname({offerMediaObject:l});if(!t){n.encodings=b.getRtpEncodings({offerMediaObject:l})}else if(t.length===1){let e=b.getRtpEncodings({offerMediaObject:l});Object.assign(e[0],t[0]);if(u)e=[e[0]];n.encodings=e}else{n.encodings=t}if(n.encodings.length>1&&(n.codecs[0].mimeType.toLowerCase()==="video/vp8"||n.codecs[0].mimeType.toLowerCase()==="video/h264")){for(const m of n.encodings){m.scalabilityMode="S1T3"}}this._remoteSdp.send({offerMediaObject:l,reuseMid:a.reuseMid,offerRtpParameters:n,answerRtpParameters:s,codecOptions:i,extmapAllowMixed:true});const p={type:"answer",sdp:this._remoteSdp.getSdp()};w.debug("send() | calling pc.setRemoteDescription() [answer:%o]",p);await this._pc.setRemoteDescription(p);this._mapMidTransceiver.set(f,o);return{localId:f,rtpParameters:n,rtpSender:o.sender}}async stopSending(e){this._assertSendDirection();w.debug("stopSending() [localId:%s]",e);const t=this._mapMidTransceiver.get(e);if(!t)throw new Error("associated RTCRtpTransceiver not found");t.sender.replaceTrack(null);this._pc.removeTrack(t.sender);this._remoteSdp.closeMediaSection(t.mid);const i=await this._pc.createOffer();w.debug("stopSending() | calling pc.setLocalDescription() [offer:%o]",i);await this._pc.setLocalDescription(i);const r={type:"answer",sdp:this._remoteSdp.getSdp()};w.debug("stopSending() | calling pc.setRemoteDescription() [answer:%o]",r);await this._pc.setRemoteDescription(r)}async replaceTrack(e,t){this._assertSendDirection();if(t){w.debug("replaceTrack() [localId:%s, track.id:%s]",e,t.id)}else{w.debug("replaceTrack() [localId:%s, no track]",e)}const i=this._mapMidTransceiver.get(e);if(!i)throw new Error("associated RTCRtpTransceiver not found");await i.sender.replaceTrack(t)}async setMaxSpatialLayer(e,i){this._assertSendDirection();w.debug("setMaxSpatialLayer() [localId:%s, spatialLayer:%s]",e,i);const t=this._mapMidTransceiver.get(e);if(!t)throw new Error("associated RTCRtpTransceiver not found");const r=t.sender.getParameters();r.encodings.forEach((e,t)=>{if(t<=i)e.active=true;else e.active=false});await t.sender.setParameters(r)}async setRtpEncodingParameters(e,i){this._assertSendDirection();w.debug("setRtpEncodingParameters() [localId:%s, params:%o]",e,i);const t=this._mapMidTransceiver.get(e);if(!t)throw new Error("associated RTCRtpTransceiver not found");const r=t.sender.getParameters();r.encodings.forEach((e,t)=>{r.encodings[t]=Object.assign(Object.assign({},e),i)});await t.sender.setParameters(r)}async getSenderStats(e){this._assertSendDirection();const t=this._mapMidTransceiver.get(e);if(!t)throw new Error("associated RTCRtpTransceiver not found");return t.sender.getStats()}async sendDataChannel({ordered:e,maxPacketLifeTime:t,maxRetransmits:i,label:r,protocol:n,priority:s}){this._assertSendDirection();const a={negotiated:true,id:this._nextSendSctpStreamId,ordered:e,maxPacketLifeTime:t,maxRetransmits:i,protocol:n,priority:s};w.debug("sendDataChannel() [options:%o]",a);const o=this._pc.createDataChannel(r,a);this._nextSendSctpStreamId=++this._nextSendSctpStreamId%f.MIS;if(!this._hasDataChannelMediaSection){const d=await this._pc.createOffer();const l=v.parse(d.sdp);const u=l.media.find(e=>e.type==="application");if(!this._transportReady)await this._setupTransport({localDtlsRole:"server",localSdpObject:l});w.debug("sendDataChannel() | calling pc.setLocalDescription() [offer:%o]",d);await this._pc.setLocalDescription(d);this._remoteSdp.sendSctpAssociation({offerMediaObject:u});const h={type:"answer",sdp:this._remoteSdp.getSdp()};w.debug("sendDataChannel() | calling pc.setRemoteDescription() [answer:%o]",h);await this._pc.setRemoteDescription(h);this._hasDataChannelMediaSection=true}const c={streamId:a.id,ordered:a.ordered,maxPacketLifeTime:a.maxPacketLifeTime,maxRetransmits:a.maxRetransmits};return{dataChannel:o,sctpStreamParameters:c}}async receive({trackId:e,kind:t,rtpParameters:i}){this._assertRecvDirection();w.debug("receive() [trackId:%s, kind:%s]",e,t);const r=i.mid||String(this._mapMidTransceiver.size);this._remoteSdp.receive({mid:r,kind:t,offerRtpParameters:i,streamId:i.rtcp.cname,trackId:e});const n={type:"offer",sdp:this._remoteSdp.getSdp()};w.debug("receive() | calling pc.setRemoteDescription() [offer:%o]",n);await this._pc.setRemoteDescription(n);let s=await this._pc.createAnswer();const a=v.parse(s.sdp);const o=a.media.find(e=>String(e.mid)===r);_.applyCodecParameters({offerRtpParameters:i,answerMediaObject:o});s={type:"answer",sdp:v.write(a)};if(!this._transportReady)await this._setupTransport({localDtlsRole:"client",localSdpObject:a});w.debug("receive() | calling pc.setLocalDescription() [answer:%o]",s);await this._pc.setLocalDescription(s);const c=this._pc.getTransceivers().find(e=>e.mid===r);if(!c)throw new Error("new RTCRtpTransceiver not found");this._mapMidTransceiver.set(r,c);return{localId:r,track:c.receiver.track,rtpReceiver:c.receiver}}async stopReceiving(e){this._assertRecvDirection();w.debug("stopReceiving() [localId:%s]",e);const t=this._mapMidTransceiver.get(e);if(!t)throw new Error("associated RTCRtpTransceiver not found");this._remoteSdp.closeMediaSection(t.mid);const i={type:"offer",sdp:this._remoteSdp.getSdp()};w.debug("stopReceiving() | calling pc.setRemoteDescription() [offer:%o]",i);await this._pc.setRemoteDescription(i);const r=await this._pc.createAnswer();w.debug("stopReceiving() | calling pc.setLocalDescription() [answer:%o]",r);await this._pc.setLocalDescription(r)}async getReceiverStats(e){this._assertRecvDirection();const t=this._mapMidTransceiver.get(e);if(!t)throw new Error("associated RTCRtpTransceiver not found");return t.receiver.getStats()}async receiveDataChannel({sctpStreamParameters:e,label:t,protocol:i}){this._assertRecvDirection();const{streamId:r,ordered:n,maxPacketLifeTime:s,maxRetransmits:a}=e;const o={negotiated:true,id:r,ordered:n,maxPacketLifeTime:s,maxRetransmits:a,protocol:i};w.debug("receiveDataChannel() [options:%o]",o);const c=this._pc.createDataChannel(t,o);if(!this._hasDataChannelMediaSection){this._remoteSdp.receiveSctpAssociation();const d={type:"offer",sdp:this._remoteSdp.getSdp()};w.debug("receiveDataChannel() | calling pc.setRemoteDescription() [offer:%o]",d);await this._pc.setRemoteDescription(d);const l=await this._pc.createAnswer();if(!this._transportReady){const u=v.parse(l.sdp);await this._setupTransport({localDtlsRole:"client",localSdpObject:u})}w.debug("receiveDataChannel() | calling pc.setRemoteDescription() [answer:%o]",l);await this._pc.setLocalDescription(l);this._hasDataChannelMediaSection=true}return{dataChannel:c}}async _setupTransport({localDtlsRole:e,localSdpObject:t}){if(!t)t=v.parse(this._pc.localDescription.sdp);const i=_.extractDtlsParameters({sdpObject:t});i.role=e;this._remoteSdp.updateDtlsRole(e==="client"?"server":"client");await this.safeEmitAsPromise("@connect",{dtlsParameters:i});this._transportReady=true}_assertSendDirection(){if(this._direction!=="send"){throw new Error('method can just be called for handlers with "send" direction')}}_assertRecvDirection(){if(this._direction!=="recv"){throw new Error('method can just be called for handlers with "recv" direction')}}}i.Chrome74=c},{"../Logger":15,"../ortc":38,"../scalabilityModes":39,"../utils":41,"./HandlerInterface":27,"./sdp/RemoteSdp":33,"./sdp/commonUtils":34,"./sdp/unifiedPlanUtils":36,"sdp-transform":64}],25:[function(e,t,i){"use strict";var r=this&&this.__createBinding||(Object.create?function(e,t,i,r){if(r===undefined)r=i;Object.defineProperty(e,r,{enumerable:true,get:function(){return t[i]}})}:function(e,t,i,r){if(r===undefined)r=i;e[r]=t[i]});var n=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:true,value:t})}:function(e,t){e["default"]=t});var s=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(e!=null)for(var i in e)if(i!=="default"&&Object.hasOwnProperty.call(e,i))r(t,e,i);n(t,e);return t};Object.defineProperty(i,"__esModule",{value:true});i.Edge11=void 0;const a=e("../Logger");const o=e("../errors");const l=s(e("../utils"));const u=s(e("../ortc"));const h=s(e("./ortc/edgeUtils"));const c=e("./HandlerInterface");const f=new a.Logger("Edge11");class d extends c.HandlerInterface{constructor(){super();this._rtpSenders=new Map;this._rtpReceivers=new Map;this._nextSendLocalId=0;this._transportReady=false}static createFactory(){return()=>new d}get name(){return"Edge11"}close(){f.debug("close()");try{this._iceGatherer.close()}catch(e){}try{this._iceTransport.stop()}catch(e){}try{this._dtlsTransport.stop()}catch(e){}for(const e of this._rtpSenders.values()){try{e.stop()}catch(e){}}for(const t of this._rtpReceivers.values()){try{t.stop()}catch(e){}}}async getNativeRtpCapabilities(){f.debug("getNativeRtpCapabilities()");return h.getCapabilities()}async getNativeSctpCapabilities(){f.debug("getNativeSctpCapabilities()");return{numStreams:{OS:0,MIS:0}}}run({direction:e,iceParameters:t,iceCandidates:i,dtlsParameters:r,sctpParameters:n,iceServers:s,iceTransportPolicy:a,additionalSettings:o,proprietaryConstraints:c,extendedRtpCapabilities:d}){f.debug("run()");this._sendingRtpParametersByKind={audio:u.getSendingRtpParameters("audio",d),video:u.getSendingRtpParameters("video",d)};this._remoteIceParameters=t;this._remoteIceCandidates=i;this._remoteDtlsParameters=r;this._cname=`CNAME-${l.generateRandomNumber()}`;this._setIceGatherer({iceServers:s,iceTransportPolicy:a});this._setIceTransport();this._setDtlsTransport()}async updateIceServers(e){throw new o.UnsupportedError("not supported")}async restartIce(e){f.debug("restartIce()");this._remoteIceParameters=e;if(!this._transportReady)return;f.debug("restartIce() | calling iceTransport.start()");this._iceTransport.start(this._iceGatherer,e,"controlling");for(const t of this._remoteIceCandidates){this._iceTransport.addRemoteCandidate(t)}this._iceTransport.addRemoteCandidate({})}async getTransportStats(){return this._iceTransport.getStats()}async send({track:e,encodings:t,codecOptions:i,codec:r}){f.debug("send() [kind:%s, track.id:%s]",e.kind,e.id);if(!this._transportReady)await this._setupTransport({localDtlsRole:"server"});f.debug("send() | calling new RTCRtpSender()");const n=new RTCRtpSender(e,this._dtlsTransport);const s=l.clone(this._sendingRtpParametersByKind[e.kind],{});s.codecs=u.reduceCodecs(s.codecs,r);const a=s.codecs.some(e=>/.+\/rtx$/i.test(e.mimeType));if(!t)t=[{}];for(const d of t){d.ssrc=l.generateRandomNumber();if(a)d.rtx={ssrc:l.generateRandomNumber()}}s.encodings=t;s.rtcp={cname:this._cname,reducedSize:true,mux:true};const o=h.mangleRtpParameters(s);f.debug("send() | calling rtpSender.send() [params:%o]",o);await n.send(o);const c=String(this._nextSendLocalId);this._nextSendLocalId++;this._rtpSenders.set(c,n);return{localId:c,rtpParameters:s,rtpSender:n}}async stopSending(e){f.debug("stopSending() [localId:%s]",e);const t=this._rtpSenders.get(e);if(!t)throw new Error("RTCRtpSender not found");this._rtpSenders.delete(e);try{f.debug("stopSending() | calling rtpSender.stop()");t.stop()}catch(e){f.warn("stopSending() | rtpSender.stop() failed:%o",e);throw e}}async replaceTrack(e,t){if(t){f.debug("replaceTrack() [localId:%s, track.id:%s]",e,t.id)}else{f.debug("replaceTrack() [localId:%s, no track]",e)}const i=this._rtpSenders.get(e);if(!i)throw new Error("RTCRtpSender not found");i.setTrack(t)}async setMaxSpatialLayer(e,i){f.debug("setMaxSpatialLayer() [localId:%s, spatialLayer:%s]",e,i);const t=this._rtpSenders.get(e);if(!t)throw new Error("RTCRtpSender not found");const r=t.getParameters();r.encodings.forEach((e,t)=>{if(t<=i)e.active=true;else e.active=false});await t.setParameters(r)}async setRtpEncodingParameters(e,i){f.debug("setRtpEncodingParameters() [localId:%s, params:%o]",e,i);const t=this._rtpSenders.get(e);if(!t)throw new Error("RTCRtpSender not found");const r=t.getParameters();r.encodings.forEach((e,t)=>{r.encodings[t]=Object.assign(Object.assign({},e),i)});await t.setParameters(r)}async getSenderStats(e){const t=this._rtpSenders.get(e);if(!t)throw new Error("RTCRtpSender not found");return t.getStats()}async sendDataChannel(e){throw new o.UnsupportedError("not implemented")}async receive({trackId:e,kind:t,rtpParameters:i}){f.debug("receive() [trackId:%s, kind:%s]",e,t);if(!this._transportReady)await this._setupTransport({localDtlsRole:"server"});f.debug("receive() | calling new RTCRtpReceiver()");const r=new RTCRtpReceiver(this._dtlsTransport,t);r.addEventListener("error",e=>{f.error('rtpReceiver "error" event [event:%o]',e)});const n=h.mangleRtpParameters(i);f.debug("receive() | calling rtpReceiver.receive() [params:%o]",n);await r.receive(n);const s=e;this._rtpReceivers.set(s,r);return{localId:s,track:r.track,rtpReceiver:r}}async stopReceiving(e){f.debug("stopReceiving() [localId:%s]",e);const t=this._rtpReceivers.get(e);if(!t)throw new Error("RTCRtpReceiver not found");this._rtpReceivers.delete(e);try{f.debug("stopReceiving() | calling rtpReceiver.stop()");t.stop()}catch(e){f.warn("stopReceiving() | rtpReceiver.stop() failed:%o",e)}}async getReceiverStats(e){const t=this._rtpReceivers.get(e);if(!t)throw new Error("RTCRtpReceiver not found");return t.getStats()}async receiveDataChannel(e){throw new o.UnsupportedError("not implemented")}_setIceGatherer({iceServers:e,iceTransportPolicy:t}){const i=new RTCIceGatherer({iceServers:e||[],gatherPolicy:t||"all"});i.addEventListener("error",e=>{f.error('iceGatherer "error" event [event:%o]',e)});try{i.gather()}catch(e){f.debug("_setIceGatherer() | iceGatherer.gather() failed: %s",e.toString())}this._iceGatherer=i}_setIceTransport(){const e=new RTCIceTransport(this._iceGatherer);e.addEventListener("statechange",()=>{switch(e.state){case"checking":this.emit("@connectionstatechange","connecting");break;case"connected":case"completed":this.emit("@connectionstatechange","connected");break;case"failed":this.emit("@connectionstatechange","failed");break;case"disconnected":this.emit("@connectionstatechange","disconnected");break;case"closed":this.emit("@connectionstatechange","closed");break}});e.addEventListener("icestatechange",()=>{switch(e.state){case"checking":this.emit("@connectionstatechange","connecting");break;case"connected":case"completed":this.emit("@connectionstatechange","connected");break;case"failed":this.emit("@connectionstatechange","failed");break;case"disconnected":this.emit("@connectionstatechange","disconnected");break;case"closed":this.emit("@connectionstatechange","closed");break}});e.addEventListener("candidatepairchange",e=>{f.debug('iceTransport "candidatepairchange" event [pair:%o]',e.pair)});this._iceTransport=e}_setDtlsTransport(){const e=new RTCDtlsTransport(this._iceTransport);e.addEventListener("statechange",()=>{f.debug('dtlsTransport "statechange" event [state:%s]',e.state)});e.addEventListener("dtlsstatechange",()=>{f.debug('dtlsTransport "dtlsstatechange" event [state:%s]',e.state);if(e.state==="closed")this.emit("@connectionstatechange","closed")});e.addEventListener("error",e=>{f.error('dtlsTransport "error" event [event:%o]',e)});this._dtlsTransport=e}async _setupTransport({localDtlsRole:e}){f.debug("_setupTransport()");const t=this._dtlsTransport.getLocalParameters();t.role=e;await this.safeEmitAsPromise("@connect",{dtlsParameters:t});this._iceTransport.start(this._iceGatherer,this._remoteIceParameters,"controlling");for(const i of this._remoteIceCandidates){this._iceTransport.addRemoteCandidate(i)}this._iceTransport.addRemoteCandidate({});this._remoteDtlsParameters.fingerprints=this._remoteDtlsParameters.fingerprints.filter(e=>{return e.algorithm==="sha-256"||e.algorithm==="sha-384"||e.algorithm==="sha-512"});this._dtlsTransport.start(this._remoteDtlsParameters);this._transportReady=true}}i.Edge11=d},{"../Logger":15,"../errors":20,"../ortc":38,"../utils":41,"./HandlerInterface":27,"./ortc/edgeUtils":31}],26:[function(e,t,i){"use strict";var r=this&&this.__createBinding||(Object.create?function(e,t,i,r){if(r===undefined)r=i;Object.defineProperty(e,r,{enumerable:true,get:function(){return t[i]}})}:function(e,t,i,r){if(r===undefined)r=i;e[r]=t[i]});var n=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:true,value:t})}:function(e,t){e["default"]=t});var s=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(e!=null)for(var i in e)if(i!=="default"&&Object.hasOwnProperty.call(e,i))r(t,e,i);n(t,e);return t};Object.defineProperty(i,"__esModule",{value:true});i.Firefox60=void 0;const m=s(e("sdp-transform"));const a=e("../Logger");const o=e("../errors");const v=s(e("../utils"));const g=s(e("../ortc"));const y=s(e("./sdp/commonUtils"));const _=s(e("./sdp/unifiedPlanUtils"));const c=e("./HandlerInterface");const l=e("./sdp/RemoteSdp");const b=new a.Logger("Firefox60");const f={OS:16,MIS:2048};class d extends c.HandlerInterface{constructor(){super();this._mapMidTransceiver=new Map;this._sendStream=new MediaStream;this._hasDataChannelMediaSection=false;this._nextSendSctpStreamId=0;this._transportReady=false}static createFactory(){return()=>new d}get name(){return"Firefox60"}close(){b.debug("close()");if(this._pc){try{this._pc.close()}catch(e){}}}async getNativeRtpCapabilities(){b.debug("getNativeRtpCapabilities()");const t=new RTCPeerConnection({iceServers:[],iceTransportPolicy:"all",bundlePolicy:"max-bundle",rtcpMuxPolicy:"require"});const i=document.createElement("canvas");i.getContext("2d");const e=i.captureStream();const r=e.getVideoTracks()[0];try{t.addTransceiver("audio",{direction:"sendrecv"});const n=t.addTransceiver(r,{direction:"sendrecv"});const s=n.sender.getParameters();const a=[{rid:"r0",maxBitrate:1e5},{rid:"r1",maxBitrate:5e5}];s.encodings=a;await n.sender.setParameters(s);const o=await t.createOffer();try{i.remove()}catch(e){}try{r.stop()}catch(e){}try{t.close()}catch(e){}const c=m.parse(o.sdp);const d=y.extractRtpCapabilities({sdpObject:c});return d}catch(e){try{i.remove()}catch(e){}try{r.stop()}catch(e){}try{t.close()}catch(e){}throw e}}async getNativeSctpCapabilities(){b.debug("getNativeSctpCapabilities()");return{numStreams:f}}run({direction:e,iceParameters:t,iceCandidates:i,dtlsParameters:r,sctpParameters:n,iceServers:s,iceTransportPolicy:a,additionalSettings:o,proprietaryConstraints:c,extendedRtpCapabilities:d}){b.debug("run()");this._direction=e;this._remoteSdp=new l.RemoteSdp({iceParameters:t,iceCandidates:i,dtlsParameters:r,sctpParameters:n});this._sendingRtpParametersByKind={audio:g.getSendingRtpParameters("audio",d),video:g.getSendingRtpParameters("video",d)};this._sendingRemoteRtpParametersByKind={audio:g.getSendingRemoteRtpParameters("audio",d),video:g.getSendingRemoteRtpParameters("video",d)};this._pc=new RTCPeerConnection(Object.assign({iceServers:s||[],iceTransportPolicy:a||"all",bundlePolicy:"max-bundle",rtcpMuxPolicy:"require"},o),c);this._pc.addEventListener("iceconnectionstatechange",()=>{switch(this._pc.iceConnectionState){case"checking":this.emit("@connectionstatechange","connecting");break;case"connected":case"completed":this.emit("@connectionstatechange","connected");break;case"failed":this.emit("@connectionstatechange","failed");break;case"disconnected":this.emit("@connectionstatechange","disconnected");break;case"closed":this.emit("@connectionstatechange","closed");break}})}async updateIceServers(e){throw new o.UnsupportedError("not supported")}async restartIce(e){b.debug("restartIce()");this._remoteSdp.updateIceParameters(e);if(!this._transportReady)return;if(this._direction==="send"){const t=await this._pc.createOffer({iceRestart:true});b.debug("restartIce() | calling pc.setLocalDescription() [offer:%o]",t);await this._pc.setLocalDescription(t);const i={type:"answer",sdp:this._remoteSdp.getSdp()};b.debug("restartIce() | calling pc.setRemoteDescription() [answer:%o]",i);await this._pc.setRemoteDescription(i)}else{const t={type:"offer",sdp:this._remoteSdp.getSdp()};b.debug("restartIce() | calling pc.setRemoteDescription() [offer:%o]",t);await this._pc.setRemoteDescription(t);const i=await this._pc.createAnswer();b.debug("restartIce() | calling pc.setLocalDescription() [answer:%o]",i);await this._pc.setLocalDescription(i)}}async getTransportStats(){return this._pc.getStats()}async send({track:e,encodings:t,codecOptions:i,codec:r}){this._assertSendDirection();b.debug("send() [kind:%s, track.id:%s]",e.kind,e.id);if(t){t=v.clone(t,[]);if(t.length>1){t.forEach((e,t)=>{e.rid=`r${t}`});t.reverse()}}const n=v.clone(this._sendingRtpParametersByKind[e.kind],{});n.codecs=g.reduceCodecs(n.codecs,r);const s=v.clone(this._sendingRemoteRtpParametersByKind[e.kind],{});s.codecs=g.reduceCodecs(s.codecs,r);const a=this._pc.addTransceiver(e,{direction:"sendonly",streams:[this._sendStream]});if(t){const h=a.sender.getParameters();h.encodings=t;await a.sender.setParameters(h)}const o=await this._pc.createOffer();let c=m.parse(o.sdp);if(!this._transportReady)await this._setupTransport({localDtlsRole:"client",localSdpObject:c});b.debug("send() | calling pc.setLocalDescription() [offer:%o]",o);await this._pc.setLocalDescription(o);const d=a.mid;n.mid=d;c=m.parse(this._pc.localDescription.sdp);const l=c.media[c.media.length-1];n.rtcp.cname=y.getCname({offerMediaObject:l});if(!t){n.encodings=_.getRtpEncodings({offerMediaObject:l})}else if(t.length===1){const f=_.getRtpEncodings({offerMediaObject:l});Object.assign(f[0],t[0]);n.encodings=f}else{n.encodings=t.reverse()}if(n.encodings.length>1&&(n.codecs[0].mimeType.toLowerCase()==="video/vp8"||n.codecs[0].mimeType.toLowerCase()==="video/h264")){for(const p of n.encodings){p.scalabilityMode="S1T3"}}this._remoteSdp.send({offerMediaObject:l,offerRtpParameters:n,answerRtpParameters:s,codecOptions:i,extmapAllowMixed:true});const u={type:"answer",sdp:this._remoteSdp.getSdp()};b.debug("send() | calling pc.setRemoteDescription() [answer:%o]",u);await this._pc.setRemoteDescription(u);this._mapMidTransceiver.set(d,a);return{localId:d,rtpParameters:n,rtpSender:a.sender}}async stopSending(e){b.debug("stopSending() [localId:%s]",e);const t=this._mapMidTransceiver.get(e);if(!t)throw new Error("associated transceiver not found");t.sender.replaceTrack(null);this._pc.removeTrack(t.sender);this._remoteSdp.disableMediaSection(t.mid);const i=await this._pc.createOffer();b.debug("stopSending() | calling pc.setLocalDescription() [offer:%o]",i);await this._pc.setLocalDescription(i);const r={type:"answer",sdp:this._remoteSdp.getSdp()};b.debug("stopSending() | calling pc.setRemoteDescription() [answer:%o]",r);await this._pc.setRemoteDescription(r)}async replaceTrack(e,t){this._assertSendDirection();if(t){b.debug("replaceTrack() [localId:%s, track.id:%s]",e,t.id)}else{b.debug("replaceTrack() [localId:%s, no track]",e)}const i=this._mapMidTransceiver.get(e);if(!i)throw new Error("associated RTCRtpTransceiver not found");await i.sender.replaceTrack(t)}async setMaxSpatialLayer(e,i){this._assertSendDirection();b.debug("setMaxSpatialLayer() [localId:%s, spatialLayer:%s]",e,i);const t=this._mapMidTransceiver.get(e);if(!t)throw new Error("associated transceiver not found");const r=t.sender.getParameters();i=r.encodings.length-1-i;r.encodings.forEach((e,t)=>{if(t>=i)e.active=true;else e.active=false});await t.sender.setParameters(r)}async setRtpEncodingParameters(e,i){this._assertSendDirection();b.debug("setRtpEncodingParameters() [localId:%s, params:%o]",e,i);const t=this._mapMidTransceiver.get(e);if(!t)throw new Error("associated RTCRtpTransceiver not found");const r=t.sender.getParameters();r.encodings.forEach((e,t)=>{r.encodings[t]=Object.assign(Object.assign({},e),i)});await t.sender.setParameters(r)}async getSenderStats(e){this._assertSendDirection();const t=this._mapMidTransceiver.get(e);if(!t)throw new Error("associated RTCRtpTransceiver not found");return t.sender.getStats()}async sendDataChannel({ordered:e,maxPacketLifeTime:t,maxRetransmits:i,label:r,protocol:n,priority:s}){this._assertSendDirection();const a={negotiated:true,id:this._nextSendSctpStreamId,ordered:e,maxPacketLifeTime:t,maxRetransmits:i,protocol:n,priority:s};b.debug("sendDataChannel() [options:%o]",a);const o=this._pc.createDataChannel(r,a);this._nextSendSctpStreamId=++this._nextSendSctpStreamId%f.MIS;if(!this._hasDataChannelMediaSection){const d=await this._pc.createOffer();const l=m.parse(d.sdp);const u=l.media.find(e=>e.type==="application");if(!this._transportReady)await this._setupTransport({localDtlsRole:"server",localSdpObject:l});b.debug("sendDataChannel() | calling pc.setLocalDescription() [offer:%o]",d);await this._pc.setLocalDescription(d);this._remoteSdp.sendSctpAssociation({offerMediaObject:u});const h={type:"answer",sdp:this._remoteSdp.getSdp()};b.debug("sendDataChannel() | calling pc.setRemoteDescription() [answer:%o]",h);await this._pc.setRemoteDescription(h);this._hasDataChannelMediaSection=true}const c={streamId:a.id,ordered:a.ordered,maxPacketLifeTime:a.maxPacketLifeTime,maxRetransmits:a.maxRetransmits};return{dataChannel:o,sctpStreamParameters:c}}async receive({trackId:e,kind:t,rtpParameters:i}){this._assertRecvDirection();b.debug("receive() [trackId:%s, kind:%s]",e,t);const r=i.mid||String(this._mapMidTransceiver.size);this._remoteSdp.receive({mid:r,kind:t,offerRtpParameters:i,streamId:i.rtcp.cname,trackId:e});const n={type:"offer",sdp:this._remoteSdp.getSdp()};b.debug("receive() | calling pc.setRemoteDescription() [offer:%o]",n);await this._pc.setRemoteDescription(n);let s=await this._pc.createAnswer();const a=m.parse(s.sdp);const o=a.media.find(e=>String(e.mid)===r);y.applyCodecParameters({offerRtpParameters:i,answerMediaObject:o});s={type:"answer",sdp:m.write(a)};if(!this._transportReady)await this._setupTransport({localDtlsRole:"client",localSdpObject:a});b.debug("receive() | calling pc.setLocalDescription() [answer:%o]",s);await this._pc.setLocalDescription(s);const c=this._pc.getTransceivers().find(e=>e.mid===r);if(!c)throw new Error("new RTCRtpTransceiver not found");this._mapMidTransceiver.set(r,c);return{localId:r,track:c.receiver.track,rtpReceiver:c.receiver}}async stopReceiving(e){this._assertRecvDirection();b.debug("stopReceiving() [localId:%s]",e);const t=this._mapMidTransceiver.get(e);if(!t)throw new Error("associated RTCRtpTransceiver not found");this._remoteSdp.closeMediaSection(t.mid);const i={type:"offer",sdp:this._remoteSdp.getSdp()};b.debug("stopReceiving() | calling pc.setRemoteDescription() [offer:%o]",i);await this._pc.setRemoteDescription(i);const r=await this._pc.createAnswer();b.debug("stopReceiving() | calling pc.setLocalDescription() [answer:%o]",r);await this._pc.setLocalDescription(r)}async getReceiverStats(e){this._assertRecvDirection();const t=this._mapMidTransceiver.get(e);if(!t)throw new Error("associated RTCRtpTransceiver not found");return t.receiver.getStats()}async receiveDataChannel({sctpStreamParameters:e,label:t,protocol:i}){this._assertRecvDirection();const{streamId:r,ordered:n,maxPacketLifeTime:s,maxRetransmits:a}=e;const o={negotiated:true,id:r,ordered:n,maxPacketLifeTime:s,maxRetransmits:a,protocol:i};b.debug("receiveDataChannel() [options:%o]",o);const c=this._pc.createDataChannel(t,o);if(!this._hasDataChannelMediaSection){this._remoteSdp.receiveSctpAssociation();const d={type:"offer",sdp:this._remoteSdp.getSdp()};b.debug("receiveDataChannel() | calling pc.setRemoteDescription() [offer:%o]",d);await this._pc.setRemoteDescription(d);const l=await this._pc.createAnswer();if(!this._transportReady){const u=m.parse(l.sdp);await this._setupTransport({localDtlsRole:"client",localSdpObject:u})}b.debug("receiveDataChannel() | calling pc.setRemoteDescription() [answer:%o]",l);await this._pc.setLocalDescription(l);this._hasDataChannelMediaSection=true}return{dataChannel:c}}async _setupTransport({localDtlsRole:e,localSdpObject:t}){if(!t)t=m.parse(this._pc.localDescription.sdp);const i=y.extractDtlsParameters({sdpObject:t});i.role=e;this._remoteSdp.updateDtlsRole(e==="client"?"server":"client");await this.safeEmitAsPromise("@connect",{dtlsParameters:i});this._transportReady=true}_assertSendDirection(){if(this._direction!=="send"){throw new Error('method can just be called for handlers with "send" direction')}}_assertRecvDirection(){if(this._direction!=="recv"){throw new Error('method can just be called for handlers with "recv" direction')}}}i.Firefox60=d},{"../Logger":15,"../errors":20,"../ortc":38,"../utils":41,"./HandlerInterface":27,"./sdp/RemoteSdp":33,"./sdp/commonUtils":34,"./sdp/unifiedPlanUtils":36,"sdp-transform":64}],27:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:true});i.HandlerInterface=void 0;const r=e("../EnhancedEventEmitter");class n extends r.EnhancedEventEmitter{constructor(){super()}}i.HandlerInterface=n},{"../EnhancedEventEmitter":14}],28:[function(e,t,i){"use strict";var r=this&&this.__createBinding||(Object.create?function(e,t,i,r){if(r===undefined)r=i;Object.defineProperty(e,r,{enumerable:true,get:function(){return t[i]}})}:function(e,t,i,r){if(r===undefined)r=i;e[r]=t[i]});var n=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:true,value:t})}:function(e,t){e["default"]=t});var s=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(e!=null)for(var i in e)if(i!=="default"&&Object.hasOwnProperty.call(e,i))r(t,e,i);n(t,e);return t};Object.defineProperty(i,"__esModule",{value:true});i.ReactNative=void 0;const f=s(e("sdp-transform"));const a=e("../Logger");const o=e("../errors");const h=s(e("../utils"));const p=s(e("../ortc"));const m=s(e("./sdp/commonUtils"));const v=s(e("./sdp/planBUtils"));const c=e("./HandlerInterface");const l=e("./sdp/RemoteSdp");const g=new a.Logger("ReactNative");const y={OS:1024,MIS:1024};class d extends c.HandlerInterface{constructor(){super();this._sendStream=new MediaStream;this._mapSendLocalIdTrack=new Map;this._nextSendLocalId=0;this._mapRecvLocalIdInfo=new Map;this._hasDataChannelMediaSection=false;this._nextSendSctpStreamId=0;this._transportReady=false}static createFactory(){return()=>new d}get name(){return"ReactNative"}close(){g.debug("close()");if(this._pc){try{this._pc.close()}catch(e){}}}async getNativeRtpCapabilities(){g.debug("getNativeRtpCapabilities()");const t=new RTCPeerConnection({iceServers:[],iceTransportPolicy:"all",bundlePolicy:"max-bundle",rtcpMuxPolicy:"require",sdpSemantics:"plan-b"});try{const e=await t.createOffer({offerToReceiveAudio:true,offerToReceiveVideo:true});try{t.close()}catch(e){}const i=f.parse(e.sdp);const r=m.extractRtpCapabilities({sdpObject:i});return r}catch(e){try{t.close()}catch(e){}throw e}}async getNativeSctpCapabilities(){g.debug("getNativeSctpCapabilities()");return{numStreams:y}}run({direction:e,iceParameters:t,iceCandidates:i,dtlsParameters:r,sctpParameters:n,iceServers:s,iceTransportPolicy:a,additionalSettings:o,proprietaryConstraints:c,extendedRtpCapabilities:d}){g.debug("run()");this._direction=e;this._remoteSdp=new l.RemoteSdp({iceParameters:t,iceCandidates:i,dtlsParameters:r,sctpParameters:n,planB:true});this._sendingRtpParametersByKind={audio:p.getSendingRtpParameters("audio",d),video:p.getSendingRtpParameters("video",d)};this._sendingRemoteRtpParametersByKind={audio:p.getSendingRemoteRtpParameters("audio",d),video:p.getSendingRemoteRtpParameters("video",d)};this._pc=new RTCPeerConnection(Object.assign({iceServers:s||[],iceTransportPolicy:a||"all",bundlePolicy:"max-bundle",rtcpMuxPolicy:"require",sdpSemantics:"plan-b"},o),c);this._pc.addEventListener("iceconnectionstatechange",()=>{switch(this._pc.iceConnectionState){case"checking":this.emit("@connectionstatechange","connecting");break;case"connected":case"completed":this.emit("@connectionstatechange","connected");break;case"failed":this.emit("@connectionstatechange","failed");break;case"disconnected":this.emit("@connectionstatechange","disconnected");break;case"closed":this.emit("@connectionstatechange","closed");break}})}async updateIceServers(e){g.debug("updateIceServers()");const t=this._pc.getConfiguration();t.iceServers=e;this._pc.setConfiguration(t)}async restartIce(e){g.debug("restartIce()");this._remoteSdp.updateIceParameters(e);if(!this._transportReady)return;if(this._direction==="send"){const t=await this._pc.createOffer({iceRestart:true});g.debug("restartIce() | calling pc.setLocalDescription() [offer:%o]",t);await this._pc.setLocalDescription(t);const i={type:"answer",sdp:this._remoteSdp.getSdp()};g.debug("restartIce() | calling pc.setRemoteDescription() [answer:%o]",i);await this._pc.setRemoteDescription(i)}else{const t={type:"offer",sdp:this._remoteSdp.getSdp()};g.debug("restartIce() | calling pc.setRemoteDescription() [offer:%o]",t);await this._pc.setRemoteDescription(t);const i=await this._pc.createAnswer();g.debug("restartIce() | calling pc.setLocalDescription() [answer:%o]",i);await this._pc.setLocalDescription(i)}}async getTransportStats(){return this._pc.getStats()}async send({track:t,encodings:i,codecOptions:e,codec:r}){this._assertSendDirection();g.debug("send() [kind:%s, track.id:%s]",t.kind,t.id);if(r){g.warn("send() | codec selection is not available in %s handler",this.name)}this._sendStream.addTrack(t);this._pc.addStream(this._sendStream);let n=await this._pc.createOffer();let s=f.parse(n.sdp);let a;const o=h.clone(this._sendingRtpParametersByKind[t.kind],{});o.codecs=p.reduceCodecs(o.codecs);const c=h.clone(this._sendingRemoteRtpParametersByKind[t.kind],{});c.codecs=p.reduceCodecs(c.codecs);if(!this._transportReady)await this._setupTransport({localDtlsRole:"server",localSdpObject:s});if(t.kind==="video"&&i&&i.length>1){g.debug("send() | enabling simulcast");s=f.parse(n.sdp);a=s.media.find(e=>e.type==="video");v.addLegacySimulcast({offerMediaObject:a,track:t,numStreams:i.length});n={type:"offer",sdp:f.write(s)}}g.debug("send() | calling pc.setLocalDescription() [offer:%o]",n);await this._pc.setLocalDescription(n);s=f.parse(this._pc.localDescription.sdp);a=s.media.find(e=>e.type===t.kind);o.rtcp.cname=m.getCname({offerMediaObject:a});o.encodings=v.getRtpEncodings({offerMediaObject:a,track:t});if(i){for(let e=0;e<o.encodings.length;++e){if(i[e])Object.assign(o.encodings[e],i[e])}}if(o.encodings.length>1&&(o.codecs[0].mimeType.toLowerCase()==="video/vp8"||o.codecs[0].mimeType.toLowerCase()==="video/h264")){for(const u of o.encodings){u.scalabilityMode="S1T3"}}this._remoteSdp.send({offerMediaObject:a,offerRtpParameters:o,answerRtpParameters:c,codecOptions:e});const d={type:"answer",sdp:this._remoteSdp.getSdp()};g.debug("send() | calling pc.setRemoteDescription() [answer:%o]",d);await this._pc.setRemoteDescription(d);const l=String(this._nextSendLocalId);this._nextSendLocalId++;this._mapSendLocalIdTrack.set(l,t);return{localId:l,rtpParameters:o}}async stopSending(e){this._assertSendDirection();g.debug("stopSending() [localId:%s]",e);const t=this._mapSendLocalIdTrack.get(e);if(!t)throw new Error("track not found");this._mapSendLocalIdTrack.delete(e);this._sendStream.removeTrack(t);this._pc.addStream(this._sendStream);const i=await this._pc.createOffer();g.debug("stopSending() | calling pc.setLocalDescription() [offer:%o]",i);try{await this._pc.setLocalDescription(i)}catch(e){if(this._sendStream.getTracks().length===0){g.warn("stopSending() | ignoring expected error due no sending tracks: %s",e.toString());return}throw e}if(this._pc.signalingState==="stable")return;const r={type:"answer",sdp:this._remoteSdp.getSdp()};g.debug("stopSending() | calling pc.setRemoteDescription() [answer:%o]",r);await this._pc.setRemoteDescription(r)}async replaceTrack(e,t){throw new o.UnsupportedError("not implemented")}async setMaxSpatialLayer(e,t){throw new o.UnsupportedError("not implemented")}async setRtpEncodingParameters(e,t){throw new o.UnsupportedError("not implemented")}async getSenderStats(e){throw new o.UnsupportedError("not implemented")}async sendDataChannel({ordered:e,maxPacketLifeTime:t,maxRetransmits:i,label:r,protocol:n,priority:s}){this._assertSendDirection();const a={negotiated:true,id:this._nextSendSctpStreamId,ordered:e,maxPacketLifeTime:t,maxRetransmitTime:t,maxRetransmits:i,protocol:n,priority:s};g.debug("sendDataChannel() [options:%o]",a);const o=this._pc.createDataChannel(r,a);this._nextSendSctpStreamId=++this._nextSendSctpStreamId%y.MIS;if(!this._hasDataChannelMediaSection){const d=await this._pc.createOffer();const l=f.parse(d.sdp);const u=l.media.find(e=>e.type==="application");if(!this._transportReady)await this._setupTransport({localDtlsRole:"server",localSdpObject:l});g.debug("sendDataChannel() | calling pc.setLocalDescription() [offer:%o]",d);await this._pc.setLocalDescription(d);this._remoteSdp.sendSctpAssociation({offerMediaObject:u});const h={type:"answer",sdp:this._remoteSdp.getSdp()};g.debug("sendDataChannel() | calling pc.setRemoteDescription() [answer:%o]",h);await this._pc.setRemoteDescription(h);this._hasDataChannelMediaSection=true}const c={streamId:a.id,ordered:a.ordered,maxPacketLifeTime:a.maxPacketLifeTime,maxRetransmits:a.maxRetransmits};return{dataChannel:o,sctpStreamParameters:c}}async receive({trackId:e,kind:t,rtpParameters:i}){this._assertRecvDirection();g.debug("receive() [trackId:%s, kind:%s]",e,t);const r=e;const n=t;let s=i.rtcp.cname;g.debug("receive() | forcing a random remote streamId to avoid well known bug in react-native-webrtc");s+=`-hack-${h.generateRandomNumber()}`;this._remoteSdp.receive({mid:n,kind:t,offerRtpParameters:i,streamId:s,trackId:e});const a={type:"offer",sdp:this._remoteSdp.getSdp()};g.debug("receive() | calling pc.setRemoteDescription() [offer:%o]",a);await this._pc.setRemoteDescription(a);let o=await this._pc.createAnswer();const c=f.parse(o.sdp);const d=c.media.find(e=>String(e.mid)===n);m.applyCodecParameters({offerRtpParameters:i,answerMediaObject:d});o={type:"answer",sdp:f.write(c)};if(!this._transportReady)await this._setupTransport({localDtlsRole:"client",localSdpObject:c});g.debug("receive() | calling pc.setLocalDescription() [answer:%o]",o);await this._pc.setLocalDescription(o);const l=this._pc.getRemoteStreams().find(e=>e.id===s);const u=l.getTrackById(r);if(!u)throw new Error("remote track not found");this._mapRecvLocalIdInfo.set(r,{mid:n,rtpParameters:i});return{localId:r,track:u}}async stopReceiving(e){this._assertRecvDirection();g.debug("stopReceiving() [localId:%s]",e);const{mid:t,rtpParameters:i}=this._mapRecvLocalIdInfo.get(e)||{};this._mapRecvLocalIdInfo.delete(e);this._remoteSdp.planBStopReceiving({mid:t,offerRtpParameters:i});const r={type:"offer",sdp:this._remoteSdp.getSdp()};g.debug("stopReceiving() | calling pc.setRemoteDescription() [offer:%o]",r);await this._pc.setRemoteDescription(r);const n=await this._pc.createAnswer();g.debug("stopReceiving() | calling pc.setLocalDescription() [answer:%o]",n);await this._pc.setLocalDescription(n)}async getReceiverStats(e){throw new o.UnsupportedError("not implemented")}async receiveDataChannel({sctpStreamParameters:e,label:t,protocol:i}){this._assertRecvDirection();const{streamId:r,ordered:n,maxPacketLifeTime:s,maxRetransmits:a}=e;const o={negotiated:true,id:r,ordered:n,maxPacketLifeTime:s,maxRetransmitTime:s,maxRetransmits:a,protocol:i};g.debug("receiveDataChannel() [options:%o]",o);const c=this._pc.createDataChannel(t,o);if(!this._hasDataChannelMediaSection){this._remoteSdp.receiveSctpAssociation({oldDataChannelSpec:true});const d={type:"offer",sdp:this._remoteSdp.getSdp()};g.debug("receiveDataChannel() | calling pc.setRemoteDescription() [offer:%o]",d);await this._pc.setRemoteDescription(d);const l=await this._pc.createAnswer();if(!this._transportReady){const u=f.parse(l.sdp);await this._setupTransport({localDtlsRole:"client",localSdpObject:u})}g.debug("receiveDataChannel() | calling pc.setRemoteDescription() [answer:%o]",l);await this._pc.setLocalDescription(l);this._hasDataChannelMediaSection=true}return{dataChannel:c}}async _setupTransport({localDtlsRole:e,localSdpObject:t}){if(!t)t=f.parse(this._pc.localDescription.sdp);const i=m.extractDtlsParameters({sdpObject:t});i.role=e;this._remoteSdp.updateDtlsRole(e==="client"?"server":"client");await this.safeEmitAsPromise("@connect",{dtlsParameters:i});this._transportReady=true}_assertSendDirection(){if(this._direction!=="send"){throw new Error('method can just be called for handlers with "send" direction')}}_assertRecvDirection(){if(this._direction!=="recv"){throw new Error('method can just be called for handlers with "recv" direction')}}}i.ReactNative=d},{"../Logger":15,"../errors":20,"../ortc":38,"../utils":41,"./HandlerInterface":27,"./sdp/RemoteSdp":33,"./sdp/commonUtils":34,"./sdp/planBUtils":35,"sdp-transform":64}],29:[function(e,t,i){"use strict";var r=this&&this.__createBinding||(Object.create?function(e,t,i,r){if(r===undefined)r=i;Object.defineProperty(e,r,{enumerable:true,get:function(){return t[i]}})}:function(e,t,i,r){if(r===undefined)r=i;e[r]=t[i]});var n=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:true,value:t})}:function(e,t){e["default"]=t});var s=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(e!=null)for(var i in e)if(i!=="default"&&Object.hasOwnProperty.call(e,i))r(t,e,i);n(t,e);return t};Object.defineProperty(i,"__esModule",{value:true});i.Safari11=void 0;const f=s(e("sdp-transform"));const a=e("../Logger");const p=s(e("../utils"));const m=s(e("../ortc"));const v=s(e("./sdp/commonUtils"));const g=s(e("./sdp/planBUtils"));const o=e("./HandlerInterface");const l=e("./sdp/RemoteSdp");const y=new a.Logger("Safari11");const _={OS:1024,MIS:1024};class c extends o.HandlerInterface{constructor(){super();this._sendStream=new MediaStream;this._mapSendLocalIdRtpSender=new Map;this._nextSendLocalId=0;this._mapRecvLocalIdInfo=new Map;this._hasDataChannelMediaSection=false;this._nextSendSctpStreamId=0;this._transportReady=false}static createFactory(){return()=>new c}get name(){return"Safari11"}close(){y.debug("close()");if(this._pc){try{this._pc.close()}catch(e){}}}async getNativeRtpCapabilities(){y.debug("getNativeRtpCapabilities()");const t=new RTCPeerConnection({iceServers:[],iceTransportPolicy:"all",bundlePolicy:"max-bundle",rtcpMuxPolicy:"require",sdpSemantics:"plan-b"});try{const e=await t.createOffer({offerToReceiveAudio:true,offerToReceiveVideo:true});try{t.close()}catch(e){}const i=f.parse(e.sdp);const r=v.extractRtpCapabilities({sdpObject:i});return r}catch(e){try{t.close()}catch(e){}throw e}}async getNativeSctpCapabilities(){y.debug("getNativeSctpCapabilities()");return{numStreams:_}}run({direction:e,iceParameters:t,iceCandidates:i,dtlsParameters:r,sctpParameters:n,iceServers:s,iceTransportPolicy:a,additionalSettings:o,proprietaryConstraints:c,extendedRtpCapabilities:d}){y.debug("run()");this._direction=e;this._remoteSdp=new l.RemoteSdp({iceParameters:t,iceCandidates:i,dtlsParameters:r,sctpParameters:n,planB:true});this._sendingRtpParametersByKind={audio:m.getSendingRtpParameters("audio",d),video:m.getSendingRtpParameters("video",d)};this._sendingRemoteRtpParametersByKind={audio:m.getSendingRemoteRtpParameters("audio",d),video:m.getSendingRemoteRtpParameters("video",d)};this._pc=new RTCPeerConnection(Object.assign({iceServers:s||[],iceTransportPolicy:a||"all",bundlePolicy:"max-bundle",rtcpMuxPolicy:"require"},o),c);this._pc.addEventListener("iceconnectionstatechange",()=>{switch(this._pc.iceConnectionState){case"checking":this.emit("@connectionstatechange","connecting");break;case"connected":case"completed":this.emit("@connectionstatechange","connected");break;case"failed":this.emit("@connectionstatechange","failed");break;case"disconnected":this.emit("@connectionstatechange","disconnected");break;case"closed":this.emit("@connectionstatechange","closed");break}})}async updateIceServers(e){y.debug("updateIceServers()");const t=this._pc.getConfiguration();t.iceServers=e;this._pc.setConfiguration(t)}async restartIce(e){y.debug("restartIce()");this._remoteSdp.updateIceParameters(e);if(!this._transportReady)return;if(this._direction==="send"){const t=await this._pc.createOffer({iceRestart:true});y.debug("restartIce() | calling pc.setLocalDescription() [offer:%o]",t);await this._pc.setLocalDescription(t);const i={type:"answer",sdp:this._remoteSdp.getSdp()};y.debug("restartIce() | calling pc.setRemoteDescription() [answer:%o]",i);await this._pc.setRemoteDescription(i)}else{const t={type:"offer",sdp:this._remoteSdp.getSdp()};y.debug("restartIce() | calling pc.setRemoteDescription() [offer:%o]",t);await this._pc.setRemoteDescription(t);const i=await this._pc.createAnswer();y.debug("restartIce() | calling pc.setLocalDescription() [answer:%o]",i);await this._pc.setLocalDescription(i)}}async getTransportStats(){return this._pc.getStats()}async send({track:t,encodings:i,codecOptions:e,codec:r}){this._assertSendDirection();y.debug("send() [kind:%s, track.id:%s]",t.kind,t.id);if(r){y.warn("send() | codec selection is not available in %s handler",this.name)}this._sendStream.addTrack(t);this._pc.addTrack(t,this._sendStream);let n=await this._pc.createOffer();let s=f.parse(n.sdp);let a;const o=p.clone(this._sendingRtpParametersByKind[t.kind],{});o.codecs=m.reduceCodecs(o.codecs);const c=p.clone(this._sendingRemoteRtpParametersByKind[t.kind],{});c.codecs=m.reduceCodecs(c.codecs);if(!this._transportReady)await this._setupTransport({localDtlsRole:"server",localSdpObject:s});if(t.kind==="video"&&i&&i.length>1){y.debug("send() | enabling simulcast");s=f.parse(n.sdp);a=s.media.find(e=>e.type==="video");g.addLegacySimulcast({offerMediaObject:a,track:t,numStreams:i.length});n={type:"offer",sdp:f.write(s)}}y.debug("send() | calling pc.setLocalDescription() [offer:%o]",n);await this._pc.setLocalDescription(n);s=f.parse(this._pc.localDescription.sdp);a=s.media.find(e=>e.type===t.kind);o.rtcp.cname=v.getCname({offerMediaObject:a});o.encodings=g.getRtpEncodings({offerMediaObject:a,track:t});if(i){for(let e=0;e<o.encodings.length;++e){if(i[e])Object.assign(o.encodings[e],i[e])}}if(o.encodings.length>1&&o.codecs[0].mimeType.toLowerCase()==="video/vp8"){for(const h of o.encodings){h.scalabilityMode="S1T3"}}this._remoteSdp.send({offerMediaObject:a,offerRtpParameters:o,answerRtpParameters:c,codecOptions:e});const d={type:"answer",sdp:this._remoteSdp.getSdp()};y.debug("send() | calling pc.setRemoteDescription() [answer:%o]",d);await this._pc.setRemoteDescription(d);const l=String(this._nextSendLocalId);this._nextSendLocalId++;const u=this._pc.getSenders().find(e=>e.track===t);this._mapSendLocalIdRtpSender.set(l,u);return{localId:l,rtpParameters:o,rtpSender:u}}async stopSending(e){this._assertSendDirection();const t=this._mapSendLocalIdRtpSender.get(e);if(!t)throw new Error("associated RTCRtpSender not found");if(t.track)this._sendStream.removeTrack(t.track);this._mapSendLocalIdRtpSender.delete(e);const i=await this._pc.createOffer();y.debug("stopSending() | calling pc.setLocalDescription() [offer:%o]",i);try{await this._pc.setLocalDescription(i)}catch(e){if(this._sendStream.getTracks().length===0){y.warn("stopSending() | ignoring expected error due no sending tracks: %s",e.toString());return}throw e}if(this._pc.signalingState==="stable")return;const r={type:"answer",sdp:this._remoteSdp.getSdp()};y.debug("stopSending() | calling pc.setRemoteDescription() [answer:%o]",r);await this._pc.setRemoteDescription(r)}async replaceTrack(e,t){this._assertSendDirection();if(t){y.debug("replaceTrack() [localId:%s, track.id:%s]",e,t.id)}else{y.debug("replaceTrack() [localId:%s, no track]",e)}const i=this._mapSendLocalIdRtpSender.get(e);if(!i)throw new Error("associated RTCRtpSender not found");const r=i.track;await i.replaceTrack(t);if(r)this._sendStream.removeTrack(r);if(t)this._sendStream.addTrack(t)}async setMaxSpatialLayer(e,i){this._assertSendDirection();y.debug("setMaxSpatialLayer() [localId:%s, spatialLayer:%s]",e,i);const t=this._mapSendLocalIdRtpSender.get(e);if(!t)throw new Error("associated RTCRtpSender not found");const r=t.getParameters();r.encodings.forEach((e,t)=>{if(t<=i)e.active=true;else e.active=false});await t.setParameters(r)}async setRtpEncodingParameters(e,i){this._assertSendDirection();y.debug("setRtpEncodingParameters() [localId:%s, params:%o]",e,i);const t=this._mapSendLocalIdRtpSender.get(e);if(!t)throw new Error("associated RTCRtpSender not found");const r=t.getParameters();r.encodings.forEach((e,t)=>{r.encodings[t]=Object.assign(Object.assign({},e),i)});await t.setParameters(r)}async getSenderStats(e){this._assertSendDirection();const t=this._mapSendLocalIdRtpSender.get(e);if(!t)throw new Error("associated RTCRtpSender not found");return t.getStats()}async sendDataChannel({ordered:e,maxPacketLifeTime:t,maxRetransmits:i,label:r,protocol:n,priority:s}){this._assertSendDirection();const a={negotiated:true,id:this._nextSendSctpStreamId,ordered:e,maxPacketLifeTime:t,maxRetransmits:i,protocol:n,priority:s};y.debug("sendDataChannel() [options:%o]",a);const o=this._pc.createDataChannel(r,a);this._nextSendSctpStreamId=++this._nextSendSctpStreamId%_.MIS;if(!this._hasDataChannelMediaSection){const d=await this._pc.createOffer();const l=f.parse(d.sdp);const u=l.media.find(e=>e.type==="application");if(!this._transportReady)await this._setupTransport({localDtlsRole:"server",localSdpObject:l});y.debug("sendDataChannel() | calling pc.setLocalDescription() [offer:%o]",d);await this._pc.setLocalDescription(d);this._remoteSdp.sendSctpAssociation({offerMediaObject:u});const h={type:"answer",sdp:this._remoteSdp.getSdp()};y.debug("sendDataChannel() | calling pc.setRemoteDescription() [answer:%o]",h);await this._pc.setRemoteDescription(h);this._hasDataChannelMediaSection=true}const c={streamId:a.id,ordered:a.ordered,maxPacketLifeTime:a.maxPacketLifeTime,maxRetransmits:a.maxRetransmits};return{dataChannel:o,sctpStreamParameters:c}}async receive({trackId:e,kind:t,rtpParameters:i}){this._assertRecvDirection();y.debug("receive() [trackId:%s, kind:%s]",e,t);const r=e;const n=t;this._remoteSdp.receive({mid:n,kind:t,offerRtpParameters:i,streamId:i.rtcp.cname,trackId:e});const s={type:"offer",sdp:this._remoteSdp.getSdp()};y.debug("receive() | calling pc.setRemoteDescription() [offer:%o]",s);await this._pc.setRemoteDescription(s);let a=await this._pc.createAnswer();const o=f.parse(a.sdp);const c=o.media.find(e=>String(e.mid)===n);v.applyCodecParameters({offerRtpParameters:i,answerMediaObject:c});a={type:"answer",sdp:f.write(o)};if(!this._transportReady)await this._setupTransport({localDtlsRole:"client",localSdpObject:o});y.debug("receive() | calling pc.setLocalDescription() [answer:%o]",a);await this._pc.setLocalDescription(a);const d=this._pc.getReceivers().find(e=>e.track&&e.track.id===r);if(!d)throw new Error("new RTCRtpReceiver not");this._mapRecvLocalIdInfo.set(r,{mid:n,rtpParameters:i,rtpReceiver:d});return{localId:r,track:d.track,rtpReceiver:d}}async stopReceiving(e){this._assertRecvDirection();y.debug("stopReceiving() [localId:%s]",e);const{mid:t,rtpParameters:i}=this._mapRecvLocalIdInfo.get(e)||{};this._mapRecvLocalIdInfo.delete(e);this._remoteSdp.planBStopReceiving({mid:t,offerRtpParameters:i});const r={type:"offer",sdp:this._remoteSdp.getSdp()};y.debug("stopReceiving() | calling pc.setRemoteDescription() [offer:%o]",r);await this._pc.setRemoteDescription(r);const n=await this._pc.createAnswer();y.debug("stopReceiving() | calling pc.setLocalDescription() [answer:%o]",n);await this._pc.setLocalDescription(n)}async getReceiverStats(e){this._assertRecvDirection();const{rtpReceiver:t}=this._mapRecvLocalIdInfo.get(e)||{};if(!t)throw new Error("associated RTCRtpReceiver not found");return t.getStats()}async receiveDataChannel({sctpStreamParameters:e,label:t,protocol:i}){this._assertRecvDirection();const{streamId:r,ordered:n,maxPacketLifeTime:s,maxRetransmits:a}=e;const o={negotiated:true,id:r,ordered:n,maxPacketLifeTime:s,maxRetransmits:a,protocol:i};y.debug("receiveDataChannel() [options:%o]",o);const c=this._pc.createDataChannel(t,o);if(!this._hasDataChannelMediaSection){this._remoteSdp.receiveSctpAssociation({oldDataChannelSpec:true});const d={type:"offer",sdp:this._remoteSdp.getSdp()};y.debug("receiveDataChannel() | calling pc.setRemoteDescription() [offer:%o]",d);await this._pc.setRemoteDescription(d);const l=await this._pc.createAnswer();if(!this._transportReady){const u=f.parse(l.sdp);await this._setupTransport({localDtlsRole:"client",localSdpObject:u})}y.debug("receiveDataChannel() | calling pc.setRemoteDescription() [answer:%o]",l);await this._pc.setLocalDescription(l);this._hasDataChannelMediaSection=true}return{dataChannel:c}}async _setupTransport({localDtlsRole:e,localSdpObject:t}){if(!t)t=f.parse(this._pc.localDescription.sdp);const i=v.extractDtlsParameters({sdpObject:t});i.role=e;this._remoteSdp.updateDtlsRole(e==="client"?"server":"client");await this.safeEmitAsPromise("@connect",{dtlsParameters:i});this._transportReady=true}_assertSendDirection(){if(this._direction!=="send"){throw new Error('method can just be called for handlers with "send" direction')}}_assertRecvDirection(){if(this._direction!=="recv"){throw new Error('method can just be called for handlers with "recv" direction')}}}i.Safari11=c},{"../Logger":15,"../ortc":38,"../utils":41,"./HandlerInterface":27,"./sdp/RemoteSdp":33,"./sdp/commonUtils":34,"./sdp/planBUtils":35,"sdp-transform":64}],30:[function(e,t,i){"use strict";var r=this&&this.__createBinding||(Object.create?function(e,t,i,r){if(r===undefined)r=i;Object.defineProperty(e,r,{enumerable:true,get:function(){return t[i]}})}:function(e,t,i,r){if(r===undefined)r=i;e[r]=t[i]});var n=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:true,value:t})}:function(e,t){e["default"]=t});var s=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(e!=null)for(var i in e)if(i!=="default"&&Object.hasOwnProperty.call(e,i))r(t,e,i);n(t,e);return t};Object.defineProperty(i,"__esModule",{value:true});i.Safari12=void 0;const p=s(e("sdp-transform"));const a=e("../Logger");const m=s(e("../utils"));const v=s(e("../ortc"));const g=s(e("./sdp/commonUtils"));const y=s(e("./sdp/unifiedPlanUtils"));const o=e("./HandlerInterface");const l=e("./sdp/RemoteSdp");const _=new a.Logger("Safari12");const f={OS:1024,MIS:1024};class c extends o.HandlerInterface{constructor(){super();this._mapMidTransceiver=new Map;this._sendStream=new MediaStream;this._hasDataChannelMediaSection=false;this._nextSendSctpStreamId=0;this._transportReady=false}static createFactory(){return()=>new c}get name(){return"Safari12"}close(){_.debug("close()");if(this._pc){try{this._pc.close()}catch(e){}}}async getNativeRtpCapabilities(){_.debug("getNativeRtpCapabilities()");const t=new RTCPeerConnection({iceServers:[],iceTransportPolicy:"all",bundlePolicy:"max-bundle",rtcpMuxPolicy:"require"});try{t.addTransceiver("audio");t.addTransceiver("video");const e=await t.createOffer();try{t.close()}catch(e){}const i=p.parse(e.sdp);const r=g.extractRtpCapabilities({sdpObject:i});return r}catch(e){try{t.close()}catch(e){}throw e}}async getNativeSctpCapabilities(){_.debug("getNativeSctpCapabilities()");return{numStreams:f}}run({direction:e,iceParameters:t,iceCandidates:i,dtlsParameters:r,sctpParameters:n,iceServers:s,iceTransportPolicy:a,additionalSettings:o,proprietaryConstraints:c,extendedRtpCapabilities:d}){_.debug("run()");this._direction=e;this._remoteSdp=new l.RemoteSdp({iceParameters:t,iceCandidates:i,dtlsParameters:r,sctpParameters:n});this._sendingRtpParametersByKind={audio:v.getSendingRtpParameters("audio",d),video:v.getSendingRtpParameters("video",d)};this._sendingRemoteRtpParametersByKind={audio:v.getSendingRemoteRtpParameters("audio",d),video:v.getSendingRemoteRtpParameters("video",d)};this._pc=new RTCPeerConnection(Object.assign({iceServers:s||[],iceTransportPolicy:a||"all",bundlePolicy:"max-bundle",rtcpMuxPolicy:"require"},o),c);this._pc.addEventListener("iceconnectionstatechange",()=>{switch(this._pc.iceConnectionState){case"checking":this.emit("@connectionstatechange","connecting");break;case"connected":case"completed":this.emit("@connectionstatechange","connected");break;case"failed":this.emit("@connectionstatechange","failed");break;case"disconnected":this.emit("@connectionstatechange","disconnected");break;case"closed":this.emit("@connectionstatechange","closed");break}})}async updateIceServers(e){_.debug("updateIceServers()");const t=this._pc.getConfiguration();t.iceServers=e;this._pc.setConfiguration(t)}async restartIce(e){_.debug("restartIce()");this._remoteSdp.updateIceParameters(e);if(!this._transportReady)return;if(this._direction==="send"){const t=await this._pc.createOffer({iceRestart:true});_.debug("restartIce() | calling pc.setLocalDescription() [offer:%o]",t);await this._pc.setLocalDescription(t);const i={type:"answer",sdp:this._remoteSdp.getSdp()};_.debug("restartIce() | calling pc.setRemoteDescription() [answer:%o]",i);await this._pc.setRemoteDescription(i)}else{const t={type:"offer",sdp:this._remoteSdp.getSdp()};_.debug("restartIce() | calling pc.setRemoteDescription() [offer:%o]",t);await this._pc.setRemoteDescription(t);const i=await this._pc.createAnswer();_.debug("restartIce() | calling pc.setLocalDescription() [answer:%o]",i);await this._pc.setLocalDescription(i)}}async getTransportStats(){return this._pc.getStats()}async send({track:e,encodings:t,codecOptions:i,codec:r}){this._assertSendDirection();_.debug("send() [kind:%s, track.id:%s]",e.kind,e.id);const n=m.clone(this._sendingRtpParametersByKind[e.kind],{});n.codecs=v.reduceCodecs(n.codecs,r);const s=m.clone(this._sendingRemoteRtpParametersByKind[e.kind],{});s.codecs=v.reduceCodecs(s.codecs,r);const a=this._remoteSdp.getNextMediaSectionIdx();const o=this._pc.addTransceiver(e,{direction:"sendonly",streams:[this._sendStream]});let c=await this._pc.createOffer();let d=p.parse(c.sdp);let l;if(!this._transportReady)await this._setupTransport({localDtlsRole:"server",localSdpObject:d});if(t&&t.length>1){_.debug("send() | enabling legacy simulcast");d=p.parse(c.sdp);l=d.media[a.idx];y.addLegacySimulcast({offerMediaObject:l,numStreams:t.length});c={type:"offer",sdp:p.write(d)}}_.debug("send() | calling pc.setLocalDescription() [offer:%o]",c);await this._pc.setLocalDescription(c);const u=o.mid;n.mid=u;d=p.parse(this._pc.localDescription.sdp);l=d.media[a.idx];n.rtcp.cname=g.getCname({offerMediaObject:l});n.encodings=y.getRtpEncodings({offerMediaObject:l});if(t){for(let e=0;e<n.encodings.length;++e){if(t[e])Object.assign(n.encodings[e],t[e])}}if(n.encodings.length>1&&(n.codecs[0].mimeType.toLowerCase()==="video/vp8"||n.codecs[0].mimeType.toLowerCase()==="video/h264")){for(const f of n.encodings){f.scalabilityMode="S1T3"}}this._remoteSdp.send({offerMediaObject:l,reuseMid:a.reuseMid,offerRtpParameters:n,answerRtpParameters:s,codecOptions:i});const h={type:"answer",sdp:this._remoteSdp.getSdp()};_.debug("send() | calling pc.setRemoteDescription() [answer:%o]",h);await this._pc.setRemoteDescription(h);this._mapMidTransceiver.set(u,o);return{localId:u,rtpParameters:n,rtpSender:o.sender}}async stopSending(e){this._assertSendDirection();_.debug("stopSending() [localId:%s]",e);const t=this._mapMidTransceiver.get(e);if(!t)throw new Error("associated RTCRtpTransceiver not found");t.sender.replaceTrack(null);this._pc.removeTrack(t.sender);this._remoteSdp.closeMediaSection(t.mid);const i=await this._pc.createOffer();_.debug("stopSending() | calling pc.setLocalDescription() [offer:%o]",i);await this._pc.setLocalDescription(i);const r={type:"answer",sdp:this._remoteSdp.getSdp()};_.debug("stopSending() | calling pc.setRemoteDescription() [answer:%o]",r);await this._pc.setRemoteDescription(r)}async replaceTrack(e,t){this._assertSendDirection();if(t){_.debug("replaceTrack() [localId:%s, track.id:%s]",e,t.id)}else{_.debug("replaceTrack() [localId:%s, no track]",e)}const i=this._mapMidTransceiver.get(e);if(!i)throw new Error("associated RTCRtpTransceiver not found");await i.sender.replaceTrack(t)}async setMaxSpatialLayer(e,i){this._assertSendDirection();_.debug("setMaxSpatialLayer() [localId:%s, spatialLayer:%s]",e,i);const t=this._mapMidTransceiver.get(e);if(!t)throw new Error("associated RTCRtpTransceiver not found");const r=t.sender.getParameters();r.encodings.forEach((e,t)=>{if(t<=i)e.active=true;else e.active=false});await t.sender.setParameters(r)}async setRtpEncodingParameters(e,i){this._assertSendDirection();_.debug("setRtpEncodingParameters() [localId:%s, params:%o]",e,i);const t=this._mapMidTransceiver.get(e);if(!t)throw new Error("associated RTCRtpTransceiver not found");const r=t.sender.getParameters();r.encodings.forEach((e,t)=>{r.encodings[t]=Object.assign(Object.assign({},e),i)});await t.sender.setParameters(r)}async getSenderStats(e){this._assertSendDirection();const t=this._mapMidTransceiver.get(e);if(!t)throw new Error("associated RTCRtpTransceiver not found");return t.sender.getStats()}async sendDataChannel({ordered:e,maxPacketLifeTime:t,maxRetransmits:i,label:r,protocol:n,priority:s}){this._assertSendDirection();const a={negotiated:true,id:this._nextSendSctpStreamId,ordered:e,maxPacketLifeTime:t,maxRetransmits:i,protocol:n,priority:s};_.debug("sendDataChannel() [options:%o]",a);const o=this._pc.createDataChannel(r,a);this._nextSendSctpStreamId=++this._nextSendSctpStreamId%f.MIS;if(!this._hasDataChannelMediaSection){const d=await this._pc.createOffer();const l=p.parse(d.sdp);const u=l.media.find(e=>e.type==="application");if(!this._transportReady)await this._setupTransport({localDtlsRole:"server",localSdpObject:l});_.debug("sendDataChannel() | calling pc.setLocalDescription() [offer:%o]",d);await this._pc.setLocalDescription(d);this._remoteSdp.sendSctpAssociation({offerMediaObject:u});const h={type:"answer",sdp:this._remoteSdp.getSdp()};_.debug("sendDataChannel() | calling pc.setRemoteDescription() [answer:%o]",h);await this._pc.setRemoteDescription(h);this._hasDataChannelMediaSection=true}const c={streamId:a.id,ordered:a.ordered,maxPacketLifeTime:a.maxPacketLifeTime,maxRetransmits:a.maxRetransmits};return{dataChannel:o,sctpStreamParameters:c}}async receive({trackId:e,kind:t,rtpParameters:i}){this._assertRecvDirection();_.debug("receive() [trackId:%s, kind:%s]",e,t);const r=i.mid||String(this._mapMidTransceiver.size);this._remoteSdp.receive({mid:r,kind:t,offerRtpParameters:i,streamId:i.rtcp.cname,trackId:e});const n={type:"offer",sdp:this._remoteSdp.getSdp()};_.debug("receive() | calling pc.setRemoteDescription() [offer:%o]",n);await this._pc.setRemoteDescription(n);let s=await this._pc.createAnswer();const a=p.parse(s.sdp);const o=a.media.find(e=>String(e.mid)===r);g.applyCodecParameters({offerRtpParameters:i,answerMediaObject:o});s={type:"answer",sdp:p.write(a)};if(!this._transportReady)await this._setupTransport({localDtlsRole:"client",localSdpObject:a});_.debug("receive() | calling pc.setLocalDescription() [answer:%o]",s);await this._pc.setLocalDescription(s);const c=this._pc.getTransceivers().find(e=>e.mid===r);if(!c)throw new Error("new RTCRtpTransceiver not found");this._mapMidTransceiver.set(r,c);return{localId:r,track:c.receiver.track,rtpReceiver:c.receiver}}async stopReceiving(e){this._assertRecvDirection();_.debug("stopReceiving() [localId:%s]",e);const t=this._mapMidTransceiver.get(e);if(!t)throw new Error("associated RTCRtpTransceiver not found");this._remoteSdp.closeMediaSection(t.mid);const i={type:"offer",sdp:this._remoteSdp.getSdp()};_.debug("stopReceiving() | calling pc.setRemoteDescription() [offer:%o]",i);await this._pc.setRemoteDescription(i);const r=await this._pc.createAnswer();_.debug("stopReceiving() | calling pc.setLocalDescription() [answer:%o]",r);await this._pc.setLocalDescription(r)}async getReceiverStats(e){this._assertRecvDirection();const t=this._mapMidTransceiver.get(e);if(!t)throw new Error("associated RTCRtpTransceiver not found");return t.receiver.getStats()}async receiveDataChannel({sctpStreamParameters:e,label:t,protocol:i}){this._assertRecvDirection();const{streamId:r,ordered:n,maxPacketLifeTime:s,maxRetransmits:a}=e;const o={negotiated:true,id:r,ordered:n,maxPacketLifeTime:s,maxRetransmits:a,protocol:i};_.debug("receiveDataChannel() [options:%o]",o);const c=this._pc.createDataChannel(t,o);if(!this._hasDataChannelMediaSection){this._remoteSdp.receiveSctpAssociation();const d={type:"offer",sdp:this._remoteSdp.getSdp()};_.debug("receiveDataChannel() | calling pc.setRemoteDescription() [offer:%o]",d);await this._pc.setRemoteDescription(d);const l=await this._pc.createAnswer();if(!this._transportReady){const u=p.parse(l.sdp);await this._setupTransport({localDtlsRole:"client",localSdpObject:u})}_.debug("receiveDataChannel() | calling pc.setRemoteDescription() [answer:%o]",l);await this._pc.setLocalDescription(l);this._hasDataChannelMediaSection=true}return{dataChannel:c}}async _setupTransport({localDtlsRole:e,localSdpObject:t}){if(!t)t=p.parse(this._pc.localDescription.sdp);const i=g.extractDtlsParameters({sdpObject:t});i.role=e;this._remoteSdp.updateDtlsRole(e==="client"?"server":"client");await this.safeEmitAsPromise("@connect",{dtlsParameters:i});this._transportReady=true}_assertSendDirection(){if(this._direction!=="send"){throw new Error('method can just be called for handlers with "send" direction')}}_assertRecvDirection(){if(this._direction!=="recv"){throw new Error('method can just be called for handlers with "recv" direction')}}}i.Safari12=c},{"../Logger":15,"../ortc":38,"../utils":41,"./HandlerInterface":27,"./sdp/RemoteSdp":33,"./sdp/commonUtils":34,"./sdp/unifiedPlanUtils":36,"sdp-transform":64}],31:[function(e,t,i){"use strict";var r=this&&this.__createBinding||(Object.create?function(e,t,i,r){if(r===undefined)r=i;Object.defineProperty(e,r,{enumerable:true,get:function(){return t[i]}})}:function(e,t,i,r){if(r===undefined)r=i;e[r]=t[i]});var n=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:true,value:t})}:function(e,t){e["default"]=t});var s=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(e!=null)for(var i in e)if(i!=="default"&&Object.hasOwnProperty.call(e,i))r(t,e,i);n(t,e);return t};Object.defineProperty(i,"__esModule",{value:true});i.mangleRtpParameters=i.getCapabilities=void 0;const a=s(e("../../utils"));function o(){const e=RTCRtpReceiver.getCapabilities();const t=a.clone(e,{});for(const i of t.codecs){i.channels=i.numChannels;delete i.numChannels;i.mimeType=i.mimeType||`${i.kind}/${i.name}`;if(i.parameters){const r=i.parameters;if(r.apt)r.apt=Number(r.apt);if(r["packetization-mode"])r["packetization-mode"]=Number(r["packetization-mode"])}for(const n of i.rtcpFeedback||[]){if(!n.parameter)n.parameter=""}}return t}i.getCapabilities=o;function c(e){const t=a.clone(e,{});if(t.mid){t.muxId=t.mid;delete t.mid}for(const i of t.codecs){if(i.channels){i.numChannels=i.channels;delete i.channels}if(i.mimeType&&!i.name)i.name=i.mimeType.split("/")[1];delete i.mimeType}return t}i.mangleRtpParameters=c},{"../../utils":41}],32:[function(e,t,i){"use strict";var r=this&&this.__createBinding||(Object.create?function(e,t,i,r){if(r===undefined)r=i;Object.defineProperty(e,r,{enumerable:true,get:function(){return t[i]}})}:function(e,t,i,r){if(r===undefined)r=i;e[r]=t[i]});var n=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:true,value:t})}:function(e,t){e["default"]=t});var s=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(e!=null)for(var i in e)if(i!=="default"&&Object.hasOwnProperty.call(e,i))r(t,e,i);n(t,e);return t};Object.defineProperty(i,"__esModule",{value:true});i.OfferMediaSection=i.AnswerMediaSection=i.MediaSection=void 0;const E=s(e("../../utils"));class a{constructor({iceParameters:e,iceCandidates:t,dtlsParameters:i,planB:r=false}){this._mediaObject={};this._planB=r;if(e){this.setIceParameters(e)}if(t){this._mediaObject.candidates=[];for(const n of t){const s={};s.component=1;s.foundation=n.foundation;s.ip=n.ip;s.port=n.port;s.priority=n.priority;s.transport=n.protocol;s.type=n.type;if(n.tcpType)s.tcptype=n.tcpType;this._mediaObject.candidates.push(s)}this._mediaObject.endOfCandidates="end-of-candidates";this._mediaObject.iceOptions="renomination"}if(i){this.setDtlsRole(i.role)}}get mid(){return String(this._mediaObject.mid)}get closed(){return this._mediaObject.port===0}getObject(){return this._mediaObject}setIceParameters(e){this._mediaObject.iceUfrag=e.usernameFragment;this._mediaObject.icePwd=e.password}disable(){this._mediaObject.direction="inactive";delete this._mediaObject.ext;delete this._mediaObject.ssrcs;delete this._mediaObject.ssrcGroups;delete this._mediaObject.simulcast;delete this._mediaObject.simulcast_03;delete this._mediaObject.rids}close(){this._mediaObject.direction="inactive";this._mediaObject.port=0;delete this._mediaObject.ext;delete this._mediaObject.ssrcs;delete this._mediaObject.ssrcGroups;delete this._mediaObject.simulcast;delete this._mediaObject.simulcast_03;delete this._mediaObject.rids;delete this._mediaObject.extmapAllowMixed}}i.MediaSection=a;class o extends a{constructor({iceParameters:e,iceCandidates:t,dtlsParameters:i,sctpParameters:r,plainRtpParameters:n,planB:s=false,offerMediaObject:a,offerRtpParameters:o,answerRtpParameters:c,codecOptions:d,extmapAllowMixed:l=false}){super({iceParameters:e,iceCandidates:t,dtlsParameters:i,planB:s});this._mediaObject.mid=String(a.mid);this._mediaObject.type=a.type;this._mediaObject.protocol=a.protocol;if(!n){this._mediaObject.connection={ip:"127.0.0.1",version:4};this._mediaObject.port=7}else{this._mediaObject.connection={ip:n.ip,version:n.ipVersion};this._mediaObject.port=n.port}switch(a.type){case"audio":case"video":{this._mediaObject.direction="recvonly";this._mediaObject.rtp=[];this._mediaObject.rtcpFb=[];this._mediaObject.fmtp=[];for(const u of c.codecs){const h={payload:u.payloadType,codec:D(u),rate:u.clockRate};if(u.channels>1)h.encoding=u.channels;this._mediaObject.rtp.push(h);const f=E.clone(u.parameters,{});if(d){const{opusStereo:m,opusFec:v,opusDtx:g,opusMaxPlaybackRate:y,opusMaxAverageBitrate:_,opusPtime:b,videoGoogleStartBitrate:S,videoGoogleMaxBitrate:w,videoGoogleMinBitrate:k}=d;const C=o.codecs.find(e=>e.payloadType===u.payloadType);switch(u.mimeType.toLowerCase()){case"audio/opus":{if(m!==undefined){C.parameters["sprop-stereo"]=m?1:0;f.stereo=m?1:0}if(v!==undefined){C.parameters.useinbandfec=v?1:0;f.useinbandfec=v?1:0}if(g!==undefined){C.parameters.usedtx=g?1:0;f.usedtx=g?1:0}if(y!==undefined){f.maxplaybackrate=y}if(_!==undefined){f.maxaveragebitrate=_}if(b!==undefined){C.parameters.ptime=b;f.ptime=b}break}case"video/vp8":case"video/vp9":case"video/h264":case"video/h265":{if(S!==undefined)f["x-google-start-bitrate"]=S;if(w!==undefined)f["x-google-max-bitrate"]=w;if(k!==undefined)f["x-google-min-bitrate"]=k;break}}}const p={payload:u.payloadType,config:""};for(const T of Object.keys(f)){if(p.config)p.config+=";";p.config+=`${T}=${f[T]}`}if(p.config)this._mediaObject.fmtp.push(p);for(const P of u.rtcpFeedback){this._mediaObject.rtcpFb.push({payload:u.payloadType,type:P.type,subtype:P.parameter})}}this._mediaObject.payloads=c.codecs.map(e=>e.payloadType).join(" ");this._mediaObject.ext=[];for(const R of c.headerExtensions){const x=(a.ext||[]).some(e=>e.uri===R.uri);if(!x)continue;this._mediaObject.ext.push({uri:R.uri,value:R.id})}if(l&&a.extmapAllowMixed==="extmap-allow-mixed"){this._mediaObject.extmapAllowMixed="extmap-allow-mixed"}if(a.simulcast){this._mediaObject.simulcast={dir1:"recv",list1:a.simulcast.list1};this._mediaObject.rids=[];for(const M of a.rids||[]){if(M.direction!=="send")continue;this._mediaObject.rids.push({id:M.id,direction:"recv"})}}else if(a.simulcast_03){this._mediaObject.simulcast_03={value:a.simulcast_03.value.replace(/send/g,"recv")};this._mediaObject.rids=[];for(const M of a.rids||[]){if(M.direction!=="send")continue;this._mediaObject.rids.push({id:M.id,direction:"recv"})}}this._mediaObject.rtcpMux="rtcp-mux";this._mediaObject.rtcpRsize="rtcp-rsize";if(this._planB&&this._mediaObject.type==="video")this._mediaObject.xGoogleFlag="conference";break}case"application":{if(typeof a.sctpPort==="number"){this._mediaObject.payloads="webrtc-datachannel";this._mediaObject.sctpPort=r.port;this._mediaObject.maxMessageSize=r.maxMessageSize}else if(a.sctpmap){this._mediaObject.payloads=r.port;this._mediaObject.sctpmap={app:"webrtc-datachannel",sctpmapNumber:r.port,maxMessageSize:r.maxMessageSize}}break}}}setDtlsRole(e){switch(e){case"client":this._mediaObject.setup="active";break;case"server":this._mediaObject.setup="passive";break;case"auto":this._mediaObject.setup="actpass";break}}}i.AnswerMediaSection=o;class c extends a{constructor({iceParameters:e,iceCandidates:t,dtlsParameters:i,sctpParameters:r,plainRtpParameters:n,planB:s=false,mid:a,kind:o,offerRtpParameters:c,streamId:d,trackId:l,oldDataChannelSpec:u=false}){super({iceParameters:e,iceCandidates:t,dtlsParameters:i,planB:s});this._mediaObject.mid=String(a);this._mediaObject.type=o;if(!n){this._mediaObject.connection={ip:"127.0.0.1",version:4};if(!r)this._mediaObject.protocol="UDP/TLS/RTP/SAVPF";else this._mediaObject.protocol="UDP/DTLS/SCTP";this._mediaObject.port=7}else{this._mediaObject.connection={ip:n.ip,version:n.ipVersion};this._mediaObject.protocol="RTP/AVP";this._mediaObject.port=n.port}switch(o){case"audio":case"video":{this._mediaObject.direction="sendonly";this._mediaObject.rtp=[];this._mediaObject.rtcpFb=[];this._mediaObject.fmtp=[];if(!this._planB)this._mediaObject.msid=`${d||"-"} ${l}`;for(const m of c.codecs){const v={payload:m.payloadType,codec:D(m),rate:m.clockRate};if(m.channels>1)v.encoding=m.channels;this._mediaObject.rtp.push(v);const g={payload:m.payloadType,config:""};for(const y of Object.keys(m.parameters)){if(g.config)g.config+=";";g.config+=`${y}=${m.parameters[y]}`}if(g.config)this._mediaObject.fmtp.push(g);for(const _ of m.rtcpFeedback){this._mediaObject.rtcpFb.push({payload:m.payloadType,type:_.type,subtype:_.parameter})}}this._mediaObject.payloads=c.codecs.map(e=>e.payloadType).join(" ");this._mediaObject.ext=[];for(const b of c.headerExtensions){this._mediaObject.ext.push({uri:b.uri,value:b.id})}this._mediaObject.rtcpMux="rtcp-mux";this._mediaObject.rtcpRsize="rtcp-rsize";const h=c.encodings[0];const f=h.ssrc;const p=h.rtx&&h.rtx.ssrc?h.rtx.ssrc:undefined;this._mediaObject.ssrcs=[];this._mediaObject.ssrcGroups=[];if(c.rtcp.cname){this._mediaObject.ssrcs.push({id:f,attribute:"cname",value:c.rtcp.cname})}if(this._planB){this._mediaObject.ssrcs.push({id:f,attribute:"msid",value:`${d||"-"} ${l}`})}if(p){if(c.rtcp.cname){this._mediaObject.ssrcs.push({id:p,attribute:"cname",value:c.rtcp.cname})}if(this._planB){this._mediaObject.ssrcs.push({id:p,attribute:"msid",value:`${d||"-"} ${l}`})}this._mediaObject.ssrcGroups.push({semantics:"FID",ssrcs:`${f} ${p}`})}break}case"application":{if(!u){this._mediaObject.payloads="webrtc-datachannel";this._mediaObject.sctpPort=r.port;this._mediaObject.maxMessageSize=r.maxMessageSize}else{this._mediaObject.payloads=r.port;this._mediaObject.sctpmap={app:"webrtc-datachannel",sctpmapNumber:r.port,maxMessageSize:r.maxMessageSize}}break}}}setDtlsRole(e){this._mediaObject.setup="actpass"}planBReceive({offerRtpParameters:e,streamId:t,trackId:i}){const r=e.encodings[0];const n=r.ssrc;const s=r.rtx&&r.rtx.ssrc?r.rtx.ssrc:undefined;if(e.rtcp.cname){this._mediaObject.ssrcs.push({id:n,attribute:"cname",value:e.rtcp.cname})}this._mediaObject.ssrcs.push({id:n,attribute:"msid",value:`${t||"-"} ${i}`});if(s){if(e.rtcp.cname){this._mediaObject.ssrcs.push({id:s,attribute:"cname",value:e.rtcp.cname})}this._mediaObject.ssrcs.push({id:s,attribute:"msid",value:`${t||"-"} ${i}`});this._mediaObject.ssrcGroups.push({semantics:"FID",ssrcs:`${n} ${s}`})}}planBStopReceiving({offerRtpParameters:e}){const t=e.encodings[0];const i=t.ssrc;const r=t.rtx&&t.rtx.ssrc?t.rtx.ssrc:undefined;this._mediaObject.ssrcs=this._mediaObject.ssrcs.filter(e=>e.id!==i&&e.id!==r);if(r){this._mediaObject.ssrcGroups=this._mediaObject.ssrcGroups.filter(e=>e.ssrcs!==`${i} ${r}`)}}}i.OfferMediaSection=c;function D(e){const t=new RegExp("^(audio|video)/(.+)","i");const i=t.exec(e.mimeType);if(!i)throw new TypeError("invalid codec.mimeType");return i[2]}},{"../../utils":41}],33:[function(e,t,i){"use strict";var r=this&&this.__createBinding||(Object.create?function(e,t,i,r){if(r===undefined)r=i;Object.defineProperty(e,r,{enumerable:true,get:function(){return t[i]}})}:function(e,t,i,r){if(r===undefined)r=i;e[r]=t[i]});var n=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:true,value:t})}:function(e,t){e["default"]=t});var s=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(e!=null)for(var i in e)if(i!=="default"&&Object.hasOwnProperty.call(e,i))r(t,e,i);n(t,e);return t};Object.defineProperty(i,"__esModule",{value:true});i.RemoteSdp=void 0;const a=s(e("sdp-transform"));const o=e("../../Logger");const c=e("./MediaSection");const d=new o.Logger("RemoteSdp");class l{constructor({iceParameters:e,iceCandidates:t,dtlsParameters:i,sctpParameters:r,plainRtpParameters:n,planB:s=false}){this._mediaSections=[];this._midToIndex=new Map;this._iceParameters=e;this._iceCandidates=t;this._dtlsParameters=i;this._sctpParameters=r;this._plainRtpParameters=n;this._planB=s;this._sdpObject={version:0,origin:{address:"0.0.0.0",ipVer:4,netType:"IN",sessionId:1e4,sessionVersion:0,username:"mediasoup-client"},name:"-",timing:{start:0,stop:0},media:[]};if(e&&e.iceLite){this._sdpObject.icelite="ice-lite"}if(i){this._sdpObject.msidSemantic={semantic:"WMS",token:"*"};const a=this._dtlsParameters.fingerprints.length;this._sdpObject.fingerprint={type:i.fingerprints[a-1].algorithm,hash:i.fingerprints[a-1].value};this._sdpObject.groups=[{type:"BUNDLE",mids:""}]}if(n){this._sdpObject.origin.address=n.ip;this._sdpObject.origin.ipVer=n.ipVersion}}updateIceParameters(e){d.debug("updateIceParameters() [iceParameters:%o]",e);this._iceParameters=e;this._sdpObject.icelite=e.iceLite?"ice-lite":undefined;for(const t of this._mediaSections){t.setIceParameters(e)}}updateDtlsRole(e){d.debug("updateDtlsRole() [role:%s]",e);this._dtlsParameters.role=e;for(const t of this._mediaSections){t.setDtlsRole(e)}}getNextMediaSectionIdx(){for(let e=0;e<this._mediaSections.length;++e){const t=this._mediaSections[e];if(t.closed)return{idx:e,reuseMid:t.mid}}return{idx:this._mediaSections.length}}send({offerMediaObject:e,reuseMid:t,offerRtpParameters:i,answerRtpParameters:r,codecOptions:n,extmapAllowMixed:s=false}){const a=new c.AnswerMediaSection({iceParameters:this._iceParameters,iceCandidates:this._iceCandidates,dtlsParameters:this._dtlsParameters,plainRtpParameters:this._plainRtpParameters,planB:this._planB,offerMediaObject:e,offerRtpParameters:i,answerRtpParameters:r,codecOptions:n,extmapAllowMixed:s});if(t){this._replaceMediaSection(a,t)}else if(!this._midToIndex.has(a.mid)){this._addMediaSection(a)}else{this._replaceMediaSection(a)}}receive({mid:e,kind:t,offerRtpParameters:i,streamId:r,trackId:n}){const s=this._midToIndex.get(e);let a;if(s!==undefined)a=this._mediaSections[s];if(!a){a=new c.OfferMediaSection({iceParameters:this._iceParameters,iceCandidates:this._iceCandidates,dtlsParameters:this._dtlsParameters,plainRtpParameters:this._plainRtpParameters,planB:this._planB,mid:e,kind:t,offerRtpParameters:i,streamId:r,trackId:n});const o=this._mediaSections.find(e=>e.closed);if(o){this._replaceMediaSection(a,o.mid)}else{this._addMediaSection(a)}}else{a.planBReceive({offerRtpParameters:i,streamId:r,trackId:n});this._replaceMediaSection(a)}}disableMediaSection(e){const t=this._midToIndex.get(e);if(t===undefined){throw new Error(`no media section found with mid '${e}'`)}const i=this._mediaSections[t];i.disable()}closeMediaSection(e){const t=this._midToIndex.get(e);if(t===undefined){throw new Error(`no media section found with mid '${e}'`)}const i=this._mediaSections[t];if(e===this._firstMid){d.debug("closeMediaSection() | cannot close first media section, disabling it instead [mid:%s]",e);this.disableMediaSection(e);return}i.close();this._regenerateBundleMids()}planBStopReceiving({mid:e,offerRtpParameters:t}){const i=this._midToIndex.get(e);if(i===undefined){throw new Error(`no media section found with mid '${e}'`)}const r=this._mediaSections[i];r.planBStopReceiving({offerRtpParameters:t});this._replaceMediaSection(r)}sendSctpAssociation({offerMediaObject:e}){const t=new c.AnswerMediaSection({iceParameters:this._iceParameters,iceCandidates:this._iceCandidates,dtlsParameters:this._dtlsParameters,sctpParameters:this._sctpParameters,plainRtpParameters:this._plainRtpParameters,offerMediaObject:e});this._addMediaSection(t)}receiveSctpAssociation({oldDataChannelSpec:e=false}={}){const t=new c.OfferMediaSection({iceParameters:this._iceParameters,iceCandidates:this._iceCandidates,dtlsParameters:this._dtlsParameters,sctpParameters:this._sctpParameters,plainRtpParameters:this._plainRtpParameters,mid:"datachannel",kind:"application",oldDataChannelSpec:e});this._addMediaSection(t)}getSdp(){this._sdpObject.origin.sessionVersion++;return a.write(this._sdpObject)}_addMediaSection(e){if(!this._firstMid)this._firstMid=e.mid;this._mediaSections.push(e);this._midToIndex.set(e.mid,this._mediaSections.length-1);this._sdpObject.media.push(e.getObject());this._regenerateBundleMids()}_replaceMediaSection(e,t){if(typeof t==="string"){const i=this._midToIndex.get(t);if(i===undefined){throw new Error(`no media section found for reuseMid '${t}'`)}const r=this._mediaSections[i];this._mediaSections[i]=e;this._midToIndex.delete(r.mid);this._midToIndex.set(e.mid,i);this._sdpObject.media[i]=e.getObject();this._regenerateBundleMids()}else{const i=this._midToIndex.get(e.mid);if(i===undefined){throw new Error(`no media section found with mid '${e.mid}'`)}this._mediaSections[i]=e;this._sdpObject.media[i]=e.getObject()}}_regenerateBundleMids(){if(!this._dtlsParameters)return;this._sdpObject.groups[0].mids=this._mediaSections.filter(e=>!e.closed).map(e=>e.mid).join(" ")}}i.RemoteSdp=l},{"../../Logger":15,"./MediaSection":32,"sdp-transform":64}],34:[function(e,t,i){"use strict";var r=this&&this.__createBinding||(Object.create?function(e,t,i,r){if(r===undefined)r=i;Object.defineProperty(e,r,{enumerable:true,get:function(){return t[i]}})}:function(e,t,i,r){if(r===undefined)r=i;e[r]=t[i]});var n=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:true,value:t})}:function(e,t){e["default"]=t});var s=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(e!=null)for(var i in e)if(i!=="default"&&Object.hasOwnProperty.call(e,i))r(t,e,i);n(t,e);return t};Object.defineProperty(i,"__esModule",{value:true});i.applyCodecParameters=i.getCname=i.extractDtlsParameters=i.extractRtpCapabilities=void 0;const v=s(e("sdp-transform"));function a({sdpObject:e}){const t=new Map;const i=[];let r=false;let n=false;for(const a of e.media){const o=a.type;switch(o){case"audio":{if(r)continue;r=true;break}case"video":{if(n)continue;n=true;break}default:{continue}}for(const c of a.rtp){const d={kind:o,mimeType:`${o}/${c.codec}`,preferredPayloadType:c.payload,clockRate:c.rate,channels:c.encoding,parameters:{},rtcpFeedback:[]};t.set(d.preferredPayloadType,d)}for(const l of a.fmtp||[]){const u=v.parseParams(l.config);const d=t.get(l.payload);if(!d)continue;if(u&&u.hasOwnProperty("profile-level-id"))u["profile-level-id"]=String(u["profile-level-id"]);d.parameters=u}for(const h of a.rtcpFb||[]){const d=t.get(h.payload);if(!d)continue;const f={type:h.type,parameter:h.subtype};if(!f.parameter)delete f.parameter;d.rtcpFeedback.push(f)}for(const p of a.ext||[]){if(p["encrypt-uri"])continue;const m={kind:o,uri:p.uri,preferredId:p.value};i.push(m)}}const s={codecs:Array.from(t.values()),headerExtensions:i};return s}i.extractRtpCapabilities=a;function o({sdpObject:e}){const t=(e.media||[]).find(e=>e.iceUfrag&&e.port!==0);if(!t)throw new Error("no active media section found");const i=t.fingerprint||e.fingerprint;let r;switch(t.setup){case"active":r="client";break;case"passive":r="server";break;case"actpass":r="auto";break}const n={role:r,fingerprints:[{algorithm:i.type,value:i.hash}]};return n}i.extractDtlsParameters=o;function c({offerMediaObject:e}){const t=(e.ssrcs||[]).find(e=>e.attribute==="cname");if(!t)return"";return t.value}i.getCname=c;function d({offerRtpParameters:e,answerMediaObject:t}){for(const i of e.codecs){const r=i.mimeType.toLowerCase();if(r!=="audio/opus")continue;const n=(t.rtp||[]).find(e=>e.payload===i.payloadType);if(!n)continue;t.fmtp=t.fmtp||[];let e=t.fmtp.find(e=>e.payload===i.payloadType);if(!e){e={payload:i.payloadType,config:""};t.fmtp.push(e)}const s=v.parseParams(e.config);switch(r){case"audio/opus":{const a=i.parameters["sprop-stereo"];if(a!==undefined)s.stereo=a?1:0;break}}e.config="";for(const o of Object.keys(s)){if(e.config)e.config+=";";e.config+=`${o}=${s[o]}`}}}i.applyCodecParameters=d},{"sdp-transform":64}],35:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:true});i.addLegacySimulcast=i.getRtpEncodings=void 0;function r({offerMediaObject:e,track:t}){let i;const r=new Set;for(const a of e.ssrcs||[]){if(a.attribute!=="msid")continue;const o=a.value.split(" ")[1];if(o===t.id){const c=a.id;r.add(c);if(!i)i=c}}if(r.size===0)throw new Error(`a=ssrc line with msid information not found [track.id:${t.id}]`);const n=new Map;for(const a of e.ssrcGroups||[]){if(a.semantics!=="FID")continue;let[e,t]=a.ssrcs.split(/\s+/);e=Number(e);t=Number(t);if(r.has(e)){r.delete(e);r.delete(t);n.set(e,t)}}for(const c of r){n.set(c,null)}const s=[];for(const[c,d]of n){const l={ssrc:c};if(d)l.rtx={ssrc:d};s.push(l)}return s}i.getRtpEncodings=r;function n({offerMediaObject:t,track:i,numStreams:r}){if(r<=1)throw new TypeError("numStreams must be greater than 1");let n;let s;let a;const e=(t.ssrcs||[]).find(e=>{if(e.attribute!=="msid")return false;const t=e.value.split(" ")[1];if(t===i.id){n=e.id;a=e.value.split(" ")[0];return true}else{return false}});if(!e)throw new Error(`a=ssrc line with msid information not found [track.id:${i.id}]`);(t.ssrcGroups||[]).some(e=>{if(e.semantics!=="FID")return false;const t=e.ssrcs.split(/\s+/);if(Number(t[0])===n){s=Number(t[1]);return true}else{return false}});const o=t.ssrcs.find(e=>e.attribute==="cname"&&e.id===n);if(!o)throw new Error(`a=ssrc line with cname information not found [track.id:${i.id}]`);const c=o.value;const d=[];const l=[];for(let e=0;e<r;++e){d.push(n+e);if(s)l.push(s+e)}t.ssrcGroups=t.ssrcGroups||[];t.ssrcs=t.ssrcs||[];t.ssrcGroups.push({semantics:"SIM",ssrcs:d.join(" ")});for(let e=0;e<d.length;++e){const u=d[e];t.ssrcs.push({id:u,attribute:"cname",value:c});t.ssrcs.push({id:u,attribute:"msid",value:`${a} ${i.id}`})}for(let e=0;e<l.length;++e){const u=d[e];const h=l[e];t.ssrcs.push({id:h,attribute:"cname",value:c});t.ssrcs.push({id:h,attribute:"msid",value:`${a} ${i.id}`});t.ssrcGroups.push({semantics:"FID",ssrcs:`${u} ${h}`})}}i.addLegacySimulcast=n},{}],36:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:true});i.addLegacySimulcast=i.getRtpEncodings=void 0;function r({offerMediaObject:e}){const i=new Set;for(const n of e.ssrcs||[]){const s=n.id;i.add(s)}if(i.size===0)throw new Error("no a=ssrc lines found");const r=new Map;for(const n of e.ssrcGroups||[]){if(n.semantics!=="FID")continue;let[e,t]=n.ssrcs.split(/\s+/);e=Number(e);t=Number(t);if(i.has(e)){i.delete(e);i.delete(t);r.set(e,t)}}for(const s of i){r.set(s,null)}const t=[];for(const[s,a]of r){const o={ssrc:s};if(a)o.rtx={ssrc:a};t.push(o)}return t}i.getRtpEncodings=r;function n({offerMediaObject:t,numStreams:i}){if(i<=1)throw new TypeError("numStreams must be greater than 1");const e=(t.ssrcs||[]).find(e=>e.attribute==="msid");if(!e)throw new Error("a=ssrc line with msid information not found");const[r,n]=e.value.split(" ");const s=e.id;let a;(t.ssrcGroups||[]).some(e=>{if(e.semantics!=="FID")return false;const t=e.ssrcs.split(/\s+/);if(Number(t[0])===s){a=Number(t[1]);return true}else{return false}});const o=t.ssrcs.find(e=>e.attribute==="cname");if(!o)throw new Error("a=ssrc line with cname information not found");const c=o.value;const d=[];const l=[];for(let e=0;e<i;++e){d.push(s+e);if(a)l.push(a+e)}t.ssrcGroups=[];t.ssrcs=[];t.ssrcGroups.push({semantics:"SIM",ssrcs:d.join(" ")});for(let e=0;e<d.length;++e){const u=d[e];t.ssrcs.push({id:u,attribute:"cname",value:c});t.ssrcs.push({id:u,attribute:"msid",value:`${r} ${n}`})}for(let e=0;e<l.length;++e){const u=d[e];const h=l[e];t.ssrcs.push({id:h,attribute:"cname",value:c});t.ssrcs.push({id:h,attribute:"msid",value:`${r} ${n}`});t.ssrcGroups.push({semantics:"FID",ssrcs:`${u} ${h}`})}}i.addLegacySimulcast=n},{}],37:[function(e,t,i){"use strict";var r=this&&this.__createBinding||(Object.create?function(e,t,i,r){if(r===undefined)r=i;Object.defineProperty(e,r,{enumerable:true,get:function(){return t[i]}})}:function(e,t,i,r){if(r===undefined)r=i;e[r]=t[i]});var n=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:true,value:t})}:function(e,t){e["default"]=t});var s=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(e!=null)for(var i in e)if(i!=="default"&&Object.hasOwnProperty.call(e,i))r(t,e,i);n(t,e);return t};Object.defineProperty(i,"__esModule",{value:true});i.detectDevice=i.Device=i.version=i.types=void 0;const a=e("./Device");Object.defineProperty(i,"Device",{enumerable:true,get:function(){return a.Device}});Object.defineProperty(i,"detectDevice",{enumerable:true,get:function(){return a.detectDevice}});const o=s(e("./types"));i.types=o;i.version="3.6.30";var c=e("./scalabilityModes");Object.defineProperty(i,"parseScalabilityMode",{enumerable:true,get:function(){return c.parse}})},{"./Device":13,"./scalabilityModes":39,"./types":40}],38:[function(e,t,i){"use strict";var r=this&&this.__createBinding||(Object.create?function(e,t,i,r){if(r===undefined)r=i;Object.defineProperty(e,r,{enumerable:true,get:function(){return t[i]}})}:function(e,t,i,r){if(r===undefined)r=i;e[r]=t[i]});var n=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:true,value:t})}:function(e,t){e["default"]=t});var s=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(e!=null)for(var i in e)if(i!=="default"&&Object.hasOwnProperty.call(e,i))r(t,e,i);n(t,e);return t};Object.defineProperty(i,"__esModule",{value:true});i.canReceive=i.canSend=i.generateProbatorRtpParameters=i.reduceCodecs=i.getSendingRemoteRtpParameters=i.getSendingRtpParameters=i.getRecvRtpCapabilities=i.getExtendedRtpCapabilities=i.validateSctpStreamParameters=i.validateSctpParameters=i.validateNumSctpStreams=i.validateSctpCapabilities=i.validateRtcpParameters=i.validateRtpEncodingParameters=i.validateRtpHeaderExtensionParameters=i.validateRtpCodecParameters=i.validateRtpParameters=i.validateRtpHeaderExtension=i.validateRtcpFeedback=i.validateRtpCodecCapability=i.validateRtpCapabilities=void 0;const l=s(e("h264-profile-level-id"));const a=s(e("./utils"));const o="probator";const c=1234;const d=127;function u(e){if(typeof e!=="object")throw new TypeError("caps is not an object");if(e.codecs&&!Array.isArray(e.codecs))throw new TypeError("caps.codecs is not an array");else if(!e.codecs)e.codecs=[];for(const t of e.codecs){h(t)}if(e.headerExtensions&&!Array.isArray(e.headerExtensions))throw new TypeError("caps.headerExtensions is not an array");else if(!e.headerExtensions)e.headerExtensions=[];for(const i of e.headerExtensions){p(i)}}i.validateRtpCapabilities=u;function h(t){const e=new RegExp("^(audio|video)/(.+)","i");if(typeof t!=="object")throw new TypeError("codec is not an object");if(!t.mimeType||typeof t.mimeType!=="string")throw new TypeError("missing codec.mimeType");const i=e.exec(t.mimeType);if(!i)throw new TypeError("invalid codec.mimeType");t.kind=i[1].toLowerCase();if(t.preferredPayloadType&&typeof t.preferredPayloadType!=="number")throw new TypeError("invalid codec.preferredPayloadType");if(typeof t.clockRate!=="number")throw new TypeError("missing codec.clockRate");if(t.kind==="audio"){if(typeof t.channels!=="number")t.channels=1}else{delete t.channels}if(!t.parameters||typeof t.parameters!=="object")t.parameters={};for(const r of Object.keys(t.parameters)){let e=t.parameters[r];if(e===undefined){t.parameters[r]="";e=""}if(typeof e!=="string"&&typeof e!=="number"){throw new TypeError(`invalid codec parameter [key:${r}s, value:${e}]`)}if(r==="apt"){if(typeof e!=="number")throw new TypeError("invalid codec apt parameter")}}if(!t.rtcpFeedback||!Array.isArray(t.rtcpFeedback))t.rtcpFeedback=[];for(const n of t.rtcpFeedback){f(n)}}i.validateRtpCodecCapability=h;function f(e){if(typeof e!=="object")throw new TypeError("fb is not an object");if(!e.type||typeof e.type!=="string")throw new TypeError("missing fb.type");if(!e.parameter||typeof e.parameter!=="string")e.parameter=""}i.validateRtcpFeedback=f;function p(e){if(typeof e!=="object")throw new TypeError("ext is not an object");if(!e.kind||typeof e.kind!=="string")e.kind="";if(e.kind!==""&&e.kind!=="audio"&&e.kind!=="video")throw new TypeError("invalid ext.kind");if(!e.uri||typeof e.uri!=="string")throw new TypeError("missing ext.uri");if(typeof e.preferredId!=="number")throw new TypeError("missing ext.preferredId");if(e.preferredEncrypt&&typeof e.preferredEncrypt!=="boolean")throw new TypeError("invalid ext.preferredEncrypt");else if(!e.preferredEncrypt)e.preferredEncrypt=false;if(e.direction&&typeof e.direction!=="string")throw new TypeError("invalid ext.direction");else if(!e.direction)e.direction="sendrecv"}i.validateRtpHeaderExtension=p;function m(e){if(typeof e!=="object")throw new TypeError("params is not an object");if(e.mid&&typeof e.mid!=="string")throw new TypeError("params.mid is not a string");if(!Array.isArray(e.codecs))throw new TypeError("missing params.codecs");for(const t of e.codecs){v(t)}if(e.headerExtensions&&!Array.isArray(e.headerExtensions))throw new TypeError("params.headerExtensions is not an array");else if(!e.headerExtensions)e.headerExtensions=[];for(const i of e.headerExtensions){g(i)}if(e.encodings&&!Array.isArray(e.encodings))throw new TypeError("params.encodings is not an array");else if(!e.encodings)e.encodings=[];for(const r of e.encodings){y(r)}if(e.rtcp&&typeof e.rtcp!=="object")throw new TypeError("params.rtcp is not an object");else if(!e.rtcp)e.rtcp={};_(e.rtcp)}i.validateRtpParameters=m;function v(t){const e=new RegExp("^(audio|video)/(.+)","i");if(typeof t!=="object")throw new TypeError("codec is not an object");if(!t.mimeType||typeof t.mimeType!=="string")throw new TypeError("missing codec.mimeType");const i=e.exec(t.mimeType);if(!i)throw new TypeError("invalid codec.mimeType");if(typeof t.payloadType!=="number")throw new TypeError("missing codec.payloadType");if(typeof t.clockRate!=="number")throw new TypeError("missing codec.clockRate");const r=i[1].toLowerCase();if(r==="audio"){if(typeof t.channels!=="number")t.channels=1}else{delete t.channels}if(!t.parameters||typeof t.parameters!=="object")t.parameters={};for(const n of Object.keys(t.parameters)){let e=t.parameters[n];if(e===undefined){t.parameters[n]="";e=""}if(typeof e!=="string"&&typeof e!=="number"){throw new TypeError(`invalid codec parameter [key:${n}s, value:${e}]`)}if(n==="apt"){if(typeof e!=="number")throw new TypeError("invalid codec apt parameter")}}if(!t.rtcpFeedback||!Array.isArray(t.rtcpFeedback))t.rtcpFeedback=[];for(const s of t.rtcpFeedback){f(s)}}i.validateRtpCodecParameters=v;function g(t){if(typeof t!=="object")throw new TypeError("ext is not an object");if(!t.uri||typeof t.uri!=="string")throw new TypeError("missing ext.uri");if(typeof t.id!=="number")throw new TypeError("missing ext.id");if(t.encrypt&&typeof t.encrypt!=="boolean")throw new TypeError("invalid ext.encrypt");else if(!t.encrypt)t.encrypt=false;if(!t.parameters||typeof t.parameters!=="object")t.parameters={};for(const i of Object.keys(t.parameters)){let e=t.parameters[i];if(e===undefined){t.parameters[i]="";e=""}if(typeof e!=="string"&&typeof e!=="number")throw new TypeError("invalid header extension parameter")}}i.validateRtpHeaderExtensionParameters=g;function y(e){if(typeof e!=="object")throw new TypeError("encoding is not an object");if(e.ssrc&&typeof e.ssrc!=="number")throw new TypeError("invalid encoding.ssrc");if(e.rid&&typeof e.rid!=="string")throw new TypeError("invalid encoding.rid");if(e.rtx&&typeof e.rtx!=="object"){throw new TypeError("invalid encoding.rtx")}else if(e.rtx){if(typeof e.rtx.ssrc!=="number")throw new TypeError("missing encoding.rtx.ssrc")}if(!e.dtx||typeof e.dtx!=="boolean")e.dtx=false;if(e.scalabilityMode&&typeof e.scalabilityMode!=="string")throw new TypeError("invalid encoding.scalabilityMode")}i.validateRtpEncodingParameters=y;function _(e){if(typeof e!=="object")throw new TypeError("rtcp is not an object");if(e.cname&&typeof e.cname!=="string")throw new TypeError("invalid rtcp.cname");if(!e.reducedSize||typeof e.reducedSize!=="boolean")e.reducedSize=true}i.validateRtcpParameters=_;function b(e){if(typeof e!=="object")throw new TypeError("caps is not an object");if(!e.numStreams||typeof e.numStreams!=="object")throw new TypeError("missing caps.numStreams");S(e.numStreams)}i.validateSctpCapabilities=b;function S(e){if(typeof e!=="object")throw new TypeError("numStreams is not an object");if(typeof e.OS!=="number")throw new TypeError("missing numStreams.OS");if(typeof e.MIS!=="number")throw new TypeError("missing numStreams.MIS")}i.validateNumSctpStreams=S;function w(e){if(typeof e!=="object")throw new TypeError("params is not an object");if(typeof e.port!=="number")throw new TypeError("missing params.port");if(typeof e.OS!=="number")throw new TypeError("missing params.OS");if(typeof e.MIS!=="number")throw new TypeError("missing params.MIS");if(typeof e.maxMessageSize!=="number")throw new TypeError("missing params.maxMessageSize")}i.validateSctpParameters=w;function k(e){if(typeof e!=="object")throw new TypeError("params is not an object");if(typeof e.streamId!=="number")throw new TypeError("missing params.streamId");let t=false;if(typeof e.ordered==="boolean")t=true;else e.ordered=true;if(e.maxPacketLifeTime&&typeof e.maxPacketLifeTime!=="number")throw new TypeError("invalid params.maxPacketLifeTime");if(e.maxRetransmits&&typeof e.maxRetransmits!=="number")throw new TypeError("invalid params.maxRetransmits");if(e.maxPacketLifeTime&&e.maxRetransmits)throw new TypeError("cannot provide both maxPacketLifeTime and maxRetransmits");if(t&&e.ordered&&(e.maxPacketLifeTime||e.maxRetransmits)){throw new TypeError("cannot be ordered with maxPacketLifeTime or maxRetransmits")}else if(!t&&(e.maxPacketLifeTime||e.maxRetransmits)){e.ordered=false}if(e.priority&&typeof e.priority!=="string")throw new TypeError("invalid params.priority");if(e.label&&typeof e.label!=="string")throw new TypeError("invalid params.label");if(e.protocol&&typeof e.protocol!=="string")throw new TypeError("invalid params.protocol")}i.validateSctpStreamParameters=k;function C(e,t){const i={codecs:[],headerExtensions:[]};for(const r of t.codecs||[]){if(L(r))continue;const n=(e.codecs||[]).find(e=>I(e,r,{strict:true,modify:true}));if(!n)continue;const s={mimeType:n.mimeType,kind:n.kind,clockRate:n.clockRate,channels:n.channels,localPayloadType:n.preferredPayloadType,localRtxPayloadType:undefined,remotePayloadType:r.preferredPayloadType,remoteRtxPayloadType:undefined,localParameters:n.parameters,remoteParameters:r.parameters,rtcpFeedback:j(n,r)};i.codecs.push(s)}for(const s of i.codecs){const a=e.codecs.find(e=>L(e)&&e.parameters.apt===s.localPayloadType);const o=t.codecs.find(e=>L(e)&&e.parameters.apt===s.remotePayloadType);if(a&&o){s.localRtxPayloadType=a.preferredPayloadType;s.remoteRtxPayloadType=o.preferredPayloadType}}for(const c of t.headerExtensions){const d=e.headerExtensions.find(e=>O(e,c));if(!d)continue;const l={kind:c.kind,uri:c.uri,sendId:d.preferredId,recvId:c.preferredId,encrypt:d.preferredEncrypt,direction:"sendrecv"};switch(c.direction){case"sendrecv":l.direction="sendrecv";break;case"recvonly":l.direction="sendonly";break;case"sendonly":l.direction="recvonly";break;case"inactive":l.direction="inactive";break}i.headerExtensions.push(l)}return i}i.getExtendedRtpCapabilities=C;function T(e){const t={codecs:[],headerExtensions:[]};for(const i of e.codecs){const r={mimeType:i.mimeType,kind:i.kind,preferredPayloadType:i.remotePayloadType,clockRate:i.clockRate,channels:i.channels,parameters:i.localParameters,rtcpFeedback:i.rtcpFeedback};t.codecs.push(r);if(!i.remoteRtxPayloadType)continue;const n={mimeType:`${i.kind}/rtx`,kind:i.kind,preferredPayloadType:i.remoteRtxPayloadType,clockRate:i.clockRate,parameters:{apt:i.remotePayloadType},rtcpFeedback:[]};t.codecs.push(n)}for(const s of e.headerExtensions){if(s.direction!=="sendrecv"&&s.direction!=="recvonly"){continue}const a={kind:s.kind,uri:s.uri,preferredId:s.recvId,preferredEncrypt:s.encrypt,direction:s.direction};t.headerExtensions.push(a)}return t}i.getRecvRtpCapabilities=T;function P(e,t){const i={mid:undefined,codecs:[],headerExtensions:[],encodings:[],rtcp:{}};for(const r of t.codecs){if(r.kind!==e)continue;const n={mimeType:r.mimeType,payloadType:r.localPayloadType,clockRate:r.clockRate,channels:r.channels,parameters:r.localParameters,rtcpFeedback:r.rtcpFeedback};i.codecs.push(n);if(r.localRtxPayloadType){const s={mimeType:`${r.kind}/rtx`,payloadType:r.localRtxPayloadType,clockRate:r.clockRate,parameters:{apt:r.localPayloadType},rtcpFeedback:[]};i.codecs.push(s)}}for(const a of t.headerExtensions){if(a.kind&&a.kind!==e||a.direction!=="sendrecv"&&a.direction!=="sendonly"){continue}const o={uri:a.uri,id:a.sendId,encrypt:a.encrypt,parameters:{}};i.headerExtensions.push(o)}return i}i.getSendingRtpParameters=P;function R(e,t){const i={mid:undefined,codecs:[],headerExtensions:[],encodings:[],rtcp:{}};for(const r of t.codecs){if(r.kind!==e)continue;const n={mimeType:r.mimeType,payloadType:r.localPayloadType,clockRate:r.clockRate,channels:r.channels,parameters:r.remoteParameters,rtcpFeedback:r.rtcpFeedback};i.codecs.push(n);if(r.localRtxPayloadType){const s={mimeType:`${r.kind}/rtx`,payloadType:r.localRtxPayloadType,clockRate:r.clockRate,parameters:{apt:r.localPayloadType},rtcpFeedback:[]};i.codecs.push(s)}}for(const a of t.headerExtensions){if(a.kind&&a.kind!==e||a.direction!=="sendrecv"&&a.direction!=="sendonly"){continue}const o={uri:a.uri,id:a.sendId,encrypt:a.encrypt,parameters:{}};i.headerExtensions.push(o)}if(i.headerExtensions.some(e=>e.uri==="http://www.ietf.org/id/draft-holmer-rmcat-transport-wide-cc-extensions-01")){for(const n of i.codecs){n.rtcpFeedback=(n.rtcpFeedback||[]).filter(e=>e.type!=="goog-remb")}}else if(i.headerExtensions.some(e=>e.uri==="http://www.webrtc.org/experiments/rtp-hdrext/abs-send-time")){for(const n of i.codecs){n.rtcpFeedback=(n.rtcpFeedback||[]).filter(e=>e.type!=="transport-cc")}}else{for(const n of i.codecs){n.rtcpFeedback=(n.rtcpFeedback||[]).filter(e=>e.type!=="transport-cc"&&e.type!=="goog-remb")}}return i}i.getSendingRemoteRtpParameters=R;function x(t,i){const r=[];if(!i){r.push(t[0]);if(L(t[1]))r.push(t[1])}else{for(let e=0;e<t.length;++e){if(I(t[e],i)){r.push(t[e]);if(L(t[e+1]))r.push(t[e+1]);break}}if(r.length===0)throw new TypeError("no matching codec found")}return r}i.reduceCodecs=x;function M(e){e=a.clone(e,{});m(e);const t={mid:o,codecs:[],headerExtensions:[],encodings:[{ssrc:c}],rtcp:{cname:"probator"}};t.codecs.push(e.codecs[0]);t.codecs[0].payloadType=d;t.headerExtensions=e.headerExtensions;return t}i.generateProbatorRtpParameters=M;function E(t,e){return e.codecs.some(e=>e.kind===t)}i.canSend=E;function D(e,t){m(e);if(e.codecs.length===0)return false;const i=e.codecs[0];return t.codecs.some(e=>e.remotePayloadType===i.payloadType)}i.canReceive=D;function L(e){if(!e)return false;return/.+\/rtx$/i.test(e.mimeType)}function I(t,i,{strict:e=false,modify:r=false}={}){const n=t.mimeType.toLowerCase();const s=i.mimeType.toLowerCase();if(n!==s)return false;if(t.clockRate!==i.clockRate)return false;if(t.channels!==i.channels)return false;switch(n){case"video/h264":{const a=t.parameters["packetization-mode"]||0;const o=i.parameters["packetization-mode"]||0;if(a!==o)return false;if(e){if(!l.isSameProfile(t.parameters,i.parameters))return false;let e;try{e=l.generateProfileLevelIdForAnswer(t.parameters,i.parameters)}catch(e){return false}if(r){if(e){t.parameters["profile-level-id"]=e;i.parameters["profile-level-id"]=e}else{delete t.parameters["profile-level-id"];delete i.parameters["profile-level-id"]}}}break}case"video/vp9":{if(e){const c=t.parameters["profile-id"]||0;const d=i.parameters["profile-id"]||0;if(c!==d)return false}break}}return true}function O(e,t){if(e.kind&&t.kind&&e.kind!==t.kind)return false;if(e.uri!==t.uri)return false;return true}function j(e,t){const i=[];for(const r of e.rtcpFeedback||[]){const n=(t.rtcpFeedback||[]).find(e=>e.type===r.type&&(e.parameter===r.parameter||!e.parameter&&!r.parameter));if(n)i.push(n)}return i}},{"./utils":41,"h264-profile-level-id":6}],39:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:true});i.parse=void 0;const r=new RegExp("^[LS]([1-9]\\d{0,1})T([1-9]\\d{0,1})");function n(e){const t=r.exec(e||"");if(t){return{spatialLayers:Number(t[1]),temporalLayers:Number(t[2])}}else{return{spatialLayers:1,temporalLayers:1}}}i.parse=n},{}],40:[function(e,t,i){"use strict";var r=this&&this.__createBinding||(Object.create?function(e,t,i,r){if(r===undefined)r=i;Object.defineProperty(e,r,{enumerable:true,get:function(){return t[i]}})}:function(e,t,i,r){if(r===undefined)r=i;e[r]=t[i]});var n=this&&this.__exportStar||function(e,t){for(var i in e)if(i!=="default"&&!t.hasOwnProperty(i))r(t,e,i)};Object.defineProperty(i,"__esModule",{value:true});n(e("./Device"),i);n(e("./Transport"),i);n(e("./Producer"),i);n(e("./Consumer"),i);n(e("./DataProducer"),i);n(e("./DataConsumer"),i);n(e("./RtpParameters"),i);n(e("./SctpParameters"),i);n(e("./handlers/HandlerInterface"),i);n(e("./errors"),i)},{"./Consumer":10,"./DataConsumer":11,"./DataProducer":12,"./Device":13,"./Producer":16,"./RtpParameters":17,"./SctpParameters":18,"./Transport":19,"./errors":20,"./handlers/HandlerInterface":27}],41:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:true});i.generateRandomNumber=i.clone=void 0;function r(e,t){if(typeof e==="undefined")return t;return JSON.parse(JSON.stringify(e))}i.clone=r;function n(){return Math.round(Math.random()*1e7)}i.generateRandomNumber=n},{}],42:[function(o,c,d){(function(t){d.formatArgs=i;d.save=r;d.load=n;d.useColors=e;d.storage=s();d.destroy=(()=>{let e=false;return()=>{if(!e){e=true;console.warn("Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`.")}}})();d.colors=["#0000CC","#0000FF","#0033CC","#0033FF","#0066CC","#0066FF","#0099CC","#0099FF","#00CC00","#00CC33","#00CC66","#00CC99","#00CCCC","#00CCFF","#3300CC","#3300FF","#3333CC","#3333FF","#3366CC","#3366FF","#3399CC","#3399FF","#33CC00","#33CC33","#33CC66","#33CC99","#33CCCC","#33CCFF","#6600CC","#6600FF","#6633CC","#6633FF","#66CC00","#66CC33","#9900CC","#9900FF","#9933CC","#9933FF","#99CC00","#99CC33","#CC0000","#CC0033","#CC0066","#CC0099","#CC00CC","#CC00FF","#CC3300","#CC3333","#CC3366","#CC3399","#CC33CC","#CC33FF","#CC6600","#CC6633","#CC9900","#CC9933","#CCCC00","#CCCC33","#FF0000","#FF0033","#FF0066","#FF0099","#FF00CC","#FF00FF","#FF3300","#FF3333","#FF3366","#FF3399","#FF33CC","#FF33FF","#FF6600","#FF6633","#FF9900","#FF9933","#FFCC00","#FFCC33"];function e(){if(typeof window!=="undefined"&&window.process&&(window.process.type==="renderer"||window.process.__nwjs)){return true}if(typeof navigator!=="undefined"&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/(edge|trident)\/(\d+)/)){return false}return typeof document!=="undefined"&&document.documentElement&&document.documentElement.style&&document.documentElement.style.WebkitAppearance||typeof window!=="undefined"&&window.console&&(window.console.firebug||window.console.exception&&window.console.table)||typeof navigator!=="undefined"&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/firefox\/(\d+)/)&&parseInt(RegExp.$1,10)>=31||typeof navigator!=="undefined"&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/applewebkit\/(\d+)/)}function i(e){e[0]=(this.useColors?"%c":"")+this.namespace+(this.useColors?" %c":" ")+e[0]+(this.useColors?"%c ":" ")+"+"+c.exports.humanize(this.diff);if(!this.useColors){return}const t="color: "+this.color;e.splice(1,0,t,"color: inherit");let i=0;let r=0;e[0].replace(/%[a-zA-Z%]/g,e=>{if(e==="%%"){return}i++;if(e==="%c"){r=i}});e.splice(r,0,t)}d.log=console.debug||console.log||(()=>{});function r(e){try{if(e){d.storage.setItem("debug",e)}else{d.storage.removeItem("debug")}}catch(e){}}function n(){let e;try{e=d.storage.getItem("debug")}catch(e){}if(!e&&typeof t!=="undefined"&&"env"in t){e=t.env.DEBUG}return e}function s(){try{return localStorage}catch(e){}}c.exports=o("./common")(d);const{formatters:a}=c.exports;a.j=function(e){try{return JSON.stringify(e)}catch(e){return"[UnexpectedJSONParseError]: "+e.message}}}).call(this,o("_process"))},{"./common":43,_process:45}],43:[function(e,t,i){arguments[4][8][0].apply(i,arguments)},{dup:8,ms:44}],44:[function(e,t,i){arguments[4][9][0].apply(i,arguments)},{dup:9}],45:[function(e,t,i){var r=t.exports={};var n;var s;function a(){throw new Error("setTimeout has not been defined")}function o(){throw new Error("clearTimeout has not been defined")}(function(){try{if(typeof setTimeout==="function"){n=setTimeout}else{n=a}}catch(e){n=a}try{if(typeof clearTimeout==="function"){s=clearTimeout}else{s=o}}catch(e){s=o}})();function c(t){if(n===setTimeout){return setTimeout(t,0)}if((n===a||!n)&&setTimeout){n=setTimeout;return setTimeout(t,0)}try{return n(t,0)}catch(e){try{return n.call(null,t,0)}catch(e){return n.call(this,t,0)}}}function d(t){if(s===clearTimeout){return clearTimeout(t)}if((s===o||!s)&&clearTimeout){s=clearTimeout;return clearTimeout(t)}try{return s(t)}catch(e){try{return s.call(null,t)}catch(e){return s.call(this,t)}}}var l=[];var u=false;var h;var f=-1;function p(){if(!u||!h){return}u=false;if(h.length){l=h.concat(l)}else{f=-1}if(l.length){m()}}function m(){if(u){return}var e=c(p);u=true;var t=l.length;while(t){h=l;l=[];while(++f<t){if(h){h[f].run()}}f=-1;t=l.length}h=null;u=false;d(e)}r.nextTick=function(e){var t=new Array(arguments.length-1);if(arguments.length>1){for(var i=1;i<arguments.length;i++){t[i-1]=arguments[i]}}l.push(new v(e,t));if(l.length===1&&!u){c(m)}};function v(e,t){this.fun=e;this.array=t}v.prototype.run=function(){this.fun.apply(null,this.array)};r.title="browser";r.browser=true;r.env={};r.argv=[];r.version="";r.versions={};function g(){}r.on=g;r.addListener=g;r.once=g;r.off=g;r.removeListener=g;r.removeAllListeners=g;r.emit=g;r.prependListener=g;r.prependOnceListener=g;r.listeners=function(e){return[]};r.binding=function(e){throw new Error("process.binding is not supported")};r.cwd=function(){return"/"};r.chdir=function(e){throw new Error("process.chdir is not supported")};r.umask=function(){return 0}},{}],46:[function(e,t,i){const{EventEmitter:r}=e("events");const n=e("./Logger");class s extends r{constructor(e){super();this.setMaxListeners(Infinity);this._logger=e||new n("EnhancedEventEmitter")}safeEmit(t,...e){try{this.emit(t,...e)}catch(e){this._logger.error("safeEmit() | event listener threw an error [event:%s]:%o",t,e)}}async safeEmitAsPromise(i,...r){return new Promise((e,t)=>{this.safeEmit(i,...r,e,t)})}}t.exports=s},{"./Logger":47,events:5}],47:[function(e,t,i){const r=e("debug");const n="protoo-client";class s{constructor(e){if(e){this._debug=r(`${n}:${e}`);this._warn=r(`${n}:WARN:${e}`);this._error=r(`${n}:ERROR:${e}`)}else{this._debug=r(n);this._warn=r(`${n}:WARN`);this._error=r(`${n}:ERROR`)}this._debug.log=console.info.bind(console);this._warn.log=console.warn.bind(console);this._error.log=console.error.bind(console)}get debug(){return this._debug}get warn(){return this._warn}get error(){return this._error}}t.exports=s},{debug:53}],48:[function(e,t,i){const r=e("./Logger");const{generateRandomNumber:n}=e("./utils");const s=new r("Message");class a{static parse(e){let t;const i={};try{t=JSON.parse(e)}catch(e){s.error("parse() | invalid JSON: %s",e);return}if(typeof t!=="object"||Array.isArray(t)){s.error("parse() | not an object");return}if(t.request){i.request=true;if(typeof t.method!=="string"){s.error("parse() | missing/invalid method field");return}if(typeof t.id!=="number"){s.error("parse() | missing/invalid id field");return}i.id=t.id;i.method=t.method;i.data=t.data||{}}else if(t.response){i.response=true;if(typeof t.id!=="number"){s.error("parse() | missing/invalid id field");return}i.id=t.id;if(t.ok){i.ok=true;i.data=t.data||{}}else{i.ok=false;i.errorCode=t.errorCode;i.errorReason=t.errorReason}}else if(t.notification){i.notification=true;if(typeof t.method!=="string"){s.error("parse() | missing/invalid method field");return}i.method=t.method;i.data=t.data||{}}else{s.error("parse() | missing request/response field");return}return i}static createRequest(e,t){const i={request:true,id:n(),method:e,data:t||{}};return i}static createSuccessResponse(e,t){const i={response:true,id:e.id,ok:true,data:t||{}};return i}static createErrorResponse(e,t,i){const r={response:true,id:e.id,ok:false,errorCode:t,errorReason:i};return r}static createNotification(e,t){const i={notification:true,method:e,data:t||{}};return i}}t.exports=a},{"./Logger":47,"./utils":52}],49:[function(e,t,i){const r=e("./Logger");const n=e("./EnhancedEventEmitter");const s=e("./Message");const a=new r("Peer");class o extends n{constructor(e){super(a);a.debug("constructor()");this._closed=false;this._transport=e;this._connected=false;this._data={};this._sents=new Map;this._handleTransport()}get closed(){return this._closed}get connected(){return this._connected}get data(){return this._data}set data(e){throw new Error("cannot override data object")}close(){if(this._closed)return;a.debug("close()");this._closed=true;this._connected=false;this._transport.close();for(const e of this._sents.values()){e.close()}this.safeEmit("close")}async request(e,t=undefined){const n=s.createRequest(e,t);this._logger.debug("request() [method:%s, id:%s]",e,n.id);await this._transport.send(n);return new Promise((t,i)=>{const e=1500*(15+.1*this._sents.size);const r={id:n.id,method:n.method,resolve:e=>{if(!this._sents.delete(n.id))return;clearTimeout(r.timer);t(e)},reject:e=>{if(!this._sents.delete(n.id))return;clearTimeout(r.timer);i(e)},timer:setTimeout(()=>{if(!this._sents.delete(n.id))return;i(new Error("request timeout"))},e),close:()=>{clearTimeout(r.timer);i(new Error("peer closed"))}};this._sents.set(n.id,r)})}async notify(e,t=undefined){const i=s.createNotification(e,t);this._logger.debug("notify() [method:%s]",e);await this._transport.send(i)}_handleTransport(){if(this._transport.closed){this._closed=true;setTimeout(()=>{if(this._closed)return;this._connected=false;this.safeEmit("close")});return}this._transport.on("open",()=>{if(this._closed)return;a.debug('emit "open"');this._connected=true;this.safeEmit("open")});this._transport.on("disconnected",()=>{if(this._closed)return;a.debug('emit "disconnected"');this._connected=false;this.safeEmit("disconnected")});this._transport.on("failed",e=>{if(this._closed)return;a.debug('emit "failed" [currentAttempt:%s]',e);this._connected=false;this.safeEmit("failed",e)});this._transport.on("close",()=>{if(this._closed)return;this._closed=true;a.debug('emit "close"');this._connected=false;this.safeEmit("close")});this._transport.on("message",e=>{if(e.request)this._handleRequest(e);else if(e.response)this._handleResponse(e);else if(e.notification)this._handleNotification(e)})}_handleRequest(r){try{this.emit("request",r,e=>{const t=s.createSuccessResponse(r,e);this._transport.send(t).catch(()=>{})},(e,t)=>{if(e instanceof Error){t=e.message;e=500}else if(typeof e==="number"&&t instanceof Error){t=t.message}const i=s.createErrorResponse(r,e,t);this._transport.send(i).catch(()=>{})})}catch(e){const t=s.createErrorResponse(r,500,String(e));this._transport.send(t).catch(()=>{})}}_handleResponse(e){const t=this._sents.get(e.id);if(!t){a.error("received response does not match any sent request [id:%s]",e.id);return}if(e.ok){t.resolve(e.data)}else{const i=new Error(e.errorReason);i.code=e.errorCode;t.reject(i)}}_handleNotification(e){this.safeEmit("notification",e)}}t.exports=o},{"./EnhancedEventEmitter":46,"./Logger":47,"./Message":48}],50:[function(e,t,i){const{version:r}=e("../package.json");const n=e("./Peer");const s=e("./transports/WebSocketTransport");i.version=r;i.Peer=n;i.WebSocketTransport=s},{"../package.json":56,"./Peer":49,"./transports/WebSocketTransport":51}],51:[function(e,t,i){const n=e("websocket").w3cwebsocket;const s=e("retry");const r=e("../Logger");const a=e("../EnhancedEventEmitter");const o=e("../Message");const c="protoo";const d={retries:10,factor:2,minTimeout:1*1e3,maxTimeout:8*1e3};const l=new r("WebSocketTransport");class u extends a{constructor(e,t){super(l);l.debug("constructor() [url:%s, options:%o]",e,t);this._closed=false;this._url=e;this._options=t||{};this._ws=null;this._runWebSocket()}get closed(){return this._closed}close(){if(this._closed)return;l.debug("close()");this._closed=true;this.safeEmit("close");try{this._ws.onopen=null;this._ws.onclose=null;this._ws.onerror=null;this._ws.onmessage=null;this._ws.close()}catch(e){l.error("close() | error closing the WebSocket: %o",e)}}async send(e){if(this._closed)throw new Error("transport closed");try{this._ws.send(JSON.stringify(e))}catch(e){l.warn("send() failed:%o",e);throw e}}_runWebSocket(){const i=s.operation(this._options.retry||d);let r=false;i.attempt(t=>{if(this._closed){i.stop();return}l.debug("_runWebSocket() [currentAttempt:%s]",t);this._ws=new n(this._url,c,this._options.origin,this._options.headers,this._options.requestOptions,this._options.clientConfig);this._ws.onopen=()=>{if(this._closed)return;r=true;this.safeEmit("open")};this._ws.onclose=e=>{if(this._closed)return;l.warn('WebSocket "close" event [wasClean:%s, code:%s, reason:"%s"]',e.wasClean,e.code,e.reason);if(e.code!==4e3){if(!r){this.safeEmit("failed",t);if(this._closed)return;if(i.retry(true))return}else{i.stop();this.safeEmit("disconnected");if(this._closed)return;this._runWebSocket();return}}this._closed=true;this.safeEmit("close")};this._ws.onerror=()=>{if(this._closed)return;l.error('WebSocket "error" event')};this._ws.onmessage=e=>{if(this._closed)return;const t=o.parse(e.data);if(!t)return;if(this.listenerCount("message")===0){l.error('no listeners for WebSocket "message" event, ignoring received message');return}this.safeEmit("message",t)}})}}t.exports=u},{"../EnhancedEventEmitter":46,"../Logger":47,"../Message":48,retry:60,websocket:68}],52:[function(e,t,i){i.generateRandomNumber=function(){return Math.round(Math.random()*1e7)}},{}],53:[function(o,c,d){(function(t){d.formatArgs=i;d.save=r;d.load=n;d.useColors=e;d.storage=s();d.destroy=(()=>{let e=false;return()=>{if(!e){e=true;console.warn("Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`.")}}})();d.colors=["#0000CC","#0000FF","#0033CC","#0033FF","#0066CC","#0066FF","#0099CC","#0099FF","#00CC00","#00CC33","#00CC66","#00CC99","#00CCCC","#00CCFF","#3300CC","#3300FF","#3333CC","#3333FF","#3366CC","#3366FF","#3399CC","#3399FF","#33CC00","#33CC33","#33CC66","#33CC99","#33CCCC","#33CCFF","#6600CC","#6600FF","#6633CC","#6633FF","#66CC00","#66CC33","#9900CC","#9900FF","#9933CC","#9933FF","#99CC00","#99CC33","#CC0000","#CC0033","#CC0066","#CC0099","#CC00CC","#CC00FF","#CC3300","#CC3333","#CC3366","#CC3399","#CC33CC","#CC33FF","#CC6600","#CC6633","#CC9900","#CC9933","#CCCC00","#CCCC33","#FF0000","#FF0033","#FF0066","#FF0099","#FF00CC","#FF00FF","#FF3300","#FF3333","#FF3366","#FF3399","#FF33CC","#FF33FF","#FF6600","#FF6633","#FF9900","#FF9933","#FFCC00","#FFCC33"];function e(){if(typeof window!=="undefined"&&window.process&&(window.process.type==="renderer"||window.process.__nwjs)){return true}if(typeof navigator!=="undefined"&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/(edge|trident)\/(\d+)/)){return false}return typeof document!=="undefined"&&document.documentElement&&document.documentElement.style&&document.documentElement.style.WebkitAppearance||typeof window!=="undefined"&&window.console&&(window.console.firebug||window.console.exception&&window.console.table)||typeof navigator!=="undefined"&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/firefox\/(\d+)/)&&parseInt(RegExp.$1,10)>=31||typeof navigator!=="undefined"&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/applewebkit\/(\d+)/)}function i(e){e[0]=(this.useColors?"%c":"")+this.namespace+(this.useColors?" %c":" ")+e[0]+(this.useColors?"%c ":" ")+"+"+c.exports.humanize(this.diff);if(!this.useColors){return}const t="color: "+this.color;e.splice(1,0,t,"color: inherit");let i=0;let r=0;e[0].replace(/%[a-zA-Z%]/g,e=>{if(e==="%%"){return}i++;if(e==="%c"){r=i}});e.splice(r,0,t)}d.log=console.debug||console.log||(()=>{});function r(e){try{if(e){d.storage.setItem("debug",e)}else{d.storage.removeItem("debug")}}catch(e){}}function n(){let e;try{e=d.storage.getItem("debug")}catch(e){}if(!e&&typeof t!=="undefined"&&"env"in t){e=t.env.DEBUG}return e}function s(){try{return localStorage}catch(e){}}c.exports=o("./common")(d);const{formatters:a}=c.exports;a.j=function(e){try{return JSON.stringify(e)}catch(e){return"[UnexpectedJSONParseError]: "+e.message}}}).call(this,o("_process"))},{"./common":54,_process:45}],54:[function(e,t,i){arguments[4][8][0].apply(i,arguments)},{dup:8,ms:55}],55:[function(e,t,i){arguments[4][9][0].apply(i,arguments)},{dup:9}],56:[function(e,t,i){t.exports={_from:"protoo-client@^4.0.5",_id:"protoo-client@4.0.6",_inBundle:false,_integrity:"sha512-ZqImkKHpeJhSlgvyI6QAfZNc/aXcCgmmocMx4S1w2lAaxXtckxxeDtcVNtkOISUWm/mbC+BrmYPXoGMkfhkKOQ==",_location:"/protoo-client",_phantomChildren:{},_requested:{type:"range",registry:true,raw:"protoo-client@^4.0.5",name:"protoo-client",escapedName:"protoo-client",rawSpec:"^4.0.5",saveSpec:null,fetchSpec:"^4.0.5"},_requiredBy:["#DEV:/"],_resolved:"https://registry.npmjs.org/protoo-client/-/protoo-client-4.0.6.tgz",_shasum:"02a89f997ee5a4f385dab7be938dda1a2c5158e4",_spec:"protoo-client@^4.0.5",_where:"D:\\Works\\Git\\Video\\Wasm\\tstWeb",author:{name:"Iñaki Baz Castillo",email:"ibc@aliax.net"},bugs:{url:"https://github.com/ibc/protoo/issues"},bundleDependencies:false,dependencies:{debug:"^4.3.1",events:"^3.2.0",retry:"^0.12.0",websocket:"^1.0.33"},deprecated:false,description:"protoo JavaScript client module",devDependencies:{eslint:"^5.16.0"},engines:{node:">=8.0.0"},homepage:"https://protoo.versatica.com",keywords:["nodejs","browser","websocket"],license:"MIT",main:"lib/index.js",name:"protoo-client",optionalDependencies:{websocket:"^1.0.33"},repository:{type:"git",url:"git+https://github.com/ibc/protoo.git"},scripts:{lint:"eslint -c .eslintrc.js lib"},version:"4.0.6"}},{}],57:[function(e,t,i){"use strict";var s=Object.prototype.hasOwnProperty,a;function o(e){try{return decodeURIComponent(e.replace(/\+/g," "))}catch(e){return null}}function c(e){try{return encodeURIComponent(e)}catch(e){return null}}function r(e){var t=/([^=?#&]+)=?([^&]*)/g,i={},r;while(r=t.exec(e)){var n=o(r[1]),s=o(r[2]);if(n===null||s===null||n in i)continue;i[n]=s}return i}function n(e,t){t=t||"";var i=[],r,n;if("string"!==typeof t)t="?";for(n in e){if(s.call(e,n)){r=e[n];if(!r&&(r===null||r===a||isNaN(r))){r=""}n=c(n);r=c(r);if(n===null||r===null)continue;i.push(n+"="+r)}}return i.length?t+i.join("&"):""}i.stringify=n;i.parse=r},{}],58:[function(e,t,i){"use strict";var r="0123456789",n="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz",s="!$%^&*()_+|~-=`{}[]:;<>?,./";function c(e){e||(e={});return{length:e.length||8,numeric:typeof e.numeric==="boolean"?e.numeric:true,letters:typeof e.letters==="boolean"?e.letters:true,special:typeof e.special==="boolean"?e.special:false,exclude:Array.isArray(e.exclude)?e.exclude:[]}}function d(e){var t="";if(e.numeric){t+=r}if(e.letters){t+=n}if(e.special){t+=s}for(var i=0;i<=e.exclude.length;i++){t=t.replace(e.exclude[i],"")}return t}t.exports=function e(t){t=c(t);var i,r,n="",s=t.length,a=t.exclude,o=d(t);for(i=1;i<=s;i++){n+=o.substring(r=Math.floor(Math.random()*o.length),r+1)}return n}},{}],59:[function(e,t,i){"use strict";t.exports=function e(t,i){i=i.split(":")[0];t=+t;if(!t)return false;switch(i){case"http":case"ws":return t!==80;case"https":case"wss":return t!==443;case"ftp":return t!==21;case"gopher":return t!==70;case"file":return false}return t!==0}},{}],60:[function(e,t,i){t.exports=e("./lib/retry")},{"./lib/retry":61}],61:[function(e,t,o){var i=e("./retry_operation");o.operation=function(e){var t=o.timeouts(e);return new i(t,{forever:e&&e.forever,unref:e&&e.unref,maxRetryTime:e&&e.maxRetryTime})};o.timeouts=function(e){if(e instanceof Array){return[].concat(e)}var t={retries:10,factor:2,minTimeout:1*1e3,maxTimeout:Infinity,randomize:false};for(var i in e){t[i]=e[i]}if(t.minTimeout>t.maxTimeout){throw new Error("minTimeout is greater than maxTimeout")}var r=[];for(var n=0;n<t.retries;n++){r.push(this.createTimeout(n,t))}if(e&&e.forever&&!r.length){r.push(this.createTimeout(n,t))}r.sort(function(e,t){return e-t});return r};o.createTimeout=function(e,t){var i=t.randomize?Math.random()+1:1;var r=Math.round(i*t.minTimeout*Math.pow(t.factor,e));r=Math.min(r,t.maxTimeout);return r};o.wrap=function(s,a,e){if(a instanceof Array){e=a;a=null}if(!e){e=[];for(var t in s){if(typeof s[t]==="function"){e.push(t)}}}for(var i=0;i<e.length;i++){var r=e[i];var n=s[r];s[r]=function e(t){var i=o.operation(a);var r=Array.prototype.slice.call(arguments,1);var n=r.pop();r.push(function(e){if(i.retry(e)){return}if(e){arguments[0]=i.mainError()}n.apply(this,arguments)});i.attempt(function(){t.apply(s,r)})}.bind(s,n);s[r].options=a}}},{"./retry_operation":62}],62:[function(e,t,i){function r(e,t){if(typeof t==="boolean"){t={forever:t}}this._originalTimeouts=JSON.parse(JSON.stringify(e));this._timeouts=e;this._options=t||{};this._maxRetryTime=t&&t.maxRetryTime||Infinity;this._fn=null;this._errors=[];this._attempts=1;this._operationTimeout=null;this._operationTimeoutCb=null;this._timeout=null;this._operationStart=null;if(this._options.forever){this._cachedTimeouts=this._timeouts.slice(0)}}t.exports=r;r.prototype.reset=function(){this._attempts=1;this._timeouts=this._originalTimeouts};r.prototype.stop=function(){if(this._timeout){clearTimeout(this._timeout)}this._timeouts=[];this._cachedTimeouts=null};r.prototype.retry=function(e){if(this._timeout){clearTimeout(this._timeout)}if(!e){return false}var t=(new Date).getTime();if(e&&t-this._operationStart>=this._maxRetryTime){this._errors.unshift(new Error("RetryOperation timeout occurred"));return false}this._errors.push(e);var i=this._timeouts.shift();if(i===undefined){if(this._cachedTimeouts){this._errors.splice(this._errors.length-1,this._errors.length);this._timeouts=this._cachedTimeouts.slice(0);i=this._timeouts.shift()}else{return false}}var r=this;var n=setTimeout(function(){r._attempts++;if(r._operationTimeoutCb){r._timeout=setTimeout(function(){r._operationTimeoutCb(r._attempts)},r._operationTimeout);if(r._options.unref){r._timeout.unref()}}r._fn(r._attempts)},i);if(this._options.unref){n.unref()}return true};r.prototype.attempt=function(e,t){this._fn=e;if(t){if(t.timeout){this._operationTimeout=t.timeout}if(t.cb){this._operationTimeoutCb=t.cb}}var i=this;if(this._operationTimeoutCb){this._timeout=setTimeout(function(){i._operationTimeoutCb()},i._operationTimeout)}this._operationStart=(new Date).getTime();this._fn(this._attempts)};r.prototype.try=function(e){console.log("Using RetryOperation.try() is deprecated");this.attempt(e)};r.prototype.start=function(e){console.log("Using RetryOperation.start() is deprecated");this.attempt(e)};r.prototype.start=r.prototype.try;r.prototype.errors=function(){return this._errors};r.prototype.attempts=function(){return this._attempts};r.prototype.mainError=function(){if(this._errors.length===0){return null}var e={};var t=null;var i=0;for(var r=0;r<this._errors.length;r++){var n=this._errors[r];var s=n.message;var a=(e[s]||0)+1;e[s]=a;if(a>=i){t=n;i=a}}return t}},{}],63:[function(e,t,i){var r=t.exports={v:[{name:"version",reg:/^(\d*)$/}],o:[{name:"origin",reg:/^(\S*) (\d*) (\d*) (\S*) IP(\d) (\S*)/,names:["username","sessionId","sessionVersion","netType","ipVer","address"],format:"%s %s %d %s IP%d %s"}],s:[{name:"name"}],i:[{name:"description"}],u:[{name:"uri"}],e:[{name:"email"}],p:[{name:"phone"}],z:[{name:"timezones"}],r:[{name:"repeats"}],t:[{name:"timing",reg:/^(\d*) (\d*)/,names:["start","stop"],format:"%d %d"}],c:[{name:"connection",reg:/^IN IP(\d) (\S*)/,names:["version","ip"],format:"IN IP%d %s"}],b:[{push:"bandwidth",reg:/^(TIAS|AS|CT|RR|RS):(\d*)/,names:["type","limit"],format:"%s:%s"}],m:[{reg:/^(\w*) (\d*) ([\w/]*)(?: (.*))?/,names:["type","port","protocol","payloads"],format:"%s %d %s %s"}],a:[{push:"rtp",reg:/^rtpmap:(\d*) ([\w\-.]*)(?:\s*\/(\d*)(?:\s*\/(\S*))?)?/,names:["payload","codec","rate","encoding"],format:function(e){return e.encoding?"rtpmap:%d %s/%s/%s":e.rate?"rtpmap:%d %s/%s":"rtpmap:%d %s"}},{push:"fmtp",reg:/^fmtp:(\d*) ([\S| ]*)/,names:["payload","config"],format:"fmtp:%d %s"},{name:"control",reg:/^control:(.*)/,format:"control:%s"},{name:"rtcp",reg:/^rtcp:(\d*)(?: (\S*) IP(\d) (\S*))?/,names:["port","netType","ipVer","address"],format:function(e){return e.address!=null?"rtcp:%d %s IP%d %s":"rtcp:%d"}},{push:"rtcpFbTrrInt",reg:/^rtcp-fb:(\*|\d*) trr-int (\d*)/,names:["payload","value"],format:"rtcp-fb:%s trr-int %d"},{push:"rtcpFb",reg:/^rtcp-fb:(\*|\d*) ([\w-_]*)(?: ([\w-_]*))?/,names:["payload","type","subtype"],format:function(e){return e.subtype!=null?"rtcp-fb:%s %s %s":"rtcp-fb:%s %s"}},{push:"ext",reg:/^extmap:(\d+)(?:\/(\w+))?(?: (urn:ietf:params:rtp-hdrext:encrypt))? (\S*)(?: (\S*))?/,names:["value","direction","encrypt-uri","uri","config"],format:function(e){return"extmap:%d"+(e.direction?"/%s":"%v")+(e["encrypt-uri"]?" %s":"%v")+" %s"+(e.config?" %s":"")}},{name:"extmapAllowMixed",reg:/^(extmap-allow-mixed)/},{push:"crypto",reg:/^crypto:(\d*) ([\w_]*) (\S*)(?: (\S*))?/,names:["id","suite","config","sessionConfig"],format:function(e){return e.sessionConfig!=null?"crypto:%d %s %s %s":"crypto:%d %s %s"}},{name:"setup",reg:/^setup:(\w*)/,format:"setup:%s"},{name:"connectionType",reg:/^connection:(new|existing)/,format:"connection:%s"},{name:"mid",reg:/^mid:([^\s]*)/,format:"mid:%s"},{name:"msid",reg:/^msid:(.*)/,format:"msid:%s"},{name:"ptime",reg:/^ptime:(\d*(?:\.\d*)*)/,format:"ptime:%d"},{name:"maxptime",reg:/^maxptime:(\d*(?:\.\d*)*)/,format:"maxptime:%d"},{name:"direction",reg:/^(sendrecv|recvonly|sendonly|inactive)/},{name:"icelite",reg:/^(ice-lite)/},{name:"iceUfrag",reg:/^ice-ufrag:(\S*)/,format:"ice-ufrag:%s"},{name:"icePwd",reg:/^ice-pwd:(\S*)/,format:"ice-pwd:%s"},{name:"fingerprint",reg:/^fingerprint:(\S*) (\S*)/,names:["type","hash"],format:"fingerprint:%s %s"},{push:"candidates",reg:/^candidate:(\S*) (\d*) (\S*) (\d*) (\S*) (\d*) typ (\S*)(?: raddr (\S*) rport (\d*))?(?: tcptype (\S*))?(?: generation (\d*))?(?: network-id (\d*))?(?: network-cost (\d*))?/,names:["foundation","component","transport","priority","ip","port","type","raddr","rport","tcptype","generation","network-id","network-cost"],format:function(e){var t="candidate:%s %d %s %d %s %d typ %s";t+=e.raddr!=null?" raddr %s rport %d":"%v%v";t+=e.tcptype!=null?" tcptype %s":"%v";if(e.generation!=null){t+=" generation %d"}t+=e["network-id"]!=null?" network-id %d":"%v";t+=e["network-cost"]!=null?" network-cost %d":"%v";return t}},{name:"endOfCandidates",reg:/^(end-of-candidates)/},{name:"remoteCandidates",reg:/^remote-candidates:(.*)/,format:"remote-candidates:%s"},{name:"iceOptions",reg:/^ice-options:(\S*)/,format:"ice-options:%s"},{push:"ssrcs",reg:/^ssrc:(\d*) ([\w_-]*)(?::(.*))?/,names:["id","attribute","value"],format:function(e){var t="ssrc:%d";if(e.attribute!=null){t+=" %s";if(e.value!=null){t+=":%s"}}return t}},{push:"ssrcGroups",reg:/^ssrc-group:([\x21\x23\x24\x25\x26\x27\x2A\x2B\x2D\x2E\w]*) (.*)/,names:["semantics","ssrcs"],format:"ssrc-group:%s %s"},{name:"msidSemantic",reg:/^msid-semantic:\s?(\w*) (\S*)/,names:["semantic","token"],format:"msid-semantic: %s %s"},{push:"groups",reg:/^group:(\w*) (.*)/,names:["type","mids"],format:"group:%s %s"},{name:"rtcpMux",reg:/^(rtcp-mux)/},{name:"rtcpRsize",reg:/^(rtcp-rsize)/},{name:"sctpmap",reg:/^sctpmap:([\w_/]*) (\S*)(?: (\S*))?/,names:["sctpmapNumber","app","maxMessageSize"],format:function(e){return e.maxMessageSize!=null?"sctpmap:%s %s %s":"sctpmap:%s %s"}},{name:"xGoogleFlag",reg:/^x-google-flag:([^\s]*)/,format:"x-google-flag:%s"},{push:"rids",reg:/^rid:([\d\w]+) (\w+)(?: ([\S| ]*))?/,names:["id","direction","params"],format:function(e){return e.params?"rid:%s %s %s":"rid:%s %s"}},{push:"imageattrs",reg:new RegExp("^imageattr:(\\d+|\\*)"+"[\\s\\t]+(send|recv)[\\s\\t]+(\\*|\\[\\S+\\](?:[\\s\\t]+\\[\\S+\\])*)"+"(?:[\\s\\t]+(recv|send)[\\s\\t]+(\\*|\\[\\S+\\](?:[\\s\\t]+\\[\\S+\\])*))?"),names:["pt","dir1","attrs1","dir2","attrs2"],format:function(e){return"imageattr:%s %s %s"+(e.dir2?" %s %s":"")}},{name:"simulcast",reg:new RegExp("^simulcast:"+"(send|recv) ([a-zA-Z0-9\\-_~;,]+)"+"(?:\\s?(send|recv) ([a-zA-Z0-9\\-_~;,]+))?"+"$"),names:["dir1","list1","dir2","list2"],format:function(e){return"simulcast:%s %s"+(e.dir2?" %s %s":"")}},{name:"simulcast_03",reg:/^simulcast:[\s\t]+([\S+\s\t]+)$/,names:["value"],format:"simulcast: %s"},{name:"framerate",reg:/^framerate:(\d+(?:$|\.\d+))/,format:"framerate:%s"},{name:"sourceFilter",reg:/^source-filter: *(excl|incl) (\S*) (IP4|IP6|\*) (\S*) (.*)/,names:["filterMode","netType","addressTypes","destAddress","srcList"],format:"source-filter: %s %s %s %s %s"},{name:"bundleOnly",reg:/^(bundle-only)/},{name:"label",reg:/^label:(.+)/,format:"label:%s"},{name:"sctpPort",reg:/^sctp-port:(\d+)$/,format:"sctp-port:%s"},{name:"maxMessageSize",reg:/^max-message-size:(\d+)$/,format:"max-message-size:%s"},{push:"tsRefClocks",reg:/^ts-refclk:([^\s=]*)(?:=(\S*))?/,names:["clksrc","clksrcExt"],format:function(e){return"ts-refclk:%s"+(e.clksrcExt!=null?"=%s":"")}},{name:"mediaClk",reg:/^mediaclk:(?:id=(\S*))? *([^\s=]*)(?:=(\S*))?(?: *rate=(\d+)\/(\d+))?/,names:["id","mediaClockName","mediaClockValue","rateNumerator","rateDenominator"],format:function(e){var t="mediaclk:";t+=e.id!=null?"id=%s %s":"%v%s";t+=e.mediaClockValue!=null?"=%s":"";t+=e.rateNumerator!=null?" rate=%s":"";t+=e.rateDenominator!=null?"/%s":"";return t}},{name:"keywords",reg:/^keywds:(.+)$/,format:"keywds:%s"},{name:"content",reg:/^content:(.+)/,format:"content:%s"},{name:"bfcpFloorCtrl",reg:/^floorctrl:(c-only|s-only|c-s)/,format:"floorctrl:%s"},{name:"bfcpConfId",reg:/^confid:(\d+)/,format:"confid:%s"},{name:"bfcpUserId",reg:/^userid:(\d+)/,format:"userid:%s"},{name:"bfcpFloorId",reg:/^floorid:(.+) (?:m-stream|mstrm):(.+)/,names:["id","mStream"],format:"floorid:%s mstrm:%s"},{push:"invalid",names:["value"]}]};Object.keys(r).forEach(function(e){var t=r[e];t.forEach(function(e){if(!e.reg){e.reg=/(.*)/}if(!e.format){e.format="%s"}})})},{}],64:[function(e,t,i){var r=e("./parser");var n=e("./writer");i.write=n;i.parse=r.parse;i.parseParams=r.parseParams;i.parseFmtpConfig=r.parseFmtpConfig;i.parsePayloads=r.parsePayloads;i.parseRemoteCandidates=r.parseRemoteCandidates;i.parseImageAttributes=r.parseImageAttributes;i.parseSimulcastStreamList=r.parseSimulcastStreamList},{"./parser":65,"./writer":66}],65:[function(e,t,i){var s=function(e){return String(Number(e))===e?Number(e):e};var a=function(e,t,i,r){if(r&&!i){t[r]=s(e[1])}else{for(var n=0;n<i.length;n+=1){if(e[n+1]!=null){t[i[n]]=s(e[n+1])}}}};var o=function(e,t,i){var r=e.name&&e.names;if(e.push&&!t[e.push]){t[e.push]=[]}else if(r&&!t[e.name]){t[e.name]={}}var n=e.push?{}:r?t[e.name]:t;a(i.match(e.reg),n,e.names,e.name);if(e.push){t[e.push].push(n)}};var c=e("./grammar");var r=RegExp.prototype.test.bind(/^([a-z])=(.*)/);i.parse=function(e){var t={},s=[],a=t;e.split(/(\r\n|\r|\n)/).filter(r).forEach(function(e){var t=e[0];var i=e.slice(2);if(t==="m"){s.push({rtp:[],fmtp:[]});a=s[s.length-1]}for(var r=0;r<(c[t]||[]).length;r+=1){var n=c[t][r];if(n.reg.test(i)){return o(n,a,i)}}});t.media=s;return t};var n=function(e,t){var i=t.split(/=(.+)/,2);if(i.length===2){e[i[0]]=s(i[1])}else if(i.length===1&&t.length>1){e[i[0]]=undefined}return e};i.parseParams=function(e){return e.split(/;\s?/).reduce(n,{})};i.parseFmtpConfig=i.parseParams;i.parsePayloads=function(e){return e.toString().split(" ").map(Number)};i.parseRemoteCandidates=function(e){var t=[];var i=e.split(" ").map(s);for(var r=0;r<i.length;r+=3){t.push({component:i[r],ip:i[r+1],port:i[r+2]})}return t};i.parseImageAttributes=function(e){return e.split(" ").map(function(e){return e.substring(1,e.length-1).split(",").reduce(n,{})})};i.parseSimulcastStreamList=function(e){return e.split(";").map(function(e){return e.split(",").map(function(e){var t,i=false;if(e[0]!=="~"){t=s(e)}else{t=s(e.substring(1,e.length));i=true}return{scid:t,paused:i}})})}},{"./grammar":63}],66:[function(e,t,i){var s=e("./grammar");var a=/%[sdv%]/g;var o=function(e){var i=1;var r=arguments;var n=r.length;return e.replace(a,function(e){if(i>=n){return e}var t=r[i];i+=1;switch(e){case"%%":return"%";case"%s":return String(t);case"%d":return Number(t);case"%v":return""}})};var c=function(e,t,i){var r=t.format instanceof Function?t.format(t.push?i:i[t.name]):t.format;var n=[e+"="+r];if(t.names){for(var s=0;s<t.names.length;s+=1){var a=t.names[s];if(t.name){n.push(i[t.name][a])}else{n.push(i[t.names[s]])}}}else{n.push(i[t.name])}return o.apply(null,n)};var d=["v","o","s","i","u","e","p","c","b","t","r","z","a"];var l=["i","c","b","a"];t.exports=function(e,t){t=t||{};if(e.version==null){e.version=0}if(e.name==null){e.name=" "}e.media.forEach(function(e){if(e.payloads==null){e.payloads=""}});var i=t.outerOrder||d;var r=t.innerOrder||l;var n=[];i.forEach(function(i){s[i].forEach(function(t){if(t.name in e&&e[t.name]!=null){n.push(c(i,t,e))}else if(t.push in e&&e[t.push]!=null){e[t.push].forEach(function(e){n.push(c(i,t,e))})}})});e.media.forEach(function(e){n.push(c("m",s.m[0],e));r.forEach(function(i){s[i].forEach(function(t){if(t.name in e&&e[t.name]!=null){n.push(c(i,t,e))}else if(t.push in e&&e[t.push]!=null){e[t.push].forEach(function(e){n.push(c(i,t,e))})}})})});return n.join("\r\n")+"\r\n"}},{"./grammar":63}],67:[function(n,d,e){(function(a){"use strict";var f=n("requires-port"),p=n("querystringify"),o=/^[A-Za-z][A-Za-z0-9+-.]*:[\\/]+/,s=/^([a-z][a-z0-9.+-]*:)?([\\/]{1,})?([\S\s]*)/i,e="[\\x09\\x0A\\x0B\\x0C\\x0D\\x20\\xA0\\u1680\\u180E\\u2000\\u2001\\u2002\\u2003\\u2004\\u2005\\u2006\\u2007\\u2008\\u2009\\u200A\\u202F\\u205F\\u3000\\u2028\\u2029\\uFEFF]",t=new RegExp("^"+e+"+");function m(e){return(e?e:"").toString().replace(t,"")}var v=[["#","hash"],["?","query"],function e(t){return t.replace("\\","/")},["/","pathname"],["@","auth",1],[NaN,"host",undefined,1,1],[/:(\d+)$/,"port",undefined,1],[NaN,"hostname",undefined,1,1]];var c={hash:1,query:1};function g(e){var t;if(typeof window!=="undefined")t=window;else if(typeof a!=="undefined")t=a;else if(typeof self!=="undefined")t=self;else t={};var i=t.location||{};e=e||i;var r={},n=typeof e,s;if("blob:"===e.protocol){r=new b(unescape(e.pathname),{})}else if("string"===n){r=new b(e,{});for(s in c)delete r[s]}else if("object"===n){for(s in e){if(s in c)continue;r[s]=e[s]}if(r.slashes===undefined){r.slashes=o.test(e.href)}}return r}function y(e){e=m(e);var t=s.exec(e),i=t[1]?t[1].toLowerCase():"",r=!!(t[2]&&t[2].length>=2),n=t[2]&&t[2].length===1?"/"+t[3]:t[3];return{protocol:i,slashes:r,rest:n}}function _(e,t){if(e==="")return t;var i=(t||"/").split("/").slice(0,-1).concat(e.split("/")),r=i.length,n=i[r-1],s=false,a=0;while(r--){if(i[r]==="."){i.splice(r,1)}else if(i[r]===".."){i.splice(r,1);a++}else if(a){if(r===0)s=true;i.splice(r,1);a--}}if(s)i.unshift("");if(n==="."||n==="..")i.push("");return i.join("/")}function b(e,t,i){e=m(e);if(!(this instanceof b)){return new b(e,t,i)}var r,n,s,a,o,c,d=v.slice(),l=typeof t,u=this,h=0;if("object"!==l&&"string"!==l){i=t;t=null}if(i&&"function"!==typeof i)i=p.parse;t=g(t);n=y(e||"");r=!n.protocol&&!n.slashes;u.slashes=n.slashes||r&&t.slashes;u.protocol=n.protocol||t.protocol||"";e=n.rest;if(!n.slashes)d[3]=[/(.*)/,"pathname"];for(;h<d.length;h++){a=d[h];if(typeof a==="function"){e=a(e);continue}s=a[0];c=a[1];if(s!==s){u[c]=e}else if("string"===typeof s){if(~(o=e.indexOf(s))){if("number"===typeof a[2]){u[c]=e.slice(0,o);e=e.slice(o+a[2])}else{u[c]=e.slice(o);e=e.slice(0,o)}}}else if(o=s.exec(e)){u[c]=o[1];e=e.slice(0,o.index)}u[c]=u[c]||(r&&a[3]?t[c]||"":"");if(a[4])u[c]=u[c].toLowerCase()}if(i)u.query=i(u.query);if(r&&t.slashes&&u.pathname.charAt(0)!=="/"&&(u.pathname!==""||t.pathname!=="")){u.pathname=_(u.pathname,t.pathname)}if(u.pathname.charAt(0)!=="/"&&u.hostname){u.pathname="/"+u.pathname}if(!f(u.port,u.protocol)){u.host=u.hostname;u.port=""}u.username=u.password="";if(u.auth){a=u.auth.split(":");u.username=a[0]||"";u.password=a[1]||""}u.origin=u.protocol&&u.host&&u.protocol!=="file:"?u.protocol+"//"+u.host:"null";u.href=u.toString()}function i(e,t,i){var r=this;switch(e){case"query":if("string"===typeof t&&t.length){t=(i||p.parse)(t)}r[e]=t;break;case"port":r[e]=t;if(!f(t,r.protocol)){r.host=r.hostname;r[e]=""}else if(t){r.host=r.hostname+":"+t}break;case"hostname":r[e]=t;if(r.port)t+=":"+r.port;r.host=t;break;case"host":r[e]=t;if(/:\d+$/.test(t)){t=t.split(":");r.port=t.pop();r.hostname=t.join(":")}else{r.hostname=t;r.port=""}break;case"protocol":r.protocol=t.toLowerCase();r.slashes=!i;break;case"pathname":case"hash":if(t){var n=e==="pathname"?"/":"#";r[e]=t.charAt(0)!==n?n+t:t}else{r[e]=t}break;default:r[e]=t}for(var s=0;s<v.length;s++){var a=v[s];if(a[4])r[a[1]]=r[a[1]].toLowerCase()}r.origin=r.protocol&&r.host&&r.protocol!=="file:"?r.protocol+"//"+r.host:"null";r.href=r.toString();return r}function r(e){if(!e||"function"!==typeof e)e=p.stringify;var t,i=this,r=i.protocol;if(r&&r.charAt(r.length-1)!==":")r+=":";var n=r+(i.slashes?"//":"");if(i.username){n+=i.username;if(i.password)n+=":"+i.password;n+="@"}n+=i.host+i.pathname;t="object"===typeof i.query?e(i.query):i.query;if(t)n+="?"!==t.charAt(0)?"?"+t:t;if(i.hash)n+=i.hash;return n}b.prototype={set:i,toString:r};b.extractProtocol=y;b.location=g;b.trimLeft=m;b.qs=p;d.exports=b}).call(this,typeof global!=="undefined"?global:typeof self!=="undefined"?self:typeof window!=="undefined"?window:{})},{querystringify:57,"requires-port":59}],68:[function(e,t,i){var r;if(typeof globalThis==="object"){r=globalThis}else{try{r=e("es5-ext/global")}catch(e){}finally{if(!r&&typeof window!=="undefined"){r=window}if(!r){throw new Error("Could not determine global this")}}}var n=r.WebSocket||r.MozWebSocket;var s=e("./version");function a(e,t){var i;if(t){i=new n(e,t)}else{i=new n(e)}return i}if(n){["CONNECTING","OPEN","CLOSING","CLOSED"].forEach(function(e){Object.defineProperty(a,e,{get:function(){return n[e]}})})}t.exports={w3cwebsocket:n?a:null,version:s}},{"./version":69,"es5-ext/global":4}],69:[function(e,t,i){t.exports=e("../package.json").version},{"../package.json":70}],70:[function(e,t,i){t.exports={_from:"websocket@^1.0.33",_id:"websocket@1.0.34",_inBundle:false,_integrity:"sha512-PRDso2sGwF6kM75QykIesBijKSVceR6jL2G8NGYyq2XrItNC2P5/qL5XeR056GhA+Ly7JMFvJb9I312mJfmqnQ==",_location:"/websocket",_phantomChildren:{},_requested:{type:"range",registry:true,raw:"websocket@^1.0.33",name:"websocket",escapedName:"websocket",rawSpec:"^1.0.33",saveSpec:null,fetchSpec:"^1.0.33"},_requiredBy:["/protoo-client"],_resolved:"https://registry.npmjs.org/websocket/-/websocket-1.0.34.tgz",_shasum:"2bdc2602c08bf2c82253b730655c0ef7dcab3111",_spec:"websocket@^1.0.33",_where:"D:\\Works\\Git\\Video\\Wasm\\tstWeb\\node_modules\\protoo-client",author:{name:"Brian McKelvey",email:"theturtle32@gmail.com",url:"https://github.com/theturtle32"},browser:"lib/browser.js",bugs:{url:"https://github.com/theturtle32/WebSocket-Node/issues"},bundleDependencies:false,config:{verbose:false},contributors:[{name:"Iñaki Baz Castillo",email:"ibc@aliax.net",url:"http://dev.sipdoc.net"}],dependencies:{bufferutil:"^4.0.1",debug:"^2.2.0","es5-ext":"^0.10.50","typedarray-to-buffer":"^3.1.5","utf-8-validate":"^5.0.2",yaeti:"^0.0.6"},deprecated:false,description:"Websocket Client & Server Library implementing the WebSocket protocol as specified in RFC 6455.",devDependencies:{"buffer-equal":"^1.0.0",gulp:"^4.0.2","gulp-jshint":"^2.0.4",jshint:"^2.0.0","jshint-stylish":"^2.2.1",tape:"^4.9.1"},directories:{lib:"./lib"},engines:{node:">=4.0.0"},homepage:"https://github.com/theturtle32/WebSocket-Node",keywords:["websocket","websockets","socket","networking","comet","push","RFC-6455","realtime","server","client"],license:"Apache-2.0",main:"index",name:"websocket",repository:{type:"git",url:"git+https://github.com/theturtle32/WebSocket-Node.git"},scripts:{gulp:"gulp",test:"tape test/unit/*.js"},version:"1.0.34"}},{}],71:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:true});var r=function(){function r(e,t){for(var i=0;i<t.length;i++){var r=t[i];r.enumerable=r.enumerable||false;r.configurable=true;if("value"in r)r.writable=true;Object.defineProperty(e,r.key,r)}}return function(e,t,i){if(t)r(e.prototype,t);if(i)r(e,i);return e}}();var n=e("./events");var u=p(n);var s=e("./utils/logger");var a=p(s);var o=e("./utils/g726conf");var c=p(o);var d=e("./UCMain");var h=p(d);var l=e("./utils/cvComm");var f=p(l);function p(e){return e&&e.__esModule?e:{default:e}}function m(e,t){if(!(e instanceof t)){throw new TypeError("Cannot call a class as a function")}}var v=function(){function l(){m(this,l)}r(l,null,[{key:"Init",value:function e(t){var i=arguments.length>1&&arguments[1]!==undefined?arguments[1]:4;var r=arguments.length>2&&arguments[2]!==undefined?arguments[2]:{};a.default.SetLevel(1);var n=new h.default;if(document.readyState!=="complete"&&document.readyState!=="loaded"){window.addEventListener("load",function(){n.Init(t,i,r)},false)}else{n.Init(t,i,r)}this.uc=n;return n}},{key:"StartRealTimeVideo",value:function e(t,i){var r=arguments.length>2&&arguments[2]!==undefined?arguments[2]:1;var n=arguments.length>3&&arguments[3]!==undefined?arguments[3]:true;var s=arguments.length>4&&arguments[4]!==undefined?arguments[4]:0;var a=arguments.length>5&&arguments[5]!==undefined?arguments[5]:{};var o=arguments.length>6&&arguments[6]!==undefined?arguments[6]:null;var c=arguments.length>7&&arguments[7]!==undefined?arguments[7]:0;return this.uc.StartRealTimeVideo(t,i,r,n,s,a,o,c)}},{key:"GovPlay",value:function e(t){var i=arguments.length>1&&arguments[1]!==undefined?arguments[1]:0;var r=arguments.length>2&&arguments[2]!==undefined?arguments[2]:{};var n=arguments.length>3&&arguments[3]!==undefined?arguments[3]:null;return this.uc.GovPlay(t,i,r,n)}},{key:"PlaybackVideo",value:function e(t,i,r){var n=arguments.length>3&&arguments[3]!==undefined?arguments[3]:0;var s=arguments.length>4&&arguments[4]!==undefined?arguments[4]:0;var a=arguments.length>5&&arguments[5]!==undefined?arguments[5]:0;var o=arguments.length>6&&arguments[6]!==undefined?arguments[6]:0;var c=arguments[7];var d=arguments[8];var l=arguments.length>9&&arguments[9]!==undefined?arguments[9]:0;var u=arguments.length>10&&arguments[10]!==undefined?arguments[10]:{};var h=arguments.length>11&&arguments[11]!==undefined?arguments[11]:null;var f=arguments.length>12&&arguments[12]!==undefined?arguments[12]:0;var p=arguments.length>13&&arguments[13]!==undefined?arguments[13]:0;return this.uc.PlaybackVideo(t,i,r,n,s,a,o,c,d,l,u,h,f,p)}},{key:"PlayBackVideoByPlayer",value:function e(t,i,r){return this.uc.PlayBackVideoByPlayer(t,i,r)}},{key:"Stop",value:function e(){var t=arguments.length>0&&arguments[0]!==undefined?arguments[0]:-1;return this.uc.Stop(t)}},{key:"StartSpeek",value:function e(t,i){var r=arguments.length>2&&arguments[2]!==undefined?arguments[2]:{};return this.uc.StartSpeek(t,i,r)}},{key:"StopSpeak",value:function e(){return this.uc.StopSpeak()}},{key:"IsPlaying",value:function e(){var t=arguments.length>0&&arguments[0]!==undefined?arguments[0]:0;return this.uc.IsPlaying(t)}},{key:"SetRotate",value:function e(t,i){return this.uc.SetRotate(t,i)}},{key:"SetMirrorInver",value:function e(t){return this.uc.SetMirrorInver(t)}},{key:"SetTimeoutMsec",value:function e(t,i){return this.uc.SetTimeoutMsec(t,i)}},{key:"CustomScreens",value:function e(t,i){return this.uc.CustomScreens(t,i)}},{key:"LayoutByScreens",value:function e(t){return this.uc.LayoutByScreens(t)}},{key:"Resize",value:function e(t,i){return this.uc.Resize(t,i)}},{key:"FullScreen",value:function e(){return this.uc.FullScreen()}},{key:"GetContainerSize",value:function e(){return this.uc.GetContainerSize()}},{key:"ZoomUC",value:function e(t){return this.uc.ZoomUC(t)}},{key:"UnZoomUC",value:function e(){return this.uc.UnZoomUC()}},{key:"SetOsdVisible",value:function e(t,i){return this.uc.SetOsdVisible(t,i)}},{key:"SetOsdColor",value:function e(t,i){return this.uc.SetOsdColor(t,i)}},{key:"SetOsdText",value:function e(t,i){return this.uc.SetOsdText(t,i)}},{key:"Capture",value:function e(t,i,r){var n=arguments.length>3&&arguments[3]!==undefined?arguments[3]:0;return this.uc.Capture(t,i,r,n)}},{key:"SetPriority",value:function e(t){var i=arguments.length>1&&arguments[1]!==undefined?arguments[1]:0;return this.uc.SetPriority(t,i)}},{key:"SetRealOrBack",value:function e(t){return this.uc.SetRealOrBack(t)}},{key:"SetBackDateTime",value:function e(t,i,r){var n=arguments.length>3&&arguments[3]!==undefined?arguments[3]:0;var s=arguments.length>4&&arguments[4]!==undefined?arguments[4]:0;var a=arguments.length>5&&arguments[5]!==undefined?arguments[5]:0;var o=arguments.length>6&&arguments[6]!==undefined?arguments[6]:0;var c=arguments.length>7&&arguments[7]!==undefined?arguments[7]:0;var d=arguments.length>8&&arguments[8]!==undefined?arguments[8]:{};var l=arguments.length>9&&arguments[9]!==undefined?arguments[9]:0;return this.uc.SetBackDateTime(t,i,r,n,s,a,o,c,d,l)}},{key:"Split1X1",value:function e(t,i){return this.uc.Split1X1(t,i)}},{key:"Split2",value:function e(t,i){return this.uc.Split2(t,i)}},{key:"Split2X2",value:function e(t,i){return this.uc.Split2X2(t,i)}},{key:"Split1P5",value:function e(t,i){return this.uc.Split1P5(t,i)}},{key:"Split1P7",value:function e(t,i){return this.uc.Split1P7(t,i)}},{key:"Split3X3",value:function e(t,i){return this.uc.Split3X3(t,i)}},{key:"Split1P9",value:function e(t,i){return this.uc.Split1P9(t,i)}},{key:"Split1P12",value:function e(t,i){return this.uc.Split1P12(t,i)}},{key:"Split4X4",value:function e(t,i){return this.uc.Split4X4(t,i)}},{key:"GetOperateUCVideo",value:function e(){return this.uc.GetOperateUCVideo()}},{key:"ContainsScreen",value:function e(t){return this.uc.ContainsScreen(t)}},{key:"ScreenNumToSplidIndex",value:function e(t){return this.uc.ScreenNumToSplidIndex(t)}},{key:"GetSelectedVideo",value:function e(){var t=arguments.length>0&&arguments[0]!==undefined?arguments[0]:0;var i=arguments.length>1&&arguments[1]!==undefined?arguments[1]:{};return this.uc.GetSelectedVideo(t,i)}},{key:"AVTransferControl",value:function e(t,i,r,n,s){var a=arguments.length>5&&arguments[5]!==undefined?arguments[5]:0;var o=arguments.length>6&&arguments[6]!==undefined?arguments[6]:{};return this.uc.AVTransferControl(t,i,r,n,s,a,o)}},{key:"PlaybackVideoControl",value:function e(t,i,r,n,s){var a=arguments.length>5&&arguments[5]!==undefined?arguments[5]:0;var o=arguments.length>6&&arguments[6]!==undefined?arguments[6]:{};return this.uc.PlaybackVideoControl(t,i,r,n,s,a,o)}},{key:"QueryVideoFileList",value:function e(t,i,r,n,s,a,o,c,d){var l=arguments.length>9&&arguments[9]!==undefined?arguments[9]:0;var u=arguments.length>10&&arguments[10]!==undefined?arguments[10]:{};var h=arguments.length>11&&arguments[11]!==undefined?arguments[11]:0;return this.uc.QueryVideoFileList(t,i,r,n,s,a,o,c,d,l,u,h)}},{key:"FtpVideoFileUpload",value:function e(t,i,r,n,s,a,o,c,d,l,u,h,f,p,m){var v=arguments.length>15&&arguments[15]!==undefined?arguments[15]:0;var g=arguments.length>16&&arguments[16]!==undefined?arguments[16]:{};return this.uc.FtpVideoFileUpload(t,i,r,n,s,a,o,c,d,l,u,h,f,p,m,v,g)}},{key:"FtpVideoFileUploadControl",value:function e(t,i,r){var n=arguments.length>3&&arguments[3]!==undefined?arguments[3]:0;var s=arguments.length>4&&arguments[4]!==undefined?arguments[4]:{};return this.uc.FtpVideoFileUploadControl(t,i,r,n,s)}},{key:"RotationControl",value:function e(t,i,r,n){var s=arguments.length>4&&arguments[4]!==undefined?arguments[4]:0;var a=arguments.length>5&&arguments[5]!==undefined?arguments[5]:{};return this.uc.RotationControl(t,i,r,n,s,a)}},{key:"FocusControl",value:function e(t,i,r){var n=arguments.length>3&&arguments[3]!==undefined?arguments[3]:0;var s=arguments.length>4&&arguments[4]!==undefined?arguments[4]:{};return this.uc.FocusControl(t,i,r,n,s)}},{key:"ApertureControl",value:function e(t,i,r){var n=arguments.length>3&&arguments[3]!==undefined?arguments[3]:0;var s=arguments.length>4&&arguments[4]!==undefined?arguments[4]:{};return this.uc.ApertureControl(t,i,r,n,s)}},{key:"WiperControl",value:function e(t,i,r){var n=arguments.length>3&&arguments[3]!==undefined?arguments[3]:0;var s=arguments.length>4&&arguments[4]!==undefined?arguments[4]:{};return this.uc.WiperControl(t,i,r,n,s)}},{key:"InfraredControl",value:function e(t,i,r){var n=arguments.length>3&&arguments[3]!==undefined?arguments[3]:0;var s=arguments.length>4&&arguments[4]!==undefined?arguments[4]:{};return this.uc.InfraredControl(t,i,r,n,s)}},{key:"TimesControl",value:function e(t,i,r){var n=arguments.length>3&&arguments[3]!==undefined?arguments[3]:0;var s=arguments.length>4&&arguments[4]!==undefined?arguments[4]:{};return this.uc.TimesControl(t,i,r,n,s)}},{key:"InitWasm",value:function e(t){if(l.wasmState==0){l.wasmState=1;f.default.loadJs(t.libffmpegUrl,function(){addOnPostRun(function(){try{l.WASM.FfmpegInit();if(t.govmd5!=""){l.WASM.FMp4SetUser(t.govmd5,t.govnum)}l.wasmState=2}catch(e){l.wasmState=0;console.error(e)}})})}}},{key:"JXFMp4",value:function e(t,i,r){var n=l.WasmId2Uc.v[t];if(n){var s=Module.HEAPU8.slice(i,i+r);if(n.player.GetFisrtMsg()){if(s.length!=5||s[0]!=119||s[1]!=119)return;var a=s[2].toString(16).length==1?"0"+s[2].toString(16):s[2].toString(16);var o=s[3].toString(16).length==1?"0"+s[3].toString(16):s[3].toString(16);var c=s[4].toString(16).length==1?"0"+s[4].toString(16):s[4].toString(16);var d="avc1."+a+o+c+",mp4a.40.2";n.trigger(u.default.BUFFER_RESET,{mimeType:d});return}else{n.trigger(u.default.BUFFER_APPENDING,{type:"video",data:s})}}return 1}},{key:"JXRGB",value:function e(t,i,r,n,s){var a=l.WasmId2Uc.v[t];if(a){if(i>0&&r>0&&n>0){var o=Module.HEAPU32[n/4];var c=Module.HEAPU8.subarray(o,o+s);a.trigger(u.default.JT1078_RGB_OUT,{width:i,height:r,imageBuffer:c})}}return 1}},{key:"JXPCM",value:function e(t,i,r){var n=l.WasmId2Uc.d[t];if(n){var s=Module.HEAPF32.slice(i/4,(i+r)/4);n.InputPcm(t,s,s.length)}}},{key:"JXEncodeAudio",value:function e(t,i,r){var n=l.WasmId2Uc.e[t];if(n){var s=Module.HEAPU8.subarray(i,i+r);n.InputEncodeAudio(t,s,s.length)}}},{key:"version",get:function e(){return"CvNetVideo1.3.0"}},{key:"logger",get:function e(){return a.default}},{key:"DefaultConfig",get:function e(){if(!l.defaultConfig){l.defaultConfig={media:null,videoWidth:352,videoHeight:288,libffmpegUrl:"https://lib.cvtsp.com/video/CVNetVideoJs/libffmpeg/1.32/libffmpeg.js",cssUrl:"https://lib.cvtsp.com/video/CVNetVideoJs/1.3.0/CVNetVideo.css",EncodeAudioWorkerUrl:"https://lib.cvtsp.com/video/CVNetVideoJs/1.3.0/EncodeAudioWorker.js",DecodeAudioWorkerUrl:"https://lib.cvtsp.com/video/CVNetVideoJs/1.3.0/DecodeAudioWorker.js",recordVideo:true,screenshot:true,yuntaiCtrl:true,networkSpeaking:true,timeoutWarningMsec:27e4,timeoutCloseMsec:3e5,events:{timeoutWarning:null,timeoutCanceled:null,timeoutClose:null,onCapture:null,onStop:null,onDevConnect:null,onDevDisconnect:null,onWsClose:null,onServerNotice:null,onEndByServer:null,onHlsPlay:null,onStartSpeek:null},callback:null,enableDbcZoom:true,playerMode:0,usingCluster:true,clusterHost:"127.0.0.1",clusterPort:17e3,remoteHost:"127.0.0.1",remotePortWs:18002,remotePortFmp4:18003,priority:0,forceKeyFrameOnDiscontinuity:true,pcmCacheSec:.2,maxPcmQueueCount:15,speekSendMode:0,showLoadingByPlay:true,showLoadDelayMs:1e3,seekMode:1,maxDelay:8,selectedEvent:null,captureType:0,captureQuality:null,smoothMode:false,govmd5:"",govnum:100}}return l.defaultConfig}},{key:"Events",get:function e(){return u.default}},{key:"Videos",get:function e(){return this.uc.Videos}},{key:"WasmId2Uc",get:function e(){if(!l.wasmId2Uc){l.wasmId2Uc={v:{},d:{},e:{}}}return l.wasmId2Uc}},{key:"WASM",get:function e(){if(!l.wasm){l.wasm={FfmpegInit:Module["cwrap"]("FfmpegInit","number"),CreateAVideoDecoder:Module["cwrap"]("CreateAVideoDecoder","number",["number","number"]),VideoDecoderDecode:Module["cwrap"]("VideoDecoderDecode","number",["number","array","number"]),VideoDecoderFlush:Module["cwrap"]("VideoDecoderFlush","number",["number"]),VideoDecoderClear:Module["cwrap"]("VideoDecoderClear","number",["number"]),CreateAAudioEncoder:Module["cwrap"]("CreateAAudioEncoder","number",["number","number","number","number","number","number","number","number","number"]),AudioEncoderEncode:Module["cwrap"]("AudioEncoderEncode","number",["number","array","number"]),AudioEncoderClear:Module["cwrap"]("AudioEncoderClear","number",["number"]),CreateAAudioDecoder:Module["cwrap"]("CreateAAudioDecoder","number",["number","number","number","number","number","number","number"]),AudioDecoderDecode:Module["cwrap"]("AudioDecoderDecode","number",["number","array","number"]),AudioDecoderFlush:Module["cwrap"]("AudioDecoderFlush","number",["number"]),AudioDecoderClear:Module["cwrap"]("AudioDecoderClear","number",["number"]),CreateAAacTranscoder:Module["cwrap"]("CreateAAacTranscoder","number",["number","number","number","number"]),AacTranscoderTrans:Module["cwrap"]("AacTranscoderTrans","number",["number","array","number"]),AacTranscoderFlush:Module["cwrap"]("AacTranscoderFlush","number",["number"]),AacTranscoderClear:Module["cwrap"]("AacTranscoderClear","number",["number","number","number","number","number"]),FMp4SetUser:Module["cwrap"]("FMp4SetUser","number",["string","number"]),CreateFMp4Muxer:Module["cwrap"]("CreateFMp4Muxer","number",["number"]),FMp4SetAudioInfo:Module["cwrap"]("FMp4SetAudioInfo","number",["number","number","number","number","number"]),FMp4Input1078Package:Module["cwrap"]("FMp4Input1078Package","number",["number","array","number"]),FMp4InputVideo:Module["cwrap"]("FMp4InputVideo","number",["number","array","number","number","number"]),FMp4InputAudio:Module["cwrap"]("FMp4InputAudio","number",["number","array","number","number","number"]),FMp4MuxClear:Module["cwrap"]("FMp4MuxClear","number",["number"]),JX_ADPCMA:26,JX_H264:98,JX_G711A:6,JX_G711U:7,JX_G726:8,JX_G726_16K:253,JX_G726_24K:254,JX_G726_40K:255,AAC:19,AV_PIX_FMT_RGB24:2,AV_PIX_FMT_ARGB:27,AV_PIX_FMT_RGBA:28}}return l.wasm}}]);return l}();v.wasmState=0;v.g726_conf=c.default.getDefault();i.default=v},{"./UCMain":74,"./events":77,"./utils/cvComm":98,"./utils/g726conf":99,"./utils/logger":100}],72:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:true});var r=function(){function r(e,t){for(var i=0;i<t.length;i++){var r=t[i];r.enumerable=r.enumerable||false;r.configurable=true;if("value"in r)r.writable=true;Object.defineProperty(e,r.key,r)}}return function(e,t,i){if(t)r(e.prototype,t);if(i)r(e,i);return e}}();var n=e("../helper/ByteHelper");var S=u(n);var s=e("../events");var a=u(s);var o=e("../utils/logger");var d=u(o);var c=e("../utils/cvComm");var l=u(c);function u(e){return e&&e.__esModule?e:{default:e}}function h(e,t){if(!(e instanceof t)){throw new TypeError("Cannot call a class as a function")}}var w=function(){function _(e){h(this,_);this.wfs=e;this.msg_serial_number=0;this.v2=true}r(_,[{key:"JT1078808Package7",value:function e(t,i,r,n){var s=arguments.length>4&&arguments[4]!==undefined?arguments[4]:null;var a=arguments.length>5&&arguments[5]!==undefined?arguments[5]:0;return this.JT1078808Package(t,i,r,n,s,a,7)}},{key:"JT1078808Package",value:function e(t,i,r,n){var s=arguments.length>4&&arguments[4]!==undefined?arguments[4]:null;var a=arguments.length>5&&arguments[5]!==undefined?arguments[5]:0;var o=arguments.length>6&&arguments[6]!==undefined?arguments[6]:8;var c=arguments.length>7&&arguments[7]!==undefined?arguments[7]:null;if(s==null){s=r}var d=0;if(i){d=i.GetLength()}var l=0;if(c){l=c.msg_serial_number;if(l>=255)c.msg_serial_number=0;else c.msg_serial_number+=1}else{l=this.msg_serial_number;if(l>=255)this.msg_serial_number=0;else this.msg_serial_number+=1}var u=new _.JTHeader(t,false,0,d,s,l);var h=0;var f;f=new Uint8Array(d+u.GetLength());u.GetBinaryData(f,h);h+=u.GetLength();if(d>0){i.GetBinaryData(f,h)}var p=new _.JT808Package(f,0,f.length);var m=new _.JTRTHead(false,a,0,r,n,o,0,0,0,0,p.length);h=0;var v=new Uint8Array(m.GetLength()+p.length);m.GetBinaryData(v,0);h+=m.GetLength();for(var g=0;g<p.length;g++){v[h++]=p[g]}return{binary:v,head:u}}},{key:"Send9101",value:function e(t,i){var r=arguments.length>2&&arguments[2]!==undefined?arguments[2]:0;var n=arguments.length>3&&arguments[3]!==undefined?arguments[3]:1;var s=arguments.length>4&&arguments[4]!==undefined?arguments[4]:0;var a=new _.JTRealVideoTransferRequest("",0,0,i,r,n);var o=this.JT1078808Package(37121,a,t,i,t,s);this.Send(o.binary)}},{key:"Send9102",value:function e(t,i,r,n,s){var a=new _.JTRealVideoTransferControl(t,i,r,n,s);var o=this.JT1078808Package(37122,a,t,i);this.Send(o.binary)}},{key:"Send9201",value:function e(t,i,r,n,s,a,o,c,d,l){var u=arguments.length>10&&arguments[10]!==undefined?arguments[10]:0;var h=new _.JTVideoPlaybackRequest("",0,0,i,r,n,s,a,o,c,d,l);var f=this.JT1078808Package(37377,h,t,i,t,u);this.Send(f.binary)}},{key:"Send9202",value:function e(t,i,r,n,s){var a=new _.JTVideoPlaybackControl(i,r,n,s);var o=this.JT1078808Package(37378,a,t,i);this.Send(o.binary)}},{key:"Send9205",value:function e(t,i,r,n,s,a,o,c,d,l,u){var h=new _.JTQueryVideoFileList(r,n,s,a,o,c,d,l);var f=this.JT1078808Package(37381,h,i,r,null,0,8,t);t.sendMessage(f.binary,u,4613,f.head.SerialNumber)}},{key:"Send9206",value:function e(t,i,r,n,s,a,o,c,d,l,u,h,f,p,m,v){var g=new _.JTVideoFileUpload(r,n,s,a,o,c,d,l,u,h,f,p,m);var y=this.JT1078808Package(37382,g,i,r,null,0,8,t);t.sendMessage(y.binary,v,4614)}},{key:"Send9207",value:function e(t,i,r,n){var s=new _.JTVideoFileUploadControl(r,n);var a=this.JT1078808Package(37383,s,t,i);this.Send(a.binary)}},{key:"Send9301",value:function e(t,i,r,n){var s=new _.JTRTPTZRotate(i,r,n);var a=this.JT1078808Package(37633,s,t,i);this.Send(a.binary)}},{key:"Send9302",value:function e(t,i,r){var n=new _.JTRPTZControl(i,r);var s=this.JT1078808Package(37634,n,t,i);this.Send(s.binary)}},{key:"Send9303",value:function e(t,i,r){var n=new _.JTRPTZControl(i,r);var s=this.JT1078808Package(37635,n,t,i);this.Send(s.binary)}},{key:"Send9304",value:function e(t,i,r){var n=new _.JTRPTZControl(i,r);var s=this.JT1078808Package(37636,n,t,i);this.Send(s.binary)}},{key:"Send9305",value:function e(t,i,r){var n=new _.JTRPTZControl(i,r);var s=this.JT1078808Package(37637,n,t,i);this.Send(s.binary)}},{key:"Send9306",value:function e(t,i,r){var n=new _.JTRPTZControl(i,r);var s=this.JT1078808Package(37638,n,t,i);this.Send(s.binary)}},{key:"Send8881",value:function e(t,i,r){var n=new _.JTPrioritySetExt(r);var s=this.JT1078808Package(34945,n,t,i);this.Send(s.binary)}},{key:"Send9101Webrtc",value:function e(t,i){var r=arguments.length>2&&arguments[2]!==undefined?arguments[2]:0;var n=arguments.length>3&&arguments[3]!==undefined?arguments[3]:1;this.Send9101_SpecialSim(this.GetWebrtcSim(t),t,i,r,n)}},{key:"Send9201Webrtc",value:function e(t,i,r,n,s,a,o,c,d,l){this.Send9201_SpecialSim(this.GetWebrtcSim(t),t,i,r,n,s,a,o,c,d,l)}},{key:"Send8801",value:function e(t,i,r){var n=new _.JT0x8886(5,r,null,null);var s=this.JT1078808Package(34950,n,t,i);this.Send(s.binary)}},{key:"SendHeartRtmp",value:function e(t,i,r,n){var s=new _.JT0x8886(6,null,r,n);var a=this.JT1078808Package(34950,s,t,i);this.Send(a.binary)}},{key:"Send9101Rtmp",value:function e(t,i){var r=arguments.length>2&&arguments[2]!==undefined?arguments[2]:0;var n=arguments.length>3&&arguments[3]!==undefined?arguments[3]:1;this.Send9101_SpecialSim(this.GetRtmpSim(t),t,i,r,n)}},{key:"Send9201Rtmp",value:function e(t,i,r,n,s,a,o,c,d,l){this.Send9201_SpecialSim(this.GetRtmpSim(t),t,i,r,n,s,a,o,c,d,l)}},{key:"Send9101_SpecialSim",value:function e(t,i,r){var n=arguments.length>3&&arguments[3]!==undefined?arguments[3]:0;var s=arguments.length>4&&arguments[4]!==undefined?arguments[4]:1;var a=new _.JTRealVideoTransferRequest("",0,0,r,n,s);var o=this.JT1078808Package7(37121,a,i,r,t);this.Send(o.binary)}},{key:"Send9201_SpecialSim",value:function e(t,i,r,n,s,a,o,c,d,l,u){var h=new _.JTVideoPlaybackRequest("",0,0,r,n,s,a,o,c,d,l,u);var f=this.JT1078808Package7(37377,h,i,r,t);this.Send(f.binary)}},{key:"SendAudio",value:function e(t,i,r,n,s,a){var o=new _.JTRTHead(1,s,n,t,i,3,0,a,0,0,r.length);var c=new Uint8Array(o.GetLength()+r.length);o.GetBinaryData(c,0);var d=o.GetLength();for(var l=0;l<r.length;l++){c[d++]=r[l]}this.Send(c)}},{key:"Send",value:function e(t){this.wfs.trigger(a.default.WEBSOCKET_DATA_UPLOADING,{data:t})}},{key:"GetRtmpSim",value:function e(t){var i="1234888888ec";if(i==t.toLowerCase()){return"1234888888eb"}return i}},{key:"GetWebrtcSim",value:function e(t){var i="1234888888ee";if(i==t.toLowerCase()){return"1234888888ed"}return i}}]);return _}();w.GetFirstSerialNumber=function(e){var t=void 0;if(e.PackInfo){t=e.SerialNumber-e.PackInfo.Index+1}else{t=e.SerialNumber}return t};w.GetMsbBody=function(e,t){var i=e.GetLength();return t.slice(i,i+e.MsgLen)};w.JTRTHead=function(r,n,s,a,o,c,d,l,u,h,f){this.V=2;this.P=false;this.X=false;this.CC=1;this.M=r;this.PT=n;this.SerialNumber=s;this.Sim=a;this.Channel=o;this.XXXX=c;this.YYYY=d;this.RTTimeSpan=l;this.LastIFrameInterval=u;this.LastFrameInterval=h;this.DLen=f;this.BinaryDataLen=0;this.FillByBinary=function(e,t,i){if(isNaN(t)){t=0}if(isNaN(i)){i=e.length}var r=t;if(e[r]===48&&e[r+1]===49&&e[r+2]===99&&e[r+3]===100){r+=4;this.V=e[r]>>6;this.P=(e[r]&32)===32;this.X=(e[r]&16)===16;this.CC=e[r]&15;r+=1;this.M=(e[r]&128)===128;this.PT=e[r]&127;r+=1;this.SerialNumber=S.default.Byte2ToUInt(e,r);r+=2;this.Sim=S.default.BcdToString(e,r,12);r+=6;this.Channel=e[r];r+=1;this.XXXX=e[r]>>4;this.YYYY=e[r]&15;r+=1;if(this.XXXX<4){this.RTTimeSpan=S.default.Byte8ToULong(e,r);r+=8}if(this.XXXX<3){this.LastIFrameInterval=S.default.Byte2ToUInt(e,r);r+=2;this.LastFrameInterval=S.default.Byte2ToUInt(e,r);r+=2}this.DLen=S.default.Byte2ToUInt(e,r);r+=2;this.BinaryDataLen=r-t}};this.GetBinaryData=function(e,t){var i=t;if(c>=4){S.default.UIntToByte2(e,i+16,f)}else if(c===3){S.default.ULongToByte8(e,i+16,l);S.default.UIntToByte2(e,i+24,f)}else{S.default.ULongToByte8(e,i+16,l);S.default.UIntToByte2(e,i+24,u);S.default.UIntToByte2(e,i+26,h);S.default.UIntToByte2(e,i+28,f)}e[i++]=48;e[i++]=49;e[i++]=99;e[i++]=100;e[i++]=129;if(r==1){e[i++]=n|128}else{e[i++]=n}S.default.UIntToByte2(e,i,s);i+=2;S.default.StringToBcd(e,i,a,12);i+=6;e[i++]=o;e[i++]=c<<4&240|d&15};this.GetLength=function(){if(c>=4){return 18}else if(c===3){return 26}else{return 30}}};w.JTHeader=function(r,n,s,a,o,c){this.MsgId=r;this.Sub=n;this.DataEncryptType=s;this.MsgLen=a;this.Sim=o;this.SerialNumber=c;this.Length=0;this.PackInfo=null;this.FillByBinary=function(e,t,i){var r=t;this.MsgId=S.default.Byte2ToUInt(e,r);this.Sub=(e[r+2]&32)===32;this.DataEncryptType=(e[r+2]&28)>>2;e[r+2]=e[r+2]&3;this.MsgLen=S.default.Byte2ToUInt(e,r+2);this.Sim=S.default.BcdToString(e,r+4,12);this.SerialNumber=S.default.Byte2ToUInt(e,r+10);if(this.Sub){this.PackInfo=new w.JTPackageInfo;this.PackInfo.Sum=S.default.Byte2ToUInt(e,t+12);this.PackInfo.Index=S.default.Byte2ToUInt(e,t+14)}};this.GetBinaryData=function(e,t){var i=t;S.default.UIntToByte2(e,i,r);i+=2;S.default.UIntToByte2(e,i,a);i+=2;e[t+2]=e[t+2]&63;if(!n){e[t+2]=e[t+2]&223}e[2]=e[2]|s<<2;S.default.StringToBcd(e,i,o,12);i+=6;S.default.UIntToByte2(e,i,c)};this.GetLength=function(){return this.Sub?16:12}};w.JTPackageInfo=function(e,t){this.Index=e;this.Sum=t};w.JTRealVideoTransferRequest=function(i,r,n,s,a,o){this.IPAddress=i;this.TcpPort=r;this.UdpPort=n;this.Channel=s;this.DataType=a;this.StreamType=o;this.Length=0;this.GetBinaryData=function(e,t){e[t]=S.default.StringToGBK(e,t+1,i);t=t+1+e[t];S.default.UIntToByte2(e,t,r);t+=2;S.default.UIntToByte2(e,t,n);t+=2;e[t++]=s;e[t++]=a;e[t++]=o};this.GetLength=function(){var e=i.length;return e+8}};w.JTRealVideoTransferControl=function(i,r,n,s){this.Channel=i;this.ControlCommand=r;this.SwitchStreamType=n;this.TurnOffMediaType=s;this.GetBinaryData=function(e,t){e[t]=i;t+=1;e[t]=r;t+=1;e[t]=s;t+=1;e[t]=n;t+=1};this.GetLength=function(){return 4}};w.JTVideoPlaybackRequest=function(n,s,a,o,c,d,l,u,h,f,p,m){this.IPAddress=n;this.TcpPort=s;this.UdpPort=a;this.Channel=o;this.MediaType=c;this.StreamType=d;this.StorageType=l;this.PlaybackMode=u;this.Multiple=h;this.StartTime=f;this.EndTime=p;this.DataSource=m;this.Length=0;this.GetBinaryData=function(e,t){e[t]=S.default.StringToGBK(e,t+1,n);t=t+1+e[t];S.default.UIntToByte2(e,t,s);t+=2;S.default.UIntToByte2(e,t,a);t+=2;e[t++]=o;e[t++]=c;e[t++]=d;e[t++]=l;e[t++]=u;e[t++]=h;var i=w.GetYYMMddHHmmssByDate(f);S.default.StringToBcd(e,t,i,12);t+=6;if(p===""){S.default.StringToBcd(e,t,"000000000000",12)}else{var r=w.GetYYMMddHHmmssByDate(p);S.default.StringToBcd(e,t,r,12)}t+=6;e[t++]=m};this.GetLength=function(){var e=n.length;return e+24}};w.JTVideoPlaybackControl=function(r,n,s,a){this.Channel=r;this.PlaybackControl=n;this.Multiple=s;this.DragPlaybackPosition=a;this.GetBinaryData=function(e,t){e[t]=r;t+=1;e[t]=n;t+=1;e[t]=s;t+=1;if(n===5){var i=w.GetYYMMddHHmmssByDate(a);S.default.StringToBcd(e,t,i,12);t+=6}};this.GetLength=function(){return 9}};w.JTQueryVideoFileList=function(a,o,c,d,l,u,h,f){this.Channel=a,this.StartTime=o,this.EndTime=c,this.Alarm=d,this.MediaType=l,this.StreamType=u,this.StorageType=h,this.DataSource=f;this.GetBinaryData=function(e,t){e[t]=a;t+=1;if(o===0){S.default.StringToBcd(e,t,"000000000000",12)}else{var i=w.UnixLongToDate(o);var r=w.GetYYMMddHHmmssByDate(i);S.default.StringToBcd(e,t,r,12)}t+=6;if(c===0){S.default.StringToBcd(e,t,"000000000000",12)}else{var n=w.UnixLongToDate(c);var s=w.GetYYMMddHHmmssByDate(n);S.default.StringToBcd(e,t,s,12)}t+=6;S.default.ULongToByte8(e,t,d);t+=8;e[t]=l;t+=1;e[t]=u;t+=1;e[t]=h;t+=1;e[t]=f;t+=1};this.GetLength=function(){return 25}};w.JTVideoFileUpload=function(c,d,l,u,h,f,p,m,v,g,y,_,b){this.Channel=c;this.FtpAddress=d;this.FtpPort=l;this.UserName=u;this.Password=h;this.FileUploadPath=f;this.StartTime=p;this.EndTime=m;this.Alarm=v;this.MediaType=g;this.StreamType=y;this.StorageType=_;this.TaskExecutionCondition=b;this.GetBinaryData=function(e,t){var i=S.default.StringToGBK(e,t+1,d);e[t]=i;t+=1;t+=i;S.default.UIntToByte2(e,t,l);t+=2;var r=S.default.StringToGBK(e,t+1,u);e[t]=r;t+=1;t+=r;var n=S.default.StringToGBK(e,t+1,h);e[t]=n;t+=1;t+=n;var s=S.default.StringToGBK(e,t+1,f);e[t]=s;t+=1;t+=s;e[t]=c;t+=1;var a=w.GetYYMMddHHmmssByDate(p);S.default.StringToBcd(e,t,a,12);t+=6;var o=w.GetYYMMddHHmmssByDate(m);S.default.StringToBcd(e,t,o,12);t+=6;S.default.ULongToByte8(e,t,v);t+=8;e[t]=g;t+=1;e[t]=y;t+=1;e[t]=_;t+=1;e[t]=b;t+=1};this.GetLength=function(){return 31+d.length+u.length+h.length+f.length}};w.JTVideoFileUploadControl=function(i,r){this.SerialNumber=i;this.UploadControl=r;this.GetBinaryData=function(e,t){S.default.UIntToByte2(e,t,i);t+=2;e[t]=r;t+=1};this.GetLength=function(){return 3}};w.JTRTPTZRotate=function(i,r,n){this.LogicalChannel=i;this.Direction=r;this.Speed=n;this.GetBinaryData=function(e,t){e[t]=i;t+=1;e[t]=r;t+=1;e[t]=n;t+=1};this.GetLength=function(){return 3}};w.JTRPTZControl=function(i,r){this.Channel=i;this.Flag=r;this.GetBinaryData=function(e,t){e[t]=i;t+=1;e[t]=r;t+=1};this.GetLength=function(){return 2}};w.JT808Package=function(e,t,i){var r=i+2;var n=t;var s=0;for(;n<i+t;n++){s=e[n]^s;if(e[n]===126){r++}if(e[n]===125){r++}}if(s===126){r+=2}else if(s===125){r+=2}else{r+=1}var a=new Uint8Array(r);var o=0;a[o++]=126;s=0;for(n=t;n<i+t;n++,o++){a[o]=e[n];s=e[n]^s;if(e[n]===126){e[n]=125;o++;a[o]=1}if(e[n]===125){o++;a[o]=2}}if(s===126){a[o++]=125;a[o++]=2}else if(s===125){a[o++]=125;a[o++]=1}else{a[o++]=s}a[o++]=126;return a};w.JTVideoListInfo=function(){this.SerialNumber;this.FileCount;this.FileList;this.FillByBinary=function(e,t,i){this.FileList=[];var r=t;this.SerialNumber=S.default.Byte2ToUInt(e,r);r+=2;this.FileCount=S.default.Byte4ToUInt(e,r);r+=4;if(this.FileCount>0&&e.length>=28*this.FileCount+r){for(var n=0;n<this.FileCount;n++){var s=new w.JTVideoFileListItem;s.FillByBinary(e,r);this.FileList.push(s);r+=28}}}};w.JTVideoFileListItem=function(){this.Channel;this.StartTime;this.EndTime;this.Alarm;this.MediaType;this.StreamType;this.StorageType;this.FileSize;this.FillByBinary=function(e,t){this.Channel=e[t];t+=1;this.StartTime=S.default.BcdToString(e,t,12);t+=6;this.EndTime=S.default.BcdToString(e,t,12);t+=6;this.Alarm=S.default.Byte8ToULong(e,t);t+=8;this.MediaType=e[t];t+=1;this.StreamType=e[t];t+=1;this.StorageType=e[t];t+=1;this.FileSize=S.default.Byte4ToUInt(e,t);t+=4}};w.JTVideoFileUploadEndInform=function(){this.SerialNumber;this.Result;this.FillByBinary=function(e,t){this.SerialNumber=S.default.Byte2ToUInt(e,t);t+=2;this.Result=e[t];t+=1}};w.MedisPackageAnalysis=function(){this.least_header_size=18;this.head=new w.JTRTHead;this.m_head_size=0;this.m_data_offset=0;this.m_data_size=0;this.AnalysisPackage=function(e,t,i){if(i<this.least_header_size)return 0;var r=t;if(e[r]==48&&e[r+1]==49&&e[r+2]==99&&e[r+3]==100){r+=5;this.head.PT=e[r]&127;r+=1;this.head.SerialNumber=S.default.Byte2ToUInt(e,r);r+=2;this.head.Sim=S.default.BcdToString(e,r,12);r+=6;this.head.Channel=e[r];r+=1;this.head.XXXX=e[r]>>4;this.head.YYYY=e[r]&15;r+=1;if(this.head.XXXX<4){if(i<26)return 0;this.head.RTTimeSpan=S.default.Byte8ToULong(e,r);r+=8}if(this.head.XXXX<3){if(i<30)return 0;r+=4}this.head.DLen=S.default.Byte2ToUInt(e,r);r+=2;if(i<r+this.head.DLen-t)return 0;this.m_head_size=r-t;this.m_data_offset=t;this.m_data_size=this.m_head_size+this.head.DLen;return this.m_data_size}else{return-1}}};w.SplitData=function(){var c=[];this.SplitDataBy7E=function(e,t,i,r){try{var n=0;var s=false;var a=false;var o=[];if(c!=[]&&(i>0&&e[t]!=126||i>1&&e[t]==126&&e[t+1]==126)){o=c;s=false;if(c.length>0)a=c[c.length-1]==125}else{o=[];s=true;a=false}while(n<i){if(e[t+n]==126){s=!s;if(s){try{r(o)}catch(e){d.default.error("SplitDataBy7E analyze exeception:"+e)}}else{while(i>n+1&&e[t+n+1]==126){n++}o=[]}}else if(a){if(e[t+n]==1)o[o.length-1]=125;else if(e[t+n]==2)o[o.length-1]=126;else{d.default.error("ErrorBinaryData7E");break}}else{o.push(e[t+n])}a=e[t+n]==125;n++}c=s?[]:o}catch(e){d.default.error("SplitDataBy7E exception:"+e)}}};w.CheckHelper=function(){this.CheckXOR=function(e,t,i){var r=0;for(var n=0;n<i;n++){r=(e[n+t]^r)&255}return r}};w.GetYYMMddHHmmssByDate=function(e){try{var t="";var i=w.ParseDate(e);var r=i.getFullYear()-2e3;t+=(r+"").length<2?"0"+r:r;var n=i.getMonth()+1;t+=(n+"").length<2?"0"+n:n;var s=i.getDate();t+=(s+"").length<2?"0"+s:s;var a=i.getHours();t+=(a+"").length<2?"0"+a:a;var o=i.getMinutes();t+=(o+"").length<2?"0"+o:o;var c=i.getSeconds();t+=(c+"").length<2?"0"+c:c;return t}catch(e){d.default.error("Datetime format must match:yyyy-mm-dd hh:mm:ss");return""}};w.ParseDate=function(e){var t=Date.parse(e);if(isNaN(t)){return new Date(Date.parse(e.replace(/-/g,"/")))}else{return new Date(t)}};w.DateToUnixLong=function(e){return Date.parse(w.ParseDate(e))/1e3};w.UnixLongToDate=function(e){return new Date(e*1e3)};w.JTPrioritySetExt=function(i){this.Priority=i;this.GetBinaryData=function(e,t){e[t]=i;t+=1};this.GetLength=function(){return 1}};w.ExtendRefuse=function(){this.DLen;this.Reason;this.FillByBinary=function(e,t,i){if(isNaN(t)){t=0}if(isNaN(i)){i=e.length}var r=t;this.DLen=S.default.Byte2ToUInt(e,r);r+=2;this.Reason=n(e,r,this.DLen)};function n(e,t,i){var r="",n=e;for(var s=t;s<i+t;s++){var a=n[s].toString(2),o=a.match(/^1+?(?=0)/);if(o&&a.length==8){var c=o[0].length;var d=n[s].toString(2).slice(7-c);for(var l=1;l<c;l++){d+=n[l+s].toString(2).slice(2)}r+=String.fromCharCode(parseInt(d,2));s+=c-1}else{r+=String.fromCharCode(n[s])}}return r}};w.JT0x8886=function(r,n,s,a){this.Type=r;this.WebrtcRoomid=n;this.RtmpURL=s;this.RtmpClientId=a;this.Length=0;this.GetBinaryData=function(e,t){e[t]=r;t+=1;if(r==5){var i=S.default.StringToGBK(e,t+2,n);S.default.UIntToByte2(e,t,i)}if(r==6){var i=S.default.StringToGBK(e,t+2,s);S.default.UIntToByte2(e,t,i);t=t+2+i;i=S.default.StringToGBK(e,t+2,a);S.default.UIntToByte2(e,t,i)}};this.GetLength=function(){var e=1;if(r==5){e+=n.length+2}if(r==6){e+=s.length+a.length+4}return e}};w.JT0x0889=function(){this.ASerial;this.Type;this.Url;this.FillByBinary=function(e,t,i){this.ASerial=S.default.Byte2ToUInt(e,t);this.Type=e[t+2];this.Url=S.default.GBKToString(e,t+3,i-3)}};w.JT0x8889=function(){this.Wss=l.default.IsHttps();this.GetBinaryData=function(e,t){if(this.Wss){e[t]=1}else{e[t]=0}};this.GetLength=function(){return 1}};w.JT0x8890=function(){this.NType;this.Notice;this.FillByBinary=function(e,t,i){this.NType=S.default.Byte2ToUInt(e,t);var r=S.default.Byte2ToUInt(e,t+2);this.Notice=S.default.Utf8ArrayToStr(e,t+4,r)}};i.default=w},{"../events":77,"../helper/ByteHelper":78,"../utils/cvComm":98,"../utils/logger":100}],73:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:true});var r=function(){function r(e,t){for(var i=0;i<t.length;i++){var r=t[i];r.enumerable=r.enumerable||false;r.configurable=true;if("value"in r)r.writable=true;Object.defineProperty(e,r.key,r)}}return function(e,t,i){if(t)r(e.prototype,t);if(i)r(e,i);return e}}();var n=e("../helper/ByteHelper");var s=u(n);var a=e("../events");var o=u(a);var c=e("./JTT1078");var T=u(c);var d=e("../utils/cvComm");var l=u(d);function u(e){return e&&e.__esModule?e:{default:e}}function h(e,t){if(!(e instanceof t)){throw new TypeError("Cannot call a class as a function")}}var f=function(){function t(e){h(this,t);this.wfs=e;this.msg_serial_number=0;this.v1=true}r(t,[{key:"Send9101",value:function e(t,i){var r=arguments.length>2&&arguments[2]!==undefined?arguments[2]:0;var n=arguments.length>3&&arguments[3]!==undefined?arguments[3]:1;var s=arguments.length>4&&arguments[4]!==undefined?arguments[4]:0;var a=new T.default.JTRealVideoTransferRequest("",0,0,i,r,n);var o=new T.default.JTHeader(37121,false,0,a.GetLength(),t,0);var c=0;var d=new Uint8Array(a.GetLength()+o.GetLength());o.GetBinaryData(d,c);c+=o.GetLength();a.GetBinaryData(d,c);var l=new T.default.JT808Package(d,0,d.length);var u=new T.default.JTRTHead(false,s,0,t,i,8,0,0,0,0,l.length);c=0;var h=new Uint8Array(u.GetLength()+l.length);u.GetBinaryData(h,0);c+=u.GetLength();for(var f=0;f<l.length;f++){h[c++]=l[f]}this.Send(h)}},{key:"Send9102",value:function e(t,i,r,n,s){var a=new T.default.JTRealVideoTransferControl(t,i,r,n,s);var o=new T.default.JTHeader(37122,false,0,a.GetLength(),t,0);var c=0;var d=new Uint8Array(a.GetLength()+o.GetLength());o.GetBinaryData(d,c);c+=o.GetLength();a.GetBinaryData(d,c);var l=new T.default.JT808Package(d,0,d.length);var u=new T.default.JTRTHead(false,0,0,t,i,8,0,0,0,0,l.length);c=0;var h=new Uint8Array(u.GetLength()+l.length);u.GetBinaryData(h,0);c+=u.GetLength();for(var f=0;f<l.length;f++){h[c++]=l[f]}this.Send(h)}},{key:"Send9201",value:function e(t,i,r,n,s,a,o,c,d,l){var u=arguments.length>10&&arguments[10]!==undefined?arguments[10]:0;var h=new T.default.JTVideoPlaybackRequest("",0,0,i,r,n,s,a,o,c,d,l);var f=new T.default.JTHeader(37377,false,0,h.GetLength(),t,0);var p=0;var m=new Uint8Array(h.GetLength()+f.GetLength());f.GetBinaryData(m,p);p+=f.GetLength();h.GetBinaryData(m,p);var v=new T.default.JT808Package(m,0,m.length);var g=new T.default.JTRTHead(false,u,0,t,i,8,0,0,0,0,v.length);p=0;var y=new Uint8Array(g.GetLength()+v.length);g.GetBinaryData(y,0);p+=g.GetLength();for(var _=0;_<v.length;_++){y[p++]=v[_]}this.Send(y)}},{key:"Send9202",value:function e(t,i,r,n,s){var a=new T.default.JTVideoPlaybackControl(i,r,n,s);var o=new T.default.JTHeader(37378,false,0,a.GetLength(),t,0);var c=0;var d=new Uint8Array(a.GetLength()+o.GetLength());o.GetBinaryData(d,c);c+=o.GetLength();a.GetBinaryData(d,c);var l=new T.default.JT808Package(d,0,d.length);var u=new T.default.JTRTHead(false,0,0,t,i,8,0,0,0,0,l.length);c=0;var h=new Uint8Array(u.GetLength()+l.length);u.GetBinaryData(h,0);c+=u.GetLength();for(var f=0;f<l.length;f++){h[c++]=l[f]}this.Send(h)}},{key:"Send9205",value:function e(t,i,r,n,s,a,o,c,d,l,u){var h=new T.default.JTQueryVideoFileList(r,n,s,a,o,c,d,l);this.msg_serial_number=this.msg_serial_number+1>255?0:this.msg_serial_number+1;var f=new T.default.JTHeader(37381,0,0,h.GetLength(),i,this.msg_serial_number);var p=0;var m=new Uint8Array(h.GetLength()+f.GetLength());f.GetBinaryData(m,p);p+=f.GetLength();h.GetBinaryData(m,p);var v=new T.default.JT808Package(m,0,m.length);var g=new T.default.JTRTHead(false,0,0,i,r,8,0,0,0,0,v.length);p=0;var y=new Uint8Array(g.GetLength()+v.length);g.GetBinaryData(y,0);p+=g.GetLength();for(var _=0;_<v.length;_++){y[p++]=v[_]}t.sendMessage(y,u,4613,this.msg_serial_number)}},{key:"Send9206",value:function e(t,i,r,n,s,a,o,c,d,l,u,h,f,p,m,v){var g=new T.default.JTVideoFileUpload(r,n,s,a,o,c,d,l,u,h,f,p,m);var y=new T.default.JTHeader(37382,false,0,g.GetLength(),i,0);var _=0;var b=new Uint8Array(g.GetLength()+y.GetLength());y.GetBinaryData(b,_);_+=y.GetLength();g.GetBinaryData(b,_);var S=new T.default.JT808Package(b,0,b.length);var w=new T.default.JTRTHead(false,0,0,i,r,8,0,0,0,0,S.length);_=0;var k=new Uint8Array(w.GetLength()+S.length);w.GetBinaryData(k,0);_+=w.GetLength();for(var C=0;C<S.length;C++){k[_++]=S[C]}t.sendMessage(k,v,4614)}},{key:"Send9207",value:function e(t,i,r,n){var s=new T.default.JTVideoFileUploadControl(r,n);var a=new T.default.JTHeader(37383,false,0,s.GetLength(),t,0);var o=0;var c=new Uint8Array(s.GetLength()+a.GetLength());a.GetBinaryData(c,o);o+=a.GetLength();s.GetBinaryData(c,o);var d=new T.default.JT808Package(c,0,c.length);var l=new T.default.JTRTHead(false,0,0,t,i,8,0,0,0,0,d.length);o=0;var u=new Uint8Array(l.GetLength()+d.length);l.GetBinaryData(u,0);o+=l.GetLength();for(var h=0;h<d.length;h++){u[o++]=d[h]}this.Send(u)}},{key:"Send9301",value:function e(t,i,r,n){var s=new T.default.JTRTPTZRotate(i,r,n);var a=new T.default.JTHeader(37633,false,0,s.GetLength(),t,0);var o=0;var c=new Uint8Array(s.GetLength()+a.GetLength());a.GetBinaryData(c,o);o+=a.GetLength();s.GetBinaryData(c,o);var d=new T.default.JT808Package(c,0,c.length);var l=new T.default.JTRTHead(false,0,0,t,i,8,0,0,0,0,d.length);o=0;var u=new Uint8Array(l.GetLength()+d.length);l.GetBinaryData(u,0);o+=l.GetLength();for(var h=0;h<d.length;h++){u[o++]=d[h]}this.Send(u)}},{key:"Send9302",value:function e(t,i,r){var n=new T.default.JTRPTZControl(i,r);var s=new T.default.JTHeader(37634,false,0,n.GetLength(),t,0);var a=0;var o=new Uint8Array(n.GetLength()+s.GetLength());s.GetBinaryData(o,a);a+=s.GetLength();n.GetBinaryData(o,a);var c=new T.default.JT808Package(o,0,o.length);var d=new T.default.JTRTHead(false,0,0,t,i,8,0,0,0,0,c.length);a=0;var l=new Uint8Array(d.GetLength()+c.length);d.GetBinaryData(l,0);a+=d.GetLength();for(var u=0;u<c.length;u++){l[a++]=c[u]}this.Send(l)}},{key:"Send9303",value:function e(t,i,r){var n=new T.default.JTRPTZControl(i,r);var s=new T.default.JTHeader(37635,false,0,n.GetLength(),t,0);var a=0;var o=new Uint8Array(n.GetLength()+s.GetLength());s.GetBinaryData(o,a);a+=s.GetLength();n.GetBinaryData(o,a);var c=new T.default.JT808Package(o,0,o.length);var d=new T.default.JTRTHead(false,0,0,t,i,8,0,0,0,0,c.length);a=0;var l=new Uint8Array(d.GetLength()+c.length);d.GetBinaryData(l,0);a+=d.GetLength();for(var u=0;u<c.length;u++){l[a++]=c[u]}this.Send(l)}},{key:"Send9304",value:function e(t,i,r){var n=new T.default.JTRPTZControl(i,r);var s=new T.default.JTHeader(37636,false,0,n.GetLength(),t,0);var a=0;var o=new Uint8Array(n.GetLength()+s.GetLength());s.GetBinaryData(o,a);a+=s.GetLength();n.GetBinaryData(o,a);var c=new T.default.JT808Package(o,0,o.length);var d=new T.default.JTRTHead(false,0,0,t,i,8,0,0,0,0,c.length);a=0;var l=new Uint8Array(d.GetLength()+c.length);d.GetBinaryData(l,0);a+=d.GetLength();for(var u=0;u<c.length;u++){l[a++]=c[u]}this.Send(l)}},{key:"Send9305",value:function e(t,i,r){var n=new T.default.JTRPTZControl(i,r);var s=new T.default.JTHeader(37637,false,0,n.GetLength(),t,0);var a=0;var o=new Uint8Array(n.GetLength()+s.GetLength());s.GetBinaryData(o,a);a+=s.GetLength();n.GetBinaryData(o,a);var c=new T.default.JT808Package(o,0,o.length);var d=new T.default.JTRTHead(false,0,0,t,i,8,0,0,0,0,c.length);a=0;var l=new Uint8Array(d.GetLength()+c.length);d.GetBinaryData(l,0);a+=d.GetLength();for(var u=0;u<c.length;u++){l[a++]=c[u]}this.Send(l)}},{key:"Send9306",value:function e(t,i,r){var n=new T.default.JTRPTZControl(i,r);var s=new T.default.JTHeader(37638,false,0,n.GetLength(),t,0);var a=0;var o=new Uint8Array(n.GetLength()+s.GetLength());s.GetBinaryData(o,a);a+=s.GetLength();n.GetBinaryData(o,a);var c=new T.default.JT808Package(o,0,o.length);var d=new T.default.JTRTHead(false,0,0,t,i,8,0,0,0,0,c.length);a=0;var l=new Uint8Array(d.GetLength()+c.length);d.GetBinaryData(l,0);a+=d.GetLength();for(var u=0;u<c.length;u++){l[a++]=c[u]}this.Send(l)}},{key:"Send8881",value:function e(t,i,r){var n=new T.default.JTPrioritySetExt(r);var s=new T.default.JTHeader(34945,false,0,n.GetLength(),t,0);var a=0;var o=new Uint8Array(n.GetLength()+s.GetLength());s.GetBinaryData(o,a);a+=s.GetLength();n.GetBinaryData(o,a);var c=new T.default.JT808Package(o,0,o.length);var d=new T.default.JTRTHead(false,0,0,t,i,8,0,0,0,0,c.length);a=0;var l=new Uint8Array(d.GetLength()+c.length);d.GetBinaryData(l,0);a+=d.GetLength();for(var u=0;u<c.length;u++){l[a++]=c[u]}this.Send(l)}},{key:"Send8800",value:function e(t,i){var r="123488888888";if(l.default.IsHttps()){r="123488888889"}var n=new T.default.JTRTHead(false,60,0,r,0,8,0,0,0,0,0);var s=new Uint8Array(n.GetLength());n.GetBinaryData(s,0);this.Send(s)}},{key:"Send8801",value:function e(t,i,r){var n=JSON.stringify({roomid:r});var s=new T.default.JTRTHead(false,60,0,"000011111111",0,8,0,0,0,0,n.length);var a=new Uint8Array(s.GetLength()+n.length);s.GetBinaryData(a,0);var o=s.GetLength();for(var c=0;c<n.length;c++){a[o++]=n.charCodeAt(c)}this.Send(a)}},{key:"SendHeartRtmp",value:function e(t,i,r,n){var s=new T.default.JTRTHead(false,61,0,"123488888888",0,8,0,0,0,0,r.length+n.length+1);var a=new Uint8Array(s.GetLength()+r.length+n.length+1);s.GetBinaryData(a,0);var o=s.GetLength();var c=0;for(c=0;c<r.length;c++){a[o++]=r.charCodeAt(c)}var d=",";a[o++]=d.charCodeAt(0);for(c=0;c<n.length;c++){a[o++]=n.charCodeAt(c)}this.Send(a)}},{key:"Send9101Rtmp",value:function e(t,i){var r=arguments.length>2&&arguments[2]!==undefined?arguments[2]:0;var n=arguments.length>3&&arguments[3]!==undefined?arguments[3]:1;var s=new T.default.JTRealVideoTransferRequest("",0,0,i,r,n);var a=new T.default.JTRTHead(false,62,0,t,i,8,0,0,0,0,s.GetLength());var o=0;var c=new Uint8Array(s.GetLength()+a.GetLength());a.GetBinaryData(c,o);o+=a.GetLength();s.GetBinaryData(c,o);this.Send(c)}},{key:"Send9201Rtmp",value:function e(t,i,r,n,s,a,o,c,d,l){var u=new T.default.JTVideoPlaybackRequest("",0,0,i,r,n,s,a,o,c,d,l);var h=new T.default.JTRTHead(false,63,0,t,i,8,0,0,0,0,u.GetLength());var f=0;var p=new Uint8Array(u.GetLength()+h.GetLength());h.GetBinaryData(p,f);f+=h.GetLength();u.GetBinaryData(p,f);this.Send(p)}},{key:"SendAudio",value:function e(t,i,r,n,s,a){var o=new T.default.JTRTHead(1,s,n,t,i,3,0,a,0,0,r.length);var c=new Uint8Array(o.GetLength()+r.length);o.GetBinaryData(c,0);var d=o.GetLength();for(var l=0;l<r.length;l++){c[d++]=r[l]}this.Send(c)}},{key:"Send",value:function e(t){this.wfs.trigger(o.default.WEBSOCKET_DATA_UPLOADING,{data:t})}}]);return t}();i.default=f},{"../events":77,"../helper/ByteHelper":78,"../utils/cvComm":98,"./JTT1078":72}],74:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:true});var r=function(){function r(e,t){for(var i=0;i<t.length;i++){var r=t[i];r.enumerable=r.enumerable||false;r.configurable=true;if("value"in r)r.writable=true;Object.defineProperty(e,r.key,r)}}return function(e,t,i){if(t)r(e.prototype,t);if(i)r(e,i);return e}}();var n=e("./UCVideo");var l=v(n);var s=e("./loader/cmdChannel");var a=v(s);var _=e("./utils/long");var o=e("./utils/logger");var h=v(o);var c=e("./player/PlayerAudioMan");var d=v(c);var u=e("./utils/cvComm");var f=v(u);var p=e("./timedTask");var m=v(p);function v(e){return e&&e.__esModule?e:{default:e}}function g(e,t){if(!(e instanceof t)){throw new TypeError("Cannot call a class as a function")}}var y=function(){function e(){g(this,e);this.m_border=0;this.SelectChangeZIndex=true;this.audioPlayer=null;this.NowSelectVideo=1;this.NowPlayVideosCount=0;this.cmds={};this.customScreens={};this.Zoomed=false}r(e,[{key:"Init",value:function e(t){var i=arguments.length>1&&arguments[1]!==undefined?arguments[1]:4;var r=arguments.length>2&&arguments[2]!==undefined?arguments[2]:{};if(!this.ContainsScreen(i)){h.default.warn("Init VideoNums is not in  [1, 2, 4, 6, 8, 9, 10, 13, 16]");return}this.m_is_real=true;var n=CvNetVideo.DefaultConfig;if(t){this.dom=t;this.Container=document.createElement("div");this.Container.classList.add("video-container");if(t.append){t.append(this.Container)}else{t.appendChild(this.Container)}r.dom=t}for(var s in n){if(s in r){continue}r[s]=n[s]}console.log("playerMode:"+r.playerMode);r.remotePort=r.remotePortFmp4;if(document.querySelector("#CVNetVideoCss")==null){f.default.loadCss(r.cssUrl,"CVNetVideoCss",function(){this._Init2(i,r)}.bind(this),true)}else{this._Init2(i,r)}}},{key:"_Init2",value:function e(t,i){this._InitUC(t,i);if(i.callback){i.callback()}if(i.networkSpeaking){this.audio_player=new d.default(i,this);CvNetVideo.InitWasm(i)}if(this.timedTask==undefined){this.timedTask=new m.default(i,this)}}},{key:"StartRealTimeVideo",value:function e(t,i){var r=arguments.length>2&&arguments[2]!==undefined?arguments[2]:1;var n=arguments.length>3&&arguments[3]!==undefined?arguments[3]:true;var s=arguments.length>4&&arguments[4]!==undefined?arguments[4]:0;var a=arguments.length>5&&arguments[5]!==undefined?arguments[5]:{};var o=arguments.length>6&&arguments[6]!==undefined?arguments[6]:null;var c=arguments.length>7&&arguments[7]!==undefined?arguments[7]:0;if(!this.m_is_real){h.default.warn("录像流播放器不可调用此接口");return}var d=this.GetSelectedVideo(s,a);d.StartRealTimeVideo(t,i,r,n,c);if(this.audioPlayer)this.audioPlayer.StartPlay()}},{key:"GovPlay",value:function e(t){var i=arguments.length>1&&arguments[1]!==undefined?arguments[1]:0;var r=arguments.length>2&&arguments[2]!==undefined?arguments[2]:{};var n=arguments.length>3&&arguments[3]!==undefined?arguments[3]:null;if(!this.m_is_real){h.default.warn("录像流播放器不可调用此接口");return}var s=this.GetSelectedVideo(i,r);s.GovPlay(t,n)}},{key:"PlaybackVideo",value:function e(t,i,r){var n=arguments.length>3&&arguments[3]!==undefined?arguments[3]:0;var s=arguments.length>4&&arguments[4]!==undefined?arguments[4]:0;var a=arguments.length>5&&arguments[5]!==undefined?arguments[5]:0;var o=arguments.length>6&&arguments[6]!==undefined?arguments[6]:0;var c=arguments[7];var d=arguments[8];var l=arguments.length>9&&arguments[9]!==undefined?arguments[9]:0;var u=arguments.length>10&&arguments[10]!==undefined?arguments[10]:{};var h=arguments.length>11&&arguments[11]!==undefined?arguments[11]:null;var f=arguments.length>12&&arguments[12]!==undefined?arguments[12]:0;var p=arguments.length>13&&arguments[13]!==undefined?arguments[13]:0;var m=this.GetSelectedVideo(l,u);m.PlaybackVideo(t,i,r,n,s,a,o,c,d,f,p);if(this.audioPlayer)this.audioPlayer.StartPlay()}},{key:"PlayBackVideoByPlayer",value:function e(t,i,r){var n=this.GetSelectedVideo(t);n.PlayBackVideoByPlayer(i,r)}},{key:"Stop",value:function e(){var t=arguments.length>0&&arguments[0]!==undefined?arguments[0]:-1;if(t===-1){for(var i in this.Videos){var r=this.Videos[i];if(r){r.Stop()}}}else{var n=this.GetSelectedVideo(t,{});if(n){n.Stop()}}if(this.NowPlayVideosCount===0){if(this.audioPlayer)this.audioPlayer.StopPlay()}}},{key:"StartSpeek",value:function e(t,i){var r=arguments.length>2&&arguments[2]!==undefined?arguments[2]:{};if(this.audio_player.AudioSpeek.audiocapture.GetUserMedia()==null){h.default.warn("no getUserMedia, Speek exit.");return false}for(var n in r){this.audio_player.config[n]=r[n]}this.audio_player.StartSpeek(t,i);return true}},{key:"StopSpeak",value:function e(){this.audio_player.StopSpeek()}},{key:"IsPlaying",value:function e(){var t=arguments.length>0&&arguments[0]!==undefined?arguments[0]:0;var i=this.GetSelectedVideo(t,{});if(i){return i.IsPlaying()}return false}},{key:"SetRotate",value:function e(t,i){if(t<0||t>16)return false;if(i!=0&&i!=90&&i!=180&&i!=270)return false;var r=this.GetSelectedVideo(t,{});if(r){r.SetRotate(i);return true}return false}},{key:"SetMirrorInver",value:function e(t){var i=this.GetSelectedVideo(t,{});if(i){i.SetMirrorInver();return true}return false}},{key:"SetTimeoutMsec",value:function e(t,i){this.timedTask.config.timeoutCloseMsec=t;this.timedTask.config.timeoutWarningMsec=i}},{key:"CustomScreens",value:function e(t,i){this.customScreens[t]=i}},{key:"LayoutByScreens",value:function e(t){if(this.customScreens[t]){this.ScreenIndex=t}else{if(!this.ContainsScreen(t)){h.default.warn("LayoutScreens num is not in 1, 2, 4, 6, 8, 9, 10, 13, 16");return}else{this.ScreenIndex=this.ScreenNumToSplidIndex(t)}}if(this.dom){var i=this.dom.offsetWidth;var r=this.dom.offsetHeight;this.Resize(i,r)}}},{key:"Resize",value:function e(t,i){t=parseInt(t);i=parseInt(i);this.SelectChangeZIndex=true;if(this.customScreens[this.ScreenIndex]){this.customScreens[this.ScreenIndex](t,i)}else if(this.ScreenIndex==0){this.Split1X1(t,i)}else if(this.ScreenIndex==1){this.Split2(t,i)}else if(this.ScreenIndex==2){this.Split2X2(t,i)}else if(this.ScreenIndex==3){this.Split1P5(t,i)}else if(this.ScreenIndex==4){this.Split1P7(t,i)}else if(this.ScreenIndex==5){this.Split3X3(t,i)}else if(this.ScreenIndex==6){this.Split1P9(t,i)}else if(this.ScreenIndex==7){this.Split1P12(t,i)}else if(this.ScreenIndex==8){this.Split4X4(t,i)}else{this.Split2X2(t,i)}this.Zoomed=false}},{key:"FullScreen",value:function e(){var t=this.Container;var i=document.fullScreen||document.mozFullScreen||document.webkitIsFullScreen;if(!i){t.requestFullscreen&&t.requestFullscreen()||t.mozRequestFullScreen&&t.mozRequestFullScreen()||t.webkitRequestFullscreen&&t.webkitRequestFullscreen()||t.msRequestFullscreen&&t.msRequestFullscreen();this.Resize(window.screen.width,window.screen.height)}else{document.exitFullscreen?document.exitFullscreen():document.mozCancelFullScreen?document.mozCancelFullScreen():document.webkitExitFullscreen?document.webkitExitFullscreen():"";setTimeout(function(){this.Resize(t.clientWidth,t.clientHeight)}.bind(this),300)}}},{key:"GetContainerSize",value:function e(){var t=document.fullScreen||document.mozFullScreen||document.webkitIsFullScreen;if(t){return{width:window.screen.width,height:window.screen.height}}else{return{width:this.Container.clientWidth,height:this.Container.clientHeight}}}},{key:"ZoomUC",value:function e(t){if(t>=0){var i=this.GetSelectedVideo(t);this.Zoomed=true;var r=this.GetContainerSize();for(var n=1;n<=16;n++){var s=this.videos[n];var a=s.GetVideoDiv();if(i==s){a.style.display="block";a.style.left="0px";a.style.top="0px";a.style.width=r.width-this.m_border*2+"px";a.style.height=r.height-this.m_border*2+"px";s.Resize()}else{a.style.display="none"}}}}},{key:"UnZoomUC",value:function e(){var t=this.GetContainerSize();this.Resize(t.width,t.height)}},{key:"SetOsdVisible",value:function e(t,i){if(i>=0){var r=this.GetSelectedVideo(i);r.SetOsdVisible(t)}else{for(var n=1;n<=16;n++){this.videos[n].SetOsdVisible(t)}}}},{key:"SetOsdColor",value:function e(t,i){if(i>=0){var r=this.GetSelectedVideo(i);r.SetOsdColor(t)}else{for(var n=1;n<=16;n++){this.videos[n].SetOsdColor(t)}}}},{key:"SetOsdText",value:function e(t,i){if(t>=0){var r=this.GetSelectedVideo(t);r.SetOsdText(i)}else{for(var n=1;n<=16;n++){this.videos[n].SetOsdText(i)}}}},{key:"Capture",value:function e(t,i,r){var n=arguments.length>3&&arguments[3]!==undefined?arguments[3]:0;var s=this.GetSelectedVideo(n);return s.Capture(t,i,r)}},{key:"SetPriority",value:function e(t){var i=arguments.length>1&&arguments[1]!==undefined?arguments[1]:0;var r=this.GetSelectedVideo(i);r.config.priority=t}},{key:"SetRealOrBack",value:function e(t){if(this.m_is_real==t)return;this.Stop();this.m_is_real=t;for(var i=1;i<=16;i++){var r=this.videos[i].SetRealOrBack(t)}}},{key:"SetBackDateTime",value:function e(t,i,r){var n=arguments.length>3&&arguments[3]!==undefined?arguments[3]:0;var s=arguments.length>4&&arguments[4]!==undefined?arguments[4]:0;var a=arguments.length>5&&arguments[5]!==undefined?arguments[5]:0;var o=arguments.length>6&&arguments[6]!==undefined?arguments[6]:0;var c=arguments.length>7&&arguments[7]!==undefined?arguments[7]:0;var d=arguments.length>8&&arguments[8]!==undefined?arguments[8]:{};var l=arguments.length>9&&arguments[9]!==undefined?arguments[9]:0;if(this.m_is_real){h.default.warn("实时流播放器不可调用此接口");return}var u=this.GetSelectedVideo(n,d);u.SetBackDateTime(t,i,r,n,s,a,o,c,l)}},{key:"Split1X1",value:function e(t,i){this.Container.style.width=t+"px";this.Container.style.height=i+"px";t=t-this.m_border*2;i=i-this.m_border*2;for(var r=1;r<=16;r++){var n=this.videos[r].GetVideoDiv();if(1<r){n.style.display="none"}else{n.style.display="block";n.style.left="0px";n.style.top="0px";n.style.width=t+"px";n.style.height=i+"px";this.videos[r].Resize()}}}},{key:"Split2",value:function e(t,i){this.SelectChangeZIndex=false;this.Container.style.width=t+"px";this.Container.style.height=i+"px";t=t-this.m_border*2;i=i-this.m_border*2;for(var r=1;r<=16;r++){var n=this.videos[r].GetVideoDiv();if(r>2){n.style.display="none"}else if(r==1){n.style.display="block";n.style.left="0px";n.style.top="0px";n.style.width=t+"px";n.style.height=i+"px";n.style.zIndex=r;this.videos[r].Resize()}else if(r==2){n.style.display="block";var s=parseInt(t/3);var a=parseInt(i/3);n.style.left=s*2+"px";n.style.top=a*2-42+"px";n.style.width=s+"px";n.style.height=a+"px";n.style.zIndex=r;this.videos[r].Resize()}}}},{key:"Split2X2",value:function e(t,i){this.Container.style.width=t-parseInt((t-this.m_border*3)%2)+"px";this.Container.style.height=i-parseInt((i-this.m_border*3)%2)+"px";t=parseInt((t-this.m_border*3)/2);i=parseInt((i-this.m_border*3)/2);for(var r=1;r<=16;r++){var n=this.videos[r].GetVideoDiv();if(4<r){n.style.display="none"}else{n.style.display="block";var s=r-1;var a=s%2*(t+this.m_border);var o=parseInt(s/2)*(i+this.m_border);n.style.left=a+"px";n.style.top=o+"px";n.style.width=t+"px";n.style.height=i+"px";this.videos[r].Resize()}}}},{key:"Split1P5",value:function e(t,i){this.Container.style.width=t-parseInt((t-this.m_border*4)%3)+"px";this.Container.style.height=i-parseInt((i-this.m_border*4)%3)+"px";t=parseInt((t-this.m_border*4)/3);i=parseInt((i-this.m_border*4)/3);for(var r=1;r<=16;r++){var n=this.videos[r].GetVideoDiv();if(6<r){n.style.display="none"}else{n.style.display="block";if(r==1){n.style.left="0px";n.style.top="0px";n.style.width=t*2+this.m_border+"px";n.style.height=i*2+this.m_border+"px";this.videos[r].Resize();continue}else if(r==2){n.style.left=(t+this.m_border)*2+"px";n.style.top="0px"}else if(r==3){n.style.left=(t+this.m_border)*2+"px";n.style.top=i+this.m_border+"px"}else if(r==4){n.style.left="0px";n.style.top=(i+this.m_border)*2+"px"}else if(r==5){n.style.left=t+this.m_border+"px";n.style.top=(i+this.m_border)*2+"px"}else if(r==6){n.style.left=(t+this.m_border)*2+"px";n.style.top=(i+this.m_border)*2+"px"}n.style.width=t+"px";n.style.height=i+"px";this.videos[r].Resize()}}}},{key:"Split1P7",value:function e(t,i){this.Container.style.width=t-parseInt((t-this.m_border*5)%4)+"px";this.Container.style.height=i-parseInt((i-this.m_border*5)%4)+"px";t=parseInt((t-this.m_border*5)/4);i=parseInt((i-this.m_border*5)/4);for(var r=1;r<=16;r++){var n=this.videos[r].GetVideoDiv();if(8<r){n.style.display="none"}else{n.style.display="block";if(r==1){n.style.left="0px";n.style.top="0px";n.style.width=t*3+this.m_border*2+"px";n.style.height=i*3+this.m_border*2+"px";this.videos[r].Resize();continue}else if(r==2){n.style.left=(t+this.m_border)*3+"px";n.style.top="0px"}else if(r==3){n.style.left=(t+this.m_border)*3+"px";n.style.top=i+this.m_border+"px"}else if(r==4){n.style.left=(t+this.m_border)*3+"px";n.style.top=(i+this.m_border)*2+"px"}else if(r==5){n.style.left="0px";n.style.top=(i+this.m_border)*3+"px"}else if(r==6){n.style.left=t+this.m_border+"px";n.style.top=(i+this.m_border)*3+"px"}else if(r==7){n.style.left=(t+this.m_border)*2+"px";n.style.top=(i+this.m_border)*3+"px"}else if(r==8){n.style.left=(t+this.m_border)*3+"px";n.style.top=(i+this.m_border)*3+"px"}n.style.width=t+"px";n.style.height=i+"px";this.videos[r].Resize()}}}},{key:"Split3X3",value:function e(t,i){this.Container.style.width=t-parseInt((t-this.m_border*4)%3)+"px";this.Container.style.height=i-parseInt((i-this.m_border*4)%3)+"px";t=parseInt((t-this.m_border*4)/3);i=parseInt((i-this.m_border*4)/3);for(var r=1;r<=16;r++){var n=this.videos[r].GetVideoDiv();if(9<r){n.style.display="none"}else{n.style.display="block";var s=r-1;var a=s%3*(t+this.m_border);var o=parseInt(s/3)*(i+this.m_border);n.style.left=a+"px";n.style.top=o+"px";n.style.width=t+"px";n.style.height=i+"px";this.videos[r].Resize()}}}},{key:"Split1P9",value:function e(t,i){this.Container.style.width=t-parseInt((t-this.m_border*6)%5)+"px";this.Container.style.height=i-parseInt((i-this.m_border*6)%5)+"px";t=parseInt((t-this.m_border*6)/5);i=parseInt((i-this.m_border*6)/5);for(var r=1;r<=16;r++){var n=this.videos[r].GetVideoDiv();if(10<r){n.style.display="none"}else{n.style.display="block";if(r==1){n.style.left="0px";n.style.top="0px";n.style.width=t*4+this.m_border*3+"px";n.style.height=i*4+this.m_border*3+"px";this.videos[r].Resize();continue}else if(r==2){n.style.left=(t+this.m_border)*4+"px";n.style.top="0px"}else if(r==3){n.style.left=(t+this.m_border)*4+"px";n.style.top=i+this.m_border+"px"}else if(r==4){n.style.left=(t+this.m_border)*4+"px";n.style.top=(i+this.m_border)*2+"px"}else if(r==5){n.style.left=(t+this.m_border)*4+"px";n.style.top=(i+this.m_border)*3+"px"}else if(r==6){n.style.left="0px";n.style.top=(i+this.m_border)*4+"px"}else if(r==7){n.style.left=t+this.m_border+"px";n.style.top=(i+this.m_border)*4+"px"}else if(r==8){n.style.left=(t+this.m_border)*2+"px";n.style.top=(i+this.m_border)*4+"px"}else if(r==9){n.style.left=(t+this.m_border)*3+"px";n.style.top=(i+this.m_border)*4+"px"}else if(r==10){n.style.left=(t+this.m_border)*4+"px";n.style.top=(i+this.m_border)*4+"px"}n.style.width=t+"px";n.style.height=i+"px";this.videos[r].Resize()}}}},{key:"Split1P12",value:function e(t,i){this.Container.style.width=t-parseInt((t-this.m_border*5)%4)+"px";this.Container.style.height=i-parseInt((i-this.m_border*5)%4)+"px";t=parseInt((t-this.m_border*5)/4);i=parseInt((i-this.m_border*5)/4);for(var r=1;r<=16;r++){var n=this.videos[r].GetVideoDiv();if(13<r){n.style.display="none"}else{n.style.display="block";if(r==1){n.style.left="0px";n.style.top="0px"}else if(r==2){n.style.left=t+this.m_border+"px";n.style.top="0px"}else if(r==3){n.style.left=(t+this.m_border)*2+"px";n.style.top="0px"}else if(r==4){n.style.left=(t+this.m_border)*3+"px";n.style.top="0px"}else if(r==5){n.style.left="0px";n.style.top=i+this.m_border+"px"}else if(r==6){n.style.left=t+this.m_border+"px";n.style.top=i+this.m_border+"px";n.style.width=t*2+this.m_border+"px";n.style.height=i*2+this.m_border+"px";this.videos[r].Resize();continue}else if(r==7){n.style.left=(t+this.m_border)*3+"px";n.style.top=i+this.m_border+"px"}else if(r==8){n.style.left="0px";n.style.top=(i+this.m_border)*2+"px"}else if(r==9){n.style.left=(t+this.m_border)*3+"px";n.style.top=(i+this.m_border)*2+"px"}else if(r==10){n.style.left="0px";n.style.top=(i+this.m_border)*3+"px"}else if(r==11){n.style.left=t+this.m_border+"px";n.style.top=(i+this.m_border)*3+"px"}else if(r==12){n.style.left=(t+this.m_border)*2+"px";n.style.top=(i+this.m_border)*3+"px"}else if(r==13){n.style.left=(t+this.m_border)*3+"px";n.style.top=(i+this.m_border)*3+"px"}n.style.width=t+"px";n.style.height=i+"px";this.videos[r].Resize()}}}},{key:"Split4X4",value:function e(t,i){this.Container.style.width=t-parseInt((t-this.m_border*5)%4)+"px";this.Container.style.height=i-parseInt((i-this.m_border*5)%4)+"px";t=parseInt((t-this.m_border*5)/4);i=parseInt((i-this.m_border*5)/4);for(var r=1;r<=16;r++){var n=this.videos[r].GetVideoDiv();if(16<r){n.style.display="none"}else{n.style.display="block";var s=r-1;var a=s%4*(t+this.m_border);var o=parseInt(s/4)*(i+this.m_border);n.style.left=a+"px";n.style.top=o+"px";n.style.width=t+"px";n.style.height=i+"px";this.videos[r].Resize()}}}},{key:"GetOperateUCVideo",value:function e(){return this.Videos[this.NowSelectVideo]}},{key:"_InitUC",value:function e(){var n=this;var t=arguments.length>0&&arguments[0]!==undefined?arguments[0]:4;var s=arguments[1];var i=function e(){var t={};for(o in s){t[o]=s[o]}var i=new l.default(t,a,n);n.Videos[a]=i;var r=n;c=n.videos[a].GetVideoDiv();if(c){c.index=a;c.parentContainer=n.Container;c.onclick=function(){r.NowSelectVideo=this.index;for(var e=1;e<=16;e++){if(e===r.NowSelectVideo){if(r.SelectChangeZIndex)this.style.zIndex=999;this.classList.add("video-select");r.videos[e].SetMuted(false)}else{if(r.SelectChangeZIndex)r.videos[e].GetVideoDiv().style.zIndex=e;r.videos[e].GetVideoDiv().classList.remove("video-select");r.videos[e].SetMuted(true)}}if(t.selectedEvent!=null){t.selectedEvent(r.NowSelectVideo)}}}};for(var a=1;a<=16;a++){var o;var c;i()}var r=this.videos[1].GetVideoDiv();if(r){r.classList.add("video-select");r.style.zIndex=999}this.videos[1].SetMuted(false);if(s.dom&&this.m_border==0){var d=window.getComputedStyle(this.videos[1].GetVideoDiv(),null);this.m_border=parseInt(d.borderWidth.charAt(0));if(isNaN(this.m_border)||this.m_border<=0){this.m_border=2}}this.LayoutByScreens(t)}},{key:"get808Cmd",value:function e(t,i){if(t.usingCluster){var r=this.cmds["C:"+t.clusterHost+":"+t.clusterPort];if(r===undefined){r=new a.default(t,i);this.cmds["C:"+t.clusterHost+":"+t.clusterPort]=r;r.connect();return r}return r}else{var n=this.cmds[t.remoteHost+":"+t.remotePortWs];if(n===undefined){n=new a.default(t,i);this.cmds[t.remoteHost+":"+t.remotePortWs]=n;n.connect();return n}return n}}},{key:"loadJs",value:function e(t,i){var r=document.createElement("script");r.type="text/javascript";if(typeof i!="undefined"){if(r.readyState){r.onreadystatechange=function(){if(r.readyState=="loaded"||r.readyState=="complete"){r.onreadystatechange=null;i()}}}else{r.onload=function(){i()}}}r.src=t;document.body.appendChild(r)}},{key:"loadCss",value:function e(t,i,r,n){var s=document.createElement("link");s.type="text/css";s.rel="stylesheet";if(i){s.id=i}if(typeof r!="undefined"){if(s.readyState){s.onreadystatechange=function(){if(s.readyState=="loaded"||s.readyState=="complete"){s.onreadystatechange=null;r()}}}else{s.onload=function(){r()}}}s.href=t;if(n)document.head.prepend(s);else document.head.appendChild(s)}},{key:"ContainsScreen",value:function e(t){var i=[1,2,4,6,8,9,10,13,16];for(var r=0;r<i.length;r++){if(i[r]===t||i[r]+""===t){return true}}return false}},{key:"ScreenNumToSplidIndex",value:function e(t){if(t==1){return 0}else if(t==2){return 1}else if(t==4){return 2}else if(t==6){return 3}else if(t==8){return 4}else if(t==9){return 5}else if(t==10){return 6}else if(t==13){return 7}else if(t==16){return 8}else{return 2}}},{key:"GetSelectedVideo",value:function e(){var t=arguments.length>0&&arguments[0]!==undefined?arguments[0]:0;var i=arguments.length>1&&arguments[1]!==undefined?arguments[1]:{};var r=void 0;if(t===0){r=this.GetOperateUCVideo()}else{r=this.Videos[t]}for(var n in i){r.config[n]=i[n]}return r}},{key:"AVTransferControl",value:function e(t,i,r,n,s){var a=arguments.length>5&&arguments[5]!==undefined?arguments[5]:0;var o=arguments.length>6&&arguments[6]!==undefined?arguments[6]:{};var c=this.GetSelectedVideo(a,o);c.AVTransferControl(t,i,r,n,s)}},{key:"PlaybackVideoControl",value:function e(t,i,r,n,s){var a=arguments.length>5&&arguments[5]!==undefined?arguments[5]:0;var o=arguments.length>6&&arguments[6]!==undefined?arguments[6]:{};var c=this.GetSelectedVideo(a,o);c.PlaybackVideoControl(t,i,r,n,s)}},{key:"QueryVideoFileList",value:function e(t,i,r,n,s,a,o,c,d){var l=arguments.length>9&&arguments[9]!==undefined?arguments[9]:0;var u=arguments.length>10&&arguments[10]!==undefined?arguments[10]:{};var h=arguments.length>11&&arguments[11]!==undefined?arguments[11]:0;var f=this.GetSelectedVideo(l,u);if(!(0,_.isLong)(s)){s=(0,_.fromString)(s,true)}f.QueryVideoFileList(t,i,r,n,s,a,o,c,h,d)}},{key:"FtpVideoFileUpload",value:function e(t,i,r,n,s,a,o,c,d,l,u,h,f,p,m){var v=arguments.length>15&&arguments[15]!==undefined?arguments[15]:0;var g=arguments.length>16&&arguments[16]!==undefined?arguments[16]:{};var y=this.GetSelectedVideo(v,g);if(!(0,_.isLong)(l)){l=(0,_.fromString)(l,true)}y.FtpVideoFileUpload(t,i,r,n,s,a,o,c,d,l,u,h,f,p,m)}},{key:"FtpVideoFileUploadControl",value:function e(t,i,r){var n=arguments.length>3&&arguments[3]!==undefined?arguments[3]:0;var s=arguments.length>4&&arguments[4]!==undefined?arguments[4]:{};var a=this.GetSelectedVideo(n,s);a.FtpVideoFileUploadControl(t,i,r)}},{key:"RotationControl",value:function e(t,i,r,n){var s=arguments.length>4&&arguments[4]!==undefined?arguments[4]:0;var a=arguments.length>5&&arguments[5]!==undefined?arguments[5]:{};var o=this.GetSelectedVideo(s,a);o.RotationControl(t,i,r,n)}},{key:"FocusControl",value:function e(t,i,r){var n=arguments.length>3&&arguments[3]!==undefined?arguments[3]:0;var s=arguments.length>4&&arguments[4]!==undefined?arguments[4]:{};var a=this.GetSelectedVideo(n,s);a.FocusControl(t,i,r)}},{key:"ApertureControl",value:function e(t,i,r){var n=arguments.length>3&&arguments[3]!==undefined?arguments[3]:0;var s=arguments.length>4&&arguments[4]!==undefined?arguments[4]:{};var a=this.GetSelectedVideo(n,s);a.ApertureControl(t,i,r)}},{key:"WiperControl",value:function e(t,i,r){var n=arguments.length>3&&arguments[3]!==undefined?arguments[3]:0;var s=arguments.length>4&&arguments[4]!==undefined?arguments[4]:{};var a=this.GetSelectedVideo(n,s);a.WiperControl(t,i,r)}},{key:"InfraredControl",value:function e(t,i,r){var n=arguments.length>3&&arguments[3]!==undefined?arguments[3]:0;var s=arguments.length>4&&arguments[4]!==undefined?arguments[4]:{};var a=this.GetSelectedVideo(n,s);a.InfraredControl(t,i,r)}},{key:"TimesControl",value:function e(t,i,r){var n=arguments.length>3&&arguments[3]!==undefined?arguments[3]:0;var s=arguments.length>4&&arguments[4]!==undefined?arguments[4]:{};var a=this.GetSelectedVideo(n,s);a.TimesControl(t,i,r)}},{key:"Videos",get:function e(){if(!this.videos){this.videos={}}return this.videos}}]);return e}();i.default=y},{"./UCVideo":75,"./loader/cmdChannel":81,"./player/PlayerAudioMan":90,"./timedTask":97,"./utils/cvComm":98,"./utils/logger":100,"./utils/long":101}],75:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:true});var h=typeof Symbol==="function"&&typeof Symbol.iterator==="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol==="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};var n=function(){function r(e,t){for(var i=0;i<t.length;i++){var r=t[i];r.enumerable=r.enumerable||false;r.configurable=true;if("value"in r)r.writable=true;Object.defineProperty(e,r.key,r)}}return function(e,t,i){if(t)r(e.prototype,t);if(i)r(e,i);return e}}();var r=e("./events");var s=k(r);var a=e("events");var o=k(a);var c=e("./loader/websocket-loader");var d=k(c);var l=e("./JX/JTT1078");var u=k(l);var f=e("./JX/JTT1078Old");var p=k(f);var m=e("./loader/cluster-websocket-loader");var v=k(m);var g=e("./utils/logger");var y=k(g);var _=e("./utils/cvComm");var b=k(_);var S=e("./player/PlayerMan");var w=k(S);function k(e){return e&&e.__esModule?e:{default:e}}function C(e,t){if(!(e instanceof t)){throw new TypeError("Cannot call a class as a function")}}Date.prototype.Format=function(e){var t={"M+":this.getMonth()+1,"d+":this.getDate(),"h+":this.getHours(),"m+":this.getMinutes(),"s+":this.getSeconds(),"q+":Math.floor((this.getMonth()+3)/3),S:this.getMilliseconds()};if(/(y+)/.test(e))e=e.replace(RegExp.$1,(this.getFullYear()+"").substr(4-RegExp.$1.length));for(var i in t){if(new RegExp("("+i+")").test(e))e=e.replace(RegExp.$1,RegExp.$1.length==1?t[i]:("00"+t[i]).substr((""+t[i]).length))}return e};var T=function(){function r(e,t,i){C(this,r);this.config=e;this.ucMain=i;var s=this.observer=new o.default;s.trigger=function e(t){for(var i=arguments.length,r=Array(i>1?i-1:0),n=1;n<i;n++){r[n-1]=arguments[n]}s.emit.apply(s,[t,t].concat(r))};s.off=function e(t){for(var i=arguments.length,r=Array(i>1?i-1:0),n=1;n<i;n++){r[n-1]=arguments[n]}s.removeListener.apply(s,[t].concat(r))};this.on=s.on.bind(s);this.off=s.off.bind(s);this.trigger=s.trigger.bind(s);this.jt1078=new u.default(this);this.websocketLoader=new d.default(this);this.socket=null;this.socketCreatedId=0;this.video_id=t;this.player=new w.default(this);this.playermode=w.default.PlayerMode.None;this.IsPlay=false;this.IsRequestPlay=false;this.ShowKBps=true}n(r,[{key:"destroy",value:function e(){if(this.websocketLoader){this.websocketLoader.destroy()}if(this.player){this.player.destory()}EventHandler.prototype.destroy.call(this)}},{key:"attachMedia",value:function e(t){var i=arguments.length>1&&arguments[1]!==undefined?arguments[1]:"chX";var r=arguments.length>2&&arguments[2]!==undefined?arguments[2]:"116.228.114.206:18002";this.media=t;this.trigger(s.default.MEDIA_ATTACHING,{media:t,channelName:i,websocketName:r})}},{key:"attachWebsocket",value:function e(t,i,r,n){this.trigger(s.default.WEBSOCKET_ATTACHING,{websocket:t,channelName:i,playerMode:this.playermode,onOpen:r,onCallback:n})}},{key:"createSocketAndSendCmd",value:function e(t,n,s){var a=this;this.Sim=t;this.Channel=n;var o=this.socketCreatedId;if(this.config.usingCluster){var c=1002;if(this.playermode===w.default.PlayerMode.Fmp4){c=1003}else if(this.playermode===w.default.PlayerMode.Webrtc){c=1003}else if(this.playermode==w.default.PlayerMode.Hls)c=1003;var d=new v.default;d.getConnByCluster(this.config["clusterHost"],this.config["clusterPort"],c,t,function(e,t){if(e==null){d.close()}else{var i=e.split(":");a.config["remoteHost"]=i[0];a.config["remotePort"]=i[1];if(o==a.socketCreatedId){a.CloseSocket();var r=void 0;if(c==1003&&i.length==3){r=b.default.GetWsp()+i[0]+":"+i[1];if(!a.jt1078.v2)a.jt1078=new u.default(a)}else{r=b.default.GetWsp()+e;if(!a.jt1078.v1)a.jt1078=new p.default(a);a.SetShowKBps(true,"")}a.player.SetRtvsAddr(a.config["remoteHost"]);a.socket=new WebSocket(r);t.ok=true;a.attachWebsocket(a.socket,"ch"+n,function(){s()});d.close()}}},this)}else{if(o==this.socketCreatedId){this.CloseSocket();this.config["remoteHost"]=this.config["clusterHost"];this.config["remotePort"]=this.config["clusterPort"];this.player.SetRtvsAddr(this.config["remoteHost"]);this.socket=new WebSocket(b.default.GetWsp()+this.config["remoteHost"]+":"+this.config["remotePort"]);this.attachWebsocket(this.socket,"ch"+n,function(){s()})}}}},{key:"GetServerInfo",value:function e(r){if(this.config.usingCluster){var t=1002;if(this.playermode===w.default.PlayerMode.Fmp4){t=1003}else if(this.playermode===w.default.PlayerMode.Webrtc){t=1003}else if(this.playermode==w.default.PlayerMode.Hls)t=1003;var n=new v.default;n.getConnByCluster(this.config["clusterHost"],this.config["clusterPort"],t,Sim,function(e,t){if(e==null){n.close()}else{var i=e.split(":");r(i[0],i[1])}},this)}else{r(this.config["clusterHost"],this.config["clusterPort"])}}},{key:"ShowKBpsText",value:function e(){if(this.ShowKBps&&this.playermode==w.default.PlayerMode.Fmp4){this.SetKBpsText(this.websocketLoader.trafficStat.getKBps().toFixed(2)+"KB/s")}else if(this.ShowKBps&&this.playermode==w.default.PlayerMode.Gov&&this.player.player!=null){this.SetKBpsText(this.player.player.trafficStat.getKBps().toFixed(2)+"KB/s")}}},{key:"SetShowKBps",value:function e(t,i){this.ShowKBps=t;if(i!=null&&this.IsPlaying()){this.SetKBpsText(i)}}},{key:"SetRealOrBack",value:function e(t){this.player.SetRealOrBack(t)}},{key:"SetBackDateTime",value:function e(t,i,r){var n=arguments.length>3&&arguments[3]!==undefined?arguments[3]:0;var s=arguments.length>4&&arguments[4]!==undefined?arguments[4]:0;var a=arguments.length>5&&arguments[5]!==undefined?arguments[5]:0;var o=arguments.length>6&&arguments[6]!==undefined?arguments[6]:0;var c=arguments.length>7&&arguments[7]!==undefined?arguments[7]:0;var d=arguments.length>8&&arguments[8]!==undefined?arguments[8]:0;t=b.default.SimLen12(t);this.Stop();var l=new Date(r);l.setHours(0);l.setMinutes(0);l.setSeconds(0);this.StartTime=parseInt(l.getTime()/1e3);l.setHours(23);l.setMinutes(59);l.setSeconds(59);this.EndTime=parseInt(l.getTime()/1e3);this.Sim=t;this.Channel=i;this.Alarm=s;this.MediaType=a;this.StreamType=o;this.StorageType=c;this.DataSource=d;this.player.QueryVideoListBegin();function u(e){if(h(e.FileList)!="object")return;this.player.AddVideoList(e,this.StartTime,this.EndTime);return}this.QueryVideoFileList(t,i,this.StartTime,this.EndTime,s,a,o,c,d,u.bind(this))}},{key:"PlayBackVideoByPlayer",value:function e(t,i){var r=this;var n=arguments.length>2&&arguments[2]!==undefined?arguments[2]:0;this.Stop();this.IsRequestPlay=true;n=this.SetPlayermode(n);var s=new Date(t*1e3).Format("yyyy-MM-dd hh:mm:ss");var a=new Date(i*1e3).Format("yyyy-MM-dd hh:mm:ss");this.player.PlayBackVideoBegin(this.Sim,this.Channel,s,a,this.StreamType,n);this.createSocketAndSendCmd(this.Sim,this.Channel,function(){r.IsPlay=true;if(r.config.priority!=0){r.jt1078.Send8881(r.Sim,r.Channel,r.config.priority)}r.jt1078.Send9201(r.Sim,r.Channel,r.MediaType,r.StreamType,r.StorageType,0,0,s,a,r.DataSource);r.ucMain.NowPlayVideosCount+=1})}},{key:"IsPlaying",value:function e(){return this.IsRequestPlay}},{key:"SetRotate",value:function e(t){this.player.SetRotate(t)}},{key:"SetMirrorInver",value:function e(t){this.player.SetMirrorInver()}},{key:"SetOsdVisible",value:function e(t){this.player.SetOsdVisible(t)}},{key:"GetVideoDiv",value:function e(){return this.player.GetVideoDiv()}},{key:"SetOsdColor",value:function e(t){this.player.SetOsdColor(t)}},{key:"SetOsdText",value:function e(t){this.player.SetOsdText(t)}},{key:"SetKBpsText",value:function e(t){this.player.SetKBpsText(t)}},{key:"ShowRecordText",value:function e(){this.player.ShowRecordText()}},{key:"SetMuted",value:function e(t){this.player.SetMuted(t)}},{key:"Capture",value:function e(t,i,r){return this.player.interface_player.Capture(t,i,r)}},{key:"SetPlayermode",value:function e(t){if(t==0)t=this.config.playerMode;if(t==0)t=this.GetPlayMode(true);this.playermode=t;return t}},{key:"GovPlay",value:function e(t,i){this.Stop();this.playermode=w.default.PlayerMode.Gov;this.IsRequestPlay=true;this.player.PlayRealVideoBegin(t,null,null,this.playermode);this.player.GovPlay(t,i);this.IsPlay=true;this.ucMain.NowPlayVideosCount+=1;this.SetShowKBps(true,"")}},{key:"StartRealTimeVideo",value:function e(t,i){var r=arguments.length>2&&arguments[2]!==undefined?arguments[2]:1;var n=arguments.length>3&&arguments[3]!==undefined?arguments[3]:true;var s=this;var a=arguments.length>4&&arguments[4]!==undefined?arguments[4]:0;var o=arguments.length>5&&arguments[5]!==undefined?arguments[5]:null;this.Stop();a=this.SetPlayermode(a);t=b.default.SimLen12(t);this.IsRequestPlay=true;this.player.PlayRealVideoBegin(t,i,r,a);if(a==w.default.PlayerMode.Webrtc){this.createSocketAndSendCmd(t,i,function(){s.IsPlay=true;if(n){s.jt1078.Send9101Webrtc(t,i,0,r)}else{s.jt1078.Send9101Webrtc(t,i,1,r)}s.ucMain.NowPlayVideosCount+=1})}else if(a==w.default.PlayerMode.Fmp4){this.createSocketAndSendCmd(t,i,function(){s.IsPlay=true;if(s.config.priority!=0){s.jt1078.Send8881(t,i,s.config.priority)}if(n){if(n==203){s.jt1078.Send9101(t,i,3,r)}else{s.jt1078.Send9101(t,i,0,r)}}else{s.jt1078.Send9101(t,i,1,r)}s.ucMain.NowPlayVideosCount+=1})}else if(a==w.default.PlayerMode.Hls){this.createSocketAndSendCmd(t,i,function(){s.IsPlay=true;if(n){s.jt1078.Send9101Rtmp(t,i,0,r)}else{s.jt1078.Send9101Rtmp(t,i,1,r)}s.ucMain.NowPlayVideosCount+=1})}else if(a==w.default.PlayerMode.Webrtc_srs){this.createSocketAndSendCmd(t,i,function(){s.IsPlay=true;if(n){s.jt1078.Send9101Rtmp(t,i,0,r)}else{s.jt1078.Send9101Rtmp(t,i,1,r)}s.ucMain.NowPlayVideosCount+=1})}}},{key:"AVTransferControl",value:function e(t,i,r,n,s){var a=this;t=b.default.SimLen12(t);if(this.IsPlay){this.jt1078.Send9102(t,i,r,n,s)}else{this.createSocketAndSendCmd(t,i,function(){a.jt1078.Send9102(t,i,r,n,s)})}}},{key:"PlaybackVideo",value:function e(t,i,r){var n=arguments.length>3&&arguments[3]!==undefined?arguments[3]:0;var s=arguments.length>4&&arguments[4]!==undefined?arguments[4]:0;var a=arguments.length>5&&arguments[5]!==undefined?arguments[5]:0;var o=arguments.length>6&&arguments[6]!==undefined?arguments[6]:0;var c=arguments[7];var d=arguments.length>8&&arguments[8]!==undefined?arguments[8]:"";var l=this;var u=arguments.length>9&&arguments[9]!==undefined?arguments[9]:0;var h=arguments.length>10&&arguments[10]!==undefined?arguments[10]:0;t=b.default.SimLen12(t);this.Stop();this.IsRequestPlay=true;u=this.SetPlayermode(u);this.player.PlayBackVideoBegin(t,i,c,d,r,u);if(u==w.default.PlayerMode.Webrtc){this.createSocketAndSendCmd(t,i,function(){l.IsPlay=true;l.jt1078.Send9201Webrtc(t,i,r,n,s,a,o,c,d,h);l.ucMain.NowPlayVideosCount+=1})}else if(u==w.default.PlayerMode.Fmp4){this.createSocketAndSendCmd(t,i,function(){l.IsPlay=true;if(l.config.priority!=0){l.jt1078.Send8881(t,i,l.config.priority)}l.jt1078.Send9201(t,i,r,n,s,a,o,c,d,h);l.ucMain.NowPlayVideosCount+=1})}else if(u==w.default.PlayerMode.Hls){this.createSocketAndSendCmd(t,i,function(){l.IsPlay=true;l.jt1078.Send9201Rtmp(t,i,r,n,s,a,o,c,d,h);l.ucMain.NowPlayVideosCount+=1})}}},{key:"PlaybackVideoControl",value:function e(t,i,r,n,s){var a=this;t=b.default.SimLen12(t);if(this.IsPlay){this.jt1078.Send9202(t,i,r,n,s)}else{this.createSocketAndSendCmd(t,i,function(){a.jt1078.Send9202(t,i,r,n,s)})}}},{key:"QueryVideoFileList",value:function e(t,i,r,n,s,a,o,c,d,l){t=b.default.SimLen12(t);var u=this.ucMain.get808Cmd(this.config,this);this.jt1078.Send9205(u,t,i,r,n,s,a,o,c,d,l)}},{key:"FtpVideoFileUpload",value:function e(t,i,r,n,s,a,o,c,d,l,u,h,f,p,m){t=b.default.SimLen12(t);var v=this.ucMain.get808Cmd(this.config,this);this.jt1078.Send9206(v,t,i,r,n,s,a,o,c,d,l,u,h,f,p,m)}},{key:"FtpVideoFileUploadControl",value:function e(t,i,r,n){var s=this;t=b.default.SimLen12(t);if(this.IsPlay){this.jt1078.Send9207(t,i,r,n)}else{this.createSocketAndSendCmd(t,i,function(){s.jt1078.Send9207(t,i,r,n)})}}},{key:"RotationControl",value:function e(t,i,r,n){var s=this;t=b.default.SimLen12(t);y.default.debug("下发云台旋转控制指令:0x9301");if(this.IsPlay){this.jt1078.Send9301(t,i,r,n)}else{this.createSocketAndSendCmd(t,i,function(){s.jt1078.Send9301(t,i,r,n)})}}},{key:"FocusControl",value:function e(t,i,r){var n=this;t=b.default.SimLen12(t);y.default.debug("下发云台调整焦距控制指令:0x9302");if(this.IsPlay){this.jt1078.Send9302(t,i,r)}else{this.createSocketAndSendCmd(t,i,function(){n.jt1078.Send9302(t,i,r)})}}},{key:"ApertureControl",value:function e(t,i,r){var n=this;t=b.default.SimLen12(t);y.default.debug("下发云台调整光圈控制指令:0x9303");if(this.IsPlay){this.jt1078.Send9303(t,i,r)}else{this.createSocketAndSendCmd(t,i,function(){n.jt1078.Send9303(t,i,r)})}}},{key:"WiperControl",value:function e(t,i,r){var n=this;t=b.default.SimLen12(t);y.default.debug("下发云台雨刷控制指令:0x9304");if(this.IsPlay){this.jt1078.Send9304(t,i,r)}else{this.createSocketAndSendCmd(t,i,function(){n.jt1078.Send9304(t,i,r)})}}},{key:"InfraredControl",value:function e(t,i,r){var n=this;t=b.default.SimLen12(t);y.default.debug("下发云台红外补光控制指令:0x9305");if(this.IsPlay){this.jt1078.Send9305(t,i,r)}else{this.createSocketAndSendCmd(t,i,function(){n.jt1078.Send9305(t,i,r)})}}},{key:"TimesControl",value:function e(t,i,r){var n=this;t=b.default.SimLen12(t);y.default.debug("下发云台变倍控制指令:0x9306");if(this.IsPlay){this.jt1078.Send9306(t,i,r)}else{this.createSocketAndSendCmd(t,i,function(){n.jt1078.Send9306(t,i,r)})}}},{key:"Stop",value:function e(){var t=this.IsRequestPlay;this.IsRequestPlay=false;this.player.StopPlay();this.CloseSocket();if(this.IsPlay){this.IsPlay=false;this.ucMain.NowPlayVideosCount-=1}if(t){if(this.config.events&&this.config.events.onStop){this.config.events.onStop(this.video_id,this)}}this.SetKBpsText("")}},{key:"CloseSocket",value:function e(){if(this.socket){y.default.debug("主动关闭连接");this.socket.close();this.socket=null;this.socketCreatedId++}}},{key:"Resize",value:function e(){this.player.interface_player.Resize()}},{key:"GetPlayMode",value:function e(t){var i=navigator.userAgent;var r=i.indexOf("Android")>-1||i.indexOf("Adr")>-1;var n=!!i.match(/\(i[^;]+;( U;)? CPU.+Mac OS X/);if(r){return w.default.PlayerMode.Fmp4}else if(n){if(t)return w.default.PlayerMode.Hls;else return w.default.PlayerMode.Hls}else{return w.default.PlayerMode.Fmp4}}}]);return r}();i.default=T},{"./JX/JTT1078":72,"./JX/JTT1078Old":73,"./events":77,"./loader/cluster-websocket-loader":80,"./loader/websocket-loader":82,"./player/PlayerMan":92,"./utils/cvComm":98,"./utils/logger":100,events:5}],76:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:true});var r=typeof Symbol==="function"&&typeof Symbol.iterator==="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol==="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};var s=function(){function r(e,t){for(var i=0;i<t.length;i++){var r=t[i];r.enumerable=r.enumerable||false;r.configurable=true;if("value"in r)r.writable=true;Object.defineProperty(e,r.key,r)}}return function(e,t,i){if(t)r(e.prototype,t);if(i)r(e,i);return e}}();function a(e,t){if(!(e instanceof t)){throw new TypeError("Cannot call a class as a function")}}var n=function(){function n(e){a(this,n);this.wfs=e;this.onEvent=this.onEvent.bind(this);for(var t=arguments.length,i=Array(t>1?t-1:0),r=1;r<t;r++){i[r-1]=arguments[r]}this.handledEvents=i;this.useGenericHandler=true;this.registerListeners()}s(n,[{key:"destroy",value:function e(){this.unregisterListeners()}},{key:"isEventHandler",value:function e(){return r(this.handledEvents)==="object"&&this.handledEvents.length&&typeof this.onEvent==="function"}},{key:"registerListeners",value:function e(){if(this.isEventHandler()){this.handledEvents.forEach(function(e){if(e==="wfsEventGeneric"){}this.wfs.on(e,this.onEvent)}.bind(this))}}},{key:"unregisterListeners",value:function e(){if(this.isEventHandler()){this.handledEvents.forEach(function(e){this.wfs.off(e,this.onEvent)}.bind(this))}}},{key:"onEvent",value:function e(t,i){this.onEventGeneric(t,i)}},{key:"onEventGeneric",value:function e(t,i){var r=function e(t,i){var r="on"+t.replace("wfs","");if(typeof this[r]!=="function"){}return this[r].bind(this,i)};try{r.call(this,t,i).call()}catch(e){console.log("internal error happened while processing "+t+":"+e.message)}}}]);return n}();i.default=n},{}],77:[function(e,t,i){"use strict";t.exports={MEDIA_ATTACHING:"wfsMediaAttaching",MEDIA_ATTACHED:"wfsMediaAttached",FRAG_LOADING:"wfsFragLoading",BUFFER_CREATED:"wfsBufferCreated",BUFFER_APPENDING:"wfsBufferAppending",BUFFER_RESET:"wfsBufferReset",FRAG_PARSING_DATA:"wfsFragParsingData",FRAG_PARSING_INIT_SEGMENT:"wfsFragParsingInitSegment",H264_DATA_PARSING:"wfsH264DataParsing",WEBSOCKET_ATTACHED:"wfsWebsocketAttached",WEBSOCKET_ATTACHING:"wfsWebsocketAttaching",WEBSOCKET_DATA_UPLOADING:"wfsWebsocketDataUploading",WEBSOCKET_MESSAGE_SENDING:"wfsWebsocketMessageSending",WEBSOCKET_CLOSE:"wfsWebsocketClose",WEBSOCKET_OPEN:"wfsWebsocketOpen",FILE_HEAD_LOADING:"wfsFileHeadLoading",FILE_HEAD_LOADED:"wfsFileHeadLoaded",FILE_DATA_LOADING:"wfsFileDataLoading",FILE_DATA_LOADED:"wfsFileDataLoaded",FILE_PARSING_DATA:"wfsFileParsingData",JT1078_DATA_PARSING:"wfsJT1078DataParsing",JT1078_PCM_OUT:"wfsJT1078PcmOut",JT1078_RGB_OUT:"wfsJT1078RgbOut",JT1078ToFMp4_DATA_PARSING:"wfsJT1078ToFMp4DataParsing",WEBRTC_SFU_INFO:"wfsWebrtcSFUInfo",HLS_INFO:"wfsHlsInfo",SPEEK_DATA:"wfsSpeekParsingData",WEBRTC_SRS_MSG:"wfsWebrtcSrsInfo"}},{}],78:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:true});var n=function(){function r(e,t){for(var i=0;i<t.length;i++){var r=t[i];r.enumerable=r.enumerable||false;r.configurable=true;if("value"in r)r.writable=true;Object.defineProperty(e,r.key,r)}}return function(e,t,i){if(t)r(e.prototype,t);if(i)r(e,i);return e}}();var r=e("../utils/long");var s=a(r);function a(e){return e&&e.__esModule?e:{default:e}}function o(e,t){if(!(e instanceof t)){throw new TypeError("Cannot call a class as a function")}}var c=function(){function r(){o(this,r)}n(r,[{key:"toHex",value:function e(t){return r.toHex(t)}}],[{key:"concatenate",value:function e(t,i){var r=0;var n=true;var s=false;var a=undefined;try{for(var o=i[Symbol.iterator](),c;!(n=(c=o.next()).done);n=true){var d=c.value;r+=d.length}}catch(e){s=true;a=e}finally{try{if(!n&&o.return){o.return()}}finally{if(s){throw a}}}var l=new t(r);var u=0;var h=true;var f=false;var p=undefined;try{for(var m=i[Symbol.iterator](),v;!(h=(v=m.next()).done);h=true){var g=v.value;l.set(g,u);u+=g.length}}catch(e){f=true;p=e}finally{try{if(!h&&m.return){m.return()}}finally{if(f){throw p}}}return l}},{key:"toHex",value:function e(t){var i=t.toString(16);if(i.length<2){return"0"+i}return i}},{key:"Byte2ToUInt",value:function e(t,i){return t[i+1]|t[i]<<8}},{key:"Byte4ToUInt",value:function e(t,i){return t[i+3]|t[i+2]<<8|t[i+1]<<16|t[i]<<24}},{key:"BcdToString",value:function e(t,i,r){var n="";for(var s=0;s<r/2;s++){n+=this.toHex(t[i+s])}return n}},{key:"StringTimeToUnixLong",value:function e(t){var i=parseInt("20"+t.substring(0,2));var r=parseInt(t.substring(2,4));var n=parseInt(t.substring(4,6));var s=parseInt(t.substring(6,8));var a=parseInt(t.substring(8,10));var o=parseInt(t.substring(10,12));if(n==0||r==0||r>12||n>31||s>24||a>60||o>60){return}var c=i+"-"+r+"-"+n+" "+s+":"+a+":"+o;return parseInt(new Date(c).getTime()/1e3)}},{key:"StringToBcd",value:function e(t,i,r,n){while(r.length<n){r="0"+r}for(var s=0;s<n/2;s++){t[i+s]=parseInt("0x"+r.substring(s*2,s*2+2))}}},{key:"Byte8ToULong",value:function e(t,i){return new s.default(r.Byte4ToUInt(t,i+4),r.Byte4ToUInt(t,i),true)}},{key:"UIntToByte2",value:function e(t,i,r){t[i++]=r>>8&255;t[i++]=r&255}},{key:"IntToByte4",value:function e(t,i,r){t[i++]=r>>24&255;t[i++]=r>>16&255;t[i++]=r>>8&255;t[i++]=r&255}},{key:"ULongToByte8",value:function e(t,i,r){if(!s.default.isLong(r)){r=s.default.fromString(r.toString(),true)}var n=r.toBytesBE();t[i++]=n[0];t[i++]=n[1];t[i++]=n[2];t[i++]=n[3];t[i++]=n[4];t[i++]=n[5];t[i++]=n[6];t[i++]=n[7]}},{key:"StringToGBK",value:function e(t,i,r){for(var n=0;n<r.length;n++){t[i+n]=r.charCodeAt(n)}return r.length}},{key:"GBKToString",value:function e(t,i,r){if(i===undefined){i=0}if(r===undefined){r=t.length}var n="";for(var s=0;s<r;s++){n+=String.fromCharCode(t[s+i])}return n}},{key:"Utf8ArrayToStr",value:function e(t,i,r){if(i===undefined){i=0}if(r===undefined){r=t.length}var n,s,r,a;var o,c;n="";r=r;s=i;while(s-i<r){a=t[s++];switch(a>>4){case 0:case 1:case 2:case 3:case 4:case 5:case 6:case 7:n+=String.fromCharCode(a);break;case 12:case 13:o=t[s++];n+=String.fromCharCode((a&31)<<6|o&63);break;case 14:o=t[s++];c=t[s++];n+=String.fromCharCode((a&15)<<12|(o&63)<<6|(c&63)<<0);break}}return n}}]);return r}();i.default=c},{"../utils/long":101}],79:[function(e,t,i){"use strict";t.exports=e("./CVNetVideo.js").default},{"./CVNetVideo.js":71}],80:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:true});var r=function(){function r(e,t){for(var i=0;i<t.length;i++){var r=t[i];r.enumerable=r.enumerable||false;r.configurable=true;if("value"in r)r.writable=true;Object.defineProperty(e,r.key,r)}}return function(e,t,i){if(t)r(e.prototype,t);if(i)r(e,i);return e}}();var n=e("../helper/ByteHelper");var s=l(n);var a=e("../utils/logger");var o=l(a);var c=e("../utils/cvComm");var d=l(c);function l(e){return e&&e.__esModule?e:{default:e}}function u(e,t){if(!(e instanceof t)){throw new TypeError("Cannot call a class as a function")}}var h=function(){function e(){u(this,e)}r(e,[{key:"destroy",value:function e(){}},{key:"getConnByCluster",value:function e(t,i,r,n,s,a){this.wfs=a;this.clusterHost=t;this.clusterPort=i;this.callback=s;this.type=r;this.tag=n;if(d.default.IsHttps()&&this.type==1003){this.n1006=true}this.client=new WebSocket(d.default.GetWsp()+t+":"+i);this.ok=false;this.client.onopen=this.initSocketClient.bind(this);this.client.onclose=this.closeSocket.bind(this)}},{key:"close",value:function e(){this.client.close()}},{key:"closeSocket",value:function e(t){o.default.debug("ClusterWebsocket Disconnected!");if(this.n1006){this.n1006=false;this.client=new WebSocket(d.default.GetWsp()+this.clusterHost+":"+this.clusterPort);this.client.onopen=this.initSocketClient.bind(this);this.client.onclose=this.closeSocket.bind(this)}else if(!this.ok){if(this.wfs.SetShowKBps){this.wfs.SetShowKBps(false,"连接服务器失败")}if(this.wfs.config.events){if(this.wfs.config.events.onWsClose){this.wfs.config.events.onWsClose(this.wfs.video_id,this.wfs)}if(this.wfs.config.events.onServerNotice){this.wfs.config.events.onServerNotice("onWsClose",this.wfs.video_id,this.wfs)}}}}},{key:"initSocketClient",value:function e(t){this.client.binaryType="arraybuffer";this.client.onmessage=this.receiveSocketMessage.bind(this);o.default.debug("ClusterWebsocket Open!");var i=5;if(this.tag!==undefined&&this.tag!==null){i+=this.tag.length}var r=new Uint8Array(i);r[0]=1;if(this.n1006)s.default.IntToByte4(r,1,1006);else s.default.IntToByte4(r,1,this.type);if(this.tag!==undefined&&this.tag!==null){s.default.StringToGBK(r,5,this.tag)}this.client.send(r)}},{key:"receiveSocketMessage",value:function e(t){var i=new Uint8Array(t.data);var r=s.default.GBKToString(i);if(this.n1006&&r!==null){var n=r.split(":");if(n.length==3){r=n[0]+":"+n[1]+"/"+this.type+":"+n[2]}else r+="/"+this.type}this.n1006=false;this.callback(r,this)}}]);return e}();i.default=h},{"../helper/ByteHelper":78,"../utils/cvComm":98,"../utils/logger":100}],81:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:true});var r=function(){function r(e,t){for(var i=0;i<t.length;i++){var r=t[i];r.enumerable=r.enumerable||false;r.configurable=true;if("value"in r)r.writable=true;Object.defineProperty(e,r.key,r)}}return function(e,t,i){if(t)r(e.prototype,t);if(i)r(e,i);return e}}();var n=e("../JX/JTT1078");var a=p(n);var s=e("../utils/queue");var o=p(s);var c=e("./cluster-websocket-loader");var d=p(c);var l=e("../utils/logger");var u=p(l);var h=e("../utils/cvComm");var f=p(h);function p(e){return e&&e.__esModule?e:{default:e}}function m(e,t){if(!(e instanceof t)){throw new TypeError("Cannot call a class as a function")}}var v=function(){function i(e,t){m(this,i);this.config=e;this.wfs=t;this.websocket=undefined;this.medisPackageAnalysis=new a.default.MedisPackageAnalysis;this.splitData=new a.default.SplitData;this.checkHelper=new a.default.CheckHelper;this.AllSimPackData={};this.sendCache=new o.default;this.onCallback={};this.msg_serial_number=0}r(i,[{key:"connect",value:function e(){var i=this;if(this.config.usingCluster){var r=new d.default;r.getConnByCluster(this.config.clusterHost,this.config.clusterPort,1002,null,function(e){if(e==null){r.close()}else{var t=e.split(":");i.config.remoteHost=t[0];i.config.remotePortWs=t[1];r.close();i.wsconnect(i.config.remoteHost,i.config.remotePortWs,e)}},this.wfs)}else{this.wsconnect(this.config.remoteHost,this.config.remotePortWs)}}},{key:"wsconnect",value:function e(t,i,r){this.host=t;this.port=i;var n=f.default.GetWsp();if(r==null){n+=this.host+":"+this.port}else{n+=r}this.websocket=new WebSocket(n);this.websocket.onopen=this.openSocket.bind(this);this.websocket.onclose=this.closeSocket.bind(this);this.websocket.binaryType="arraybuffer";this.websocket.onmessage=this.receiveSocketMessage.bind(this)}},{key:"closeSocket",value:function e(t){u.default.debug("Websocket808 Disconnected!")}},{key:"openSocket",value:function e(){u.default.debug("Websocket808 Open!");while(this.sendCache.size()>0){this.sendData(this.sendCache.dequeue())}}},{key:"receiveSocketMessage",value:function e(t){var i=this;var r=new Uint8Array(t.data);this.splitData.SplitDataBy7E(r,18,r.byteLength-18,function(e){if(e.length>11&&i.checkHelper.CheckXOR(e,0,e.length-1)===e[e.length-1]){i.JX808DataPD(new Uint8Array(e))}})}},{key:"JX808DataPD",value:function e(t){var i=new a.default.JTHeader;i.FillByBinary(t,0);if(i.PackInfo){var r=a.default.GetFirstSerialNumber(i);var n=this.AllSimPackData[i.Sim];if(!n){n={};this.AllSimPackData[i.Sim]=n}var s=n[r];if(s){if(!s.PackData[i.PackInfo.Index]){s.PackData.Count+=1;s.PackData.totalLength+=i.MsgLen}s.PackData[i.PackInfo.Index]=a.default.GetMsbBody(i,t);s.LastRTime=new Date;if(this.CheckPackByPD(s))n[r]=null}else{s={};s.PackData={};s.PackData[i.PackInfo.Index]=a.default.GetMsbBody(i,t);s.PackData.Count=1;s.PackData.totalLength=i.MsgLen;s.Head=new a.default.JTHeader(i.MsgId,i.Sub,i.DataEncryptType,i.MsgLen,i.Sim,r);s.Head.PackInfo=new a.default.JTPackageInfo(1,i.PackInfo.Sum);s.StartTime=s.LastRTime=new Date;n[r]=s}}else{this.JX808Data(i,a.default.GetMsbBody(i,t))}}},{key:"CheckPackByPD",value:function e(t){if(t.PackData.Count===t.Head.PackInfo.Sum){var i=new Uint8Array(t.PackData.totalLength);var r=0;for(var n=1;n<=t.Head.PackInfo.Sum;n++){i.set(t.PackData[n],r);r+=t.PackData[n].byteLength}try{this.JX808Data(t.Head,i)}catch(e){console.error(e);return true}return true}return false}},{key:"JX808Data",value:function e(t,i){switch(t.MsgId){case 4613:var r=new a.default.JTVideoListInfo;r.FillByBinary(i,0);var n=this.onCallback[4613+":"+r.SerialNumber];if(n){delete this.onCallback[4613+":"+r.SerialNumber];n(r)}break;case 4614:var s=new a.default.JTVideoFileUploadEndInform;s.FillByBinary(i,0);this.onCallback[4614](s);break;default:}}},{key:"printState",value:function e(){switch(this.websocket.readyState){case 0:u.default.debug("Websocket808 readyState=CONNECTING");break;case 1:u.default.debug("Websocket808 readyState=OPEN");break;case 2:u.default.debug("Websocket808 readyState=CLOSING");break;case 3:u.default.debug("Websocket808 readyState=CLOSED");break}}},{key:"sendData",value:function e(t){this.websocket.send(t)}},{key:"sendMessage",value:function e(t,i,r,n){if(i){if(n!==undefined){r=r+":"+n}this.onCallback[r]=i}if(this.websocket===undefined||this.websocket.readyState===0){this.sendCache.enqueue(t)}else if(this.websocket.readyState===2||this.websocket.readyState===3){this.printState();this.sendCache.enqueue(t);this.connect()}else{this.sendData(t)}}}]);return i}();i.default=v},{"../JX/JTT1078":72,"../utils/cvComm":98,"../utils/logger":100,"../utils/queue":102,"./cluster-websocket-loader":80}],82:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:true});var r=function(){function r(e,t){for(var i=0;i<t.length;i++){var r=t[i];r.enumerable=r.enumerable||false;r.configurable=true;if("value"in r)r.writable=true;Object.defineProperty(e,r.key,r)}}return function(e,t,i){if(t)r(e.prototype,t);if(i)r(e,i);return e}}();var n=e("../events");var p=f(n);var s=e("../event-handler");var a=f(s);var o=e("../JX/JTT1078");var m=f(o);var c=e("../player/PlayerMan.js");var v=f(c);var d=e("../utils/logger");var l=f(d);var u=e("../utils/trafficStat");var h=f(u);function f(e){return e&&e.__esModule?e:{default:e}}function g(e,t){if(!(e instanceof t)){throw new TypeError("Cannot call a class as a function")}}function y(e,t){if(!e){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return t&&(typeof t==="object"||typeof t==="function")?t:e}function _(e,t){if(typeof t!=="function"&&t!==null){throw new TypeError("Super expression must either be null or a function, not "+typeof t)}e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:false,writable:true,configurable:true}});if(t)Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t}var b=function(e){_(i,e);function i(e){g(this,i);var t=y(this,(i.__proto__||Object.getPrototypeOf(i)).call(this,e,p.default.WEBSOCKET_ATTACHING,p.default.WEBSOCKET_DATA_UPLOADING,p.default.WEBSOCKET_MESSAGE_SENDING));t.buf=null;t.channelName=undefined;t.onOpen=undefined;t.trafficStat=new h.default;t.isClose=true;return t}r(i,[{key:"destroy",value:function e(){a.default.prototype.destroy.call(this)}},{key:"onWebsocketAttaching",value:function e(t){this.channelName=t.channelName;this.onOpen=t.onOpen;this.playermode=t.playerMode;if(t.websocket instanceof WebSocket){this.client=t.websocket;this.client.onopen=this.initSocketClient.bind(this);this.client.onclose=this.closeSocket.bind(this)}}},{key:"closeSocket",value:function e(t){if(this.wfs.SetShowKBps){if(this.isClose)this.wfs.SetShowKBps(false,"连接服务器失败");else this.wfs.SetShowKBps(false,"传输完成")}this.isClose=true;if(this.wfs.config.events){if(this.wfs.config.events.onWsClose){this.wfs.config.events.onWsClose(this.wfs.video_id,this.wfs)}if(this.wfs.config.events.onServerNotice){this.wfs.config.events.onServerNotice("onWsClose",this.wfs.video_id,this.wfs)}}l.default.debug("Websocket Disconnected!");this.wfs.trigger(p.default.WEBSOCKET_CLOSE,{e:t})}},{key:"initSocketClient",value:function e(t){this.first_msg=false;this.isClose=false;this.client.binaryType="arraybuffer";this.client.onmessage=this.receiveSocketMessage.bind(this);if(this.onOpen){this.onOpen()}l.default.debug("Websocket Open!")}},{key:"Utf8ArrayToStr",value:function e(t){var i,r,n,s;var a,o;i="";n=t.length;r=0;while(r<n){s=t[r++];switch(s>>4){case 0:case 1:case 2:case 3:case 4:case 5:case 6:case 7:i+=String.fromCharCode(s);break;case 12:case 13:a=t[r++];i+=String.fromCharCode((s&31)<<6|a&63);break;case 14:a=t[r++];o=t[r++];i+=String.fromCharCode((s&15)<<12|(a&63)<<6|(o&63)<<0);break}}return i}},{key:"receiveSocketMessage",value:function e(t){this.trafficStat.addbytes(t.data.byteLength);var i=new Uint8Array(t.data);if(i[0]==126&&i[i.length-1]==126){var r=new m.default.JTHeader;r.FillByBinary(i,1);if(this.JX808Data(r,i,r.GetLength()+1)){return}}if(this.playermode===v.default.PlayerMode.Webrtc_srs){var n=String.fromCharCode.apply(null,i);var s=JSON.parse(n);this.wfs.trigger(p.default.WEBRTC_SRS_MSG,s)}if(this.playermode===v.default.PlayerMode.Webrtc){var a=String.fromCharCode.apply(null,i);var o=JSON.parse(a);this.wfs.trigger(p.default.WEBRTC_SFU_INFO,o);return}if(this.playermode===v.default.PlayerMode.Fmp4){if(!this.first_msg){if(i.length>5&&i[0]==0&&i[1]==0&&i[2]==1&&i[3]==153){}else{if(i.length!==5||i[0]!==119||i[1]!==119)return;var c=i[2].toString(16).length===1?"0"+i[2].toString(16):i[2].toString(16);var d=i[3].toString(16).length===1?"0"+i[3].toString(16):i[3].toString(16);var l=i[4].toString(16).length===1?"0"+i[4].toString(16):i[4].toString(16);var u="avc1."+c+d+l+",mp4a.40.2";this.wfs.trigger(p.default.BUFFER_RESET,{mimeType:u});this.first_msg=true;return}}else{this.wfs.trigger(p.default.BUFFER_APPENDING,{type:"video",data:i})}return}if(this.playermode===v.default.PlayerMode.Hls){var h=String.fromCharCode.apply(null,i);var f=JSON.parse(h);this.wfs.trigger(p.default.HLS_INFO,f)}if(this.playermode===v.default.PlayerMode.Speek){this.wfs.trigger(p.default.SPEEK_DATA,{type:"Audio",data:i})}}},{key:"JX808Data",value:function e(t,i,r){switch(t.MsgId){case 34960:var n=new m.default.JT0x8890;n.FillByBinary(i,r);if(this.wfs.config.events){if(n.NType==0){if(this.wfs.SetShowKBps){this.wfs.SetShowKBps(true,"设备连接");this.trafficStat.getKBps()}if(this.wfs.config.events.onDevConnect){this.wfs.config.events.onDevConnect(this.wfs.video_id,this.wfs)}if(this.wfs.config.events.onServerNotice){this.wfs.config.events.onServerNotice("onDevConnect",this.wfs.video_id,this.wfs)}}if(n.NType==1){if(this.wfs.config.events.onDevDisconnect){this.wfs.config.events.onDevDisconnect(this.wfs.video_id,this.wfs)}if(this.wfs.config.events.onServerNotice){this.wfs.config.events.onServerNotice("onDevDisconnect",this.wfs.video_id,this.wfs)}if(this.wfs.SetShowKBps)this.wfs.SetShowKBps(false,"设备断开")}if(n.NType==2){if(this.wfs.config.events.onEndByServer){if(this.wfs.config.events.onEndByServer(n.Notice,this.wfs.video_id,this.wfs)){this.wfs.CloseSocket();return true}}this.wfs.Stop()}}return true;case 2185:var s=new m.default.JT0x0889;s.FillByBinary(i,r,t.MsgLen);this.wfs.trigger(p.default.WEBRTC_SFU_INFO,JSON.parse(s.Url));return true;default:}return false}},{key:"onWebsocketDataUploading",value:function e(t){if(this.client.readyState==WebSocket.CONNECTING||this.client.readyState==WebSocket.CLOSING||this.client.readyState==WebSocket.CLOSED)return;this.client.send(t.data)}},{key:"onWebsocketMessageSending",value:function e(t){this.client.send(JSON.stringify({t:t.commandType,c:t.channelName,v:t.commandValue}))}}]);return i}(a.default);i.default=b},{"../JX/JTT1078":72,"../event-handler":76,"../events":77,"../player/PlayerMan.js":92,"../utils/logger":100,"../utils/trafficStat":103}],83:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:true});var r=function(){function r(e,t){for(var i=0;i<t.length;i++){var r=t[i];r.enumerable=r.enumerable||false;r.configurable=true;if("value"in r)r.writable=true;Object.defineProperty(e,r.key,r)}}return function(e,t,i){if(t)r(e.prototype,t);if(i)r(e,i);return e}}();var n=e("../../utils/logger");var s=a(n);function a(e){return e&&e.__esModule?e:{default:e}}function o(e,t){if(!(e instanceof t)){throw new TypeError("Cannot call a class as a function")}}var c=function(){function e(){o(this,e);this.track=null;this.audioInput=null;this.recorder=null}r(e,[{key:"Start",value:function e(i){navigator.getUserMedia=this.GetUserMedia();var t=window.AudioContext||window.webkitAudioContext;var r=new t;var n={};n.channelCount=1;n.numberOfInputChannels=n.channelCount;n.numberOfOutputChannels=n.channelCount;n.bufferSize=2048;navigator.mediaDevices.getUserMedia({audio:true,video:false}).then(function(e){this.track=e.getTracks()[0];this.audioInput=r.createMediaStreamSource(e);this.recorder=r.createScriptProcessor(n.bufferSize,1,1);this.recorder.onaudioprocess=function(e){var t=e.inputBuffer.getChannelData(0);if(this.recorder){i(t,t.length)}}.bind(this);this.audioInput.connect(this.recorder);this.recorder.connect(r.destination)}.bind(this)).catch(function(e){s.default.warn("navigator.mediaDevices.getUserMedia err:"+e)})}},{key:"Stop",value:function e(){if(this.track){this.track.stop();this.track=null}if(this.audioInput){this.audioInput.disconnect(this.recorder);this.audioInput=null;this.recorder.context.close();this.recorder=null}}},{key:"GetUserMedia",value:function e(){return navigator.getUserMedia||navigator.webkitGetUserMedia||navigator.mozGetUserMedia||navigator.msGetUserMedia}},{key:"GetRawDate",value:function e(){}},{key:"GetSampleRate",value:function e(){return this.recorder.context.sampleRate}}]);return e}();i.default=c},{"../../utils/logger":100}],84:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:true});var r=function(){function r(e,t){for(var i=0;i<t.length;i++){var r=t[i];r.enumerable=r.enumerable||false;r.configurable=true;if("value"in r)r.writable=true;Object.defineProperty(e,r.key,r)}}return function(e,t,i){if(t)r(e.prototype,t);if(i)r(e,i);return e}}();var n=e("../../utils/logger");var s=c(n);var a=e("../../utils/queue");var o=c(a);function c(e){return e&&e.__esModule?e:{default:e}}function d(e,t){if(!(e instanceof t)){throw new TypeError("Cannot call a class as a function")}}var l=function(){function i(e,t){d(this,i);this.is_start=false;this.audio_context=null;this.config=e;this.pcmQueue=new o.default;this.pcmQueue.pcmlen=0;this.audioSpeek=t;this.cache=new Array;this.cachedatalen=0}r(i,[{key:"destroy",value:function e(){this.Stop()}},{key:"Start",value:function e(){if(this.audio_context==null){window.AudioContext=window.AudioContext||window.webkitAudioContext||window.mozAudioContext||window.msAudioContext;try{this.audio_context=new window.AudioContext}catch(e){s.default.warn("dont support audio context!")}}if(!this.is_start){this.is_start=true;window.tmpAudioPlay=this;this.PlayPCM()}}},{key:"Stop",value:function e(){this.is_start=false;this.pcmQueue.clear();this.pcmQueue.pcmlen=0;this.cache=new Array;this.cachedatalen=0}},{key:"InputDate",value:function e(t,i){this.cache.push({data:t,len:i});this.cachedatalen+=i;if(this.cachedatalen>=this.config.pcmCacheSec*this.GetSampleRate()){this.pcmQueue.enqueue({array:this.cache,datalen:this.cachedatalen});this.pcmQueue.pcmlen+=this.cachedatalen;this.cache=new Array;this.cachedatalen=0}}},{key:"PlayPCM",value:function e(){if(this.is_start){try{var t=this.pcmQueue.dequeueall();var i=this.pcmQueue.pcmlen;this.pcmQueue.pcmlen=0;if(t.length){var r=this.audio_context;var n=r.createBuffer(1,i,r.sampleRate);var s=0;if(n.copyToChannel){for(var a=0;a<t.length;a++){var o=t[a];for(var c=0;c<o.array.length;c++){n.copyToChannel(o.array[c].data,0,s);s+=o.array[c].len}}}else{var d=n.getChannelData(0);for(var a=0;a<t.length;a++){var l=t[a];for(var c=0;c<l.array.length;c++){d.set(l.array[c].data,s);s+=l.array[c].len}}}var u=r.createBufferSource();u.connect(r.destination);u.buffer=n;var h=this;u.onended=function(){u.disconnect(r.destination);h.PlayPCM()};u.start();return}}catch(e){console.error(e)}if(this.is_start){setTimeout(this.PlayPCM.bind(this),200)}}}},{key:"GetSampleRate",value:function e(){return this.audio_context.sampleRate}}]);return i}();i.default=l},{"../../utils/logger":100,"../../utils/queue":102}],85:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:true});var r=function(){function r(e,t){for(var i=0;i<t.length;i++){var r=t[i];r.enumerable=r.enumerable||false;r.configurable=true;if("value"in r)r.writable=true;Object.defineProperty(e,r.key,r)}}return function(e,t,i){if(t)r(e.prototype,t);if(i)r(e,i);return e}}();var n=e("../../loader/websocket-loader");var s=C(n);var a=e("../../loader/cluster-websocket-loader");var c=C(a);var o=e("../../JX/JTT1078");var d=C(o);var l=e("./AudioCapture");var u=C(l);var h=e("./AudioPlay");var f=C(h);var p=e("../PlayerMan");var m=C(p);var v=e("../../events");var g=C(v);var y=e("../../event-handler");var _=C(y);var b=e("../../utils/logger");var S=C(b);var w=e("../../utils/cvComm");var k=C(w);function C(e){return e&&e.__esModule?e:{default:e}}function T(e,t){if(!(e instanceof t)){throw new TypeError("Cannot call a class as a function")}}function P(e,t){if(!e){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return t&&(typeof t==="object"||typeof t==="function")?t:e}function R(e,t){if(typeof t!=="function"&&t!==null){throw new TypeError("Super expression must either be null or a function, not "+typeof t)}e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:false,writable:true,configurable:true}});if(t)Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t}var x=function(e){R(i,e);function i(e){T(this,i);var t=P(this,(i.__proto__||Object.getPrototypeOf(i)).call(this,e,g.default.SPEEK_DATA));t.number=0;t.pts=0;t.pts_package=0;t.config=e.config;t.config.playermode=m.default.PlayerMode.Speek;t.playermode=m.default.PlayerMode.Speek;t.socket=null;t.socketCreatedId=0;t.websocketLoader=new s.default(e);t.jt1078=new d.default(e);t.audiocapture=new u.default;if(t.config.maxPcmQueueCount==0){t.audioplay=new AudioPlayNoQueue(t.config)}else{t.audioplay=new f.default(t.config,t)}t.maxPcmQueueCount=t.config.maxPcmQueueCount;t.codec_type=26;t.channel=1;t.sample_rate=8e3;t.sample_bit=16;t.frame_length=168;t.has_haisi=1;t.decoder_id=-1;t.encoder_id=-1;t.first_pts=-1;t.first_time=-1;t.m_first_pts=0;t.m_total_pts=0;t.wasm_codec_type=-1;return t}r(i,[{key:"destory",value:function e(){this.websocketLoader.destroy()}},{key:"StartSpeek",value:function e(t,i){var r=this;this.number=0;this.pts=0;this.pts_package=0;this.audioplay.Start();this.sim=t;this.channel=i;this.m_first_pts=0;this.m_total_pts=0;this.first_msg=false;this.createSocketAndSendCmd(t,i,function(){r.jt1078.Send9101(t,i,2,0)})}},{key:"StopSpeek",value:function e(){this.CloseSocket();if(this.decoder_id!=-1){CvNetVideo.WASM.AudioDecoderClear(this.decoder_id);this.decoder_id=-1}if(this.encoder_id!=-1){CvNetVideo.WASM.AudioEncoderClear(this.encoder_id);this.encoder_id=-1}this.audioplay.Stop();this.audiocapture.Stop()}},{key:"InputPcmData",value:function e(t,i,r){this.audioplay.InputDate(i,r)}},{key:"InputEncodeAudio",value:function e(t,i,r){if(this.first_pts==-1){this.first_pts=this.pts;this.first_time=new Date;this.jt1078.SendAudio(this.sim,this.channel,i,this.number,this.codec_type,this.pts)}else{if(this.config.speekSendMode==0){this.jt1078.SendAudio(this.sim,this.channel,i,this.number,this.codec_type,this.pts)}else{var n=this.pts-this.first_pts;var s=(new Date).getTime()-this.first_time.getTime();if(s<n){var a=new Uint8Array(i.length);a.set(i,0);var o={sim:this.sim,channel:this.channel,number:this.number,codec_type:this.codec_type,pts:this.pts,data:a};setTimeout(function(){this.jt1078.SendAudio(o.sim,o.channel,o.data,o.number,o.codec_type,o.pts)}.bind(this),n-s)}else{this.jt1078.SendAudio(this.sim,this.channel,i,this.number,this.codec_type,this.pts)}}}if(this.pts_package==0){var c=0;if(this.has_haisi){c=r-4}else{c=r}switch(this.codec_type){case 6:case 7:c=c*2;break;case 8:c=c*4;break;case 26:c=(c-4)*4}this.pts_package=Math.floor(c*1e3/16e3)}this.pts+=this.pts_package;this.number++;if(this.number>=65535){this.number=0}}},{key:"onSpeekParsingData",value:function e(t){var i=t.data;if(!this.first_msg){if(i.length==11&&i[0]==0&&i[1]==0&&i[2]==1&&i[3]==145){if(i[4]==6||i[4]==7||i[4]==8||i[4]==26||i[4]==19){this.codec_type=i[4];switch(i[6]){case 0:this.sample_rate=8e3;break;case 1:this.sample_rate=22050;break;case 2:this.sample_rate=44100;break;case 3:this.sample_rate=48e3;break}switch(i[7]){case 0:this.sample_bit=8;break;case 1:this.sample_bit=16;break;case 2:this.sample_bit=32;break}this.AudioFrameLength=(i[8]<<8)+i[9];this.frame_length=this.AudioFrameLength;this.has_haisi=i[10];this.bits_per_coded_sample=4;this.wasm_codec_type=this.codec_type;switch(this.codec_type){case 6:case 7:this.frame_length=320;break;case 8:this.bits_per_coded_sample=CvNetVideo.g726_conf.get_bits_per_coded_sample(this.AudioFrameLength);this.frame_length=this.bits_per_coded_sample*40;this.pts_package=40;switch(this.bits_per_coded_sample){case 2:this.wasm_codec_type=CvNetVideo.WASM.JX_G726_16K;break;case 3:this.wasm_codec_type=CvNetVideo.WASM.JX_G726_24K;break;case 5:this.wasm_codec_type=CvNetVideo.WASM.JX_G726_40K;break}break;case 26:this.frame_length=164;break}}this.first_pts=-1;if(this.config.events&&this.config.events.onStartSpeek){this.config.events.onStartSpeek()}this.audiocapture.Start(function(e,t){if(this.encoder_id==-1){S.default.debug("codectype:%d, samplerate:%d, haisi:%d, frame_length:%d",this.codec_type,this.audiocapture.GetSampleRate(),this.has_haisi,this.frame_length);this.encoder_id=CvNetVideo.WASM.CreateAAudioEncoder(this.wasm_codec_type,this.audiocapture.GetSampleRate(),32,1,8e3,16,1,this.has_haisi,this.frame_length);if(this.encoder_id>=0){CvNetVideo.WasmId2Uc.e[this.encoder_id]=this.wfs}}if(this.encoder_id>=0){var i=new Uint8Array(e.buffer);CvNetVideo.WASM.AudioEncoderEncode(this.encoder_id,i,i.length)}}.bind(this));this.first_msg=true}else if(i.length==5&&i[0]==0&&i[1]==0&&i[2]==1&&i[3]==146){var r=i[4]}return}if(this.decoder_id==-1&&this.wasm_codec_type!=-1){this.decoder_id=CvNetVideo.WASM.CreateAAudioDecoder(this.wasm_codec_type,8e3,16,1,this.audioplay.GetSampleRate(),32,1);if(this.decoder_id>=0){CvNetVideo.WasmId2Uc.d[this.decoder_id]=this.wfs}}if(this.decoder_id>=0){CvNetVideo.WASM.AudioDecoderDecode(this.decoder_id,i,i.length)}}},{key:"createSocketAndSendCmd",value:function e(t,r,n){var s=this;var a=this.socketCreatedId;if(this.config.usingCluster){var i=1003;var o=new c.default;o.getConnByCluster(this.config["clusterHost"],this.config["clusterPort"],i,t,function(e,t){if(e==null){o.close()}else{var i=e.split(":");s.config["remoteHost"]=i[0];s.config["remotePort"]=i[1];if(a==s.socketCreatedId){s.CloseSocket();s.socket=new WebSocket(k.default.GetWsp()+i[0]+":"+i[1]);t.ok=true;s.attachWebsocket(s.socket,"ch"+r,function(){n()});o.close()}}},this.wfs)}else{if(a==this.socketCreatedId){this.CloseSocket();this.config["remoteHost"]=this.config["clusterHost"];this.config["remotePort"]=this.config["clusterPort"];this.socket=new WebSocket(k.default.GetWsp()+this.config["remoteHost"]+":"+this.config["remotePort"]);this.attachWebsocket(this.socket,"ch"+r,function(){n()})}}}},{key:"attachWebsocket",value:function e(t,i,r,n){this.wfs.trigger(g.default.WEBSOCKET_ATTACHING,{websocket:t,channelName:i,playerMode:this.playermode,onOpen:r,onCallback:n})}},{key:"CloseSocket",value:function e(){if(this.socket){S.default.debug("主动关闭连接");this.socket.close();this.socket=null;this.socketCreatedId++}}}]);return i}(_.default);i.default=x},{"../../JX/JTT1078":72,"../../event-handler":76,"../../events":77,"../../loader/cluster-websocket-loader":80,"../../loader/websocket-loader":82,"../../utils/cvComm":98,"../../utils/logger":100,"../PlayerMan":92,"./AudioCapture":83,"./AudioPlay":84}],86:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:true});var n=function(){function r(e,t){for(var i=0;i<t.length;i++){var r=t[i];r.enumerable=r.enumerable||false;r.configurable=true;if("value"in r)r.writable=true;Object.defineProperty(e,r.key,r)}}return function(e,t,i){if(t)r(e.prototype,t);if(i)r(e,i);return e}}();var r=e("../PlayerInterface.js");var s=c(r);var a=e("../../utils/logger.js");var o=c(a);function c(e){return e&&e.__esModule?e:{default:e}}function d(e,t){if(!(e instanceof t)){throw new TypeError("Cannot call a class as a function")}}function l(e,t){if(!e){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return t&&(typeof t==="object"||typeof t==="function")?t:e}function u(e,t){if(typeof t!=="function"&&t!==null){throw new TypeError("Super expression must either be null or a function, not "+typeof t)}e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:false,writable:true,configurable:true}});if(t)Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t}var h=function(e){u(r,e);function r(e,t){d(this,r);var i=l(this,(r.__proto__||Object.getPrototypeOf(r)).call(this,e,t));i.ucvideo=e;i.videodom=t;i.mediaSource=null;i.mediaSourceBuffer=null;i.mediaSourceBufferArray={};i.segments=[];i.appended=0;i.browserType=0;if(navigator.userAgent.toLowerCase().indexOf("firefox")!==-1){i.browserType=1}i.onsbue=i.onSourceBufferUpdateEnd.bind(i);i.onmso=i.onMediaSourceOpen.bind(i);i.onmse=i.onMediaSourceEnded.bind(i);i.onmsc=i.onMediaSourceClose.bind(i);return i}n(r,[{key:"StartRealTimeVideo",value:function e(t,i){var r=arguments.length>2&&arguments[2]!==undefined?arguments[2]:1}},{key:"StartBackTimeVideo",value:function e(t,i,r,n){var s=arguments.length>4&&arguments[4]!==undefined?arguments[4]:1}},{key:"StopVideo",value:function e(){if(this.is_playing){if(this.mediaSourceBuffer){this.mediaSourceBuffer=null}this.mediaSource.removeEventListener("sourceopen",this.onmso);this.mediaSource.removeEventListener("sourceended",this.onmse);this.mediaSource.removeEventListener("sourceclose",this.onmsc);this.mediaSource=null;this.is_playing=false;this.videodom.src=null}}},{key:"onBufferAppending",value:function e(t){if(t.data[0]==0&&t.data[1]==0&&t.data[2]==1&&t.data[3]==153){if(t.data[4]==136&&t.data[5]==128){var i=new JT1078.ExtendRefuse;i.FillByBinary(t.data,6,t.data.length);this.StopPlay();this.LoadingPage(true,i.Reason)}}else{if(this.mediaSource==null)return;if(!this.segments){this.segments=[t]}else{this.segments.push(t)}if(this.smoothCheck&&this.ucvideo.config.smoothMode){var r=parseInt(this.ucvideo.config.smoothMode);if(isNaN(r)){r=15}if(this.segments.length<r){return}}this.smoothCheck=false;this.doAppending()}}},{key:"onBufferReset",value:function e(t){this.mimeType=t.mimeType;this.smoothCheck=true;this.StartVide()}},{key:"onMediaWaiting",value:function e(){this.smoothCheck=true;if(this.videodom.playbackRate>1){this.videodom.playbackRate=1;this.ucvideo.player.interface_player.seek2last()}}},{key:"StartVide",value:function e(){this.is_playing=true;this.mediaSource=new MediaSource;this.mediaSource.addEventListener("sourceopen",this.onmso);this.mediaSource.addEventListener("sourceended",this.onmse);this.mediaSource.addEventListener("sourceclose",this.onmsc);this.videodom.src=URL.createObjectURL(this.mediaSource);if(this.IEVersion()!="-1")this.videodom.play()}},{key:"onMediaSourceOpen",value:function e(){o.default.custom("fmp4","media source open");if(!this.mediaSource||this.mediaSource.readyState!=="open"){return}this.createSourceBuffers({tracks:"video",mimeType:this.mimeType})}},{key:"onMediaSourceClose",value:function e(){o.default.custom("fmp4","media source open")}},{key:"onMediaSourceEnded",value:function e(){o.default.custom("fmp4","media source open")}},{key:"onSourceBufferUpdateEnd",value:function e(t){this.appending=false;this.doAppending()}},{key:"createSourceBuffers",value:function e(t){var i=this.mediaSourceBufferArray,r=this.mediaSource;var n=void 0;if(t.mimeType===""){n="video/mp4;codecs=avc1.42c01e,mp4a.40.2"}else{n="video/mp4;codecs="+t.mimeType}try{this.mediaSourceBuffer=i["video"]=r.addSourceBuffer(n);this.mediaSourceBuffer.mode="sequence";this.mediaSourceBuffer.addEventListener("updateend",this.onsbue)}catch(e){this.mediaSourceBuffer=null;console.error(e)}this.ucvideo.trigger(Event.BUFFER_CREATED,{tracks:t});this.videodom.play()}},{key:"doAppending",value:function e(){if(!this.mediaSource||this.mediaSource.readyState!=="open"){return}this.ucvideo.player.interface_player.seekcheck();var t=this.ucvideo,i=this.mediaSourceBufferArray,r=this.segments;if(Object.keys(i).length){if(this.videodom.error){this.segments=[];o.default.warn("trying to append although a media error occured, flush segment and abort");return}if(this.appending){return}if(r&&r.length){var n=r.shift();try{if(i[n.type]){this.parent=n.parent;i[n.type].appendBuffer(n.data);this.appendError=0;this.appended++;this.appending=true}else{}}catch(e){r.unshift(n);var s={type:ErrorTypes.MEDIA_ERROR};if(e.code!==22){if(this.appendError){this.appendError++}else{this.appendError=1}s.details=ErrorDetails.BUFFER_APPEND_ERROR;s.frag=this.fragCurrent;if(this.appendError>t.config.appendErrorMaxRetry){r=[];s.fatal=true;return}else{s.fatal=false}}else{this.segments=[];s.details=ErrorDetails.BUFFER_FULL_ERROR;return}}}}}},{key:"getLastTime",value:function e(){var t=this.videodom.buffered;if(t.length===1){return t.end(t.length-1)}}},{key:"IEVersion",value:function e(){var t=navigator.userAgent;if(!!window.ActiveXObject||"ActiveXObject"in window)return"IE";else if(t.indexOf("Edge")>-1){return"Edge"}else{return"-1"}}},{key:"Playing",get:function e(){return this.is_playing}}]);return r}(s.default);i.default=h},{"../../utils/logger.js":100,"../PlayerInterface.js":91}],87:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:true});var n=function(){function r(e,t){for(var i=0;i<t.length;i++){var r=t[i];r.enumerable=r.enumerable||false;r.configurable=true;if("value"in r)r.writable=true;Object.defineProperty(e,r.key,r)}}return function(e,t,i){if(t)r(e.prototype,t);if(i)r(e,i);return e}}();var r=e("../../../lib/player/PlayerInterface");var s=p(r);var a=e("../../JX/JTT1078");var h=p(a);var o=e("../../utils/logger.js");var c=p(o);var d=e("../../utils/trafficStat");var l=p(d);var u=e("../../utils/g726conf.js");var f=p(u);function p(e){return e&&e.__esModule?e:{default:e}}function m(e,t){if(!(e instanceof t)){throw new TypeError("Cannot call a class as a function")}}function v(e,t){if(!e){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return t&&(typeof t==="object"||typeof t==="function")?t:e}function g(e,t){if(typeof t!=="function"&&t!==null){throw new TypeError("Super expression must either be null or a function, not "+typeof t)}e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:false,writable:true,configurable:true}});if(t)Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t}var y=function(e){g(r,e);function r(e,t){m(this,r);var i=v(this,(r.__proto__||Object.getPrototypeOf(r)).call(this,e,t));i.ucvideo=e;i.videodom=t;i.is_playing=false;i._requestAbort=false;i._bytestart=0;i._receivedLength=0;i._fmp4muxer_id=-1;i._firstmsg=true;i._WaitIFrame=true;i._isaudioinit=false;i.trafficStat=new l.default;i.mediaSource=null;i.mediaSourceBuffer=null;i.mediaSourceBufferArray={};i.segments=[];i.appended=0;i.onsbue=i.onSourceBufferUpdateEnd.bind(i);i.onmso=i.onMediaSourceOpen.bind(i);i.onmse=i.onMediaSourceEnded.bind(i);i.onmsc=i.onMediaSourceClose.bind(i);return i}n(r,[{key:"GetFmp4ID",value:function e(){return this._fmp4muxer_id}},{key:"GetFisrtMsg",value:function e(){return this._firstmsg}},{key:"GovPlay",value:function e(t,i){this._firstmsg=true;c.default.custom("Gov","StartVideo url:"+t);this.controller=new AbortController;this._FetchImpl(t,i)}},{key:"StopVideo",value:function e(){c.default.custom("Gov","StopVideos");this._requestAbort=true;if(this.is_playing){if(this.mediaSourceBuffer){this.mediaSourceBuffer=null}this.mediaSource.removeEventListener("sourceopen",this.onmso);this.mediaSource.removeEventListener("sourceended",this.onmse);this.mediaSource.removeEventListener("sourceclose",this.onmsc);this.mediaSource=null;this.is_playing=false;this.segments=[];this.videodom.src=null;if(this._fmp4muxer_id>=0){var t=this._fmp4muxer_id;this._fmp4muxer_id=-1;CvNetVideo.WASM.FMp4MuxClear(t)}}this.controller.abort()}},{key:"onBufferAppending",value:function e(t){if(t.data[0]==0&&t.data[1]==0&&t.data[2]==1&&t.data[3]==153){if(t.data[4]==136&&t.data[5]==128){var i=new h.default.ExtendRefuse;i.FillByBinary(t.data,6,t.data.length);this.StopPlay();this.LoadingPage(true,i.Reason)}}else{if(this.mediaSource==null)return;if(!this.segments){this.segments=[t]}else{this.segments.push(t)}if(this.smoothCheck&&this.ucvideo.config.smoothMode){var r=parseInt(this.ucvideo.config.smoothMode);if(isNaN(r)){r=15}if(this.segments.length<r){return}}this.smoothCheck=false;this.doAppending()}}},{key:"onBufferReset",value:function e(t){c.default.custom("Gov","onBufferReset");this._firstmsg=false;this.mimeType=t.mimeType;this.smoothCheck=true;this.StartVide()}},{key:"onMediaWaiting",value:function e(){this.smoothCheck=true;if(this.videodom.playbackRate>1){this.videodom.playbackRate=1;this.ucvideo.player.interface_player.seek2last()}}},{key:"StartVide",value:function e(){this.is_playing=true;this.mediaSource=new MediaSource;this.mediaSource.addEventListener("sourceopen",this.onmso);this.mediaSource.addEventListener("sourceended",this.onmse);this.mediaSource.addEventListener("sourceclose",this.onmsc);this.videodom.src=URL.createObjectURL(this.mediaSource);if(this.IEVersion()=="IE")this.videodom.play()}},{key:"onMediaSourceOpen",value:function e(){if(!this.mediaSource||this.mediaSource.readyState!=="open"){return}c.default.custom("Gov","media source open");this.createSourceBuffers({tracks:"video",mimeType:this.mimeType})}},{key:"onMediaSourceClose",value:function e(){c.default.custom("Gov","media source close")}},{key:"onMediaSourceEnded",value:function e(){c.default.custom("Gov","media source ended")}},{key:"onSourceBufferUpdateEnd",value:function e(t){this.appending=false;this.doAppending()}},{key:"createSourceBuffers",value:function e(t){var i=this.mediaSourceBufferArray,r=this.mediaSource;var n=void 0;if(t.mimeType===""){n="video/mp4;codecs=avc1.42c01e,mp4a.40.2"}else{n="video/mp4;codecs="+t.mimeType}try{this.mediaSourceBuffer=i["video"]=r.addSourceBuffer(n);this.mediaSourceBuffer.mode="sequence";this.mediaSourceBuffer.addEventListener("updateend",this.onsbue)}catch(e){this.mediaSourceBuffer=null;console.error(e)}this.ucvideo.trigger(Event.BUFFER_CREATED,{tracks:t});this.videodom.play()}},{key:"doAppending",value:function e(){if(!this.mediaSource||this.mediaSource.readyState!=="open"){return}this.ucvideo.player.interface_player.seekcheck();var t=this.ucvideo,i=this.mediaSourceBufferArray,r=this.segments;if(Object.keys(i).length){if(this.videodom.error){this.segments=[];c.default.warn("trying to append although a media error occured, flush segment and abort");return}if(this.appending){return}if(r&&r.length){var n=r.shift();try{if(i[n.type]){this.parent=n.parent;i[n.type].appendBuffer(n.data);this.appendError=0;this.appended++;this.appending=true}else{}}catch(e){r.unshift(n);var s={type:ErrorTypes.MEDIA_ERROR};if(e.code!==22){if(this.appendError){this.appendError++}else{this.appendError=1}s.details=ErrorDetails.BUFFER_APPEND_ERROR;s.frag=this.fragCurrent;if(this.appendError>t.config.appendErrorMaxRetry){r=[];s.fatal=true;return}else{s.fatal=false}}else{this.segments=[];s.details=ErrorDetails.BUFFER_FULL_ERROR;return}}}}}},{key:"IEVersion",value:function e(){var t=navigator.userAgent;if(!!window.ActiveXObject||"ActiveXObject"in window)return"IE";else if(t.indexOf("Edge")>-1){return"Edge"}else{return"-1"}}},{key:"_FetchImpl",value:function e(t,i){var r=this;var n={method:"GET",mode:"cors",cache:"no-cache",referrerPolicy:"no-referrer-when-downgrade",signal:this.controller.signal};this._bytestart=0;this._receivedLength=0;this._requestAbort=false;this._isaudioinit=false;fetch(t,n).then(function(e){if(e.ok&&e.status>=200&&e.status<=299){var t=e.body.getReader();r._pump(t,i)}else{if(i){i(-2,"URL请求失败")}}}).catch(function(e){if(i){c.default.custom("Gov","fetch error",e);i(-1,"URL请求发生错误")}})}},{key:"_XMLHttpRequestImpl",value:function e(t){var s=new XMLHttpRequest;s.open("GET",t,true);s.responseType="arraybuffer";s.overrideMimeType("text/plain; charset=x-user-defined");s.setRequestHeader("content-type","application/json");s.send();s.onreadystatechange=function(e){if(s.readyState==4){}if(s.readyState==3){var t=0;var i=s.response;var r=new Uint8Array(i.slice(t,t+30));var n=new h.default.JTRTHead;n.FillByBinary(r,0,30);t+=n.BinaryDataLen}}}},{key:"_pump",value:function e(d,l){var u=this;return d.read().then(function(e){if(e.done){}else{if(u._requestAbort===true){u._requestAbort=false;return d.cancel()}var t=e.value.buffer;u.trafficStat.addbytes(t.byteLength);u._receivedLength+=t.byteLength;while(t.byteLength-u._bytestart>30){var i=new h.default.JTRTHead;var r=void 0,n=null;if(u._bytestart<0){var s=new Uint8Array(980);s.set(u._bufRedis.subarray(0,u._bufRedis.length),0);var a=980-u._bufRedis.length>t.byteLength?t.byteLength:980-u._bufRedis.length;s.set(new Uint8Array(t.slice(0,a)),u._bufRedis.length);i.FillByBinary(s,0,30);if(t.byteLength-u._bytestart>=i.BinaryDataLen+i.DLen){n=new Uint8Array(s.subarray(i.BinaryDataLen,i.BinaryDataLen+i.DLen))}}else{r=new Uint8Array(t.slice(u._bytestart,u._bytestart+30));i.FillByBinary(r,0,30);if(t.byteLength-u._bytestart>=i.BinaryDataLen+i.DLen){n=new Uint8Array(t.slice(u._bytestart+i.BinaryDataLen,u._bytestart+i.BinaryDataLen+i.DLen))}}if(n!=null){u._bytestart=u._bytestart+i.BinaryDataLen+i.DLen;if(i.PT===CvNetVideo.WASM.JX_H264){if(u._fmp4muxer_id<0){u._WaitIFrame=true;u._fmp4muxer_id=CvNetVideo.WASM.CreateFMp4Muxer(3);if(u._fmp4muxer_id==-101){if(l){l(-101,"超过允许最大连接数，断开连接")}return d.cancel()}else if(u._fmp4muxer_id>=0){CvNetVideo.WasmId2Uc.v[u._fmp4muxer_id]=u.ucvideo}}if(u._fmp4muxer_id>=0){if(u._WaitIFrame){if(i.XXXX==0&&(i.YYYY==0||i.YYYY==1)){u._WaitIFrame=false}}if(!u._WaitIFrame){var o=CvNetVideo.WASM.FMp4InputVideo(u._fmp4muxer_id,n,n.length,i.RTTimeSpan.high,i.RTTimeSpan.low);if(o==-102){if(l){l(-102,"超过允许播放时长，断开连接。")}return d.cancel()}}}}else if(i.PT==CvNetVideo.WASM.JX_ADPCMA||i.PT==CvNetVideo.WASM.JX_G711A||i.PT==CvNetVideo.WASM.JX_G711U||i.PT==CvNetVideo.WASM.JX_G726){if(u._fmp4muxer_id>=0){if(!u._isaudioinit){if(i.PT==CvNetVideo.WASM.JX_G726){switch(f.default.getDefault().get_bits_per_coded_sample(i.DLen)){case 2:i.PT=CvNetVideo.WASM.JX_G726_16K;break;case 3:i.PT=CvNetVideo.WASM.JX_G726_24K;break;case 5:i.PT=CvNetVideo.WASM.JX_G726_40K;break}}CvNetVideo.WASM.FMp4SetAudioInfo(u._fmp4muxer_id,8e3,16,1,i.PT);u._isaudioinit=true}CvNetVideo.WASM.FMp4InputAudio(u._fmp4muxer_id,n,n.length,i.RTTimeSpan.high,i.RTTimeSpan.low)}}}else{break}}if(t.byteLength-u._bytestart>=980){return d.cancel()}else if(t.byteLength-u._bytestart>0){if(u._bytestart<0){var c=new Uint8Array(t.byteLength-u._bytestart);c.set(u._bufRedis.subarray(0,u._bufRedis.length),0);c.set(new Uint8Array(t.slice(0,t.byteLength)),u._bufRedis.length);u._bufRedis=c;u._bytestart=u._bytestart-t.byteLength}else{u._bufRedis=new Uint8Array(t.slice(u._bytestart,t.byteLength));u._bytestart=u._bytestart-t.byteLength}}else{u._bytestart=0}u._pump(d,l)}}).catch(function(e){if(!u._requestAbort){throw e}})}},{key:"Playing",get:function e(){return this.is_playing}}]);return r}(s.default);i.default=y},{"../../../lib/player/PlayerInterface":1,"../../JX/JTT1078":72,"../../utils/g726conf.js":99,"../../utils/logger.js":100,"../../utils/trafficStat":103}],88:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:true});var n=function(){function r(e,t){for(var i=0;i<t.length;i++){var r=t[i];r.enumerable=r.enumerable||false;r.configurable=true;if("value"in r)r.writable=true;Object.defineProperty(e,r.key,r)}}return function(e,t,i){if(t)r(e.prototype,t);if(i)r(e,i);return e}}();var r=e("../PlayerInterface.js");var s=l(r);var a=e("../../utils/logger.js");var o=l(a);var c=e("../../utils/cvComm");var d=l(c);function l(e){return e&&e.__esModule?e:{default:e}}function u(e,t){if(!(e instanceof t)){throw new TypeError("Cannot call a class as a function")}}function h(e,t){if(!e){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return t&&(typeof t==="object"||typeof t==="function")?t:e}function f(e,t){if(typeof t!=="function"&&t!==null){throw new TypeError("Super expression must either be null or a function, not "+typeof t)}e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:false,writable:true,configurable:true}});if(t)Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t}var p=function(e){f(r,e);function r(e,t){u(this,r);var i=h(this,(r.__proto__||Object.getPrototypeOf(r)).call(this,e,t));i.wfs=e;i.videodom=t;i.time_id=-1;i.is_playing=false;i.StartID=0;return i}n(r,[{key:"StartRealTimeVideo",value:function e(t,i){var r=arguments.length>2&&arguments[2]!==undefined?arguments[2]:1;this.is_playing=true;this.Sim=t;this.Channel=i;if(!this.onlyGetPullUrl){this.videodom.src=this.hls_url;this.videodom.play()}this.StartHeartbeat()}},{key:"StartBackTimeVideo",value:function e(t,i,r,n){var s=arguments.length>4&&arguments[4]!==undefined?arguments[4]:1;this.is_playing=true;this.Sim=t;this.Channel=i;if(!this.onlyGetPullUrl){this.videodom.src=this.hls_url;this.videodom.play()}this.StartHeartbeat()}},{key:"StopVideo",value:function e(){this.is_playing=false;if(this.videodom){this.videodom.src=null}this.hls_url=null;this.StopHeartbeat()}},{key:"onMediaError",value:function e(){if(this.hls_url!=null&&this.hls_url!="undefined"){var t=this.StartID;setTimeout(function(){if(t==this.StartID)this.StartRealTimeVideo(this.Sim,this.Channel)}.bind(this),2e3)}}},{key:"onHlsInfo",value:function e(t){this.hls_url_http=t.HlsAddr;this.hls_url_https=t.HlsHttpsAddr;this.rtmp_url=t.ServerAddr;this.clientid=t.ClinetID;if(d.default.IsHttps()&&this.hls_url_https){this.hls_url=this.hls_url_https}else{this.hls_url=this.hls_url_http}o.default.custom("hls","hls url:%s",t.hls_url);if(this.wfs.config.events&&this.wfs.config.events.onHlsPlay){this.onlyGetPullUrl=this.wfs.config.events.onHlsPlay(this.wfs.video_id,this.wfs,t.HlsAddr,t.HlsHttpsAddr,t.ServerAddr,t.ClinetID);if(this.onlyGetPullUrl==null){this.onlyGetPullUrl=false}}}},{key:"StartHeartbeat",value:function e(){this.StartID++;if(this.time_id===-1){this.time_id=setInterval(this.SendHeartbeatPackage.bind(this),1e3*5)}}},{key:"StopHeartbeat",value:function e(){clearInterval(this.time_id);this.time_id=-1;this.StartID++}},{key:"SendHeartbeatPackage",value:function e(){this.wfs.jt1078.SendHeartRtmp(this.Sim,this.Channel,this.rtmp_url,this.clientid)}},{key:"Playing",get:function e(){return this.is_playing}}]);return r}(s.default);i.default=p},{"../../utils/cvComm":98,"../../utils/logger.js":100,"../PlayerInterface.js":91}],89:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:true});var r=function(){function r(e,t){for(var i=0;i<t.length;i++){var r=t[i];r.enumerable=r.enumerable||false;r.configurable=true;if("value"in r)r.writable=true;Object.defineProperty(e,r.key,r)}}return function(e,t,i){if(t)r(e.prototype,t);if(i)r(e,i);return e}}();var n=e("../../helper/ByteHelper");var l=d(n);var s=e("../../utils/logger");var o=d(s);var a=e("../VideoRecorder");var c=d(a);function d(e){return e&&e.__esModule?e:{default:e}}function u(e,t){if(!(e instanceof t)){throw new TypeError("Cannot call a class as a function")}}var h=function(){function n(e,t){u(this,n);this.ucVideo=e;this.config=t;this.is_playing=false;this.is_real_or_back=true;this.start_time_minute_back=0;this.back_drag=false;this.is_cursor_in_dom=false;this.timer_audioscrollhide=-1;this.audioscroll_offsettop=75;this.audioscroll_height=60;if(e.ucMain.Container){this.video_index=e.ucMain.Container.childElementCount;var i="";{i+="<div class='video-div-rotate' id='video-div-rotate"+this.video_index+"'><video class=\"video-body\" wmode='Opaque' preload='none' webkit-playsinline playsinline id='videoBody-"+this.video_index+"'></video></div>";i+="<div class='video-control-real hide' id='video-control-real-"+this.video_index+"'>";{i+='<div class="pull-left fontzero control-leftview">';{i+="<div title='刷新' class=\"control-btn loadbtn\" id='loadBtn-"+this.video_index+"'></div>";i+="<div title='播放' class=\"control-btn playpausebtn\" id='playPauseBtn-"+this.video_index+"'></div>";i+="<div title='停止' class=\"control-btn stopbtn\" id='stopBtn-"+this.video_index+"'></div>";i+="<div title='声音' class=\"control-btn mutedbtn\" id='mutedBtn-"+this.video_index+"'></div>";i+="<div class='bufferbarbackgroud hide' id='bufferBarbackground-"+this.video_index+"'></div>";i+="<div class='bufferbar hide' id='bufferBar-"+this.video_index+"'></div>";i+="<div class='currentbar hide' id='currentBar-"+this.video_index+"'></div>";i+="<div class='drawbar hide' id='drawBar-"+this.video_index+"'></div>";i+="<div title='全屏' class=\"control-btn fullscreenbtn\" id='fullScreenBtn-"+this.video_index+"'></div>";i+="<div title='截图' class=\"control-btn capturebtn\" id='captureBtn-"+this.video_index+"'></div>";i+="<div title='录像' class=\"control-btn recorderbtn\" id='recorderBtn-"+this.video_index+"'></div>";i+="<div title='伸缩' class=\"control-btn stretchbtn\" id='stretchBtn-"+this.video_index+"'></div>"}i+="</div>"}i+="</div>";i+="<div class='video-time-rule hide' id='video-time-rule-"+this.video_index+"'>";{i+="<div class='video-time-day' id='time-day-"+this.video_index+"'>";{for(var r=0;r<60*24;r++){if(r<0){i+="<div class='video-time-minute active' id='video-time-minute"+r+"-"+this.video_index+"'></div>"}else{i+="<div class='video-time-minute' id='video-time-minute"+r+"-"+this.video_index+"'></div > "}}i+="<div class='video-time-hour-first'>00:00</div>";i+="<div class='video-time-hour'>01:00</div>";i+="<div class='video-time-hour'>02:00</div>";i+="<div class='video-time-hour'>03:00</div>";i+="<div class='video-time-hour'>04:00</div>";i+="<div class='video-time-hour'>05:00</div>";i+="<div class='video-time-hour'>06:00</div>";i+="<div class='video-time-hour'>07:00</div>";i+="<div class='video-time-hour'>08:00</div>";i+="<div class='video-time-hour'>09:00</div>";i+="<div class='video-time-hour'>10:00</div>";i+="<div class='video-time-hour'>11:00</div>";i+="<div class='video-time-hour'>12:00</div>";i+="<div class='video-time-hour'>13:00</div>";i+="<div class='video-time-hour'>14:00</div>";i+="<div class='video-time-hour'>15:00</div>";i+="<div class='video-time-hour'>16:00</div>";i+="<div class='video-time-hour'>17:00</div>";i+="<div class='video-time-hour'>18:00</div>";i+="<div class='video-time-hour'>19:00</div>";i+="<div class='video-time-hour'>20:00</div>";i+="<div class='video-time-hour'>21:00</div>";i+="<div class='video-time-hour'>22:00</div>";i+="<div class='video-time-hour'>23:00</div>"}i+="</div>";i+="<div class='video-time-cursor' id='video-time-cursor-body-"+this.video_index+"'>";i+="<div class='video-time-cursor-text' id='video-time-cursor-"+this.video_index+"'>00:00:00</div >";i+="</div> "}i+="</div>";i+="<div class='video-menu' id='video-menu-"+this.video_index+"'>";{i+="<div class='video-menu-context' id='video-menu-stop-"+this.video_index+"'>停止</div>";i+="<div class='video-menu-context' id='video-menu-full-"+this.video_index+"'>全屏</div>";i+="<div class='video-menu-context' id='video-menu-stretch-"+this.video_index+"'>伸缩</div>";i+="<div class='video-menu-context' id='video-menu-capture-"+this.video_index+"'>截图</div>";i+="<div class='video-menu-context' id='video-menu-rotate-"+this.video_index+"'>视频旋转</div>";i+="<div class='video-menu-context' id='video-menu-mirrorinver-"+this.video_index+"'>镜面反转</div>"}i+="</div>";i+="<div class='video-waiting-page hide' id='video-waiting-page-"+this.video_index+"'>";i+="<div class='video-loading-btn'></div>";i+="<div class='video-loading-text' id='video-loading-text-"+this.video_index+"'>等待..</div>";i+="</div>";i+="<div class='video-osd-text hide' id='video-osd-text-"+this.video_index+"'>";i+="</div>";i+="<div class='video-kbps-text' id='video-kbps-text-"+this.video_index+"'>";i+="</div>";i+="<div class='video-record-text' id='video-record-text-"+this.video_index+"'>";i+="</div>"}this.video_div=document.createElement("div");this.video_div.classList.add("video-box-body");this.video_div.draggable=true;this.video_div.style.zIndex=this.video_index+1;this.video_div.ondrop=this.ondrop.bind(this);this.video_div.ondragstart=this.ondragstart.bind(this);this.video_div.ondragover=this.ondragover.bind(this);this.video_div.ondragend=this.ondragend.bind(this);this.video_div.innerHTML=i;if(e.ucMain.Container.append){e.ucMain.Container.append(this.video_div)}else{e.ucMain.Container.appendChild(this.video_div)}this.video=this.video_div.querySelector("#videoBody-"+this.video_index);this.btn_mute=this.video_div.querySelector("#mutedBtn-"+this.video_index);this.btn_fullscreen=this.video_div.querySelector("#fullScreenBtn-"+this.video_index);this.btn_playorpause=this.video_div.querySelector("#playPauseBtn-"+this.video_index);this.btn_stretch=this.video_div.querySelector("#stretchBtn-"+this.video_index);this.scroll_thumb=this.video_div.querySelector("#drawBar-"+this.video_index);this.scroll_bar=this.video_div.querySelector("#currentBar-"+this.video_index);this.scroll_bar_background=this.video_div.querySelector("#bufferBar-"+this.video_index);this.scroll_bar_background_bg=this.video_div.querySelector("#bufferBarbackground-"+this.video_index);this.osd_text=this.video_div.querySelector("#video-osd-text-"+this.video_index);this.osd_text.innerText="";this.kbps_text=this.video_div.querySelector("#video-kbps-text-"+this.video_index);this.kbps_text.innerText="";this.record_text=this.video_div.querySelector("#video-record-text-"+this.video_index);this.record_text.innerText="";this.btn_recorder=this.video_div.querySelector("#recorderBtn-"+this.video_index);this.video_div.onmouseenter=this.onPlayerMouseEnter.bind(this);this.video_div.onmouseleave=this.onPlayerMouseLeave.bind(this);this.video.oncontextmenu=this.onContextMenu.bind(this);this.btn_mute.onclick=this.onClickedMutedBtn.bind(this);this.btn_mute.onmouseenter=this.onClickedMutedBtnEnter.bind(this);this.btn_mute.onmouseleave=this.onClickedMutedBtnLeave.bind(this);this.btn_fullscreen.onclick=this.onClickedFullScreenBar.bind(this);this.scroll_bar_background_bg.onmouseenter=this.onAudioScrollEnter.bind(this);this.scroll_bar_background_bg.onmouseleave=this.onAudioScrollLeave.bind(this);this.scroll_bar_background.onmousedown=this.onVolumeMouseDown.bind(this);this.scroll_bar_background.onmouseenter=this.onAudioScrollEnter.bind(this);this.scroll_bar_background.onmouseleave=this.onAudioScrollLeave.bind(this);this.scroll_thumb.onmousedown=this.onScrollThumbMouseEvent.bind(this);this.scroll_thumb.onmouseenter=this.onAudioScrollEnter.bind(this);this.scroll_thumb.onmouseleave=this.onAudioScrollLeave.bind(this);this.btn_playorpause.onclick=this.onClickedPlayPauseBtn.bind(this);this.btn_stretch.onclick=this.onClickedStretchBtn.bind(this);this.btn_recorder.onclick=this.onClickedRecorderBtn.bind(this);this.video_div.querySelector("#loadBtn-"+this.video_index).onclick=this.onClickedLoadBtn.bind(this);this.video_div.querySelector("#captureBtn-"+this.video_index).onclick=this.onClickedCaptureBtn.bind(this);this.video_div.querySelector("#stopBtn-"+this.video_index).onclick=this.onClickedStopBtn.bind(this);this.real_controlbar=this.video_div.querySelector("#video-control-real-"+this.video_index);this.real_controlbar.classList.add("disable");this.real_controlbar.onclick=this.onPlayerBarClicked.bind(this);this.controlbar_enable=false;this.time_rule_body=this.video_div.querySelector("#video-time-rule-"+this.video_index);this.time_day=this.video_div.querySelector("#time-day-"+this.video_index);this.cursor=this.video_div.querySelector("#video-time-cursor-"+this.video_index);this.cursor_body=this.video_div.querySelector("#video-time-cursor-body-"+this.video_index);this.time_day.ondblclick=this.onTimeDayDBClicked.bind(this);this.time_day.onmousedown=this.onTimeDayMouseEvent.bind(this);this.cursor.onmousedown=this.onCursorMouseEvent.bind(this);this.video_div.querySelector("#video-menu-stop-"+this.video_index).onclick=this.onClickedStopBtn.bind(this);this.video_div.querySelector("#video-menu-full-"+this.video_index).onclick=this.onClickedFullScreenBar.bind(this);this.video_div.querySelector("#video-menu-stretch-"+this.video_index).onclick=this.onClickedStretchBtn.bind(this);this.video_div.querySelector("#video-menu-capture-"+this.video_index).onclick=this.onClickedCaptureBtn.bind(this);this.video_div.querySelector("#video-menu-rotate-"+this.video_index).onclick=this.onClickedRotateBtn.bind(this);this.video_div.querySelector("#video-menu-mirrorinver-"+this.video_index).onclick=this.onClickedMirrorInverBtn.bind(this);this.video_rotate=this.video_div.querySelector("#video-div-rotate"+this.video_index);this.rotate=0;this.mirrorinver=false;this.loading_page=this.video_div.querySelector("#video-waiting-page-"+this.video_index);this.loading_text=this.video_div.querySelector("#video-loading-text-"+this.video_index);this.loading_page.oncontextmenu=this.onContextMenuCatchPage.bind(this);this.video.style.objectFit="fill";this.btn_stretch.classList.add("off");this.onwindowclicked=function e(){var t=this.video_div.querySelector("#video-menu-"+this.video_index);if(t){t.style.width=0}}.bind(this);this.onwindowresize=function e(){var t=document.fullScreen||document.mozFullScreen||document.webkitIsFullScreen;if(!t){this.video_div.classList.remove("full");this.btn_fullscreen.classList.remove("off");if(this.rotate==0){this.video_rotate.style.left=0+"px";this.video_rotate.style.top=0+"px";this.video_rotate.style.width=this.video_div.offsetWidth+"px";this.video_rotate.style.height=this.video_div.offsetHeight+"px"}else if(this.rotate==90){this.video_rotate.style.left=(this.video_div.offsetWidth-this.video_div.offsetHeight)/2+"px";this.video_rotate.style.top=(this.video_div.offsetHeight-this.video_div.offsetWidth)/2+"px";this.video_rotate.style.width=this.video_div.offsetHeight+"px";this.video_rotate.style.height=this.video_div.offsetWidth+"px"}else if(this.rotate==180){this.video_rotate.style.left=0+"px";this.video_rotate.style.top=0+"px";this.video_rotate.style.width=this.video_div.offsetWidth+"px";this.video_rotate.style.height=this.video_div.offsetHeight+"px"}else if(this.rotate==270){this.video_rotate.style.left=(this.video_div.offsetWidth-this.video_div.offsetHeight)/2+"px";this.video_rotate.style.top=(this.video_div.offsetHeight-this.video_div.offsetWidth)/2+"px";this.video_rotate.style.width=this.video_div.offsetHeight+"px";this.video_rotate.style.height=this.video_div.offsetWidth+"px"}}}.bind(this);window.addEventListener("click",this.onwindowclicked);window.addEventListener("resize",this.onwindowresize);this.video.muted=true;this.btn_mute.classList.add("off");this.videoRecorder=new c.default(this.video,function(e){if(e){this.btn_recorder.classList.add("off")}else{this.btn_recorder.classList.remove("off");this.record_text.innerText=""}}.bind(this));if(t.enableDbcZoom){this.video.addEventListener("dblclick",function(e){if(this.ucVideo.ucMain.Zoomed){this.ucVideo.ucMain.UnZoomUC()}else this.ucVideo.ucMain.ZoomUC(0)}.bind(this))}}}r(n,[{key:"StartPlay",value:function e(){this.is_playing=true;if(this.video){this.LoadingPage(true,"等待视频...");this.real_controlbar.classList.remove("disable");this.btn_playorpause.classList.add("off")}if(this.is_cursor_in_dom)this.onPlayerMouseEnter()}},{key:"StopPlay",value:function e(){this.is_playing=false;if(this.video){this.LoadingPage(false);this.real_controlbar.classList.add("disable");this.controlbar_enable=false;setTimeout(function(){if(!this.controlbar_enable)this.real_controlbar.classList.add("hide")}.bind(this),300);this.videoRecorder.stop()}}},{key:"QueryVideoListBegin",value:function e(){for(var t=0;t<60*24;t++){this.video_div.querySelector("#video-time-minute"+t+"-"+this.video_index).classList.remove("active")}if(!this.is_real_or_back){this.LoadingPage(true,"等待搜索录像")}}},{key:"AddVideoList",value:function e(t,i,r){this.video_list=t;this.start_time=i;this.end_time=r;for(var n=0;n<t.FileList.length;n++){var s=l.default.StringTimeToUnixLong(t.FileList[n].StartTime);var a=l.default.StringTimeToUnixLong(t.FileList[n].EndTime);var o=parseInt((s-i)/60);var c=parseInt((a-i)/60);o=o<0?0:o;if(c>o){for(var d=o;d<c;d++){if(d<60*24){this.video_div.querySelector("#video-time-minute"+d+"-"+this.video_index).classList.add("active")}}}}this.LoadingPage(false)}},{key:"GetVideo",value:function e(){return this.video}},{key:"SetMuted",value:function e(t){if(this.video){if(t===this.video.muted)return;if(this.video.muted){this.video.muted=false;this.btn_mute.classList.remove("off")}else{this.video.muted=true;this.btn_mute.classList.add("off")}this.updateAudioScrollLocation()}}},{key:"Capture",value:function e(t,i,r){if(!this.is_playing)return;if(i==null){i=this.config.captureType}if(r==null){r=this.config.captureQuality}var n="png";if(i==1){n="jpeg"}else if(i==2){n="webp"}var s=window.canvas=document.createElement("canvas");s.width=this.video.videoWidth;s.height=this.video.videoHeight;s.getContext("2d").drawImage(this.video,0,0,s.width,s.height);var a=s.toDataURL("image/"+n,r);if(this.config.events&&this.config.events.onCapture){if(this.config.events.onCapture(a,this.ucVideo.video_id,this.ucVideo)){return a}}if(t!=null){var o=a.split(",");var c=o[0].match(/:(.*?);/);var d=c?c.length:0;if(d<2){alert("抓图失败");return}var l=c[1],u=atob(o[1]),h=u.length,f=new Uint8Array(h);while(h--){f[h]=u.charCodeAt(h)}var p=new Blob([f],{type:l});var m=window.URL.createObjectURL(p);var v=document.createElement("a");v.style.display="none";v.href=m;v.download=t;document.body.appendChild(v);v.click();setTimeout(function(){document.body.removeChild(v);window.URL.revokeObjectURL(m)},1e3)}return a}},{key:"SetRealOrBack",value:function e(t){if(t){this.video.classList.remove("back");this.real_controlbar.classList.remove("back");this.time_rule_body.classList.add("hide");this.loading_page.classList.remove("back");this.LoadingPage(false);this.is_real_or_back=true}else{this.video.classList.add("back");this.real_controlbar.classList.add("back");this.time_rule_body.classList.remove("hide");this.loading_page.classList.add("back");this.LoadingPage(false);this.is_real_or_back=false}}},{key:"LoadingPage",value:function e(t,i){var r=arguments.length>2&&arguments[2]!==undefined?arguments[2]:0;if(this.video){if(this.LoadingPageID!=null){clearTimeout(this.LoadingPageID);this.LoadingPageID=null}if(t){if(r>0){this.LoadingPageID=setTimeout(this._ShowLoadingPage.bind(this,i),r)}else{this._ShowLoadingPage(i)}}else{this.loading_page.classList.add("hide")}}}},{key:"_ShowLoadingPage",value:function e(t){this.LoadingPageID=null;this.loading_page.classList.remove("hide");this.loading_text.innerText=t}},{key:"SetOsdVisible",value:function e(t){if(this.video){if(t){this.osd_text.classList.remove("hide")}else{this.osd_text.classList.add("hide")}}}},{key:"SetOsdColor",value:function e(t){this.osd_text.style.color=t}},{key:"SetOsdText",value:function e(t){this.osd_text.innerText=t}},{key:"SetKBpsText",value:function e(t){if(this.kbps_text){this.kbps_text.innerText=t}}},{key:"ShowRecordText",value:function e(){if(this.videoRecorder.started){this.record_text.innerText=o.default.diffTimeStr(this.videoRecorder.startTime,new Date)}else this.record_text.innerText=""}},{key:"SetRotate",value:function e(t){if(this.rotate==90){this.video_rotate.classList.remove("rotate90")}else if(this.rotate==180){this.video_rotate.classList.remove("rotate180")}else if(this.rotate==270){this.video_rotate.classList.remove("rotate270")}this.rotate=t;if(this.rotate==0){this.video_rotate.style.left=0+"px";this.video_rotate.style.top=0+"px";this.video_rotate.style.width=this.video_div.offsetWidth+"px";this.video_rotate.style.height=this.video_div.offsetHeight+"px"}else if(this.rotate==90){this.video_rotate.style.left=(this.video_div.offsetWidth-this.video_div.offsetHeight)/2+"px";this.video_rotate.style.top=(this.video_div.offsetHeight-this.video_div.offsetWidth)/2+"px";this.video_rotate.style.width=this.video_div.offsetHeight+"px";this.video_rotate.style.height=this.video_div.offsetWidth+"px";this.video_rotate.classList.add("rotate90")}else if(this.rotate==180){this.video_rotate.style.left=0+"px";this.video_rotate.style.top=0+"px";this.video_rotate.style.width=this.video_div.offsetWidth+"px";this.video_rotate.style.height=this.video_div.offsetHeight+"px";this.video_rotate.classList.add("rotate180")}else if(this.rotate==270){this.video_rotate.style.left=(this.video_div.offsetWidth-this.video_div.offsetHeight)/2+"px";this.video_rotate.style.top=(this.video_div.offsetHeight-this.video_div.offsetWidth)/2+"px";this.video_rotate.style.width=this.video_div.offsetHeight+"px";this.video_rotate.style.height=this.video_div.offsetWidth+"px";this.video_rotate.classList.add("rotate270")}}},{key:"SetMirrorInver",value:function e(){if(this.mirrorinver){this.video.classList.remove("mirrorinver")}this.mirrorinver=!this.mirrorinver;if(this.mirrorinver){this.video.classList.add("mirrorinver")}}},{key:"Resize",value:function e(){if(this.rotate==0){this.video_rotate.style.left=0+"px";this.video_rotate.style.top=0+"px";this.video_rotate.style.width=this.video_div.offsetWidth+"px";this.video_rotate.style.height=this.video_div.offsetHeight+"px"}else if(this.rotate==90){this.video_rotate.style.left=(this.video_div.offsetWidth-this.video_div.offsetHeight)/2+"px";this.video_rotate.style.top=(this.video_div.offsetHeight-this.video_div.offsetWidth)/2+"px";this.video_rotate.style.width=this.video_div.offsetHeight+"px";this.video_rotate.style.height=this.video_div.offsetWidth+"px"}else if(this.rotate==180){this.video_rotate.style.left=0+"px";this.video_rotate.style.top=0+"px";this.video_rotate.style.width=this.video_div.offsetWidth+"px";this.video_rotate.style.height=this.video_div.offsetHeight+"px"}else if(this.rotate==270){this.video_rotate.style.left=(this.video_div.offsetWidth-this.video_div.offsetHeight)/2+"px";this.video_rotate.style.top=(this.video_div.offsetHeight-this.video_div.offsetWidth)/2+"px";this.video_rotate.style.width=this.video_div.offsetHeight+"px";this.video_rotate.style.height=this.video_div.offsetWidth+"px"}}},{key:"ondragstart",value:function e(){this.ucVideo.ucMain.dragStart=this}},{key:"ondrop",value:function e(){var t=this.ucVideo.ucMain.dragStart;if(t!==this){var i=this.video_div.style.width;var r=this.video_div.style.height;var n=this.video_div.style.left;var s=this.video_div.style.top;var a=this.video_div.style.zIndex;var o=this.video_div.className;this.video_div.style.left=t.video_div.style.left;this.video_div.style.top=t.video_div.style.top;this.video_div.style.width=t.video_div.style.width;this.video_div.style.height=t.video_div.style.height;this.video_div.style.zIndex=t.video_div.style.zIndex;this.video_div.className=t.video_div.className;t.video_div.style.left=n;t.video_div.style.top=s;t.video_div.style.width=i;t.video_div.style.height=r;t.video_div.style.zIndex=a;t.video_div.className=o;t.ucVideo.Resize();this.ucVideo.Resize();this.ucVideo.ucMain.dragStart=null}}},{key:"ondragend",value:function e(){this.ucVideo.ucMain.dragStart=null}},{key:"ondragleave",value:function e(){this.ucVideo.ucMain.dragStart=null}},{key:"ondragover",value:function e(t){if(this.ucVideo.ucMain.dragStart){t.preventDefault()}}},{key:"onPlayerMouseEnter",value:function e(){this.is_cursor_in_dom=true;if(!this.is_playing)return;this.controlbar_enable=true;this.real_controlbar.classList.remove("hide");if(this.video.muted){var t=0;this.scroll_thumb.style.top=this.scroll_bar_background.offsetTop+t-3+"px";this.scroll_bar.style.height=t+"px"}else{var i=this.video.volume*this.scroll_bar_background.clientHeight;this.scroll_thumb.style.top=this.scroll_bar_background.offsetTop+i-3+"px";this.scroll_bar.style.height=i+"px"}}},{key:"onPlayerMouseLeave",value:function e(){this.is_cursor_in_dom=false;this.controlbar_enable=false;setTimeout(function(){if(!this.controlbar_enable)this.real_controlbar.classList.add("hide");this.onTimerAudioScrollHide()}.bind(this),300)}},{key:"onPlayerBarClicked",value:function e(t){if(typeof t!="undefined"){if(t.stopPropagation){t.stopPropagation()}else{t.cancelBubble=true}}}},{key:"onClickedLoadBtn",value:function e(){if(!this.is_playing)return;this.seek2last()}},{key:"onClickedPlayPauseBtn",value:function e(){if(!this.is_playing)return;if(this.video.paused){this.video.play();this.btn_playorpause.classList.add("off");this.seekcheck()}else{this.video.pause();this.btn_playorpause.classList.remove("off")}}},{key:"onClickedStopBtn",value:function e(){this.ucVideo.ucMain.Stop(this.video_index+1);this.LoadingPage(false)}},{key:"onAudioScrollEnter",value:function e(){this.stopAudioScrollHide()}},{key:"onAudioScrollLeave",value:function e(){this.startAudioScrollHide()}},{key:"onVolumeMouseDown",value:function e(t){if(this.video.muted){this.video.muted=false;this.btn_mute.classList.remove("off")}var i=t.layerY;this.scroll_thumb.style.top=this.scroll_bar_background.offsetTop+i-3+"px";this.scroll_bar.style.top=this.scroll_bar_background.offsetTop+i+"px";this.scroll_bar.style.height=this.audioscroll_height-i+"px";this.video.volume=this.scroll_bar.clientHeight/this.scroll_bar_background.clientHeight}},{key:"onClickedMutedBtn",value:function e(){if(this.video.muted){this.SetMuted(false)}else{this.SetMuted(true)}}},{key:"onClickedMutedBtnEnter",value:function e(){this.stopAudioScrollHide();this.scroll_thumb.classList.remove("hide");this.scroll_bar.classList.remove("hide");this.scroll_bar_background.classList.remove("hide");this.scroll_bar_background_bg.classList.remove("hide");this.updateAudioScrollLocation()}},{key:"onClickedMutedBtnLeave",value:function e(){this.startAudioScrollHide()}},{key:"startAudioScrollHide",value:function e(){if(this.time_id!=-1){clearInterval(this.timer_audioscrollhide)}this.timer_audioscrollhide=setTimeout(this.onTimerAudioScrollHide.bind(this),1200)}},{key:"stopAudioScrollHide",value:function e(){if(this.time_id!=-1){clearInterval(this.timer_audioscrollhide);this.timer_audioscrollhide=-1}}},{key:"onTimerAudioScrollHide",value:function e(){this.scroll_thumb.classList.add("hide");this.scroll_bar.classList.add("hide");this.scroll_bar_background.classList.add("hide");this.scroll_bar_background_bg.classList.add("hide")}},{key:"updateAudioScrollLocation",value:function e(){var t=this.btn_mute.offsetLeft+10;var i=this.btn_mute.offsetTop-this.audioscroll_offsettop;this.scroll_bar_background_bg.style.left=t-8+"px";this.scroll_bar_background_bg.style.top=i-5+"px";this.scroll_bar_background_bg.style.width="20px";this.scroll_bar_background_bg.style.height=this.audioscroll_height+18+"px";this.scroll_bar_background.style.left=t+"px";this.scroll_bar_background.style.top=i+"px";this.scroll_bar_background.style.height=this.audioscroll_height+"px";var r=this.audioscroll_height-this.audioscroll_height*this.video.volume;if(this.video.muted){r=this.audioscroll_height}this.scroll_bar.style.left=t+"px";this.scroll_bar.style.top=i+r+"px";this.scroll_bar.style.height=this.audioscroll_height-r+"px";this.scroll_thumb.style.top=i+r-3+"px";this.scroll_thumb.style.left=t-4+"px"}},{key:"onScrollThumbMouseEvent",value:function e(t){if(this.video.muted==true){this.video.muted=false;this.btn_mute.classList.remove("off")}t=t||window.event;this.start_y=t.clientY;var n=this;function i(e){e.preventDefault()}function r(e){e.preventDefault()}function s(e){var t=n.audioscroll_height;var i=void 0;var r=e.clientY;if(n.start_y>r){i=n.start_y-r;n.start_y=r;i=n.scroll_thumb.offsetTop-i;if(i<n.scroll_bar_background.offsetTop-3){n.scroll_thumb.style.top=n.scroll_bar_background.offsetTop-3+"px";n.scroll_bar.style.top=n.scroll_bar_background.offsetTop+"px";n.scroll_bar.style.height=t+"px"}else if(i>n.scroll_bar_background.offsetTop-3+t){n.scroll_thumb.style.top=n.scroll_bar_background.offsetTop+t-3+"px";n.scroll_bar.style.top=n.scroll_bar_background.offsetTop+t+"px";n.scroll_bar.style.height=0+"px"}else{n.scroll_thumb.style.top=i+"px";n.scroll_bar.style.top=i+3+"px";n.scroll_bar.style.height=n.scroll_bar_background.offsetTop+t-i-3+"px"}n.video.volume=n.scroll_bar.clientHeight/t}else if(n.start_y<r){i=r-n.start_y;n.start_y=r;i=n.scroll_thumb.offsetTop+i;if(i<n.scroll_bar_background.offsetTop-3){n.scroll_thumb.style.top=n.scroll_bar_background.offsetTop-3+"px";n.scroll_bar.style.top=n.scroll_bar_background.offsetTop+"px";n.scroll_bar.style.height=t+"px"}else if(i>n.scroll_bar_background.offsetTop-3+t){n.scroll_thumb.style.top=n.scroll_bar_background.offsetTop+t-3+"px";n.scroll_bar.style.top=n.scroll_bar_background.offsetTop+t+"px";n.scroll_bar.style.height=0+"px"}else{n.scroll_thumb.style.top=i+"px";n.scroll_bar.style.top=i+3+"px";n.scroll_bar.style.height=n.scroll_bar_background.offsetTop+t-i-3+"px"}n.video.volume=n.scroll_bar.clientHeight/t}}function a(e){document.removeEventListener("dragstart",i,false);document.removeEventListener("dragend",r,false);document.removeEventListener("mousemove",s,false);document.removeEventListener("mouseup",a,false)}document.addEventListener("dragstart",i,false);document.addEventListener("dragend",r,false);document.addEventListener("mousemove",s,false);document.addEventListener("mouseup",a,false)}},{key:"onClickedFullScreenBar",value:function e(){var t=document.fullScreen||document.mozFullScreen||document.webkitIsFullScreen;if(!t){this.video_div.requestFullscreen&&this.video_div.requestFullscreen()||this.video_div.mozRequestFullScreen&&this.video_div.mozRequestFullScreen()||this.video_div.webkitRequestFullscreen&&this.video_div.webkitRequestFullscreen()||this.video_div.msRequestFullscreen&&this.video_div.msRequestFullscreen();this.btn_fullscreen.classList.add("off");this.video_div.classList.add("full")}else{document.exitFullscreen?document.exitFullscreen():document.mozCancelFullScreen?document.mozCancelFullScreen():document.webkitExitFullscreen?document.webkitExitFullscreen():"";this.btn_fullscreen.classList.remove("off");this.video_div.classList.remove("full")}if(this.rotate==0){this.video_rotate.style.left=0+"px";this.video_rotate.style.top=0+"px";this.video_rotate.style.width=window.screen.availWidth+"px";this.video_rotate.style.height=window.screen.availHeight+"px"}else if(this.rotate==90){this.video_rotate.style.left=(this.video_div.offsetWidth-this.video_div.offsetHeight)/2+"px";this.video_rotate.style.top=(this.video_div.offsetHeight-this.video_div.offsetWidth)/2+"px";this.video_rotate.style.width=window.screen.availHeight+"px";this.video_rotate.style.height=window.screen.availWidth+"px"}else if(this.rotate==180){this.video_rotate.style.left=0+"px";this.video_rotate.style.top=0+"px";this.video_rotate.style.width=window.screen.availWidth+"px";this.video_rotate.style.height=window.screen.availHeight+"px"}else if(this.rotate==270){this.video_rotate.style.left=(this.video_div.offsetWidth-this.video_div.offsetHeight)/2+"px";this.video_rotate.style.top=(this.video_div.offsetHeight-this.video_div.offsetWidth)/2+"px";this.video_rotate.style.width=window.screen.availHeight+"px";this.video_rotate.style.height=window.screen.availWidth+"px"}}},{key:"onClickedRecorderBtn",value:function e(){if(!this.is_playing)return;if(this.videoRecorder.started){this.videoRecorder.stop()}else{this.videoRecorder.start(this.ucVideo.Sim,this.ucVideo.Channel)}}},{key:"onClickedCaptureBtn",value:function e(){var t="png";if(this.config.captureType==1){t="jpeg"}else if(this.config.captureType==2){t="webp"}this.Capture("capture_"+this.ucVideo.Sim+"_"+this.ucVideo.Channel+"."+t,this.config.captureType,this.config.captureQuality)}},{key:"onClickedRotateBtn",value:function e(){var t=0;if(this.rotate==0)t=90;else if(this.rotate==90)t=180;else if(this.rotate==180)t=270;this.SetRotate(t)}},{key:"onClickedMirrorInverBtn",value:function e(){this.SetMirrorInver()}},{key:"onClickedStretchBtn",value:function e(){if(!this.is_playing)return;if(this.video.style.objectFit==="fill"){this.video.style.objectFit="";this.btn_stretch.classList.remove("off")}else{this.video.style.objectFit="fill";this.btn_stretch.classList.add("off")}}},{key:"onContextMenu",value:function e(t){for(var i=0;i<16;i++){document.querySelector("#video-menu-"+i).style.width=0}var r=0;var n=0;if(this.rotate==0){if(this.mirrorinver){r=this.video.offsetWidth-t.offsetX;n=t.offsetY}else{r=t.offsetX;n=t.offsetY}}else if(this.rotate==90){if(this.mirrorinver){r=this.video.offsetHeight-t.offsetY;n=this.video.offsetWidth-t.offsetX}else{r=this.video.offsetHeight-t.offsetY;n=t.offsetX}}else if(this.rotate==180){if(this.mirrorinver){r=t.offsetX;n=this.video.offsetHeight-t.offsetY}else{r=this.video.offsetWidth-t.offsetX;n=this.video.offsetHeight-t.offsetY}}else if(this.rotate==270){if(this.mirrorinver){r=t.offsetY;n=t.offsetX}else{r=t.offsetY;n=this.video.offsetWidth-t.offsetX}}var s=document.querySelector("#video-menu-"+this.video_index);s.style.left=r+"px";s.style.top=n+"px";s.style.width="125px";return false}},{key:"onContextMenuCatchPage",value:function e(t){for(var i=0;i<16;i++){document.querySelector("#video-menu-"+i).style.width=0}var r=t.offsetX;var n=t.offsetY;var s=document.querySelector("#video-menu-"+this.video_index);s.style.left=r+"px";s.style.top=n+"px";s.style.width="125px";return false}},{key:"onTimeDayDBClicked",value:function e(t){t=t||window.event;this.cursor_body.style.left=this.time_day.offsetLeft+t.layerX+"px";var i=-this.time_day.offsetLeft+this.cursor_body.offsetLeft+1;var r=this.PadNum(parseInt(i/60),2)+":"+this.PadNum(i%60,2);this.cursor.innerText=r;if(this.video_div.querySelector("#video-time-minute"+i+"-"+this.video_index).classList.contains("active")){var n=this.start_time+i*60;this.ucVideo.ucMain.PlayBackVideoByPlayer(this.video_index+1,n,this.end_time);this.start_time_minute_back=i}else{alert("没有视频")}}},{key:"onTimeDayMouseEvent",value:function e(t){t=t||window.event;this.start_x=t.clientX;var s=this;function i(e){e.preventDefault()}function r(e){e.preventDefault()}function n(e){var t=s.time_rule_body.clientWidth;var i=void 0,r=void 0;var n=e.clientX;if(s.start_x>n){i=s.start_x-n;s.start_x=n;if(s.time_day.offsetLeft-i<t-1440){i=s.time_day.offsetLeft-t+1440}if(i!=0){s.time_day.style.left=s.time_day.offsetLeft-i+"px";s.cursor_body.style.left=s.cursor_body.offsetLeft-i+"px"}}else if(s.start_x<n){i=n-s.start_x;s.start_x=n;if(s.time_day.offsetLeft+i>0){i=-s.time_day.offsetLeft}if(i!=0){s.time_day.style.left=s.time_day.offsetLeft+i+"px";s.cursor_body.style.left=s.cursor_body.offsetLeft+i+"px"}}}function a(e){document.removeEventListener("dragstart",i,false);document.removeEventListener("dragend",r,false);document.removeEventListener("mousemove",n,false);document.removeEventListener("mouseup",a,false)}document.addEventListener("dragstart",i,false);document.addEventListener("dragend",r,false);document.addEventListener("mousemove",n,false);document.addEventListener("mouseup",a,false)}},{key:"onCursorMouseEvent",value:function e(t){t=t||window.event;this.back_drag=true;this.start_x=t.clientX;var c=this;function r(e){e.preventDefault()}function n(e){e.preventDefault()}function s(e){var t=c.time_rule_body.clientWidth;var i=void 0;var r=e.clientX;if(c.start_x>r){i=c.start_x-r;c.start_x=r;i=c.cursor_body.offsetLeft-i;if(i<-1){c.cursor_body.style.left=-1+"px"}else{c.cursor_body.style.left=i+"px"}var n=-c.time_day.offsetLeft+c.cursor_body.offsetLeft+1;var s=c.PadNum(parseInt(n/60),2)+":"+c.PadNum(n%60,2);c.cursor.innerText=s}else if(c.start_x<r){i=r-c.start_x;c.start_x=r;i=c.cursor_body.offsetLeft+i;if(i>t-1){c.cursor_body.style.left=t-1+"px"}else{c.cursor_body.style.left=i+"px"}var a=-c.time_day.offsetLeft+c.cursor_body.offsetLeft+1;var o=c.PadNum(parseInt(a/60),2)+":"+c.PadNum(a%60,2);c.cursor.innerText=o}}function a(e){c.back_drag=false;document.removeEventListener("dragstart",r,false);document.removeEventListener("dragend",n,false);document.removeEventListener("mousemove",s,false);document.removeEventListener("mouseup",a,false);o.default.debug("播放视频");var t=c.cursor_body.offsetLeft+1-c.time_day.offsetLeft;if(this.video_div.querySelector("#video-time-minute"+t+"-"+c.video_index).classList.contains("active")){var i=c.start_time+t*60;this.ucVideo.ucMain.PlayBackVideoByPlayer(c.video_index+1,i,c.end_time);c.start_time_minute_back=t}else{alert("没有视频")}}document.addEventListener("dragstart",r,false);document.addEventListener("dragend",n,false);document.addEventListener("mousemove",s,false);document.addEventListener("mouseup",a,false)}},{key:"onMediaTimeUpdate",value:function e(){if(this.back_drag)return;var t=parseInt(this.video.currentTime)+1;if(!this.is_real_or_back&&this.is_playing&&t>0){var i=this.start_time_minute_back+parseInt(t/60);var r=this.time_rule_body.clientWidth;var n=this.time_day.offsetLeft;var s=i+n<0?0:i+n;s=s>r?r:s;this.cursor_body.style.left=s-1+"px";var a=this.PadNum(parseInt(i/60),2)+":"+this.PadNum(i%60,2);this.cursor.innerText=a}}},{key:"seekcheck",value:function e(){if(this.is_real_or_back&&!this.video.paused&&this.config.seekMode>=0){var t=this.getLastTime();if(t){var i=t-this.video.currentTime;if(i>this.config.maxDelay){if(this.config.seekMode==0){this.video.currentTime=t}else this.video.playbackRate=8}}}}},{key:"getLastTime",value:function e(){var t=this.video.buffered;if(t.length===1){return t.end(t.length-1)}}},{key:"seek2last",value:function e(){var t=this.getLastTime();if(t){this.video.currentTime=t}else{this.video.currentTime=60*60*24*30}}},{key:"PadNum",value:function e(t,i){var r="000000000000000000000"+t;return r.substr(r.length-i)}}]);return n}();i.default=h},{"../../helper/ByteHelper":78,"../../utils/logger":100,"../VideoRecorder":93}],90:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:true});var r=function(){function r(e,t){for(var i=0;i<t.length;i++){var r=t[i];r.enumerable=r.enumerable||false;r.configurable=true;if("value"in r)r.writable=true;Object.defineProperty(e,r.key,r)}}return function(e,t,i){if(t)r(e.prototype,t);if(i)r(e,i);return e}}();var n=e("events");var a=l(n);var s=e("./Audio/AudioSpeek");var o=l(s);var c=e("../utils/cvComm");var d=l(c);function l(e){return e&&e.__esModule?e:{default:e}}function u(e,t){if(!(e instanceof t)){throw new TypeError("Cannot call a class as a function")}}var h=function(){function i(e,t){u(this,i);var s=this.observer=new a.default;s.trigger=function e(t){for(var i=arguments.length,r=Array(i>1?i-1:0),n=1;n<i;n++){r[n-1]=arguments[n]}s.emit.apply(s,[t,t].concat(r))};s.off=function e(t){for(var i=arguments.length,r=Array(i>1?i-1:0),n=1;n<i;n++){r[n-1]=arguments[n]}s.removeListener.apply(s,[t].concat(r))};this.on=s.on.bind(s);this.off=s.off.bind(s);this.trigger=s.trigger.bind(s);this.config=e;this.ucMain=t;this.AudioSpeek=new o.default(this);this.video_id=-1}r(i,[{key:"StartSpeek",value:function e(t,i){t=d.default.SimLen12(t);this.AudioSpeek.StartSpeek(t,i)}},{key:"Stop",value:function e(){this.StopSpeek()}},{key:"StopSpeek",value:function e(){this.AudioSpeek.StopSpeek()}},{key:"CloseSocket",value:function e(){this.AudioSpeek.CloseSocket()}},{key:"InputPcm",value:function e(t,i,r){this.AudioSpeek.InputPcmData(t,i,r)}},{key:"InputEncodeAudio",value:function e(t,i,r){this.AudioSpeek.InputEncodeAudio(t,i,r)}}]);return i}();i.default=h},{"../utils/cvComm":98,"./Audio/AudioSpeek":85,events:5}],91:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:true});var r=function(){function r(e,t){for(var i=0;i<t.length;i++){var r=t[i];r.enumerable=r.enumerable||false;r.configurable=true;if("value"in r)r.writable=true;Object.defineProperty(e,r.key,r)}}return function(e,t,i){if(t)r(e.prototype,t);if(i)r(e,i);return e}}();function n(e,t){if(!(e instanceof t)){throw new TypeError("Cannot call a class as a function")}}var s=function(){function i(e,t){n(this,i)}r(i,[{key:"StartRealTimeVideo",value:function e(t,i){var r=arguments.length>2&&arguments[2]!==undefined?arguments[2]:1;return-1}},{key:"StartBackTimeVideo",value:function e(t,i,r,n){var s=arguments.length>4&&arguments[4]!==undefined?arguments[4]:1;return-1}},{key:"StopVideo",value:function e(){}},{key:"onMediaWaiting",value:function e(){}},{key:"SetRtvsAddr",value:function e(t){}},{key:"onHlsInfo",value:function e(t){}},{key:"onMediaError",value:function e(){}},{key:"onWebrtcSFUInfo",value:function e(t){}},{key:"onBufferAppending",value:function e(t){}},{key:"onBufferReset",value:function e(t){}}]);return i}();i.default=s},{}],92:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:true});var r=function(){function r(e,t){for(var i=0;i<t.length;i++){var r=t[i];r.enumerable=r.enumerable||false;r.configurable=true;if("value"in r)r.writable=true;Object.defineProperty(e,r.key,r)}}return function(e,t,i){if(t)r(e.prototype,t);if(i)r(e,i);return e}}();var n=e("../events");var s=w(n);var a=e("../event-handler");var o=w(a);var c=e("./Interface/interface_player.js");var d=w(c);var l=e("./WebRTC/WebRtcPlayer.js");var u=w(l);var h=e("./Fmp4/Fmp4Player.js");var f=w(h);var p=e("./Hls/HlsPlayer");var m=w(p);var v=e("./WebRTCSrs/WebRTCSrsPlayer");var g=w(v);var y=e("../utils/logger.js");var _=w(y);var b=e("./Gov/GovPlayer");var S=w(b);function w(e){return e&&e.__esModule?e:{default:e}}function k(e,t){if(!(e instanceof t)){throw new TypeError("Cannot call a class as a function")}}function C(e,t){if(!e){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return t&&(typeof t==="object"||typeof t==="function")?t:e}function T(e,t){if(typeof t!=="function"&&t!==null){throw new TypeError("Super expression must either be null or a function, not "+typeof t)}e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:false,writable:true,configurable:true}});if(t)Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t}var P=function(e){T(o,e);r(o,[{key:"Playing",get:function e(){return this.player.Playing}}],[{key:"PlayerMode",get:function e(){return{Fmp4:4,Webrtc:5,Webrtc_srs:7,Gov:8,Hls:6,Wasm:3,Speek:2,None:0}}}]);function o(e){k(this,o);var t=C(this,(o.__proto__||Object.getPrototypeOf(o)).call(this,e,s.default.BUFFER_APPENDING,s.default.BUFFER_RESET,s.default.WEBRTC_SFU_INFO,s.default.HLS_INFO,s.default.WEBRTC_SRS_MSG));t.wfs=e;t.interface_player=new d.default(e,e.config);t.player=null;var i=t.interface_player.GetVideo();if(i){i.onplay=t.onMediaPlay.bind(t);i.onpause=t.onMediaPause.bind(t);i.ontimeupdate=t.onMediaTimeUpdate.bind(t);i.onwaiting=t.onMediaWaiting.bind(t);i.onerror=t.onMediaError.bind(t);i.onended=t.onMediaEnded.bind(t);i.onempty=t.onMediaEmpty.bind(t)}return t}r(o,[{key:"onHlsInfo",value:function e(t){this.player.onHlsInfo(t);if(this.isReal){this.player.StartRealTimeVideo(this.sim,this.channel,this.streamtype)}else{this.player.StartBackTimeVideo(this.sim,this.channel,this.startTime,this.endTime,this.streamtype)}}},{key:"onWebrtcSFUInfo",value:function e(t){this.player.onWebrtcSFUInfo(t);if(this.isReal){this.player.StartRealTimeVideo(this.sim,this.channel,this.streamtype)}else{this.player.StartBackTimeVideo(this.sim,this.channel,this.startTime,this.endTime,this.streamtype)}}},{key:"onWebrtcSrsInfo",value:function e(t){this.player.onWebrtcSrsMsg(t)}},{key:"onBufferAppending",value:function e(t){this.player.onBufferAppending(t)}},{key:"onBufferReset",value:function e(t){this.player.onBufferReset(t)}},{key:"GovPlay",value:function e(t,i){this.player.GovPlay(t,i)}},{key:"GetFmp4ID",value:function e(){if(this.player==null)return-1;if(this.playermode!=o.PlayerMode.Gov)return-1;return this.player.GetFmp4ID()}},{key:"GetFisrtMsg",value:function e(){if(this.player==null)return-1;if(this.playermode!=o.PlayerMode.Gov)return-1;return this.player.GetFisrtMsg()}},{key:"PlayRealVideoBegin",value:function e(t,i){var r=arguments.length>2&&arguments[2]!==undefined?arguments[2]:1;var n=arguments.length>3&&arguments[3]!==undefined?arguments[3]:1;this.StopPlay();this.interface_player.StartPlay();this.sim=t;this.channel=i;this.streamtype=r;this.playermode=n;this.isReal=true;switch(this.playermode){case o.PlayerMode.Fmp4:this.player=new f.default(this.wfs,this.interface_player.GetVideo());break;case o.PlayerMode.Webrtc:this.player=new u.default(this.wfs,this.interface_player.GetVideo());break;case o.PlayerMode.Hls:this.player=new m.default(this.wfs,this.interface_player.GetVideo());break;case o.PlayerMode.Wasm:this.player=new Wasm(this.wfs,this.interface_player.GetVideo());break;case o.PlayerMode.Webrtc_srs:this.player=new g.default(this.wfs,this.interface_player.GetVideo());break;case o.PlayerMode.Gov:this.player=new S.default(this.wfs,this.interface_player.GetVideo());break}}},{key:"PlayBackVideoBegin",value:function e(t,i,r,n){var s=arguments.length>4&&arguments[4]!==undefined?arguments[4]:1;var a=arguments.length>5&&arguments[5]!==undefined?arguments[5]:4;this.StopPlay();this.interface_player.StartPlay();this.sim=t;this.channel=i;this.startTime=r;this.endTime=n;this.streamtype=s;this.playermode=a;this.isReal=false;switch(this.playermode){case o.PlayerMode.Fmp4:this.player=new f.default(this.wfs,this.interface_player.GetVideo());break;case o.PlayerMode.Webrtc:this.player=new u.default(this.wfs,this.interface_player.GetVideo());break;case o.PlayerMode.Hls:this.player=new m.default(this.wfs,this.interface_player.GetVideo());break;case o.PlayerMode.Wasm:this.player=new Wasm(this.wfs,this.interface_player.GetVideo());break;case o.PlayerMode.Webrtc_srs:this.player=new g.default(this.wfs,this.interface_player.GetVideo());break;case o.PlayerMode.Gov:this.player=new S.default(this.wfs,this.interface_player.GetVideo());break}}},{key:"StopPlay",value:function e(){this.interface_player.StopPlay();if(this.player!=null){this.player.StopVideo();this.player=null}}},{key:"SetRtvsAddr",value:function e(t){if(this.player&&this.player.SetRtvsAddr)this.player.SetRtvsAddr(t)}},{key:"PlayVideoBegin",value:function e(){this.interface_player.LoadingPage(true,"等待视频...")}},{key:"SetMuted",value:function e(t){this.interface_player.SetMuted(t)}},{key:"LoadingPage",value:function e(t,i,r){this.interface_player.LoadingPage(t,i,r)}},{key:"SetOsdVisible",value:function e(t){this.interface_player.SetOsdVisible(t)}},{key:"SetOsdColor",value:function e(t){this.interface_player.SetOsdColor(t)}},{key:"SetOsdText",value:function e(t){this.interface_player.SetOsdText(t)}},{key:"SetKBpsText",value:function e(t){this.interface_player.SetKBpsText(t)}},{key:"ShowRecordText",value:function e(){this.interface_player.ShowRecordText()}},{key:"SetRotate",value:function e(t){this.interface_player.SetRotate(t)}},{key:"SetMirrorInver",value:function e(){this.interface_player.SetMirrorInver()}},{key:"QueryVideoListBegin",value:function e(){this.interface_player.QueryVideoListBegin()}},{key:"AddVideoList",value:function e(t,i,r){this.interface_player.AddVideoList(t,i,r)}},{key:"GetVideoDiv",value:function e(){return this.interface_player.video_div}},{key:"SetRealOrBack",value:function e(t){this.interface_player.SetRealOrBack(t)}},{key:"onMediaPlay",value:function e(){_.default.debug("video play")}},{key:"onMediaPause",value:function e(){_.default.debug("video pause")}},{key:"onMediaTimeUpdate",value:function e(){if(this.interface_player.GetVideo().currentTime===0)return;this.LoadingPage(false);this.interface_player.onMediaTimeUpdate()}},{key:"onMediaWaiting",value:function e(){this.player.onMediaWaiting();if(this.wfs.config.showLoadingByPlay){this.LoadingPage(true,"等待视频...",this.wfs.config.showLoadDelayMs)}}},{key:"onMediaError",value:function e(){_.default.debug("video error");if(this.player.onMediaError){this.player.onMediaError()}}},{key:"onMediaEnded",value:function e(){_.default.debug("video ended")}},{key:"onMediaEmpty",value:function e(){_.default.debug("video empty")}}]);return o}(o.default);i.default=P},{"../event-handler":76,"../events":77,"../utils/logger.js":100,"./Fmp4/Fmp4Player.js":86,"./Gov/GovPlayer":87,"./Hls/HlsPlayer":88,"./Interface/interface_player.js":89,"./WebRTC/WebRtcPlayer.js":95,"./WebRTCSrs/WebRTCSrsPlayer":94}],93:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:true});var r=function(){function r(e,t){for(var i=0;i<t.length;i++){var r=t[i];r.enumerable=r.enumerable||false;r.configurable=true;if("value"in r)r.writable=true;Object.defineProperty(e,r.key,r)}}return function(e,t,i){if(t)r(e.prototype,t);if(i)r(e,i);return e}}();var n=e("../utils/logger.js");var s=a(n);function a(e){return e&&e.__esModule?e:{default:e}}function o(e,t){if(!(e instanceof t)){throw new TypeError("Cannot call a class as a function")}}var c=function(){function i(e,t){o(this,i);this.chunks=[];this.types=[{mime:"video/mp4",ft:"mp4"},{mime:"video/webm",ft:"webm"},{mime:"video/webm;codecs=h264",ft:"webm"},{mime:"video/webm;codecs=vp8",ft:"webm"},{mime:"video/webm;codecs=vp9",ft:"webm"},{mime:"video/mpeg",ft:"mpeg"}];this.tp=this.types[0];this.video=e;this.onChange=t}r(i,[{key:"start",value:function e(t,i){try{this.startTime=new Date;this.sim=t;this.channel=i;this.tp=null;for(var r in this.types){if(MediaRecorder.isTypeSupported(this.types[r].mime)){this.tp=this.types[r];break}}if(this.tp==null){s.default.error("MediaRecorder not supported mime");return false}var n=void 0;if(this.video.captureStream){n=this.video.captureStream(25)}else if(this.video.mozCaptureStream){n=this.video.mozCaptureStream(25)}else{s.default.error("captureStream() not supported");return false}this.chunks=[];this.mediaRecorder=new MediaRecorder(n,{mimeType:this.tp.mime});this.mediaRecorder.ondataavailable=this.handle_dataavailable.bind(this);this.mediaRecorder.onstop=this.handleStop.bind(this);this.mediaRecorder.start();this.started=true;this.onChange(this.started);return true}catch(e){s.default.error("MediaRecorder not supported",e);return false}}},{key:"stop",value:function e(){if(this.mediaRecorder){this.mediaRecorder.stop();this.mediaRecorder=null}}},{key:"handle_dataavailable",value:function e(t){this.chunks.push(t.data)}},{key:"handleStop",value:function e(t){s.default.debug("Recorder stopped: ",t);this.stopTime=new Date;s.default.downUint8Arrays(this.chunks,"R"+this.sim+"_"+this.channel+"_"+this.startTime.getTime()+"_"+this.stopTime.getTime()+"."+this.tp.ft);this.chunks=[];this.started=false;this.onChange(this.started)}}]);return i}();i.default=c},{"../utils/logger.js":100}],94:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:true});var n=function(){function r(e,t){for(var i=0;i<t.length;i++){var r=t[i];r.enumerable=r.enumerable||false;r.configurable=true;if("value"in r)r.writable=true;Object.defineProperty(e,r.key,r)}}return function(e,t,i){if(t)r(e.prototype,t);if(i)r(e,i);return e}}();var r=e("../PlayerInterface.js");var s=a(r);function a(e){return e&&e.__esModule?e:{default:e}}function o(e,t){if(!(e instanceof t)){throw new TypeError("Cannot call a class as a function")}}function c(e,t){if(!e){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return t&&(typeof t==="object"||typeof t==="function")?t:e}function d(e,t){if(typeof t!=="function"&&t!==null){throw new TypeError("Super expression must either be null or a function, not "+typeof t)}e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:false,writable:true,configurable:true}});if(t)Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t}var l=function(e){d(r,e);function r(e,t){o(this,r);var i=c(this,(r.__proto__||Object.getPrototypeOf(r)).call(this,e,t));i.wfs=e;i.videodom=t;i.time_id=-1;i.pc=null;i.webrtc_url;return i}n(r,[{key:"onWebrtcSrsMsg",value:function e(t){var i=t.Status;this.rtmp_url=t.ServerAddr;this.webrtc_url=t.RtcAddr;this.clientid=t.ClinetID;this.ParseRtcUrl(this.webrtc_url);this.StartVideo()}},{key:"StartVideo",value:function e(){if(this.pc){this.pc.close()}this.pc=new RTCPeerConnection(null);this.pc.onaddstream=function(e){this.videodom.srcObject=e.stream;this.videodom.play();this.StartHeartbeat()}.bind(this);new Promise(function(t,i){this.pc.addTransceiver("audio",{direction:"recvonly"});this.pc.addTransceiver("video",{direction:"recvonly"});this.pc.createOffer(function(e){t(e)},function(e){i(e)})}.bind(this)).then(function(e){return this.pc.setLocalDescription(e).then(function(){return e})}.bind(this)).then(function(s){return new Promise(function(t,i){var e="/rtc/v1/play/";var r="http://"+this.rtc_server+":"+this.rtc_apiport+e;var n={api:r,streamurl:this.webrtc_url,clientip:null,sdp:s.sdp};$.ajax({type:"POST",url:r,data:JSON.stringify(n),contentType:"application/json",dataType:"json"}).done(function(e){t(e.sdp)}).fail(function(e){i(e)})}.bind(this))}.bind(this)).then(function(e){return this.pc.setRemoteDescription(new RTCSessionDescription({type:"answer",sdp:e}))}.bind(this)).catch(function(e){throw e})}},{key:"StopVideo",value:function e(){this.videodom.srcObject=null;if(this.pc){this.pc.close();this.pc=null}this.StopHeartbeat()}},{key:"ParseRtcUrl",value:function e(t){var i=document.createElement("a");i.href=t.replace("rtmp://","http://").replace("webrtc://","http://").replace("rtc://","http://");this.rtc_server=i.hostname;this.rtc_apiport=i.port}},{key:"StartHeartbeat",value:function e(){if(this.time_id===-1){this.time_id=setInterval(this.SendHeartbeatPackage.bind(this),1e3*5)}}},{key:"StopHeartbeat",value:function e(){clearInterval(this.time_id);this.time_id=-1}},{key:"SendHeartbeatPackage",value:function e(){this.wfs.jt1078.SendHeartRtmp(this.wfs.Sim,this.wfs.Channel,this.rtmp_url,this.clientid)}},{key:"Playing",get:function e(){return this.pc!=null}}]);return r}(s.default);i.default=l},{"../PlayerInterface.js":91}],95:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:true});var n=function(){function r(e,t){for(var i=0;i<t.length;i++){var r=t[i];r.enumerable=r.enumerable||false;r.configurable=true;if("value"in r)r.writable=true;Object.defineProperty(e,r.key,r)}}return function(e,t,i){if(t)r(e.prototype,t);if(i)r(e,i);return e}}();var r=e("../PlayerInterface.js");var s=y(r);var a=e("protoo-client");var o=y(a);var c=e("mediasoup-client");var _=g(c);var d=e("url-parse");var l=y(d);var u=e("random-string");var p=y(u);var h=e("../../utils/logger");var b=y(h);var f=e("../../utils/cvComm");var m=y(f);var v=e("./urlFactory");function g(e){if(e&&e.__esModule){return e}else{var t={};if(e!=null){for(var i in e){if(Object.prototype.hasOwnProperty.call(e,i))t[i]=e[i]}}t.default=e;return t}}function y(e){return e&&e.__esModule?e:{default:e}}function S(e,t){if(!(e instanceof t)){throw new TypeError("Cannot call a class as a function")}}function w(e,t){if(!e){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return t&&(typeof t==="object"||typeof t==="function")?t:e}function k(e,t){if(typeof t!=="function"&&t!==null){throw new TypeError("Super expression must either be null or a function, not "+typeof t)}e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:false,writable:true,configurable:true}});if(t)Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t}var C=function(e){k(r,e);function r(e,t){S(this,r);var i=w(this,(r.__proto__||Object.getPrototypeOf(r)).call(this,e,t));i.wfs=e;i.videodom=t;i.webrtcInit(false);i.time_id=-1;return i}n(r,[{key:"onWebrtcSFUInfo",value:function e(t){this._webrtc_ip=t.webrtc_ip;if(m.default.IsHttps()){this._webrtc_port=t.webrtc_port_ssl}else{this._webrtc_port=t.webrtc_port}this.roomid=t.roomid}},{key:"StartRealTimeVideo",value:function e(t,i){var r=arguments.length>2&&arguments[2]!==undefined?arguments[2]:1;this.Sim=t;this.Channel=i;var n=t;var s=i;var a=(0,p.default)({length:8}).toLowerCase();var o=this._webrtc_ip;var c=this._webrtc_port;var d=this.roomid;b.default.custom("webrtc","StartRealTimeVideo webrtc:%s:%s",o,c);this._protooUrl=(0,v.getProtooUrl)({sim:n,channel:s,peerId:a,webrtcip:o,webrtcport:c,roomid:d,streamType:r});this.StartVideo()}},{key:"StartBackTimeVideo",value:function e(t,i,r,n){var s=arguments.length>4&&arguments[4]!==undefined?arguments[4]:1;this.Sim=t;this.Channel=i;var a=t;var o=i;var c=(0,p.default)({length:8}).toLowerCase();var d=this._webrtc_ip;var l=this._webrtc_port;var u=this.roomid;var h=r;var f=n;b.default.custom("webrtc","StartBackTimeVideo webrtc:%s:%s",d,l);this._protooUrl=(0,v.getProtooUrlHistory)({sim:a,channel:o,peerId:c,webrtcip:d,webrtcport:l,roomid:u,startTime:h,endTime:f,streamType:s});this.StartVideo()}},{key:"StopVideo",value:function e(){this.webrtcClose();this.videodom.srcObject=null}},{key:"SetRtvsAddr",value:function e(t){this._rtvs_ip=t}},{key:"StartHeartbeat",value:function e(){if(this.time_id===-1){this.time_id=setInterval(this.SendHeartbeatPackage.bind(this),1e3*5)}}},{key:"StopHeartbeat",value:function e(){clearInterval(this.time_id);this.time_id=-1}},{key:"SendHeartbeatPackage",value:function e(){this.wfs.jt1078.Send8801(this.Sim,this.Channel,this._roomId.roomid)}},{key:"StartVideo",value:function e(){var y=this;var t=new o.default.WebSocketTransport(this._protooUrl);this._protoo=new o.default.Peer(t);this._protoo.on("open",function(){return y._joinRoom()});this._protoo.on("disconnected",function(){if(y._recvTransport){y._recvTransport.close();y._recvTransport=null}});this._protoo.on("close",function(){if(y._closed)return;y.webrtcClose()});this._protoo.on("request",async function(e,t,i){b.default.custom("webrtc",'proto "request" event [method:%s, data:%o]',e.method,e.data);switch(e.method){case"newConsumer":{var r=e.data,n=r.peerId,s=r.producerId,a=r.id,o=r.kind,c=r.rtpParameters,d=r.type,l=r.appData,u=r.producerPaused;var h=void 0;if(o==="audio"){h={opusStereo:1}}try{var f=await y._recvTransport.consume({id:a,producerId:s,kind:o,rtpParameters:c,codecOptions:h,appData:{appData:l,peerId:n}});y._consumers.set(f.id,f);f.on("transportclose",function(){y._consumers.delete(f.id)});var p=_.parseScalabilityMode(f.rtpParameters.encodings[0].scalabilityMode),m=p.spatialLayers,v=p.temporalLayers;var g=f.track;if(y.videodom.srcObject==null){y.videodom.srcObject=new MediaStream([g])}else{y.videodom.srcObject.addTrack(g)}y.videodom.play();t()}catch(e){b.default.error('"newConsumer" request failed:%o',e);throw e}break}}});this._protoo.on("notification",function(e){b.default.custom("webrtc",'proto "notification" event [method:%s, data:%o]',e.method,e.data);switch(e.method){case"consumerClosed":{var t=e.data.consumerId;var i=y._consumers.get(t);if(!i)break;i.close();y._consumers.delete(t);break}}});this._closed=false}},{key:"webrtcInit",value:function e(t){this._closed=true;this._forceTcp=t;this._protoo=null;this._recvTransport=null;this._consumers=new Map;var i=new l.default(window.location.href,true);this._handlerName=i.query.handler}},{key:"webrtcClose",value:function e(){if(this._closed)return;this._closed=true;b.default.custom("webrtc","close()");this._protoo.close();if(this._recvTransport){this._recvTransport.close();this.StopHeartbeat()}}},{key:"_joinRoom",value:async function e(){var n=this;b.default.custom("webrtc","_joinRoom()");try{this._mediasoupDevice=new _.Device({handlerName:this._handlerName});var t=await this._protoo.request("getRouterRtpCapabilities");this._roomId=await this._protoo.request("getRoomId");await this._mediasoupDevice.load({routerRtpCapabilities:t});if(true){var i=await this._protoo.request("createWebRtcTransport",{forceTcp:this._forceTcp,producing:false,consuming:true,sctpCapabilities:undefined});var r=i.id,s=i.iceParameters,a=i.iceCandidates,o=i.dtlsParameters,c=i.sctpParameters;this._recvTransport=this._mediasoupDevice.createRecvTransport({id:r,iceParameters:s,iceCandidates:a,dtlsParameters:o,sctpParameters:c,iceServers:[]});this._recvTransport.on("connect",function(e,t,i){var r=e.dtlsParameters;b.default.custom("webrtc","_recvTransport.on connect");n._protoo.request("connectWebRtcTransport",{transportId:n._recvTransport.id,dtlsParameters:r}).then(t).catch(i)});this.StartHeartbeat()}var d=await this._protoo.request("join",{displayName:"rtvs",device:"rtvs",rtpCapabilities:this._mediasoupDevice.rtpCapabilities,sctpCapabilities:undefined}),l=d.peers}catch(e){b.default.custom("webrtc","_joinRoom() failed:%o",e);this.webrtcClose()}}},{key:"enableAudioOnly",value:async function e(){b.default.custom("webrtc","enableAudioOnly()");var t=true;var i=false;var r=undefined;try{for(var n=this._consumers.values()[Symbol.iterator](),s;!(t=(s=n.next()).done);t=true){var a=s.value;if(a.kind!=="video")continue;this._pauseConsumer(a)}}catch(e){i=true;r=e}finally{try{if(!t&&n.return){n.return()}}finally{if(i){throw r}}}}},{key:"disableAudioOnly",value:async function e(){b.default.custom("webrtc","disableAudioOnly()");var t=true;var i=false;var r=undefined;try{for(var n=this._consumers.values()[Symbol.iterator](),s;!(t=(s=n.next()).done);t=true){var a=s.value;if(a.kind!=="video")continue;this._resumeConsumer(a)}}catch(e){i=true;r=e}finally{try{if(!t&&n.return){n.return()}}finally{if(i){throw r}}}}},{key:"restartIce",value:async function e(){b.default.custom("webrtc","restartIce()");try{if(this._recvTransport){var t=await this._protoo.request("restartIce",{transportId:this._recvTransport.id});await this._recvTransport.restartIce({iceParameters:t})}}catch(e){b.default.error("restartIce() | failed:%o",e)}}},{key:"setConsumerPreferredLayers",value:async function e(t,i,r){b.default.custom("webrtc","setConsumerPreferredLayers() [consumerId:%s, spatialLayer:%s, temporalLayer:%s]",t,i,r);try{await this._protoo.request("setConsumerPreferredLayers",{consumerId:t,spatialLayer:i,temporalLayer:r})}catch(e){b.default.error("setConsumerPreferredLayers() | failed:%o",e)}}},{key:"setConsumerPriority",value:async function e(t,i){b.default.custom("webrtc","setConsumerPriority() [consumerId:%s, priority:%d]",t,i);try{await this._protoo.request("setConsumerPriority",{consumerId:t,priority:i})}catch(e){b.default.error("setConsumerPriority() | failed:%o",e)}}},{key:"requestConsumerKeyFrame",value:async function e(t){b.default.custom("webrtc","requestConsumerKeyFrame() [consumerId:%s]",t);try{await this._protoo.request("requestConsumerKeyFrame",{consumerId:t})}catch(e){b.default.error("requestConsumerKeyFrame() | failed:%o",e)}}},{key:"changeDisplayName",value:async function e(t){b.default.custom("webrtc",'changeDisplayName() [displayName:"%s"]',t);try{await this._protoo.request("changeDisplayName",{displayName:t});this._displayName=t}catch(e){b.default.error("changeDisplayName() | failed: %o",e)}}},{key:"getRecvTransportRemoteStats",value:async function e(){b.default.custom("webrtc","getRecvTransportRemoteStats()");if(!this._recvTransport)return;return this._protoo.request("getTransportStats",{transportId:this._recvTransport.id})}},{key:"getConsumerRemoteStats",value:async function e(t){b.default.custom("webrtc","getConsumerRemoteStats()");var i=this._consumers.get(t);if(!i)return;return this._protoo.request("getConsumerStats",{consumerId:t})}},{key:"getRecvTransportLocalStats",value:async function e(){b.default.custom("webrtc","getRecvTransportLocalStats()");if(!this._recvTransport)return;return this._recvTransport.getStats()}},{key:"getConsumerLocalStats",value:async function e(t){var i=this._consumers.get(t);if(!i)return;return i.getStats()}},{key:"applyNetworkThrottle",value:async function e(t){var i=t.uplink,r=t.downlink,n=t.rtt,s=t.secret;b.default.custom("webrtc","applyNetworkThrottle() [uplink:%s, downlink:%s, rtt:%s]",i,r,n);try{await this._protoo.request("applyNetworkThrottle",{uplink:i,downlink:r,rtt:n,secret:s})}catch(e){b.default.error("applyNetworkThrottle() | failed:%o",e)}}},{key:"resetNetworkThrottle",value:async function e(t){var i=t.silent,r=i===undefined?false:i,n=t.secret;b.default.custom("webrtc","resetNetworkThrottle()");try{await this._protoo.request("resetNetworkThrottle",{secret:n})}catch(e){if(!r){b.default.error("resetNetworkThrottle() | failed:%o",e)}}}},{key:"_pauseConsumer",value:async function e(t){if(t.paused)return;try{await this._protoo.request("pauseConsumer",{consumerId:t.id});t.pause()}catch(e){b.default.error("_pauseConsumer() | failed:%o",e)}}},{key:"_resumeConsumer",value:async function e(t){if(!t.paused)return;try{await this._protoo.request("resumeConsumer",{consumerId:t.id});t.resume()}catch(e){b.default.error("_resumeConsumer() | failed:%o",e)}}},{key:"Playing",get:function e(){return!this._closed}}]);return r}(s.default);i.default=C},{"../../utils/cvComm":98,"../../utils/logger":100,"../PlayerInterface.js":91,"./urlFactory":96,"mediasoup-client":37,"protoo-client":50,"random-string":58,"url-parse":67}],96:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:true});i.getProtooUrl=s;i.getProtooUrlHistory=a;var r=e("../../utils/cvComm");var h=n(r);function n(e){return e&&e.__esModule?e:{default:e}}function f(){function e(){return((1+Math.random())*65536|0).toString(16).substring(1)}return e()+e()+"-"+e()+"-"+e()+"-"+e()+"-"+e()+e()+e()}function s(e){var t=e.sim,i=e.channel,r=e.peerId,n=e.webrtcip,s=e.webrtcport,a=e.roomid,o=e.streamType;var c=h.default.GetWsp()+(n+":"+s+"/?sim="+t+"&channel="+i+"&peerId="+r+"&roomid="+a+"&streamType="+o+"&isReal=1");return c}function a(e){var t=e.sim,i=e.channel,r=e.peerId,n=e.webrtcip,s=e.webrtcport,a=e.roomid,o=e.startTime,c=e.endTime,d=e.streamType;var l=f();var u=h.default.GetWsp()+(n+":"+s+"/?sim="+t+"&channel="+i+"&peerId="+r+"&roomid="+a+"&startTime="+o+"&endTime="+c+"&guid="+l+"&streamType="+d+"&isReal=0");return u}},{"../../utils/cvComm":98}],97:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:true});var r=function(){function r(e,t){for(var i=0;i<t.length;i++){var r=t[i];r.enumerable=r.enumerable||false;r.configurable=true;if("value"in r)r.writable=true;Object.defineProperty(e,r.key,r)}}return function(e,t,i){if(t)r(e.prototype,t);if(i)r(e,i);return e}}();var n=e("./player/PlayerMan.js");var s=a(n);function a(e){return e&&e.__esModule?e:{default:e}}function o(e,t){if(!(e instanceof t)){throw new TypeError("Cannot call a class as a function")}}var c=function(){function e(r,n){o(this,e);this.changeTime=(new Date).getTime();this.ucMain=n;this.status=0;this.regEventListener();this.config=r;this.interval=setInterval(function(){if(n.NowPlayVideosCount>0){var e=(new Date).getTime()-this.changeTime;if(r.timeoutWarningMsec>0){if(this.status==0&&e>=r.timeoutWarningMsec){this.status=1;if(r.events.timeoutWarning)r.events.timeoutWarning(r.timeoutCloseMsec-e,this.changeTime)}}if(r.timeoutCloseMsec>0){if(this.status<2&&e>=r.timeoutCloseMsec){this.status=2;if(r.events.timeoutClose)r.events.timeoutClose(this.changeTime)}}for(var t in n.Videos){var i=n.Videos[t];if(i&&i.IsPlaying()){if(i.tmpShowKBpsText){i.tmpShowKBpsText=false}else{i.tmpShowKBpsText=true;i.ShowKBpsText()}i.ShowRecordText()}}}}.bind(this),1e3)}r(e,[{key:"regEventListener",value:function e(){window.addEventListener("click",this.onevent.bind(this));window.addEventListener("keydown",this.onevent.bind(this));window.addEventListener("mousemove",this.onevent.bind(this));window.addEventListener("mousewheel",this.onevent.bind(this))}},{key:"onevent",value:function e(){if(this.status==1){if(this.config.events.timeoutCanceled)this.config.events.timeoutCanceled()}this.status=0;this.changeTime=(new Date).getTime()}}]);return e}();i.default=c},{"./player/PlayerMan.js":92}],98:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:true});var r=function(){function r(e,t){for(var i=0;i<t.length;i++){var r=t[i];r.enumerable=r.enumerable||false;r.configurable=true;if("value"in r)r.writable=true;Object.defineProperty(e,r.key,r)}}return function(e,t,i){if(t)r(e.prototype,t);if(i)r(e,i);return e}}();function n(e,t){if(!(e instanceof t)){throw new TypeError("Cannot call a class as a function")}}var s=function(){function t(){n(this,t)}r(t,null,[{key:"SimLen12",value:function e(t){if(typeof t!=="string"){t=String(t)}if(t.length>12){return t.substr(0,12)}else{while(t.length<12){t="0"+t}return t}}},{key:"IsHttps",value:function e(){if(document){return document.location.protocol=="https:"}else{return true}}},{key:"GetWsp",value:function e(){if(t.IsHttps()){return"wss://"}else{return"ws://"}}},{key:"loadJs",value:function e(t,i){var r=document.createElement("script");r.type="text/javascript";if(typeof i!="undefined"){if(r.readyState){r.onreadystatechange=function(){if(r.readyState=="loaded"||r.readyState=="complete"){r.onreadystatechange=null;i()}}}else{r.onload=function(){i()}}}r.src=t;document.body.appendChild(r)}},{key:"loadCss",value:function e(t,i,r,n){var s=document.createElement("link");s.type="text/css";s.rel="stylesheet";if(i){s.id=i}if(typeof r!="undefined"){if(s.readyState){s.onreadystatechange=function(){if(s.readyState=="loaded"||s.readyState=="complete"){s.onreadystatechange=null;r()}}}else{s.onload=function(){r()}}}s.href=t;if(n)document.head.prepend(s);else document.head.appendChild(s)}}]);return t}();i.default=s},{}],99:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:true});var r=function(){function r(e,t){for(var i=0;i<t.length;i++){var r=t[i];r.enumerable=r.enumerable||false;r.configurable=true;if("value"in r)r.writable=true;Object.defineProperty(e,r.key,r)}}return function(e,t,i){if(t)r(e.prototype,t);if(i)r(e,i);return e}}();function n(e,t){if(!(e instanceof t)){throw new TypeError("Cannot call a class as a function")}}var s=function e(t,i){var r=arguments.length>2&&arguments[2]!==undefined?arguments[2]:4;n(this,e);this.min=i;this.max=i+r;this.bits_per_coded_sample=t};var a=function(){function i(){n(this,i);this.data=new Array;this.default_bits_per_coded_sample=4}r(i,[{key:"get_bits_per_coded_sample",value:function e(t){for(var i=0;i<this.data.length;i++){var r=this.data[i];if(t>=r.min&&t<=r.max){return r.bits_per_coded_sample}}return this.default_bits_per_coded_sample}}],[{key:"getDefault",value:function e(){var t=new i;t.data.push(new s(2,20));t.data.push(new s(2,40));t.data.push(new s(3,30));t.data.push(new s(3,60));t.data.push(new s(3,90));t.data.push(new s(3,120));t.data.push(new s(3,180));t.data.push(new s(4,80));t.data.push(new s(4,160));t.data.push(new s(4,240));t.data.push(new s(5,50));t.data.push(new s(5,100));t.data.push(new s(5,150));t.data.push(new s(5,200));t.data.push(new s(5,300));return t}}]);return i}();i.default=a},{}],100:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:true});var c=typeof Symbol==="function"&&typeof Symbol.iterator==="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol==="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};var r=function(){function r(e,t){for(var i=0;i<t.length;i++){var r=t[i];r.enumerable=r.enumerable||false;r.configurable=true;if("value"in r)r.writable=true;Object.defineProperty(e,r.key,r)}}return function(e,t,i){if(t)r(e.prototype,t);if(i)r(e,i);return e}}();function n(e,t){if(!(e instanceof t)){throw new TypeError("Cannot call a class as a function")}}var s=function(){function o(){n(this,o)}r(o,null,[{key:"SetLevel",value:function e(t){o.level=t}},{key:"SetTag",value:function e(t){if(typeof o.tags=="undefined")o.tags=new Map;o.tags.set(t,1)}},{key:"debug",value:function e(t){var i;if(typeof o.level!="undefined"&&o.level>0){return}for(var r=arguments.length,n=Array(r>1?r-1:0),s=1;s<r;s++){n[s-1]=arguments[s]}(i=console).log.apply(i,["debug:"+(new Date).toLocaleTimeString()+" :"+t].concat(n))}},{key:"warn",value:function e(t){var i;if(typeof o.level!="undefined"&&o.level>1){return}for(var r=arguments.length,n=Array(r>1?r-1:0),s=1;s<r;s++){n[s-1]=arguments[s]}(i=console).log.apply(i,["warn:"+(new Date).toLocaleTimeString()+" :"+t].concat(n))}},{key:"error",value:function e(t){var i;if(typeof o.level!="undefined"&&o.level>2){return}for(var r=arguments.length,n=Array(r>1?r-1:0),s=1;s<r;s++){n[s-1]=arguments[s]}(i=console).log.apply(i,["error "+(new Date).toLocaleTimeString()+" :"+t].concat(n))}},{key:"custom",value:function e(t,i){var r;if(typeof o.tags=="undefined")return;if(!c(o.tags.has(t)))return;for(var n=arguments.length,s=Array(n>2?n-2:0),a=2;a<n;a++){s[a-2]=arguments[a]}(r=console).log.apply(r,["tag:"+t+" "+(new Date).toLocaleTimeString()+" :"+i].concat(s))}},{key:"downArrayBuffer",value:function e(t,i){var r=new Blob([t]);var n=document.createElement("a");n.download=i;n.style.display="none";n.href=URL.createObjectURL(r);document.body.appendChild(n);n.click();URL.revokeObjectURL(n.href);document.body.removeChild(n)}},{key:"downUint8Arrays",value:function e(t,i){var r=new Blob(t);var n=document.createElement("a");n.download=i;n.style.display="none";n.href=URL.createObjectURL(r);document.body.appendChild(n);n.click();URL.revokeObjectURL(n.href);document.body.removeChild(n)}},{key:"diffTimeStr",value:function e(t,i){var r=i.getTime()-t.getTime();var n=Math.floor(r/(24*3600*1e3));var s=r%(24*3600*1e3);var a=Math.floor(s/(3600*1e3));var o=s%(3600*1e3);var c=Math.floor(o/(60*1e3));var d=o%(60*1e3);var l=Math.round(d/1e3);var u=l.toString();if(l<10){u="0"+u}u=c+":"+u;if(c<10){u="0"+u}if(a>0){u=a+":"+u}if(n>0){u=n+"d"+u}return u}}]);return o}();i.default=s},{}],101:[function(e,t,i){"use strict";t.exports=n;var m=null;try{m=new WebAssembly.Instance(new WebAssembly.Module(new Uint8Array([0,97,115,109,1,0,0,0,1,13,2,96,0,1,127,96,4,127,127,127,127,1,127,3,7,6,0,1,1,1,1,1,6,6,1,127,1,65,0,11,7,50,6,3,109,117,108,0,1,5,100,105,118,95,115,0,2,5,100,105,118,95,117,0,3,5,114,101,109,95,115,0,4,5,114,101,109,95,117,0,5,8,103,101,116,95,104,105,103,104,0,0,10,191,1,6,4,0,35,0,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,126,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,127,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,128,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,129,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,130,34,4,66,32,135,167,36,0,32,4,167,11])),{}).exports}catch(e){}function n(e,t,i){this.low=e|0;this.high=t|0;this.unsigned=!!i}n.prototype.__isLong__;Object.defineProperty(n.prototype,"__isLong__",{value:true});function v(e){return(e&&e["__isLong__"])===true}n.isLong=v;var s={};var a={};function r(e,t){var i,r,n;if(t){e>>>=0;if(n=0<=e&&e<256){r=a[e];if(r)return r}i=y(e,(e|0)<0?-1:0,true);if(n)a[e]=i;return i}else{e|=0;if(n=-128<=e&&e<128){r=s[e];if(r)return r}i=y(e,e<0?-1:0,false);if(n)s[e]=i;return i}}n.fromInt=r;function g(e,t){if(isNaN(e))return t?p:S;if(t){if(e<0)return p;if(e>=h)return P}else{if(e<=-f)return R;if(e+1>=f)return T}if(e<0)return g(-e,t).neg();return y(e%d|0,e/d|0,t)}n.fromNumber=g;function y(e,t,i){return new n(e,t,i)}n.fromBits=y;var u=Math.pow;function l(e,t,i){if(e.length===0)throw Error("empty string");if(e==="NaN"||e==="Infinity"||e==="+Infinity"||e==="-Infinity")return S;if(typeof t==="number"){i=t,t=false}else{t=!!t}i=i||10;if(i<2||36<i)throw RangeError("radix");var r;if((r=e.indexOf("-"))>0)throw Error("interior hyphen");else if(r===0){return l(e.substring(1),t,i).neg()}var n=g(u(i,8));var s=S;for(var a=0;a<e.length;a+=8){var o=Math.min(8,e.length-a),c=parseInt(e.substring(a,a+o),i);if(o<8){var d=g(u(i,o));s=s.mul(d).add(g(c))}else{s=s.mul(n);s=s.add(g(c))}}s.unsigned=t;return s}n.fromString=l;function _(e,t){if(typeof e==="number")return g(e,t);if(typeof e==="string")return l(e,t);return y(e.low,e.high,typeof t==="boolean"?t:e.unsigned)}n.fromValue=_;var o=1<<16;var c=1<<24;var d=o*o;var h=d*d;var f=h/2;var b=r(c);var S=r(0);n.ZERO=S;var p=r(0,true);n.UZERO=p;var w=r(1);n.ONE=w;var k=r(1,true);n.UONE=k;var C=r(-1);n.NEG_ONE=C;var T=y(4294967295|0,2147483647|0,false);n.MAX_VALUE=T;var P=y(4294967295|0,4294967295|0,true);n.MAX_UNSIGNED_VALUE=P;var R=y(0,2147483648|0,false);n.MIN_VALUE=R;var x=n.prototype;x.toInt=function e(){return this.unsigned?this.low>>>0:this.low};x.toNumber=function e(){if(this.unsigned)return(this.high>>>0)*d+(this.low>>>0);return this.high*d+(this.low>>>0)};x.toString=function e(t){t=t||10;if(t<2||36<t)throw RangeError("radix");if(this.isZero())return"0";if(this.isNegative()){if(this.eq(R)){var i=g(t),r=this.div(i),n=r.mul(i).sub(this);return r.toString(t)+n.toInt().toString(t)}else return"-"+this.neg().toString(t)}var s=g(u(t,6),this.unsigned),a=this;var o="";while(true){var c=a.div(s),d=a.sub(c.mul(s)).toInt()>>>0,l=d.toString(t);a=c;if(a.isZero())return l+o;else{while(l.length<6){l="0"+l}o=""+l+o}}};x.getHighBits=function e(){return this.high};x.getHighBitsUnsigned=function e(){return this.high>>>0};x.getLowBits=function e(){return this.low};x.getLowBitsUnsigned=function e(){return this.low>>>0};x.getNumBitsAbs=function e(){if(this.isNegative())return this.eq(R)?64:this.neg().getNumBitsAbs();var t=this.high!=0?this.high:this.low;for(var i=31;i>0;i--){if((t&1<<i)!=0)break}return this.high!=0?i+33:i+1};x.isZero=function e(){return this.high===0&&this.low===0};x.eqz=x.isZero;x.isNegative=function e(){return!this.unsigned&&this.high<0};x.isPositive=function e(){return this.unsigned||this.high>=0};x.isOdd=function e(){return(this.low&1)===1};x.isEven=function e(){return(this.low&1)===0};x.equals=function e(t){if(!v(t))t=_(t);if(this.unsigned!==t.unsigned&&this.high>>>31===1&&t.high>>>31===1)return false;return this.high===t.high&&this.low===t.low};x.eq=x.equals;x.notEquals=function e(t){return!this.eq(t)};x.neq=x.notEquals;x.ne=x.notEquals;x.lessThan=function e(t){return this.comp(t)<0};x.lt=x.lessThan;x.lessThanOrEqual=function e(t){return this.comp(t)<=0};x.lte=x.lessThanOrEqual;x.le=x.lessThanOrEqual;x.greaterThan=function e(t){return this.comp(t)>0};x.gt=x.greaterThan;x.greaterThanOrEqual=function e(t){return this.comp(t)>=0};x.gte=x.greaterThanOrEqual;x.ge=x.greaterThanOrEqual;x.compare=function e(t){if(!v(t))t=_(t);if(this.eq(t))return 0;var i=this.isNegative(),r=t.isNegative();if(i&&!r)return-1;if(!i&&r)return 1;if(!this.unsigned)return this.sub(t).isNegative()?-1:1;return t.high>>>0>this.high>>>0||t.high===this.high&&t.low>>>0>this.low>>>0?-1:1};x.comp=x.compare;x.negate=function e(){if(!this.unsigned&&this.eq(R))return R;return this.not().add(w)};x.neg=x.negate;x.add=function e(t){if(!v(t))t=_(t);var i=this.high>>>16;var r=this.high&65535;var n=this.low>>>16;var s=this.low&65535;var a=t.high>>>16;var o=t.high&65535;var c=t.low>>>16;var d=t.low&65535;var l=0,u=0,h=0,f=0;f+=s+d;h+=f>>>16;f&=65535;h+=n+c;u+=h>>>16;h&=65535;u+=r+o;l+=u>>>16;u&=65535;l+=i+a;l&=65535;return y(h<<16|f,l<<16|u,this.unsigned)};x.subtract=function e(t){if(!v(t))t=_(t);return this.add(t.neg())};x.sub=x.subtract;x.multiply=function e(t){if(this.isZero())return S;if(!v(t))t=_(t);if(m){var i=m["mul"](this.low,this.high,t.low,t.high);return y(i,m["get_high"](),this.unsigned)}if(t.isZero())return S;if(this.eq(R))return t.isOdd()?R:S;if(t.eq(R))return this.isOdd()?R:S;if(this.isNegative()){if(t.isNegative())return this.neg().mul(t.neg());else return this.neg().mul(t).neg()}else if(t.isNegative())return this.mul(t.neg()).neg();if(this.lt(b)&&t.lt(b))return g(this.toNumber()*t.toNumber(),this.unsigned);var r=this.high>>>16;var n=this.high&65535;var s=this.low>>>16;var a=this.low&65535;var o=t.high>>>16;var c=t.high&65535;var d=t.low>>>16;var l=t.low&65535;var u=0,h=0,f=0,p=0;p+=a*l;f+=p>>>16;p&=65535;f+=s*l;h+=f>>>16;f&=65535;f+=a*d;h+=f>>>16;f&=65535;h+=n*l;u+=h>>>16;h&=65535;h+=s*d;u+=h>>>16;h&=65535;h+=a*c;u+=h>>>16;h&=65535;u+=r*l+n*d+s*c+a*o;u&=65535;return y(f<<16|p,u<<16|h,this.unsigned)};x.mul=x.multiply;x.divide=function e(t){if(!v(t))t=_(t);if(t.isZero())throw Error("division by zero");if(m){if(!this.unsigned&&this.high===-2147483648&&t.low===-1&&t.high===-1){return this}var i=(this.unsigned?m["div_u"]:m["div_s"])(this.low,this.high,t.low,t.high);return y(i,m["get_high"](),this.unsigned)}if(this.isZero())return this.unsigned?p:S;var r,n,s;if(!this.unsigned){if(this.eq(R)){if(t.eq(w)||t.eq(C))return R;else if(t.eq(R))return w;else{var a=this.shr(1);r=a.div(t).shl(1);if(r.eq(S)){return t.isNegative()?w:C}else{n=this.sub(t.mul(r));s=r.add(n.div(t));return s}}}else if(t.eq(R))return this.unsigned?p:S;if(this.isNegative()){if(t.isNegative())return this.neg().div(t.neg());return this.neg().div(t).neg()}else if(t.isNegative())return this.div(t.neg()).neg();s=S}else{if(!t.unsigned)t=t.toUnsigned();if(t.gt(this))return p;if(t.gt(this.shru(1)))return k;s=p}n=this;while(n.gte(t)){r=Math.max(1,Math.floor(n.toNumber()/t.toNumber()));var o=Math.ceil(Math.log(r)/Math.LN2),c=o<=48?1:u(2,o-48),d=g(r),l=d.mul(t);while(l.isNegative()||l.gt(n)){r-=c;d=g(r,this.unsigned);l=d.mul(t)}if(d.isZero())d=w;s=s.add(d);n=n.sub(l)}return s};x.div=x.divide;x.modulo=function e(t){if(!v(t))t=_(t);if(m){var i=(this.unsigned?m["rem_u"]:m["rem_s"])(this.low,this.high,t.low,t.high);return y(i,m["get_high"](),this.unsigned)}return this.sub(this.div(t).mul(t))};x.mod=x.modulo;x.rem=x.modulo;x.not=function e(){return y(~this.low,~this.high,this.unsigned)};x.and=function e(t){if(!v(t))t=_(t);return y(this.low&t.low,this.high&t.high,this.unsigned)};x.or=function e(t){if(!v(t))t=_(t);return y(this.low|t.low,this.high|t.high,this.unsigned)};x.xor=function e(t){if(!v(t))t=_(t);return y(this.low^t.low,this.high^t.high,this.unsigned)};x.shiftLeft=function e(t){if(v(t))t=t.toInt();if((t&=63)===0)return this;else if(t<32)return y(this.low<<t,this.high<<t|this.low>>>32-t,this.unsigned);else return y(0,this.low<<t-32,this.unsigned)};x.shl=x.shiftLeft;x.shiftRight=function e(t){if(v(t))t=t.toInt();if((t&=63)===0)return this;else if(t<32)return y(this.low>>>t|this.high<<32-t,this.high>>t,this.unsigned);else return y(this.high>>t-32,this.high>=0?0:-1,this.unsigned)};x.shr=x.shiftRight;x.shiftRightUnsigned=function e(t){if(v(t))t=t.toInt();if((t&=63)===0)return this;if(t<32)return y(this.low>>>t|this.high<<32-t,this.high>>>t,this.unsigned);if(t===32)return y(this.high,0,this.unsigned);return y(this.high>>>t-32,0,this.unsigned)};x.shru=x.shiftRightUnsigned;x.shr_u=x.shiftRightUnsigned;x.rotateLeft=function e(t){var i;if(v(t))t=t.toInt();if((t&=63)===0)return this;if(t===32)return y(this.high,this.low,this.unsigned);if(t<32){i=32-t;return y(this.low<<t|this.high>>>i,this.high<<t|this.low>>>i,this.unsigned)}t-=32;i=32-t;return y(this.high<<t|this.low>>>i,this.low<<t|this.high>>>i,this.unsigned)};x.rotl=x.rotateLeft;x.rotateRight=function e(t){var i;if(v(t))t=t.toInt();if((t&=63)===0)return this;if(t===32)return y(this.high,this.low,this.unsigned);if(t<32){i=32-t;return y(this.high<<i|this.low>>>t,this.low<<i|this.high>>>t,this.unsigned)}t-=32;i=32-t;return y(this.low<<i|this.high>>>t,this.high<<i|this.low>>>t,this.unsigned)};x.rotr=x.rotateRight;x.toSigned=function e(){if(!this.unsigned)return this;return y(this.low,this.high,false)};x.toUnsigned=function e(){if(this.unsigned)return this;return y(this.low,this.high,true)};x.toBytes=function e(t){return t?this.toBytesLE():this.toBytesBE()};x.toBytesLE=function e(){var t=this.high,i=this.low;return[i&255,i>>>8&255,i>>>16&255,i>>>24,t&255,t>>>8&255,t>>>16&255,t>>>24]};x.toBytesBE=function e(){var t=this.high,i=this.low;return[t>>>24,t>>>16&255,t>>>8&255,t&255,i>>>24,i>>>16&255,i>>>8&255,i&255]};n.fromBytes=function e(t,i,r){return r?n.fromBytesLE(t,i):n.fromBytesBE(t,i)};n.fromBytesLE=function e(t,i){return new n(t[0]|t[1]<<8|t[2]<<16|t[3]<<24,t[4]|t[5]<<8|t[6]<<16|t[7]<<24,i)};n.fromBytesBE=function e(t,i){return new n(t[4]<<24|t[5]<<16|t[6]<<8|t[7],t[0]<<24|t[1]<<16|t[2]<<8|t[3],i)}},{}],102:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:true});function r(e,t){if(!(e instanceof t)){throw new TypeError("Cannot call a class as a function")}}var n=function e(){r(this,e);this.items=[]};if(typeof n.prototype.push!=="function"){n.prototype.enqueue=function(){var e=arguments.length;if(e===0){return}for(var t=0;t<e;t++){this.items.push(arguments[t])}};n.prototype.dequeue=function(){var e=this.items.shift();return typeof e!=="undefined"?e:false};n.prototype.front=function(){return this.items[items.length-1]};n.prototype.isEmpty=function(){return this.items.length===0};n.prototype.size=function(){return this.items.length};n.prototype.clear=function(){this.items=[]};n.prototype.show=function(){return this.items};n.prototype.dequeueall=function(){var e=this.items;this.items=[];return e}}i.default=n},{}],103:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:true});var r=function(){function r(e,t){for(var i=0;i<t.length;i++){var r=t[i];r.enumerable=r.enumerable||false;r.configurable=true;if("value"in r)r.writable=true;Object.defineProperty(e,r.key,r)}}return function(e,t,i){if(t)r(e.prototype,t);if(i)r(e,i);return e}}();function n(e,t){if(!(e instanceof t)){throw new TypeError("Cannot call a class as a function")}}var s=function(){function e(){n(this,e);this.bytes=0;this.lgbytes=0;this.lgtime=0}r(e,[{key:"destroy",value:function e(){this.bytes=0;this.lgbytes=0;this.lgtime=0}},{key:"addbytes",value:function e(t){this.bytes+=t;if(this.lgtime==0){this.lgtime=(new Date).getTime()}}},{key:"getKBps",value:function e(){if(this.lgtime==0){return 0}var t=(new Date).getTime();var i=(this.bytes-this.lgbytes)/(t-this.lgtime)*.9765625;this.lgbytes=this.bytes;this.lgtime=t;return i}}]);return e}();i.default=s},{}]},{},[79])(79)});